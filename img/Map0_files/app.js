!function(e){function t(t){for(var n,s,o=t[0],l=t[1],c=t[2],d=0,p=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&p.push(i[s][0]),i[s]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(u&&u(t);p.length;)p.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],n=!0,o=1;o<a.length;o++){var l=a[o];0!==i[l]&&(n=!1)}n&&(r.splice(t--,1),e=s(s.s=a[0]))}return e}var n={},i={3:0},r=[];function s(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.e=function(e){var t=[],a=i[e];if(0!==a)if(a)t.push(a[2]);else{var n=new Promise((function(t,n){a=i[e]=[t,n]}));t.push(a[2]=n);var r,o=document.createElement("script");o.charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.src=function(e){return s.p+"dynamic_import_libs/"+({0:"JSZip",1:"MunicipalData",2:"ProvincialData",5:"moment",6:"pepjs"}[e]||e)+".min.js"}(e);var l=new Error;r=function(t){o.onerror=o.onload=null,clearTimeout(c);var a=i[e];if(0!==a){if(a){var n=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+n+": "+r+")",l.name="ChunkLoadError",l.type=n,l.request=r,a[1](l)}i[e]=void 0}};var c=setTimeout((function(){r({type:"timeout",target:o})}),12e4);o.onerror=o.onload=r,document.head.appendChild(o)}return Promise.all(t)},s.m=e,s.c=n,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(a,n,function(t){return e[t]}.bind(null,n));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="./",s.oe=function(e){throw e};var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;r.push([1830,4]),a()}({1:function(e,t,a){"use strict";a.d(t,"s",(function(){return n})),a.d(t,"t",(function(){return i})),a.d(t,"a",(function(){return r})),a.d(t,"e",(function(){return s})),a.d(t,"p",(function(){return o})),a.d(t,"i",(function(){return l})),a.d(t,"r",(function(){return c})),a.d(t,"o",(function(){return u})),a.d(t,"c",(function(){return d})),a.d(t,"j",(function(){return p})),a.d(t,"q",(function(){return h})),a.d(t,"l",(function(){return f})),a.d(t,"h",(function(){return m})),a.d(t,"g",(function(){return y})),a.d(t,"f",(function(){return g})),a.d(t,"b",(function(){return v})),a.d(t,"d",(function(){return S})),a.d(t,"k",(function(){return b})),a.d(t,"m",(function(){return I})),a.d(t,"n",(function(){return E}));var n={RESTMAP:"RESTMAP",WMS:"WMS",WMTS:"WMTS",RESTDATA:"RESTDATA",DATAFLOW:"DATAFLOW",GEOJSON:"GEOJSON",MAPBOXSTYLE:"MAPBOXSTYLE"},i=1e-7,r="DATAVIZ_THEME",s={POINT:"POINT",MUTLIPOINT:"POINT",LINESTRING:"LINE",MULTILINESTRING:"LINE",LINE:"LINE",LINEARRING:"LINE",MULTIPOLYGON:"POLYGON",POLYGON:"POLYGON",REGION:"POLYGON",CIRCLE:"POLYGON",TEXT:"TEXT",UNKNOWN:"UNKNOWN"},o={POINT:"POINT",MUTLIPOINT:"MUTLIPOINT",LINESTRING:"LINESTRING",MULTILINESTRING:"MULTILINESTRING",LINE:"LINE",LINEARRING:"LINEARRING",MULTIPOLYGON:"MULTIPOLYGON",POLYGON:"POLYGON",REGION:"REGION",TEXT:"TEXT",UNKNOWN:"UNKNOWN"},l={VECTOR_LAYER:"VECTOR_LAYER",REST_LAYER:"REST_LAYER",BASE_LAYER:"BASE_LAYER",VECTOR_TILE:"VECTOR_TILE",VECTOR:"VECTOR",TILE:"TILE",MAPBOXSTYLE:"MAPBOXSTYLE"},c={HEAT_MAP:"HEAT",VECTOR:"VECTOR",RANK_SYMBOL:"RANK_SYMBOL",RANGE:"RANGE",UNIQUE:"UNIQUE",MARKER:"MARKER",LABEL:"LABEL",GRAPHIC:"GRAPHIC",SYMBOL:"SYMBOL",DATAFLOW:"DATAFLOW_POINT_TRACK",DATAFLOWHEAT:"DATAFLOW_HEAT",MIGRATION:"MIGRATION"},u={TILE:"TILE",WMS:"WMS",WMTS:"WMTS"},d={STRING:"STRING",NUMBER:"NUMBER",DATE:"DATE",UNKNOWN:"UNKNOWN",LOCATION:"LOCATION",ORDER_NUMBER:"ORDER_NUMBER"},p={SUCCESS:"success",ERROR:"error",WARNING:"warning"},h={POINT:"supermapol-icons-Oval",LINE:"supermapol-icons-line-layer1",POLYGON:"supermapol-icons-polygon-layer1"},f={COORD:"byCoord",ADDRESS:"byAddress",DIVISION:"byDivision",CODING:"byCoding"},m={XLSX:"EXCEL",CSV:"CSV",JSON:"JSON",GEOJSON:"GEOJSON",SHP:"SHP"},y={xls:m.XLSX,xlsx:m.XLSX,XLS:m.XLSX,XLSX:m.XLSX,csv:m.CSV,CSV:m.CSV,json:m.JSON,JSON:m.JSON,geojson:m.GEOJSON,GEOJSON:m.GEOJSON,zip:"ZIP",ZIP:"ZIP",shp:m.SHP,SHP:m.SHP},g={SAMPLE:"SAMPLE",MYDATA:"MYDATA"},v={PORTAL_DATA:"PORTAL_DATA",SAMPLE_DATA:"SAMPLE_DATA",REST_DATA:"REST_DATA",REST_MAP:"REST_MAP",USER_DATA:"USER_DATA"},S={PROVINCE:"Province",CITY:"City",GB:"GB-T_2260"},b={IMAGE_POINT:"IMAGE_POINT",SVG_POINT:"SVG_POINT",BASIC_POINT:"BASIC_POINT",SYMBOL_POINT:"SYMBOL_POINT"},I=["HOSTED_TILE","HEAT","DATAFLOW_POINT_TRACK","DATAFLOW_HEAT","MAPBOXSTYLE","MIGRATION","BAIDU","GOOGLE","GOOGLE_CN","CLOUD","CLOUD_BLACK","OSM","BING","JAPAN_RELIEF","JAPAN_ORT","JAPAN_PALE","JAPAN_STD"],E={ERROR:"error",NOPERMISSION:"no-permission"}},105:function(e,t,a){"use strict";var n=a(41),i={CODE4326:"EPSG:4326",CODE3857:"EPSG:3857",CODE910111:"EPSG:3857",CODE910112:"EPSG:3857",BAIDU_BOUNDS:[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892],CLOUD_BOUNDS:[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892],TIANDITU_BOUNDS_3857:[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892],TIANDITU_BOUNDS_4326:[-180,-90,180,90],OSM_BOUNDS:[-20037508.34,-20037508.34,20037508.34,20037508.34],GOOGLE_BOUNDS:[-20037508.34,-20037508.34,20037508.34,20037508.34],BING_BOUNDS:[-20037508.34,-20037508.34,20037508.34,20037508.34],JAPAN_RELIEF_BOUNDS:[12555667.53929,1281852.98656,17525908.86651,7484870.70596],JAPAN_ORT_BOUNDS:[-19741117.14519,-10003921.36848,19981677.71404,19660983.56089],CHINA_DARK_URL:"https://maptiles.supermapol.com/iserver/services/map_China/rest/maps/China_Dark",getImagePath:function(e){return"./static/imgs/map/"+e},getMapInfo:function(e){var t=null;switch(e){case"BAIDU":t={iServerUrl:"https://map.baidu.com/",epsgCode:this.CODE910112,projection:this.CODE910112,layerType:"BAIDU",units:"m",minZoom:0,maxZoom:19,level:1,name:DataViz.Language.baiduMap,extent:this.BAIDU_BOUNDS,thumbnail:this.getImagePath("bmap.png")};break;case"CLOUD":t={url:"http://t2.dituhui.com/FileService/image?map=quanguo&type=web&x={x}&y={y}&z={z}",epsgCode:this.CODE910111,projection:this.CODE910111,layerType:"CLOUD",units:"m",minZoom:0,maxZoom:18,level:1,name:DataViz.Language.cloud,extent:this.CLOUD_BOUNDS,thumbnail:this.getImagePath("amap.png")};break;case"CLOUD_BLACK":t={url:"http://t3.dituhui.com/MapService/getGdp?x={x}&y={y}&z={z}",epsgCode:this.CODE910111,projection:this.CODE910111,layerType:"CLOUD_BLACK",units:"m",minZoom:1,maxZoom:18,level:1,name:DataViz.Language.cloudBlueBlack,extent:this.CLOUD_BOUNDS,thumbnail:this.getImagePath("blue-black.png")};break;case"TIANDITU_VEC_3857":t=this.getTianditu("vec",this.CODE3857);break;case"TIANDITU_VEC_4326":t=this.getTianditu("vec",this.CODE4326);break;case"TIANDITU_IMG_3857":t=this.getTianditu("img",this.CODE3857);break;case"TIANDITU_IMG_4326":t=this.getTianditu("img",this.CODE4326);break;case"TIANDITU_TER_3857":t=this.getTianditu("ter",this.CODE3857);break;case"TIANDITU_TER_4326":t=this.getTianditu("ter",this.CODE4326);break;case"OSM":t={url:"http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",epsgCode:this.CODE3857,projection:this.CODE3857,layerType:"OSM",units:"m",minZoom:0,maxZoom:19,level:1,name:DataViz.Language.osm,extent:this.OSM_BOUNDS,thumbnail:this.getImagePath("osm.png"),iserverUrl:"https://www.openstreetmap.org"};break;case"GOOGLE":var a=this.getGoogleMarkerLang();t={url:"https://maps.googleapis.com/maps/vt?pb=!1m5!1m4!1i{z}!2i{x}!3i{y}!4i256!2m3!1e0!2sm!3i540264686!3m12!2s".concat(a,"!3sUS!5e18!12m4!1e68!2m2!1sset!2sRoadmap!12m3!1e37!2m1!1ssmartmaps!4e0&key=").concat(n.a.dataVizConfig.googleMapsAPIKey),epsgCode:this.CODE910111,projection:this.CODE910111,layerType:"GOOGLE",units:"m",minZoom:0,maxZoom:22,level:1,name:DataViz.Language.google,extent:this.GOOGLE_BOUNDS,thumbnail:this.getImagePath("google.png"),iserverUrl:"http://www.google.cn/maps"};break;case"JAPAN_STD":t={url:"http://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",minZoom:0,maxZoom:19,epsgCode:this.CODE3857,projection:this.CODE3857,layerType:"JAPAN_STD",units:"m",level:0,name:DataViz.Language.japan_std,extent:this.GOOGLE_BOUNDS,thumbnail:this.getImagePath("japan-std.png")};break;case"JAPAN_PALE":t={url:"http://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png",epsgCode:this.CODE3857,projection:this.CODE3857,layerType:"JAPAN_PALE",units:"m",minZoom:2,maxZoom:19,level:2,name:DataViz.Language.japan_pale,extent:this.GOOGLE_BOUNDS,thumbnail:this.getImagePath("japan-pale.png")};break;case"JAPAN_RELIEF":t={url:"http://cyberjapandata.gsi.go.jp/xyz/relief/{z}/{x}/{y}.png",epsgCode:this.CODE3857,projection:this.CODE3857,layerType:"JAPAN_RELIEF",units:"m",minZoom:5,maxZoom:14,level:5,name:DataViz.Language.japan_relief,extent:this.JAPAN_RELIEF_BOUNDS,indexExtent:this.GOOGLE_BOUNDS,thumbnail:this.getImagePath("japan-relief.png")};break;case"GOOGLE_CN":t={url:"https://mt{0-3}.google.com/vt/lyrs=m&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",epsgCode:this.CODE910111,projection:this.CODE910111,layerType:"GOOGLE_CN",units:"m",minZoom:1,maxZoom:20,level:1,name:DataViz.Language.google,extent:this.GOOGLE_BOUNDS,thumbnail:this.getImagePath("google_cn.png"),iserverUrl:"http://www.google.cn/maps"};break;case"BING":t={url:"http://dynamic.t0.tiles.ditu.live.com/comp/ch/{quadKey}?it=G,TW,L,LA&mkt=zh-cn&og=109&cstl=w4c&ur=CN&n=z",epsgCode:this.CODE910111,projection:this.CODE910111,layerType:"BING",units:"m",minZoom:1,maxZoom:18,level:1,name:DataViz.Language.bing,extent:this.BING_BOUNDS,thumbnail:this.getImagePath("bing.png"),iserverUrl:"https://cn.bing.com/maps"};break;case"JAPAN_ORT":t={url:"http://cyberjapandata.gsi.go.jp/xyz/ort/{z}/{x}/{y}.jpg",epsgCode:this.CODE3857,projection:this.CODE3857,layerType:"JAPAN_ORT",units:"m",minZoom:2,maxZoom:12,level:2,name:DataViz.Language.japan_ort,extent:this.JAPAN_ORT_BOUNDS,indexExtent:this.GOOGLE_BOUNDS,thumbnail:this.getImagePath("japan-ort.png")};break;case"CHINA_DARK":t={url:this.CHINA_DARK_URL,epsgCode:this.CODE910111,projection:this.CODE910111,layerType:"CHINA_DARK",units:"m",minZoom:0,maxZoom:12,level:1,name:DataViz.Language.china_dark,extent:this.CLOUD_BOUNDS,thumbnail:this.getImagePath("china_dark.png"),visibleScales:[1.6901635716026555e-9,3.3803271432053056e-9,6.760654286410611e-9,1.3521308572821242e-8,2.7042617145642484e-8,5.408523429128511e-8,1.0817046858256998e-7,2.1634093716513974e-7,4.3268187433028044e-7,8.653637486605571e-7,17307274973211203e-22,34614549946422405e-22,69229099892844565e-22],coordUnit:"METER"}}return t},getTianditu:function(e,t){var a,n,i,r,s;"vec"===e?this.CODE4326===t?(a="tianditu_vec_4326.png",n="tianditu_vec_4326"):(a="tianditu_vec_3857.png",n="tianditu_vec_3857"):"img"===e?this.CODE4326===t?(a="tianditu_img_4326.png",n="tianditu_img_4326"):(a="tianditu_img_3857.png",n="tianditu_img_3857"):"ter"===e&&(s=14,this.CODE4326===t?(a="tianditu_ter_4326.png",n="tianditu_ter_4326"):(a="tianditu_ter_3857.png",n="tianditu_ter_3857")),this.CODE3857===t?(i="m",r=this.TIANDITU_BOUNDS_3857):(i="degrees",r=this.TIANDITU_BOUNDS_4326);var o=DataViz.Language[n];return a=this.getImagePath(a),{iserverUrl:"http://map.tianditu.gov.cn/",layerType:n&&n.toUpperCase(),epsgCode:t,projection:t,units:i,minZoom:0,maxZoom:s||19,level:1,name:o,extent:r,thumbnail:a}},getGoogleMarkerLang:function(){var e;switch(window.lang){case"zh":e="zh-CN";break;case"ar":e="ar-EG";break;case"bg":e="bg-BG";break;case"ca":e="ca-ES";break;case"cs":e="cs-CZ";break;case"da":e="da-DK";break;case"de":e="de-DE";break;case"el":e="el-GR";break;case"es":e="es-ES";break;case"et":e="et-EE";break;case"fa":e="fa-IR";break;case"fl":e="fi-FI";break;case"fr":e="fr-FR";break;case"he":e="he-IL";break;case"hu":e="hu-HU";break;case"id":e="id-ID";break;case"is":e="is-IS";break;case"it":e="it-IT";break;case"ja":e="ja-JP";break;case"ko":e="ko-KR";break;case"ku":e="ku-IQ";break;case"mn":e="mn-MN";break;case"nb":e="nb-NO";break;case"ne":e="ne-NP";break;case"nl":e="nl-NL";break;case"pl":e="pl-PL";break;case"pt":e="pt-PT";break;case"ru":e="ru-RU";break;case"sk":e="sk-SK";break;case"sl":e="sl-SI";break;case"sr":e="sr-RS";break;case"sv":e="sv-SE";break;case"th":e="th-TH";break;case"tr":e="tr-TR";break;case"uk":e="uk-UA";break;case"vi":e="vi-VN";break;default:e="en-US"}return e}};t.a=i},107:function(e,t,a){"use strict";var n=a(81),i=a.n(n),r=(a(28),a(30),a(27),a(18),a(71),a(335)),s=a.n(r),o={getWebmapPopupElements:function(e){var t=[];return(e=e.filter((function(e){return e.infos&&e.infos.length>0}))).forEach((function(a,n){a.infos&&a.infos.length>0&&("MEDIA"===a.type?a.infos.forEach((function(e){t.push({type:e.type,title:e.title,value:e.value})})):"FIELD"===a.type?a.infos.forEach((function(e){t.push({type:e.type,fieldName:e.fieldName})})):"TEXT"===a.type&&a.infos.length>0&&t.push(a),n!==e.length-1&&t.push({type:"DIVIDER"}))})),t},getDefaultPopupInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=e.map((function(e){return{type:"FIELD",fieldName:e}}));return{title:t,elements:a}},getDefaultConfigElements:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((function(e){return{type:"FIELD",fieldName:e}}));return[{type:"FIELD",infos:t}]},changeArrayIndex:function(e,t,a){var n=a[e];return e>t?(a.splice(t,0,n),a.splice(e+1,1)):(a.splice(t+1,0,n),a.splice(e,1)),a},getFieldInfos:function(e,t){return e.filter((function(e){return t.includes(e)})).map((function(e){return{type:"FIELD",fieldName:e}}))},createSortable:function(e,t){var a=document.querySelector(e);if(a)return s.a.create(a,{animation:100,handle:".handle",onEnd:function(e){e.oldIndex!==e.newIndex&&t&&t(e.oldIndex,e.newIndex)}})},getLayoutConfigElements:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=[];return e.forEach((function(e){if(e){var n=[];if(e.rangeIndex.length>0){var r=t.slice(e.rangeIndex[0],e.rangeIndex[1]+1);n.push.apply(n,i()(r))}"FIELD"===e.type?a.push({type:"FIELD",sortsFields:e.sortsFields,infos:n}):"TEXT"===e.type?a.push({type:"TEXT",infos:n[0]?n[0].infos:[]}):"MEDIA"===e.type&&a.push({type:"MEDIA",infos:n})}})),a},getSaveConfigElements:function(e){var t=[],a=0;return e.forEach((function(e){if(e){var n=[];if(e.infos.length>0){var i=a,r="TEXT"===e.type?i:i+e.infos.length-1;a=r+2,n=[i,r]}"FIELD"===e.type?t.push({type:e.type,rangeIndex:n,sortsFields:e.sortsFields}):"TEXT"!==e.type&&"MEDIA"!==e.type||t.push({type:e.type,rangeIndex:n})}})),t}};t.a=o},12:function(e,t,a){"use strict";a(28),a(30),a(20);var n=a(51),i=a.n(n),r=a(325),s=a.n(r),o=(a(73),a(1)),l=a(2),c=a(26),u=a.n(c),d=(a(253),a(17)),p=a.n(d),h=(a(32),a(18),a(87),a(25)),f=a.n(h),m=(a(14),a(7)),y=a.n(m),g=a(6),v=a.n(g),S=a(9),b=a.n(S),I=a(8),E=a.n(I),T=a(11),C=a.n(T),L=a(10),N=a.n(L),k=a(0),O=a.n(k),D=a(13),w=a.n(D),A=a(61),F=a(47),M=a(56),R=a(5),x=a(24),P=a(221),V=a.n(P),B=a(33),U=a(164),G=(a(1429),window.DataViz.Language),_=null,z=function(e){function t(e){var a;y()(this,t),a=b()(this,E()(t).call(this,e)),_=C()(a),a.state={checkLists:e.layerInfo?[e.layerInfo.id]:[],fileName:e.layerInfo.name,type:"GeoJson"},a.layers=R.a.vectorLayers,a.disableLayer=[],a.names=[],a.count=0,a.addLayer=a.addLayer.bind(C()(a)),a.addAllLayers=a.addAllLayers.bind(C()(a)),a.changeType=a.changeType.bind(C()(a));var n=C()(a);return a.config={modalWidth:"416px",modalHeight:"350px",modalTitle:G.output,okButton:G.output,okCallBack:function(){"GeoJson"===n.state.type||"Json"===n.state.type?n.outputGeojson(n.state.type):n.outputCSV(),n.modalBox.hideModal()},cancelCallBack:function(){n.modalBox.hideModal()}},a}var n,i;return N()(t,e),v()(t,[{key:"initState",value:function(e){this.setState({checkLists:e.layerInfo?[e.layerInfo.id]:[],fileName:e.layerInfo.name,type:"GeoJson"}),this.layers=R.a.vectorLayers,this.disableLayer=[]}},{key:"outputGeojson",value:(i=f()(p.a.mark((function e(t){var n,i,r,s,o,l,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r="GeoJson"===t?".geojson":".json",!(this.state.checkLists.length>1)){e.next=11;break}return e.next=4,a.e(0).then(a.t.bind(null,2035,7));case 4:s=e.sent,o=s.default,l=new o,this.state.checkLists.forEach((function(e){if(n=R.a.getVectorLayerById(e),(i=n&&n.features)&&i.length>0){var t=this.getGeojsonFromFeature(i),a=new Blob([t],{type:"application/geojson;charset=UTF-8"}),s=n.layerInfo.name;this.names.indexOf(s)>-1&&(s+=++this.count),s="".concat(s).concat(r),this.names.push(n.layerInfo.name),l.file(s,a)}}),this),this.downloadZip(l),e.next=14;break;case 11:n=R.a.getVectorLayerById(this.state.checkLists[0]),(i=n&&n.features)&&i.length>0&&(c=this.getGeojsonFromFeature(i),V.a.saveAs(new Blob([c],{type:"application/geojson;charset=UTF-8"}),this.state.fileName+r));case 14:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getGeojsonFromFeature",value:function(e){var t=[];e.forEach((function(e){var a,n={type:"Feature"},i=R.a.getBaseLayerProj();if("EPSG:4326"!==i){var r=e.getGeometry().clone();a=(r=r.transform(i,"EPSG:4326")).getCoordinates()}else a=e.getGeometry().getCoordinates();for(var s in n.properties=e.get("attributes")||{},delete n.properties.dataviz_featureID,n.properties)void 0!==n.properties[s]&&null!==n.properties[s]||(n.properties[s]="");n.geometry={type:e.getGeometry().getType(),coordinates:a},t.push(n)}));var a={type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:t};return JSON.stringify(a)}},{key:"outputCSV",value:(n=f()(p.a.mark((function e(){var t,n,i,r,s,o,l,c,u;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!0,r="",!(this.state.checkLists.length>1)){e.next=11;break}return e.next=4,a.e(0).then(a.t.bind(null,2035,7));case 4:s=e.sent,o=s.default,l=new o,this.state.checkLists.forEach((function(e){if(t=R.a.getVectorLayerById(e),n=this.judgeLonlatAttribute(t.layerInfo),(i=t&&t.features)&&i.length>0){var a=i[0].get("attributes")||{};delete a.dataviz_featureID;var s=Object.getOwnPropertyNames(a);r=x.a.createCSVTitle(s,n),r+=x.a.geCSVValue(s,i,n);var o=new Blob([r],{type:"text/csv;charset=UTF-8"}),c=t.layerInfo.name;this.names.indexOf(c)>-1&&(c+=++this.count),c+=".csv",this.names.push(t.layerInfo.name),l.file(c,o)}}),this),this.downloadZip(l),e.next=15;break;case 11:t=R.a.getVectorLayerById(this.state.checkLists[0]),n=this.judgeLonlatAttribute(t.layerInfo),(i=t&&t.features)&&i.length>0&&(delete(c=i[0].get("attributes")||{}).dataviz_featureID,u=Object.getOwnPropertyNames(c),r=x.a.createCSVTitle(u,n),r+=x.a.geCSVValue(u,i,n),V.a.saveAs(new Blob([r],{type:"text/csv;charset=UTF-8"}),this.state.fileName+".csv"));case 15:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"judgeLonlatAttribute",value:function(e){return!(e.layerType===o.r.MARKER||e.cityField||e.dataSource&&"REST_MAP"===e.dataSource.type)}},{key:"initNames",value:function(){this.names=[],this.count=0}},{key:"downloadZip",value:function(e){var t=this.state.fileName;e.generateAsync({type:"blob"}).then((function(e){V.a.saveAs(e,t)})),this.initNames()}},{key:"addLayer",value:function(){var e=this.state.checkLists;this.setState({checkLists:e,fileName:this.getFileName(e)})}},{key:"addAllLayers",value:function(e){var t=[];e.target.checked&&this.layers.forEach((function(e){"CSV"===this.state.type&&this.disableLayer.indexOf(e.layerInfo.id)>-1||t.push(e.layerInfo.id)}),this),this.setState({checkLists:t,fileName:this.getFileName(t)})}},{key:"getFileName",value:function(e){var t,a=R.a.getVectorLayerById(e[0]);switch(e.length){case 0:t="";break;case 1:t=a.layerInfo.name;break;default:t=a.layerInfo.name+G.etc+e.length+G.layerManagement}return t}},{key:"changeType",value:function(e){"CSV"===e?this.layers.forEach((function(e){this.isDisable(e)&&this.disableLayer.push(e.layerInfo.id)}),this):this.disableLayer=[],this.setState({type:e,fileName:this.getFileName(this.state.checkLists)})}},{key:"isDisable",value:function(e){if("VECTOR"===e.layerInfo.layerType&&"POINT"!=e.layerInfo.featureType)return this.removeCheckState(e.layerInfo.id),!0;if("MARKER"===e.layerInfo.layerType){var t=e.features;if(!t||t.length<=0)return!1;var a=t.some((function(e){return"Point"!=e.getGeometry().getType()}));return a&&this.removeCheckState(e.layerInfo.id),a}}},{key:"removeCheckState",value:function(e){var t=this.state.checkLists;t.forEach((function(a,n){e===a&&t.splice(n,1)}),this),this.setState()}},{key:"getLayers",value:function(){var e,t=[];return this.layers.forEach((function(a,n){e="CSV"===this.state.type?this.disableLayer.indexOf(a.layerInfo.id)>-1:null,t.push(O.a.createElement(M.a,{name:a.layerInfo.id,key:n,disabled:e},O.a.createElement("span",{className:e?"disable":""},a.layerInfo.name)))}),this),t}},{key:"render",value:function(){var e=this;return O.a.createElement(A.a,u()({},this.config,{ref:function(t){e.modalBox=t},disableConfirm:0===this.state.checkLists.length}),O.a.createElement("div",{className:"output-modal"},O.a.createElement("div",null,O.a.createElement("div",{className:"name"},G.outputType),O.a.createElement(F.b,{selectedValue:this.state.type,onChange:this.changeType},O.a.createElement(F.a,{value:"CSV"},"CSV"),O.a.createElement(F.a,{value:"GeoJson"},"GeoJSON"),O.a.createElement(F.a,{value:"Json"},"JSON")),O.a.createElement("span",{className:"supermapol-icons-error"},G.outputCSVTips)),O.a.createElement(U.a,{title:G.fileName,inputValue:this.state.fileName,onChange:function(t){t&&e.setState({fileName:t})}}),O.a.createElement("div",null,O.a.createElement("div",{className:"name"},G.layerManagement),O.a.createElement("div",{className:"layer-lists"},O.a.createElement("div",{className:"head"},O.a.createElement(M.a,{name:"selectAll",onChange:this.addAllLayers,disabled:this.disableLayer.length===this.layers.length,checked:this.layers.length-this.disableLayer.length===this.state.checkLists.length},G.selectTips)),O.a.createElement("div",{className:"content"},O.a.createElement(B.Scrollbars,{className:"scroll-bars"},O.a.createElement(M.b,{checkLists:this.state.checkLists,onChange:this.addLayer},this.getLayers())))))))}}]),t}(k.Component);z.getInstance=function(){var e=document.createElement("div");return e.className+="dataViz-output-modal",document.body.appendChild(e),{show:function(t){w.a.render(O.a.createElement(z,t),e),_.modalBox.showModal(),_.initState(t)}}};var j,W,H=z,Y=(a(43),a(45)),K=a(85),X=a(431),q=a(193),J=(a(620),window.DataViz.Language),Z=function(e){function t(e){var a;return y()(this,t),(a=b()(this,E()(t).call(this,e))).state={selectedTab:0,isShow:!0},a.close=a.close.bind(C()(a)),a}return N()(t,e),v()(t,[{key:"close",value:function(){this.setState({isShow:!1}),j=!1}},{key:"getContainer",value:function(){var e,t,a;switch(this.state.selectedTab){case 0:e=O.a.createElement(X.a,{feature:this.props.feature,layerId:W,style:Y.a.getLayerStyle(W,"POINT")});break;case 1:t=Y.a.getLayerStyle(W,"LINESTRING")||Object.assign({},K.a.lineStyle),a=K.a.getUIConfig(t,"LineString"),e=O.a.createElement(q.a,{type:"LineString",config:a,feature:this.props.feature,style:t});break;default:t=Y.a.getLayerStyle(W,"POLYGON")||Object.assign({},K.a.polygonStyle),a=K.a.getUIConfig(t,"Polygon"),e=O.a.createElement(q.a,{type:"Polygon",config:a,feature:this.props.feature,style:t})}return e}},{key:"render",value:function(){var e=this;return O.a.createElement("div",{className:"marker-feature-pop",style:{display:j||this.state.isShow?"block":"none"}},O.a.createElement("div",{className:"marker-pop-head"},O.a.createElement("div",null,J.markerLayerEdit),O.a.createElement("span",{className:"supermapol-icons-close",onClick:this.close})),O.a.createElement("div",{className:"marker-pop-content"},O.a.createElement("div",{className:"head"},O.a.createElement("div",{className:0===this.state.selectedTab?"active tab":"tab",onClick:function(){e.setState({selectedTab:0})}},J.pointStyle),O.a.createElement("div",{className:1===this.state.selectedTab?"active tab":"tab",onClick:function(){e.setState({selectedTab:1})}},J.lineStyle),O.a.createElement("div",{className:2===this.state.selectedTab?"active tab":"tab",onClick:function(){e.setState({selectedTab:2})}},J.polygonStyle)),this.getContainer()),O.a.createElement("div",{className:"marker-pop-foot"},O.a.createElement("div",{className:"confirm",onClick:this.close},J.okButton)))}}]),t}(k.Component);Z.getInstance=function(){var e=document.createElement("div");return e.className="dataViz-marker-layer-popup",document.body.appendChild(e),{show:function(t){j=!0,e.style.left="45%",e.style.top="20%",W=t.layerId,Y.a.setLayerId(W),w.a.render(O.a.createElement(Z,t),e)}}};var Q=Z,$=(a(443),function(e){function t(e){var a;y()(this,t),(a=b()(this,E()(t).call(this,e))).state={isCheck:!1};var n=C()(a);return a.okCallBack=a.props.callback,a.checkBoxContent=a.props.config.checkBoxContent,n.config={modalWidth:"484px",modalTitle:e.config.modalTitle,okButton:e.config.okButton,hideCancelBtn:e.config.hideCancelBtn,okCallBack:n.clickOkButton.bind(n),cancelCallBack:function(){n.isHandle=!1,n.refs.modal.hideModal()}},a}return N()(t,e),v()(t,[{key:"componentWillReceiveProps",value:function(e){e&&(e.config&&(this.config=Object.assign({},this.config,e.config),null!=this.config.isCheck&&this.config.isCheck!==this.state.isCheck&&this.setState({isCheck:this.config.isCheck})),e.callback!==this.props.callback&&(this.okCallBack=e.callback,this.checkBoxContent=e.config.checkBoxContent))}},{key:"clickOkButton",value:function(){this.refs.modal.hideModal(),this.okCallBack&&(this.checkBoxContent?this.okCallBack(this.state.isCheck):this.okCallBack())}},{key:"getChildren",value:function(){if(this.props.config.children&&0!==this.props.config.children.length){if(Array.isArray(this.props.config.children)){var e=[];return this.props.config.children.forEach((function(t,a){e.push(O.a.createElement("p",{key:a},t))})),e}return this.props.config.children}}},{key:"render",value:function(){var e=this;return O.a.createElement(A.a,u()({},this.config,{ref:"modal",modalIsOpen:!0,parentSelector:function(){return document.querySelector(".dataViz-delete-marker")}}),O.a.createElement("div",{className:"delete-marker"},O.a.createElement("span",{className:this.props.config.hideIcon?"":"supermapol-icons-layer-info"}),O.a.createElement("span",null,this.props.config.content),this.getChildren(),this.props.config.checkBoxContent?O.a.createElement(M.a,{className:this.state.isCheck?"delete-checkbox active":"delete-checkbox",checked:this.state.isCheck,onChange:function(t){e.setState({isCheck:t.target.checked})}},this.props.config.checkBoxContent):null))}}]),t}(k.Component));$.getInstance=function(){var e=document.createElement("div");return e.className="dataViz-delete-marker",document.body.appendChild(e),{show:function(t){w.a.render(O.a.createElement($,t),e)}}};var ee=$,te=a(217),ae=a.n(te),ne=a(82),ie=(a(1595),a(21)),re=(a(677),window.DataViz.Language),se={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",transform:"translate(-50%, -50%)",padding:"0",border:"0"}},oe=function(e){function t(e){var a;return y()(this,t),(a=b()(this,E()(t).call(this,e))).state={show:e.show},a.onLogin=a.onLogin.bind(C()(a)),a.loginSuccess=a.loginSuccess.bind(C()(a)),a}return N()(t,e),v()(t,[{key:"openPermissionModal",value:function(){this.setState({show:!0})}},{key:"closePermissionModal",value:function(){this.setState({show:!1})}},{key:"onLogin",value:function(){Ie.showLoinBox({onSucceed:this.loginSuccess})}},{key:"loginSuccess",value:function(){var e=this.props.openAppParams;if(e){var t=e.isMap,a=e.url,n=e.id,i=e.name,r=this;Ie.checkMapPermission({isMap:t,url:a,id:n,name:i},(function(){r.closePermissionModal(),ne.a.open(t,a,n)}))}}},{key:"createNewMap",value:function(){var e="".concat(l.a.getRootUrl(),"apps/dataviz/edit.html");window.open(e,"_blank")}},{key:"render",value:function(){return O.a.createElement(ae.a,{shouldFocusAfterRender:!0,shouldReturnFocusAfterClose:!1,isOpen:this.state.show,parentSelector:function(){return document.querySelector(".dataViz-permission-box")},style:se},O.a.createElement("div",{className:"dv-permission-content"},O.a.createElement("div",{className:"dv-no-permission-img"}),O.a.createElement("div",{className:"dv-permission-tip"},re.noPermissionOr404),O.a.createElement("div",{className:"dv-permission-try-tip"},O.a.createElement(ie.b,{theme:"primary",type:"empty",onClick:this.onLogin},re.login),re.or,O.a.createElement(ie.b,{theme:"primary",type:"empty",onClick:this.createNewMap},re.create),re.createNewMap)))}}]),t}(k.Component);oe.getInstance=function(){var e=document.createElement("div");return e.className="dataViz-permission-box",document.body.appendChild(e),{show:function(t){w.a.render(O.a.createElement(oe,t),e)},close:function(){w.a.unmountComponentAtNode(e)}}};var le=oe,ce=a(154),ue=(a(623),function(e){function t(e){return y()(this,t),b()(this,E()(t).call(this,e))}return N()(t,e),v()(t,[{key:"render",value:function(){return O.a.createElement("div",null,O.a.createElement("div",{className:"loading-background"},O.a.createElement(ce.a,null),O.a.createElement("div",{className:"loading-tip"},this.props.content)))}}]),t}(k.Component));ue.getInstance=function(){var e=document.createElement("div");return e.className+="dataViz-loading-box",document.body.appendChild(e),{show:function(t){w.a.render(O.a.createElement(ue,t),e)},close:function(){w.a.unmountComponentAtNode(e)}}};var de=ue,pe=(a(1596),a(328)),he=H.getInstance(),fe=Q.getInstance(),me=ee.getInstance(),ye=le.getInstance(),ge=de.getInstance(),ve=ie.i.getInstance(),Se=window.DataViz.Language,be={showMessage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.j.ERROR,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;return ve.show(e,t,a)},updateMessage:function(e){return ve.show(e)},changeMessage:function(e,t,a){var n,i=DataViz.Language,r=this;e===t?(n=(n=(n=(n=i.finishLoadDatas).replace(/{successCount}/,t-a)).replace(/{total}/,t)).replace(/{faildCount}/,a),be.updateMessage(n),setTimeout((function(){r.closeMessage()}),3e3)):(n=(n=(n=i.loadData).replace(/{count}/,e)).replace(/{total}/,t),be.updateMessage(n))},closeMessage:function(){return ve.close()},showLoadingBox:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DataViz.Language.loadingData;return ge.show({content:e})},closeLoadingBox:function(){return ge.close()},showOutputModal:function(e){return he.show({layerInfo:e})},showMarkerLayerPop:function(e){return fe.show({layerId:e})},showConfirmModal:function(e,t){return me.show({config:e,callback:t})},showLoinBox:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSucceed,a=s()(e,["onSucceed"]);new pe.a(i()({loginOptions:{lang:window.lang,theme:window.DataViz.theme,logoUrl:window.dataVizConfig.logoUrl,appName:Se.DataVizHtml.DataViz},onSucceed:function(e){var a="localStorage"in window&&window.localStorage.getItem(o.a)?window.localStorage.getItem(o.a):l.a.getAppTheme(e.data.user.theme);l.a.changeTheme(a),l.a.actions.changeLoginStatus(!0),be.showMessage(DataViz.Language.loginSuccess,o.j.SUCCESS),t&&t(e)}},a)).create()},showPermissionModal:function(e){ye.show({show:!0,openAppParams:e})},closePermissionModal:function(){ye.close()},checkMapPermission:function(e,t){var a=e.isMap,n=e.url,i=e.id,r=e.name;l.a.checkUserPermission([i],r?"SERVICE":"MAP").then((function(e){var r=e[i];["READWRITE","DELETE"].includes(r)?(l.a.actions.changeMapShare("DELETE"!==r),t&&t()):(be.showMessage(Se.noPermissionOr404),be.showPermissionModal({isMap:a,url:n,id:i}))}))}},Ie=t.a=be},125:function(e,t,a){"use strict";a.d(t,"c",(function(){return n})),a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return r}));var n=[["#D53E4F","#FC8D59","#FEE08B","#FFFFBF","#E6F598","#99D594","#3288BD"],["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#D0587e"],["#009b9e","#42b7b9","#a7d3d4","#f1f1f1","#e4c1d9","#d691c1","#c75dab"],["#a16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],["#762a83","#af8dc3","#e7d4e8","#f5f5f5","#d9f0d3","#7fbf7b","#1b7837"],["#c51b7d","#e9a3c9","#fde0ef","#f5f5f5","#e6f5d0","#a1d76a","#4d9221"],["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],["#e9f013","#b3b3b3","#408000","#000080","#0d3069","#ababab","#fffcff"],["#2ca121","#b1e086","#1777b6","#9ccbd5","#fd9997","#e614da","#ffc068","#ff7f00","#cab1d7"],["#8bd3c7","#ffffaf","#beb9db","#fd7f6f","#7eb0d5","#ffb55a","#b2e061","#fdcce5","#d9d9d9"],["#fdb4ad","#b2cde4","#cbecc4","#decae5","#ffdaa3","#ffffca","#e5d8bc","#fedaec","#f2f2f2"],["#a8071a","#f53b44","#ff7a45","#ffc069","#ffe58f","#b7eb8f","#5cdbd3","#40a9ff","#2f54eb","#531dab"],["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#F97B72","#4B4B8F","#A5AA99"],["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"]],i=[["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#e84a40"],["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0D585F"],["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],["#f2f0f7","#dadae8","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],["#e6f66b","#ace373","#78cd7c","#4cb483","#2b9b85","#1d8d7f","#246672","#2b4c5e","#2b3446"],["#fd8882","#e37982","#c66c80","#a9617b","#8b5672","#6e4c67","#534159","#3a364a","#252a39"],["#5ffbd0","#4be0c4","#3dc4b7","#34aaa6","#308f94","#2c7680","#295e6a","#234654","#1c313d"],["#fd906d","#E38161","#ca7256","#b2634b","#9a5540","#824735","#6c3a2b","#562d21","#412117"],["#56f8fe","#4cdee3","#43c4c9","#39abb0","#309397","#277c7f","#1f6568","#164f51","#0e3a3c"],["#fdbefc","#e2a9e1","#c896c7","#af82ae","#966f95","#7e5d7d","#674b66","#503a50","#3b2a3b"],["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],["#fcfbfd","#efedf5","#dadae8","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]],r=[["#f0edb6","#e0831f","#910909"],["#80ffff","#2ea7f2","#000068"],["#9999ff","#99ffff","#ff9999","#ffff99"],["#9766bf","#c9adad","#b5addd","#93a9dd","#74a9e1"],["#0000ff","#00ffff","#00ff00","#ffff00","#ff0000"],["#814bab","#821498","#d53448","#fdd944","#ffffff"],["#636cea","#1b1dd5","#be1c4d","#f79390","#ffffcc"],["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#70027f","#bf5b17"],["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#d2212d","#fdbf6f"],["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],["#e9f013","#b3b3b3","#408000","#000080","#0d3069","#ababab","#fffcff"],["#b0b0b0","#0000ff","#00a6ff","#00ff00","#00ffff","#ff0000","#ffa600","#ff00ff","#0000ff"],["#531dab","#2f54eb","#40a9ff","#5cdbd3","#b7eb8f","#ffe58f","#ffc069","#ff7a45","#f53b44","#a8071a"],["#a8071a","#f53b44","#ff7a45","#ffc069","#ffe58f","#b7eb8f","#5cdbd3","#40a9ff","#2f54eb","#531dab"]]},137:function(e,t,a){"use strict";a(43),a(28),a(30),a(252),a(71),a(18);var n=a(2),i=a(57),r={getWMTSScales:function(e,t,a){for(var n=(new ol.format.WMTSCapabilities).read(t).Contents.TileMatrixSet,i=[],r=0;r<n.length;r++)if(n[r].Identifier===e){for(var s=0;s<n[r].TileMatrix.length;s++)i.push(n[r].TileMatrix[s].ScaleDenominator);break}return i},getWMTSTileGrid:function(e,t,a,n){var i=this.getReslutionsFromScales(t,n,a);return new ol.tilegrid.WMTS({extent:e,resolutions:i.res,matrixIds:i.matrixIds})},getReslutionsFromScales:function(e,t,a){a=a&&a.toLowerCase()||"m",t=t||90.6;var i=[],r=[];return n.a.isArray(e)&&e&&e.forEach((function(e,n){e>1&&(r.push(n),i.push(this.getResolutionFromScale(e,t,a)))}),this),{res:i,matrixIds:r}},getResolutionFromScale:function(e,t,a){return e=1/(e=+e),"degrees"===a||"dd"===a||"degree"===a?254/t/e/(2*Math.PI*6378137/360)/1e4:254/t/e/1e4},getParamsFromWMTSCapabilities:function(e,t,a){var r=t.layer,s=t.tileMatrixSet,o=t.requestEncoding,l=t.style,c=e.Contents,u=c.TileMatrixSet,d=c.Layer,p="default",h=d.filter((function(e){return e.Identifier===r}));if(0===h.length)throw new Error("cant find wmts layer");var f=h[0],m=f.Format[0];l||f&&f.Style&&f.Style.forEach((function(e){e.isDefault&&(p=e.Identifier)}));var y=[],g=[],v=u.filter((function(e){return e.Identifier===s}))[0],S=v.SupportedCRS,b=S.lastIndexOf(":"),I="EPSG:".concat(S.substring(b+1));a&&n.a.isSupportedEpsg(a,I)&&(I=a);for(var E=0;E<v.TileMatrix.length;E++)y.push(v.TileMatrix[E].ScaleDenominator),g.push(v.TileMatrix[E].Identifier);var T=v.TileMatrix[0].TopLeftCorner;T=["EPSG:4326","EPSG:4490"].includes(I)?[T[1],T[0]]:T;var C,L=f.WGS84BoundingBox;L?(L[0]<-180&&(L[0]=-180),L[1]<-90&&(L[1]=-90),L[2]>180&&(L[2]=180),L[3]>90&&(L[3]=90),C=ol.proj.transformExtent(L,"EPSG:4326",I)):C=ol.proj.get(projection).getExtent();var N=!o||"KVP"===o.toUpperCase(),k=i.a.getTileUrl(e.OperationsMetadata.GetTile.DCP.HTTP.Get,f,m,N);return Object.assign(t,{tileUrl:k,extent:C,format:m,projection:I,scales:y,matrixIds:g,origin:T,identifier:s,style:p})},isKvp:function(e){return!e||"KVP"===e.toUpperCase()}};t.a=r},1425:function(e,t,a){},1426:function(e,t,a){},1427:function(e,t,a){},1429:function(e,t,a){},150:function(e,t,a){"use strict";a(18),a(43);var n=a(2),i=a(16),r=a(1),s={defaultStyle:{MARKER:{src:n.a.getRootUrl()+"apps/dataviz/static/imgs/markers/mark_red.png",scale:1,anchor:[.5,.5],imgWidth:48,imgHeight:43},CIRCLE:{radius:6,fillColor:"#53C41A",fillOpacity:1,strokeColor:"#0081E2",strokeOpacity:1,strokeWidth:1,lineCap:"round",lineDash:"solid"},LINE:{strokeColor:"#0081E2",strokeOpacity:1,strokeWidth:5,lineCap:"round",lineDash:"solid"},LINESTRING:{strokeColor:"#0081E2",strokeOpacity:1,strokeWidth:5,lineCap:"round",lineDash:"solid"},MULTILINESTRING:{strokeColor:"#0081E2",strokeOpacity:1,strokeWidth:5,lineCap:"round",lineDash:"solid"},REGION:{fillColor:"#53C41A",fillOpacity:.35,strokeColor:"#0081E2",strokeOpacity:1,strokeWidth:3,lineCap:"round",lineDash:"solid"},POLYGON:{fillColor:"#53C41A",fillOpacity:.35,strokeColor:"#0081E2",strokeOpacity:1,strokeWidth:3,lineCap:"round",lineDash:"solid"},MULTIPOLYGON:{fillColor:"#53C41A",fillOpacity:.35,strokeColor:"#0081E2",strokeOpacity:1,strokeWidth:3,lineCap:"round",lineDash:"solid"},TEXT:{text:DataViz.Language.markerText,font:"13px Microsoft YaHei",textAlign:"left",fillColor:"#595959",backgroundFill:"#FFFFFF",borderColor:"rgba(255,255,255,0)",borderWidth:4,canvas:null,maxWidth:358}},getDefaultStyle:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t?Object.assign({},this.defaultStyle[e]):this.defaultStyle[e]},getDefaultAttribute:function(){return{dataViz_title:"",dataViz_description:"",dataViz_imgUrl:"",dataViz_url:"",dataViz_videoUrl:""}},setEachFeatureDefaultStyle:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0;(e=n.a.isArray(e)||e instanceof ol.Collection?e:[e]).forEach((function(e){var n=r.e[e.getGeometry().getType().toUpperCase()],s=n===r.p.POINT?"MARKER":n,o=t||e.getProperties().useStyle||this.getDefaultStyle(s);"POINT"===n&&o.text&&(n=r.p.TEXT);var l=this.setFeatureInfo(e);e.setProperties({useStyle:o,attributes:l}),e.layerId=a,e.setStyle(i.a.toOpenLayersStyle(o,n))}),this)},setFeatureInfo:function(e){var t=e.getProperties().attributes,a=this.getDefaultAttribute(),n=Object.assign(a,t),i=e.getProperties();for(var r in n)i[r]&&(n[r]=i[r],delete i[r]);return n},createLayer:function(e,t,a,n,i,s){return e&&this.setEachFeatureDefaultStyle(e,null,s),new ol.layer.Vector({layerID:s,layerType:r.r.MARKER,source:new ol.source.Vector({features:e,wrapX:!1})})}};t.a=s},153:function(e,t,a){"use strict";a(32),a(14);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(10),p=a.n(d),h=a(0),f=a.n(h),m=a(15),y=a.n(m),g=a(430),v=a(16),S=(a(2),function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).state={top:0,showColorPicker:!1,background:e.color||"#FFA500"},a}return p()(t,e),s()(t,[{key:"componentWillReceiveProps",value:function(e){this.updateState(e.color,this.state.showColorPicker,!0)}},{key:"createReactCSS",value:function(){var e={default:{color:{width:this.props.innerWidth||"131px",height:"12px",background:"".concat(this.state.background)},swatch:{padding:"5px",background:"#fff",borderRadius:"1px",boxShadow:"0 0 0 1px rgba(0,0,0,.1)",display:"inline-block",cursor:"pointer"},popover:{position:"fixed",zIndex:"3002"},cover:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}}};this.state.background;return e.default.popover.top=this.state.top+"px",y()(e)}},{key:"getColorPicker",value:function(e){if(this.state.showColorPicker){var t=!0;return!1===this.props.disableAlpha&&(t=!1),f.a.createElement("div",{style:e.popover},f.a.createElement("div",{style:e.cover,onClick:this.handleClose.bind(this)}),f.a.createElement(g.SketchPicker,{disableAlpha:t,color:this.state.background,onChange:this.handlerChange.bind(this)}))}return null}},{key:"render",value:function(){var e=this.createReactCSS();return f.a.createElement("div",{className:"colors-picker-wrapper"},f.a.createElement("div",{className:this.state.showColorPicker?"colors-picker chart_select drop-down-box-selected":"colors-picker chart_select",onClick:this.handleClick.bind(this)},f.a.createElement("div",{ref:"selected",className:"select-name",style:{padding:"8px"}},f.a.createElement("div",{style:e.color}))),this.getColorPicker(e))}},{key:"handlerChange",value:function(e){var t=e.hex;!1===this.props.disableAlpha&&(t=v.a.RGB2String(e.rgb)),this.updateState(t,null),this.props.onColorPickerChange(e,this.props.value)}},{key:"handleClick",value:function(e){var t,a=e.target.getBoundingClientRect(),n=document.body.clientHeight,i=!1===this.props.disableAlpha?302:287;t=a.top+i>n?a.top-i-a.height/2:a.top+a.height+a.height/2,this.updateState(null,!0,!1,t)}},{key:"handleClose",value:function(){this.updateState(null,!1)}},{key:"updateState",value:function(e,t,a,n){var i={};e?(i.background=e,0!==e.indexOf("#")&&0!==e.indexOf("rgb")&&(i.background=v.a.RGB2String(e)),a&&(i.showColorPicker=t)):i.showColorPicker=t,n&&(i.top=n),this.setState(i)}}]),t}(h.Component));t.a=S},154:function(e,t,a){"use strict";var n=a(0),i=a.n(n);t.a=function(e){var t={conmon:"spinner",max:"spinnerMax",mid:"spinnerMid",min:"spinnerMin",gifSize:"gif-max"};return"min"===e.type&&(t={conmon:"min-spinner",max:"min-spinnerMax",mid:"min-spinnerMid",min:"min-spinnerMin",gifSize:"gif-min"}),i.a.createElement("div",{className:"loading-img-gif "+t.gifSize})}},157:function(e,t,a){"use strict";a(78),a(54),a(112),a(73),a(72),a(99),a(100),a(36),a(32),a(27);var n=a(136),i=a.n(n),r={BUILTIN_OBJECT:null,_ctx:null,_canvas:null,_pixelCtx:null,_width:null,_height:null,_offsetX:0,_offsetY:0,initialize:function(){this.BUILTIN_OBJECT={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1}},clone:function(e){var t=this.BUILTIN_OBJECT;if("object"===i()(e)&&null!==e){var a=e;if(e instanceof Array){a=[];for(var n=0,r=e.length;n<r;n++)a[n]=this.clone(e[n])}else if(!t[Object.prototype.toString.call(e)])for(var s in a={},e)e.hasOwnProperty(s)&&(a[s]=this.clone(e[s]));return a}return e},mergeItem:function(e,t,a,n){var r=this.BUILTIN_OBJECT;t.hasOwnProperty(a)&&("object"!==i()(e[a])||r[Object.prototype.toString.call(e[a])]?!n&&a in e||(e[a]=t[a]):this.merge(e[a],t[a],n))},merge:function(e,t,a){for(var n in t)this.mergeItem(e,t,n,a);return e},getContext:function(){return this._ctx||(this._ctx=document.createElement("canvas").getContext("2d")),this._ctx},getPixelContext:function(){return this._pixelCtx||(this._canvas=document.createElement("canvas"),this._width=this._canvas.width,this._height=this._canvas.height,this._pixelCtx=this._canvas.getContext("2d")),this._pixelCtx},adjustCanvasSize:function(e,t){var a,n=this._canvas,i=this._pixelCtx,r=this._width,s=this._height,o=this._offsetX,l=this._offsetY;e+o>r&&(r=e+o+100,n.width=r,a=!0),t+l>s&&(s=t+l+100,n.height=s,a=!0),e<-o&&(r+=o=100*Math.ceil(-e/100),n.width=r,a=!0),t<-l&&(s+=l=100*Math.ceil(-t/100),n.height=s,a=!0),a&&i.translate(o,l)},getPixelOffset:function(){return{x:this._offsetX,y:this._offsetY}},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var a=0,n=e.length;a<n;a++)if(e[a]===t)return a;return-1},inherits:function(e,t){var a=e.prototype;function n(){}for(var i in n.prototype=t.prototype,e.prototype=new n,a)e.prototype[i]=a[i];e.constructor=e},CLASS_NAME:"SuperMap.LevelRenderer.Tool.Util"};r.initialize();var s={util:null,_ctx:null,palette:null,_palette:null,highlightColor:null,_highlightColor:null,colorRegExp:null,_nameColors:null,initialize:function(){this.util=r,this.palette=["#ff9277"," #dddd00"," #ffc877"," #bbe3ff"," #d5ffbb","#bbbbff"," #ddb000"," #b0dd00"," #e2bbff"," #ffbbe3","#ff7777"," #ff9900"," #83dd00"," #77e3ff"," #778fff","#c877ff"," #ff77ab"," #ff6600"," #aa8800"," #77c7ff","#ad77ff"," #ff77ff"," #dd0083"," #777700"," #00aa00","#0088aa"," #8400dd"," #aa0088"," #dd0000"," #772e00"],this._palette=this.palette,this.highlightColor="rgba(0,0,255,1)",this._highlightColor=this.highlightColor,this.colorRegExp=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,this._nameColors={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#0ff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000",blanchedalmond:"#ffebcd",blue:"#00f",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#f0f",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#0f0",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#f0f",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#f00",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#fff",whitesmoke:"#f5f5f5",yellow:"#ff0",yellowgreen:"#9acd32"}},customPalette:function(e){this.palette=e},resetPalette:function(){this.palette=this._palette},getColor:function(e,t){return e|=0,(t=t||this.palette)[e%t.length]},customHighlight:function(e){this.highlightColor=e},resetHighlight:function(){this.highlightColor=this._highlightColor},getHighlightColor:function(){return this.highlightColor},getRadialGradient:function(e,t,a,n,i,r,s){var o=this.util;this._ctx||(this._ctx=o.getContext());for(var l=this._ctx.createRadialGradient(e,t,a,n,i,r),c=0,u=s.length;c<u;c++)l.addColorStop(s[c][0],s[c][1]);return l.__nonRecursion=!0,l},getLinearGradient:function(e,t,a,n,i){var r=this.util;this._ctx||(this._ctx=r.getContext());for(var s=this._ctx.createLinearGradient(e,t,a,n),o=0,l=i.length;o<l;o++)s.addColorStop(i[o][0],i[o][1]);return s.__nonRecursion=!0,s},getStepColors:function(e,t,a){e=this.toRGBA(e),t=this.toRGBA(t),e=this.getData(e);for(var n=[],i=((t=this.getData(t))[0]-e[0])/a,r=(t[1]-e[1])/a,s=(t[2]-e[2])/a,o=(t[3]-e[3])/a,l=0,c=e[0],u=e[1],d=e[2],p=e[3];l<a;l++)n[l]=this.toColor([this.adjust(Math.floor(c),[0,255]),this.adjust(Math.floor(u),[0,255]),this.adjust(Math.floor(d),[0,255]),p.toFixed(4)-0],"rgba"),c+=i,u+=r,d+=s,p+=o;return c=t[0],u=t[1],d=t[2],p=t[3],n[l]=this.toColor([c,u,d,p],"rgba"),n},getGradientColors:function(e,t){var a=[],n=e.length;if(void 0===t&&(t=20),1===n)a=this.getStepColors(e[0],e[0],t);else if(n>1)for(var i=0,r=n-1;i<r;i++){var s=this.getStepColors(e[i],e[i+1],t);i<r-1&&s.pop(),a=a.concat(s)}return a},toColor:function(e,t){if(t=t||"rgb",e&&(3===e.length||4===e.length)){if(e=this.map(e,(function(e){return e>1?Math.ceil(e):e})),t.indexOf("hex")>-1)return"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+ +e[2]).toString(16).slice(1);if(t.indexOf("hs")>-1){var a=this.map(e.slice(1,3),(function(e){return e+"%"}));e[1]=a[0],e[2]=a[1]}return t.indexOf("a")>-1?(3===e.length&&e.push(1),e[3]=this.adjust(e[3],[0,1]),t+"("+e.slice(0,4).join(",")+")"):t+"("+e.slice(0,3).join(",")+")"}},toArray:function(e){(e=this.trim(e)).indexOf("rgba")<0&&(e=this.toRGBA(e));var t=[],a=0;return e.replace(/[\d.]+/g,(function(e){a<3?e|=0:e=+e,t[a++]=e})),t},convert:function(e,t){if(!this.isCalculableColor(e))return e;var a=this.getData(e),n=a[3];return void 0===n&&(n=1),e.indexOf("hsb")>-1?a=this._HSV_2_RGB(a):e.indexOf("hsl")>-1&&(a=this._HSL_2_RGB(a)),t.indexOf("hsb")>-1||t.indexOf("hsv")>-1?a=this._RGB_2_HSB(a):t.indexOf("hsl")>-1&&(a=this._RGB_2_HSL(a)),a[3]=n,this.toColor(a,t)},toRGBA:function(e){return this.convert(e,"rgba")},toRGB:function(e){return this.convert(e,"rgb")},toHex:function(e){return this.convert(e,"hex")},toHSVA:function(e){return this.convert(e,"hsva")},toHSV:function(e){return this.convert(e,"hsv")},toHSBA:function(e){return this.convert(e,"hsba")},toHSB:function(e){return this.convert(e,"hsb")},toHSLA:function(e){return this.convert(e,"hsla")},toHSL:function(e){return this.convert(e,"hsl")},toName:function(e){for(var t in this._nameColors)if(this.toHex(this._nameColors[t])===this.toHex(e))return t;return null},trim:function(e){return String(e).replace(/\s+/g,"")},normalize:function(e){if(this._nameColors[e]&&(e=this._nameColors[e]),e=(e=this.trim(e)).replace(/hsv/i,"hsb"),/^#[\da-f]{3}$/i.test(e)){var t=(3840&(e=parseInt(e.slice(1),16)))<<8,a=(240&e)<<4,n=15&e;e="#"+((1<<24)+(t<<4)+t+(a<<4)+a+(n<<4)+n).toString(16).slice(1)}return e},lift:function(e,t){if(!this.isCalculableColor(e))return e;var a=t>0?1:-1;void 0===t&&(t=0),t=Math.abs(t)>1?1:Math.abs(t),e=this.toRGB(e);for(var n=this.getData(e),i=0;i<3;i++)n[i]=1===a?n[i]*(1-t)|0:(255-n[i])*t+n[i]|0;return"rgb("+n.join(",")+")"},reverse:function(e){if(!this.isCalculableColor(e))return e;var t=this.getData(this.toRGBA(e));return t=this.map(t,(function(e){return 255-e})),this.toColor(t,"rgb")},mix:function(e,t,a){if(!this.isCalculableColor(e)||!this.isCalculableColor(t))return e;void 0===a&&(a=.5);for(var n=2*(a=1-this.adjust(a,[0,1]))-1,i=this.getData(this.toRGBA(e)),r=this.getData(this.toRGBA(t)),s=i[3]-r[3],o=((n*s==-1?n:(n+s)/(1+n*s))+1)/2,l=1-o,c=[],u=0;u<3;u++)c[u]=i[u]*o+r[u]*l;var d=i[3]*a+r[3]*(1-a);return d=Math.max(0,Math.min(1,d)),1===i[3]&&1===r[3]?this.toColor(c,"rgb"):(c[3]=d,this.toColor(c,"rgba"))},random:function(){return"#"+Math.random().toString(16).slice(2,8)},getData:function(e){var t,a,n=(e=this.normalize(e)).match(this.colorRegExp);if(null===n)throw new Error("The color format error");var i,r=[];if(n[2])i=[(t=n[2].replace("#","").split(""))[0]+t[1],t[2]+t[3],t[4]+t[5]],r=this.map(i,(function(e){return s.adjust.call(this,parseInt(e,16),[0,255])}));else if(n[4]){var o=n[4].split(",");a=o[3],i=o.slice(0,3),r=this.map(i,(function(e){return e=Math.floor(e.indexOf("%")>0?2.55*parseInt(e,0):e),s.adjust.call(this,e,[0,255])})),void 0!==a&&r.push(this.adjust(parseFloat(a),[0,1]))}else if(n[5]||n[6]){var l=(n[5]||n[6]).split(","),c=parseInt(l[0],0)/360,u=l[1],d=l[2];a=l[3],(r=this.map([u,d],(function(e){return s.adjust.call(this,parseFloat(e)/100,[0,1])}))).unshift(c),void 0!==a&&r.push(this.adjust(parseFloat(a),[0,1]))}return r},alpha:function(e,t){if(!this.isCalculableColor(e))return e;null===t&&(t=1);var a=this.getData(this.toRGBA(e));return a[3]=this.adjust(Number(t).toFixed(4),[0,1]),this.toColor(a,"rgba")},map:function(e,t){if("function"!=typeof t)throw new TypeError;for(var a=e?e.length:0,n=0;n<a;n++)e[n]=t(e[n]);return e},adjust:function(e,t){return e<=t[0]?e=t[0]:e>=t[1]&&(e=t[1]),e},isCalculableColor:function(e){return e instanceof Array||"string"==typeof e},_HSV_2_RGB:function(e){var t,a,n,i=e[0],r=e[1],s=e[2];if(0===r)t=255*s,a=255*s,n=255*s;else{var o=6*i;6===o&&(o=0);var l=0|o,c=s*(1-r),u=s*(1-r*(o-l)),d=s*(1-r*(1-(o-l))),p=0,h=0,f=0;0===l?(p=s,h=d,f=c):1===l?(p=u,h=s,f=c):2===l?(p=c,h=s,f=d):3===l?(p=c,h=u,f=s):4===l?(p=d,h=c,f=s):(p=s,h=c,f=u),t=255*p,a=255*h,n=255*f}return[t,a,n]},_HSL_2_RGB:function(e){var t,a,n,i=e[0],r=e[1],s=e[2];if(0===r)t=255*s,a=255*s,n=255*s;else{var o,l=2*s-(o=s<.5?s*(1+r):s+r-r*s);t=255*this._HUE_2_RGB(l,o,i+1/3),a=255*this._HUE_2_RGB(l,o,i),n=255*this._HUE_2_RGB(l,o,i-1/3)}return[t,a,n]},_HUE_2_RGB:function(e,t,a){return a<0&&(a+=1),a>1&&(a-=1),6*a<1?e+6*(t-e)*a:2*a<1?t:3*a<2?e+(t-e)*(2/3-a)*6:e},_RGB_2_HSB:function(e){var t,a,n=e[0]/255,i=e[1]/255,r=e[2]/255,s=Math.min(n,i,r),o=Math.max(n,i,r),l=o-s,c=o;if(0===l)t=0,a=0;else{a=l/o;var u=((o-n)/6+l/2)/l,d=((o-i)/6+l/2)/l,p=((o-r)/6+l/2)/l;n===o?t=p-d:i===o?t=1/3+u-p:r===o&&(t=2/3+d-u),t<0&&(t+=1),t>1&&(t-=1)}return[t*=360,a*=100,c*=100]},_RGB_2_HSL:function(e){var t,a,n=e[0]/255,i=e[1]/255,r=e[2]/255,s=Math.min(n,i,r),o=Math.max(n,i,r),l=o-s,c=(o+s)/2;if(0===l)t=0,a=0;else{a=c<.5?l/(o+s):l/(2-o-s);var u=((o-n)/6+l/2)/l,d=((o-i)/6+l/2)/l,p=((o-r)/6+l/2)/l;n===o?t=p-d:i===o?t=1/3+u-p:r===o&&(t=2/3+d-u),t<0&&(t+=1),t>1&&(t-=1)}return[t*=360,a*=100,c*=100]},CLASS_NAME:"SuperMap.LevelRenderer.Tool.Color"},o=s;o.initialize();var l={createCanvas:function(e,t){var a=document.createElement("canvas");return a.height=e,a.width=t,a.getContext("2d")},getLinearGradient:function(e,t,a,n,i){this._ctx||(this._ctx=this.getContext());for(var r=this._ctx.createLinearGradient(e,t,a,n),s=i.length,o=1/(s-1),l=0,c=0;c<s;c++)l>1&&(l=1),r.addColorStop(l,i[c]),l+=o;return r.__nonRecursion=!0,r},getContext:function(){return this._ctx||(this._ctx=document.createElement("canvas").getContext("2d")),this._ctx},getStepColors:function(e,t,a){e=o.toRGBA(e),t=o.toRGBA(t),e=o.getData(e);for(var n=[],i=((t=o.getData(t))[0]-e[0])/a,r=(t[1]-e[1])/a,s=(t[2]-e[2])/a,l=(t[3]-e[3])/a,c=0,u=e[0],d=e[1],p=e[2],h=e[3];c<a;c++)n[c]=o.toColor([o.adjust(Math.floor(u),[0,255]),o.adjust(Math.floor(d),[0,255]),o.adjust(Math.floor(p),[0,255]),h.toFixed(4)-0],"hex"),u+=i,d+=r,p+=s,h+=l;return u=t[0],d=t[1],p=t[2],h=t[3],n[c]=o.toColor([u,d,p,h],"hex"),n},getGradientColors:function(e,t,a){var n,i,r,s=[],o=e.length;if(void 0!==t){if(o>=t)if("RANGE"===a)for(i=0;i<t;i++)s.push(e[i]);else for(i=0;i<t;i++){var l=Math.floor(i/2);if(i%2==0)s.push(e[l]);else{var c=e.length-1-l;s.push(e[c])}}else{for(n=Math.ceil(t/(o-1)),i=0,r=o-1;i<r;i++){var u=this.getStepColors(e[i],e[i+1],n);i<r-1&&u.pop(),s=s.concat(u)}for(var d=s.length-t,p=0;p<d;p++)s.splice(2,1)}return s}}};t.a=l},1586:function(e,t,a){},1587:function(e,t,a){},1593:function(e,t,a){},1594:function(e,t,a){},1595:function(e,t,a){},16:function(e,t,a){"use strict";a(28),a(30),a(78),a(208),a(32),a(18),a(27),a(54),a(73);var n=a(2),i=a(12),r=a(1),s=a(157);t.a={toOpenLayersStyle:function(e,t){var a=this;e=e||this.getDefaultStyle();var i,s,o,l=new ol.style.Style,c=e,u=c.fillColor,d=c.fillOpacity,p=c.strokeColor,h=c.strokeWidth,f=c.strokeOpacity,m=c.radius,y=c.lineDash,g=c.lineCap,v=c.src,S=c.scale,b=c.offsetX,I=void 0===b?0:b,E=c.offsetY,T=void 0===E?0:E,C=c.symbolInfo,L=c.imageInfo,N=c.rotation,k=void 0===N?0:N,O=this.hexToRgb(u);O&&n.a.isNumber(d)&&O.push(d);var D=this.hexToRgb(p);if(D&&n.a.isNumber(f)&&D.push(f),t===r.p.POINT){var w=e.type;if(v)/.+(\.svg$)/.test(v)?(this.svgDiv||(this.svgDiv=document.createElement("div"),document.body.appendChild(this.svgDiv)),this.getCanvasFromSVG(e,this.svgDiv,(function(e){i=new ol.style.Icon({img:e,scale:S||2*m/e.width,imgSize:[e.width,e.height],anchor:[.5,.5]})}))):i=new ol.style.Icon({src:v,scale:S,anchor:[.5,.5]});else if(w===r.k.SVG_POINT&&C&&C.url&&/.+(\.svg$)/.test(C.url)){this.svgDiv||(this.svgDiv=document.createElement("div"),document.body.appendChild(this.svgDiv));var A=this.getIconAnchor(I,T);this.getCanvasFromSVG(C,this.svgDiv,(function(t){i=new ol.style.Icon({img:a.setColorToCanvas(t,e),scale:S||2*m/t.width,imgSize:[t.width,t.height],anchor:A,anchorOrigin:"bottom-right",rotation:k,opacity:d})}))}else if(w===r.k.IMAGE_POINT&&L&&L.url){var F=L.img,M=L.size,R=M.w,x=M.h,P=a.getIconAnchor(I,T);i=new ol.style.Icon({img:F,scale:2*m/R,imgSize:[R,x],anchor:P,anchorOrigin:"bottom-right",rotation:k})}else i=new ol.style.Circle({radius:m,fill:new ol.style.Fill({color:O}),stroke:new ol.style.Stroke({width:h||r.t,color:D}),displacement:this.getCircleDisplacement(m,I,T)});l.setImage(i)}else if(t===r.p.LINE||t===r.p.LINESTRING||t===r.p.MULTILINESTRING||t===r.p.LINEARRING)o=new ol.style.Stroke({width:h||r.t,color:D,lineCap:g||"round",lineDash:this.getFormatLineDash(y,h)}),l.setStroke(o);else if(t===r.p.POLYGON||t===r.p.REGION||t===r.p.MULTIPOLYGON||t===r.p.CIRCLE)s=new ol.style.Fill({color:O}),o=new ol.style.Stroke({width:h||r.t,color:D,lineCap:g||"round",lineDash:this.getFormatLineDash(y,h)}),l.setFill(s),l.setStroke(o);else{var V=this.getCanvas(e);i=new ol.style.Icon({img:V.canvas,imgSize:[V.width,V.height],scale:1,anchor:[.5,.5]}),l.setImage(i)}return l},toTextOpenlayerStyle:function(e){var t=e.style,a="",n=t.symbolInfo,i=t.radius,s=t.offsetX,o=void 0===s?0:s,l=t.offsetY,c=void 0===l?0:l,u=t.rotation,d=void 0===u?0:u;if(t.symbolInfo&&"&#xe69b"===t.symbolInfo.unicode)return this.toOpenLayersStyle(t,r.p.POINT);n&&n.unicode&&(a=String.fromCharCode(parseInt(n.unicode.replace(/^&#x/,""),16)));var p=2*i,h=this.hexToRgb(t.fillColor);h.push(t.fillOpacity);var f=this.hexToRgb(t.strokeColor);f.push(t.strokeOpacity);var m=this.getTextOffset(i,o,c);return new ol.style.Style({text:new ol.style.Text({text:a,font:p+"px supermapol-icons",placement:"point",textAlign:"center",fill:new ol.style.Fill({color:h}),backgroundFill:new ol.style.Fill({color:[0,0,0,0]}),offsetX:m.x,offsetY:m.y,stroke:new ol.style.Stroke({width:t.strokeWidth||1e-6,color:f}),rotation:d})})},getRoadPath:function(e,t){var a=e.strokeWidth,i=void 0===a?r.t:a,s=e.lineCap,o=e.strokeColor,l=e.strokeOpacity,c=this.hexToRgb(o);c&&n.a.isNumber(l)&&c.push(l);var u=new ol.style.Style({stroke:new ol.style.Stroke({width:i||r.t,color:c,lineCap:s||"round",lineDash:this.getFormatLineDash("solid",i)})}),d=t.strokeColor,p=this.hexToRgb(d);p&&n.a.isNumber(l)&&p.push(l);var h=0===i?r.t:i+2;return[new ol.style.Style({stroke:new ol.style.Stroke({width:h,color:p,lineCap:s||"round",lineDash:this.getFormatLineDash("solid",i)})}),u]},getPathway:function(e,t){var a,i=e.strokeWidth,s=void 0===i?r.t:i,o=e.strokeColor,l=e.strokeOpacity,c=[a=4*s,a+2*s],u=this.hexToRgb(o);u&&n.a.isNumber(l)&&u.push(l);var d=new ol.style.Style({stroke:new ol.style.Stroke({width:.5*s||r.t,color:u,lineCap:"square",lineDash:c})}),p=t.strokeColor,h=this.hexToRgb(p);return h&&n.a.isNumber(l)&&h.push(l),[new ol.style.Style({stroke:new ol.style.Stroke({width:s||r.t,color:h,lineCap:"square"})}),d]},hexToRgb:function(e){if(e){var t=e.replace("#","").split(""),a=[t[0]+t[1],t[2]+t[3],t[4]+t[5]];return a=a.map((function(e){return parseInt(e,16)}))}},formatRGB:function(e){var t;return 3===e.length?(t="rgb(",e.forEach((function(e,a){t+=2===a?e:e+","}))):(t="rgba(",e.forEach((function(e,a){t+=3===a?e:e+","}))),t+=")"},RGB2String:function(e){return e.r>-1?void 0!==e.a&&null!==e.a?"rgba(".concat(e.r,",").concat(e.g,",").concat(e.b,",").concat(e.a,")"):"rgb(".concat(e.r,",").concat(e.g,",").concat(e.b,")"):e[0]>-1?void 0!==e[3]&&null!==e[3]?"rgba(".concat(e[0],",").concat(e[1],",").concat(e[2],",").concat(e[3],")"):"rgb(".concat(e[0],",").concat(e[1],",").concat(e[2],")"):e},RGB2Array:function(e){return void 0!==e.a&&null!==e.a?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b]},rgbaString2Array:function(e){var t="";return e.indexOf("rgba")>-1?t=e.replace("rgba(",""):e.indexOf("rgb(")>-1&&(t=t.replace("rgb(","")),(t=t.replace(")","")).split(",").map((function(e){return parseFloat(e)}))},getFormatLineDash:function(e,t){if(e){var a;switch(e){case"solid":a=[0];break;case"dot":a=[1,4*t];break;case"dash":a=[4*t,4*t];break;case"dashdot":a=[4*t,4*t,1,4*t];break;case"longdash":a=[8*t,4*t];break;case"longdashdot":a=[8*t,4*t,1,4*t];break;default:a=[0]}return a}},getCanvasFromSVG:function(e,t,a){var r=e.canvas,s=e.url||e.src;r||((r=e.canvas=document.createElement("canvas")).id="dataviz-canvg-"+n.a.newGuid(8),t.appendChild(r));try{canvg(r.id,s,{ignoreMouse:!0,ignoreAnimation:!0,renderCallback:function(){r.width>300||r.height>300?i.a.showMessage(DataViz.Language.sizeIsWrong):a(r)},forceRedraw:function(){return!1},useCORS:!0})}catch(e){i.a.showMessage(DataViz.Language.loadFaild)}},setColorToCanvas:function(e,t){var a=e.getContext("2d"),n=this.hexToRgb(t.fillColor);n&&n.push(t.fillOpacity);var i=this.hexToRgb(t.strokeColor);return i&&i.push(t.strokeOpacity),a.fillStyle=this.formatRGB(n),a.fill(),a.strokeStyle=this.formatRGB(i),a.lineWidth=t.strokeWidth,a.stroke(),e},getCanvas:function(e){var t;e.canvas?document.querySelector("#"+e.canvas)?(document.getElementById(e.canvas)&&document.getElementById("dataviz-text-canvas").removeChild(document.getElementById(e.canvas)),t=this.createCanvas(e),e.canvas=t.id):t=this.createCanvas(e):(t=this.createCanvas(e),e.canvas=t.id),t.style.display="none";var a=t.getContext("2d"),n=Number(e.font.replace(/[^0-9]/gi,""))+3,i=e.text.split("\r\n"),r=i.length;a.font=e.font;var s=this.drawRect(a,e,i,n,t);return this.positionY=8,r>1?i.forEach((function(t,i){0!==i&&(this.positionY=this.positionY+n),this.canvasTextAutoLine(t,e,a,n,s.width)}),this):this.canvasTextAutoLine(i[0],e,a,n,s.width),{canvas:t,width:s.width,height:s.height}},createCanvas:function(e){var t=document.getElementById("dataviz-text-canvas");t||((t=document.createElement("div")).setAttribute("id","dataviz-text-canvas"),document.body.appendChild(t));var a=document.createElement("canvas");return a.id=e.canvas?e.canvas:"textCanvas"+n.a.newGuid(8),t.appendChild(a),a},drawRect:function(e,t,a,n,i){var r,s,o=t.backgroundFill,l=t.maxWidth-16,c=0,u=[];return a.forEach((function(t,a){var n,i="";c++;for(var s=0;s<t.length;s++){var o=i+t[s],d=e.measureText(o).width;d>l&&s>0||"\n"===t[s]?(i=t[s],c++,n=!0):(i=o,r=d)}n?u.push(l):u.push(r)}),this),r=this.getCanvasWidth(u,l),s=c*n+16-6,i.width=r,i.height=s,e.fillStyle=o,e.fillRect(0,0,r,s),e.lineWidth=t.borderWidth,e.strokeStyle=t.borderColor,e.strokeRect(0,0,r,s),{width:r,height:s}},getCanvasWidth:function(e,t){for(var a=0,n=0;n<e.length;n++){var i=e[n];if(i>=t)return t+16;i>a&&(a=i)}return a+16},canvasTextAutoLine:function(e,t,a,n,i){a.font=t.font;for(var r=t.textAlign,s=this.getPositionX(r,i),o=e.split(""),l="",c=t.fillColor,u=t.maxWidth-16,d=0;d<o.length;d++){var p=l+o[d];a.measureText(p).width>u&&d>0||"\n"===o[d]?(a.fillStyle=c,a.textAlign=r,a.textBaseline="top",a.fillText(l,s,this.positionY),l=o[d],this.positionY+=n):l=p}a.fillStyle=c,a.textAlign=r,a.textBaseline="top",a.fillText(l,s,this.positionY)},getPositionX:function(e,t){var a,n=t-16;switch(e){case"center":a=n/2;break;case"right":a=n;break;default:a=8}return a},judgeType:function(e){if(e.getProperties().useStyle&&e.getProperties().useStyle.text)return r.e.TEXT;var t=e.getGeometry().getType().toUpperCase();return r.e[t]},getUniqueColors:function(e,t){return s.a.getGradientColors(e,t)},getIconAnchor:function(e,t){return[e,t]},getCircleDisplacement:function(e,t,a){return[e*t,-(e*a)]},getTextOffset:function(e,t,a){return{x:e*t,y:e*a}},getPointOffsetValue:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=e.type,s=e.radius,o=e.imageInfo,l=e.symbolInfo,c=0,u=0;if(!a&&!n)return{x:c,y:u};if(i===r.k.SYMBOL_POINT)c=(t=this.getTextOffset(s,a,n)).x,u=t.y;else if(i===r.k.IMAGE_POINT&&o){var d=o.size;c=a*d.w,u=n*d.h}else if(i===r.k.SVG_POINT&&l&&l.url&&l.canvas){var p=l.canvas,h=p.width,f=p.height;c=a*h,u=n*f}else c=(t=this.getCircleDisplacement(s,a,n))[0],u=-t[1];return{x:c,y:u}},getLabelOffset:function(e){var t=e.radius,a=void 0===t?0:t,n=e.strokeWidth;return a+(void 0===n?0:n)+3},initOffset:function(e){["SYMBOL_POINT","BASIC_POINT"].includes(e.type)?(e.imageOffset={offsetX:.5,offsetY:.5},e.svgOffset={offsetX:.5,offsetY:.5},e.symbolOffset={offsetX:e.offsetX,offsetY:e.offsetY}):"SVG_POINT"===e.type?(e.imageOffset={offsetX:.5,offsetY:.5},e.svgOffset={offsetX:e.offsetX,offsetY:e.offsetY},e.symbolOffset={offsetX:0,offsetY:0}):"IMAGE_POINT"===e.type&&(e.imageOffset={offsetX:e.offsetX,offsetY:e.offsetX},e.svgOffset={offsetX:.5,offsetY:.5},e.symbolOffset={offsetX:0,offsetY:0})}}},1604:function(e,t,a){},161:function(e,t,a){"use strict";a(32),a(20),a(43);var n=a(21),i=a(218),r=a.n(i),s=a(1),o=a(16),l={getWebMapPointThemeStyle:function(e,t){var a;if(e.type=t,t===s.k.BASIC_POINT)a=r()(e,["type","radius","fillColor","fillOpacity","strokeColor","strokeOpacity","strokeWidth","offsetX","offsetY"]);else if(t===s.k.SYMBOL_POINT){var i=e.symbolInfo,o=e.radius;e.fontSize="".concat(2*o,"px"),Object.assign(e,i),a=r()(e,["type","className","name","unicode","fillColor","fillOpacity","fontSize","strokeColor","strokeOpacity","strokeWidth","offsetX","offsetY","rotation"])}else if(t===s.k.SVG_POINT){var l=e.symbolInfo;Object.assign(e,l),a=r()(e,["type","radius","fillColor","fillOpacity","url","strokeColor","strokeOpacity","strokeWidth","offsetX","offsetY","rotation"])}else if(t===s.k.IMAGE_POINT){var c=e.imageInfo,u=c.url;u&&/point_imgs/.test(u)&&!/apps\/dataviz/.test(u)&&!/^(http:|https:)/.test(u)&&(c.url="".concat(n.p.getRootUrl(),"apps/dataviz/").concat(u)),e.imageInfo=r()(c,["url","size"]),a=r()(e,["type","radius","imageInfo","offsetX","offsetY","rotation"])}return a},getDVPointThemeStyle:function(e,t){var a=e.className,i=e.name,r=e.unicode,l=e.fontSize,c=e.type;if(t&&o.a.initOffset(e),c===s.k.SYMBOL_POINT)e.symbolInfo={className:a,name:i,unicode:r},e.radius=l.substr(0,l.length-2)/2,delete e.className,delete e.name,delete e.unicode,delete e.fontSize;else if(c===s.k.SVG_POINT)e.symbolInfo={url:e.url},delete e.url;else if(c===s.k.IMAGE_POINT){var u=e.imageInfo,d=new Image,p=u.url;p.indexOf("resources")>-1&&p.indexOf("http")<0&&(p="".concat(n.p.getRootUrl()).concat(p)),d.src=p,e.imageInfo.img=d}return e}};t.a=l},1610:function(e,t,a){},1611:function(e,t,a){},1612:function(e,t,a){},1613:function(e,t,a){},1614:function(e,t,a){},1616:function(e,t,a){},1617:function(e,t,a){},1618:function(e,t,a){},1619:function(e,t,a){},1620:function(e,t,a){},1621:function(e,t,a){},1629:function(e,t,a){},163:function(e,t,a){"use strict";a(20);var n,i=a(17),r=a.n(i),s=(a(87),a(25)),o=a.n(s),l=a(2),c={readExcelWorker:null,sheet2blobWorker:null,readCsvExcelData:(n=o()(r.a.mark((function e(t,a,n,i){var s,o,u,d,p,h;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=l.a.getRootUrl(),o="".concat(s,"apps/dataviz/"),u={type:n,root:o},window.Worker&&(d="".concat(s,"apps/dataviz/libs/web-worker/upload/readExcelFileWorker.js"),p=c.readExcelWorker=new Worker(c.createBloburl(d)),h=t,p.onmessage=function(e){(h=e.data)&&0===h.length&&(h.type="empty"),i&&i(h),p.terminate()},p.onerror=function(e){throw i&&i(h),p.terminate(),h},p.postMessage({param:u,fileInfo:t,readOptions:a}));case 4:case"end":return e.stop()}}),e)}))),function(e,t,a,i){return n.apply(this,arguments)}),createBloburl:function(e){var t;try{t=new Blob(["importScripts('".concat(e,"')")],{type:"application/javascript"})}catch(n){var a=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);a.append("importScripts('"+e+"');"),t=a.getBlob("application/javascript")}return(window.URL||window.webkitURL).createObjectURL(t)},readJSONData:function(e,t){var a=new FileReader,n=e.type,i=e.uploadFile,r={name:e.name,originName:e.originName,type:n,uploadFile:i,success:!1,data:null};a.onload=function(e){if(""===e.target.result)return r.type="empty",void t(r);try{r.success=!0,r.data=JSON.parse(e.target.result)}catch(e){r.uploadFile=null,r.type="unsupported"}finally{t(r)}},a.readAsText(i)}};t.a=c},1630:function(e,t,a){},164:function(e,t,a){"use strict";a(14);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(10),p=a.n(d),h=a(0),f=a.n(h),m=a(2),y=function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).state={inputValue:e.inputValue},a}return p()(t,e),s()(t,[{key:"componentWillReceiveProps",value:function(e){null!=e.inputValue&&null!=e.inputValue&&this.setState({inputValue:e.inputValue})}},{key:"changeValue",value:function(e){var t=e.target.value,a=this;this.setState({inputValue:t}),a.props.onChange&&m.a.delayCall((function(){a.props.onChange(t,a.props.attribute)}),300,a)}},{key:"onBlur",value:function(){var e=this.state.inputValue;this.props.onBlur&&this.props.onBlur(e)}},{key:"getValue",value:function(){return this.state.inputValue}},{key:"render",value:function(){var e,t=this.props,a=t.type,n=t.inputTips,i=t.title,r=t.disabled;return e="textarea"===a?f.a.createElement("textarea",{placeholder:n,onChange:this.changeValue.bind(this),onBlur:this.onBlur.bind(this),value:this.state.inputValue}):f.a.createElement("input",{type:"text",className:r&&"disabled",onChange:this.changeValue.bind(this),value:this.state.inputValue,onBlur:this.onBlur.bind(this),placeholder:n}),f.a.createElement("div",{className:"span-text"},f.a.createElement("span",null,i),e)}}]),t}(h.Component);t.a=y},165:function(e,t,a){"use strict";var n=a(216),i=a(632),r=(a(43),{selectedId:"dv-layers",fold:!1,logoUrl:"./static/imgs/logo.png",unShare:!1}),s=a(19),o=a(5),l=a(82),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case s.r:if((e=Object.assign({},e,{selectedId:t.payload})).fold){e.fold=!1;var a=window.innerHeight,n=window.innerWidth-344;o.a.resizeMap(n,a)}return e;case s.u:l.a.isIportalMap&&(t.payload=!0);var i=t.payload?52:344,c=window.innerHeight,u=window.innerWidth-i;return o.a.resizeMap(u,c),e=Object.assign({},e,{fold:t.payload});case s.o:return e=Object.assign({},e,{unShare:t.payload});case s.E:return document.querySelector("#shortcut_icon").href=t.payload,e=Object.assign({},e,{logoUrl:t.payload});case s.l:return e=Object.assign({},e,{isLogin:t.isLogin});default:return e}},u=(a(18),{selectedLayerIndex:null,tileLayers:[],vectorLayers:[],removeLayerID:null,baseLayerIndex:0,showATLayerID:0}),d=a(2),p=a(52);function h(e,t){for(var a=-1,n=0;n<e.length;n++)if(e[n].id===t){a=n;break}return a}var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case s.b:case s.c:var a=t.payload.layerInfo,n=o.a.addVectorLayerToMap(t.payload.features,a);return e.vectorLayers.push(n),p.a.updateGraticuleLayer(),e=Object.assign({},e,{layers:e.vectorLayers,selectedLayerId:t.payload.selectedLayerId}),o.a.selectedLayerId=t.payload.selectedLayerId,e;case s.e:var i=o.a.addTileLayerToMap(t.payload.restMapInfo,!1,e.vectorLayers);return e.tileLayers.push(i),p.a.updateGraticuleLayer(),e=Object.assign({},e,{layers:e.tileLayers,twinkleLayerId:t.payload.twinkleLayerId});case s.f:var r=o.a.addVectorTileLayer(t.payload,!1,e.vectorLayers);return e.tileLayers.push(r),p.a.updateGraticuleLayer(),e=Object.assign({},e,{layers:e.tileLayers});case s.a:var l=o.a.addVectorLayerToMap(null,t.payload.dataflowInfo);return e.vectorLayers.push(l),p.a.updateGraticuleLayer(),e=Object.assign({},e,{layers:e.vectorLayers,selectedLayerId:t.payload.selectedLayerId});case s.d:var c=o.a.addVectorLayerToMap(t.features||null,t.payload);return e.vectorLayers.push(c),p.a.updateGraticuleLayer(),e=Object.assign({},e,{layers:e.vectorLayers,selectedLayerId:c.id}),o.a.selectedLayerId=c.id,e;case s.y:var f=o.a.getVectorLayerById(t.payload.id);return f&&f.setId(t.payload.serverId),e;case s.t:return e=Object.assign({},e,{selectedLayerId:t.payload}),o.a.selectedLayerId=t.payload,e;case s.k:return e=Object.assign({},e,{layers:[].concat(t.payload)});case s.x:case s.g:var m=o.a.addBaseMap(t.payload.baseLayerInfo||t.payload);return e.tileLayers.shift(),e.tileLayers.unshift(m),p.a.updateGraticuleLayer(!0),e=Object.assign({},e,{layers:e.tileLayers,baseLayerIndex:t.payload.idx});case s.z:var y=o.a.getVectorLayerById(t.layerID),g=y&&y.layerInfo.enableFields?y.layerInfo.enableFields:[];return e=Object.assign({},e,{showATLayerID:t.layerID,enableFields:g.slice()});case s.w:var v=o.a.getLayerById(t.layerID),S=-1;return d.a.isVectorLayer(v.layerInfo.layerType)?(o.a.removeVectorLayerFromMap(v),S=h(e.vectorLayers,t.layerID),e.vectorLayers.splice(S,1)):(d.a.isTileLayer(v.layerInfo.layerType)||d.a.isVectorTileLayer(v.layerInfo.layerType))&&(o.a.removeTileLayerFromMap(v),S=h(e.tileLayers,t.layerID),e.tileLayers.splice(S,1),e.tileLayers.forEach((function(e){e.zIndex>v.layerInfo.zIndex&&(e.zIndex=e.zIndex-1)}))),e.vectorLayers.forEach((function(e){e.zIndex>v.layerInfo.zIndex&&(e.zIndex=e.zIndex-1)})),p.a.updateGraticuleLayer(),e.removeLayerID=t.layerID,e=Object.assign({},e,{tileLayers:e.tileLayers,vectorLayers:e.vectorLayers});case s.G:return e=Object.assign({},e,{legendLayerID:t.layerID,updateTime:t.updateTime,isFold:t.isFold});case s.C:return e=Object.assign({},e,{twinkleLayerId:t.payload});case s.F:var b=t.layerInfo,I=t.layerType,E=-1;if("tile"===I){var T=b.layerInfo;(E=h(e.tileLayers,T.id))>-1&&(e.tileLayers[E]=T,o.a.tileLayers[E]=b),e=Object.assign({},e,{layers:e.tileLayers})}else(E=h(e.vectorLayers,b.id))>-1&&(e.vectorLayers[E]=b,o.a.vectorLayers[E].layerInfo=b),e=Object.assign({},e,{layers:e.vectorLayers});return e;default:return e}},m=a(51),y=a.n(m),g={mapTitle:DataViz.Language.lackOfTitle,mapTags:[DataViz.Language.defaultTag],mapDescription:"",mapSetting:{type:"level",center:[0,0,0],extent:[0,0,0,0]},minScale:"",maxScale:"",scale:"",authorizeSetting:[],graticuleVisible:!1},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case s.q:return t.payload&&(e=Object.assign({},e,{mapTitle:t.payload})),e;case s.p:return t.payload&&(e=Object.assign({},e,{mapTags:t.payload})),e;case s.m:return t.payload&&(e=Object.assign({},e,{mapDescription:t.payload})),e;case s.n:var a=y()({},e.mapSetting,t.payload);return a.center[2]=o.a.roundZoom(a.center[2]),e=Object.assign({},e,{mapSetting:a}),o.a.viewType=a.type,t.operation&&o.a.changeMapSetting(e.mapSetting,t.operation),e;case s.s:return e=Object.assign({},e,t.payload);case s.i:return e=Object.assign({},e,{scale:t.payload});case s.h:return e=Object.assign({},e,{authorizeSetting:t.payload});case s.j:return e=Object.assign({},e,{graticuleVisible:t.visible});default:return e}},S={feature:null,layerId:null,mousePosition:null,layerNotEditable:!1},b=a(188),I=a(45),E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case s.B:var a=t.feature,n=t.mousePosition,i=t.layerNotEditable;return!i&&b.a.setFeatureEditable(a),o.a.setOnlySelectedFeature({feature:a,layerID:t.feature.layerId}),I.a.refreshMarkerPopup(a,n,i),e=Object.assign({},e,{feature:t.feature,layerId:t.layerId,mousePosition:n,layerNotEditable:i});case s.D:return e=Object.assign({},e,{feature:t.feature});case s.v:return o.a.setOnlySelectedFeature(),e=Object.assign({},e,S);default:return e}},T={isShowCutomSetting:!1},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case s.A:return e=Object.assign({},e,{isShowCustomSetting:t.payload});default:return e}},L=Object(n.c)({changeTabReducer:c,layerGroupReducer:f,MapInfoReducer:v,manageMarkerLayerReducer:E,layerEditorReducer:C}),N=(a(1607),[i.a]),k=Object(n.d)(L,n.a.apply(void 0,N));t.a=k},1669:function(e,t){window.onbeforeunload=function(e){e.returnValue=""}},1670:function(e,t,a){},1671:function(e,t,a){},1672:function(e,t,a){},1673:function(e,t,a){},1674:function(e,t,a){},1675:function(e,t,a){},1687:function(e,t,a){},1688:function(e,t,a){},1689:function(e,t,a){},1690:function(e,t,a){},1691:function(e,t,a){},1692:function(e,t,a){},1699:function(e,t,a){},1700:function(e,t,a){},1701:function(e,t,a){},1702:function(e,t,a){},1703:function(e,t,a){},1704:function(e,t,a){},1709:function(e,t,a){},1710:function(e,t,a){},1711:function(e,t,a){},1712:function(e,t,a){},1713:function(e,t,a){},1714:function(e,t,a){},1715:function(e,t,a){},1716:function(e,t,a){},1717:function(e,t,a){},1719:function(e,t,a){},1720:function(e,t,a){},1721:function(e,t,a){},1724:function(e,t,a){},1725:function(e,t,a){},1727:function(e,t,a){},1728:function(e,t,a){},1729:function(e,t,a){},1730:function(e,t,a){},1731:function(e,t,a){},1732:function(e,t,a){},1733:function(e,t,a){},1734:function(e,t,a){},1735:function(e,t,a){},1736:function(e,t,a){},1737:function(e,t,a){},1739:function(e,t,a){},1742:function(e,t,a){},1743:function(e,t,a){},1744:function(e,t,a){},1745:function(e,t,a){},1746:function(e,t,a){},1820:function(e,t,a){},1822:function(e,t,a){},1823:function(e,t,a){},1824:function(e,t,a){},1825:function(e,t,a){},1826:function(e,t){},1830:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(13),s=a.n(r),o=a(98),l=(a(1668),a(165)),c=(a(1669),a(17)),u=a.n(c),d=(a(20),a(28),a(30),a(87),a(25)),p=a.n(d),h=a(7),f=a.n(h),m=a(6),y=a.n(m),g=a(9),v=a.n(g),S=a(8),b=a.n(S),I=a(10),E=a.n(I),T=(a(78),a(1608),a(14),a(2)),C=a(31),L=(a(1670),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isFlod:!0},a}return E()(t,e),y()(t,[{key:"changeTabFold",value:function(){this.props.changeTabFold(!this.props.fold)}},{key:"goHome",value:function(){var e=DataViz.Plugins||{}||{},t=e.logoHrefTargetSelf,a=e.logoHref||T.a.getRootUrl();try{t?window.open(a,"_self"):window.open(a)}catch(e){t?window.open("errorUrl","_self"):window.open("errorUrl")}}},{key:"render",value:function(){return i.a.createElement("div",{className:"slide-link",tabIndex:"1"},this.props.fold?i.a.createElement(C.a,{placement:"bottom",tooltip:DataViz.Language.expand,labelType:"div",iconClassName:"logo-fold supermapol-icons-packup",onClick:this.changeTabFold.bind(this)}):i.a.createElement("img",{src:this.props.logoUrl,onClick:this.goHome.bind(this)}))}}]),t}(n.Component)),N=Object(o.b)((function(e){return{logoUrl:e.changeTabReducer.logoUrl}}),(function(e){return{}}))(L),k=(a(72),a(11)),O=a.n(k),D=a(184),w=(a(1671),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isEdit:e.isEdit,value:e.value,inputType:e.inputType,disabled:e.disabled||!1},a.onKeyDown=a.onKeyDown.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.value===this.state.value&&e.isEdit===this.state.isEdit&&e.inputType===this.state.inputType&&e.disabled===this.state.disabled||this.changeState(e.value,e.isEdit,e.inputType,e.disabled)}},{key:"onBlur",value:function(e){this.props.onBlur&&this.props.onBlur(e.trim())}},{key:"changeState",value:function(e,t,a,n){this.setState({isEdit:t,inputType:a,value:e,disabled:n})}},{key:"onClick",value:function(e){!this.state.disabled&&this.props.onClick&&this.props.onClick(e)}},{key:"getInputValue",value:function(){return this.refs.myInput&&this.refs.myInput.value}},{key:"componentDidUpdate",value:function(){this.refs.myInput&&this.refs.myInput.focus()}},{key:"onKeyDown",value:function(e){13===e.keyCode&&this.onBlur(this.refs.myInput.value,!1)}},{key:"spanClick",value:function(e){e.stopPropagation(),!this.state.disabled&&this.changeState(this.state.value,!0)}},{key:"render",value:function(){var e=this;return i.a.createElement(D.a,{placement:this.props.placement||"right",trigger:this.props.trigger||"hover",overlay:i.a.createElement("span",null,this.props.tipValue||this.state.value)},i.a.createElement("span",{className:"editable-span "+this.props.className,onClick:this.onClick.bind(this)},this.state.isEdit?i.a.createElement("input",{ref:"myInput",type:"text",className:"error"===this.state.inputType?"error":"",defaultValue:this.state.value,onClick:function(e){e.stopPropagation()},onBlur:function(t){e.onBlur(t.target.value,!1)},onKeyDown:this.onKeyDown}):i.a.createElement("span",{onClick:function(t){e.spanClick(t)}},this.state.value)))}}]),t}(n.Component)),A=a(19);function F(e){return{payload:e,type:A.q}}function M(e){return{payload:e,type:A.p}}function R(e){return{payload:e,type:A.m}}function x(e,t){return{payload:e,operation:t,type:A.n}}function P(e){return{payload:e,type:A.s}}function V(e){return{payload:e,type:A.i}}function B(e){return{payload:e,type:A.h}}a(1672);var U=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"changeTabFold",value:function(){this.props.changeTabFold(!this.props.fold)}},{key:"render",value:function(){return i.a.createElement("div",{className:"fold-btn",tabIndex:"-1"},i.a.createElement(C.a,{placement:"bottom",tooltip:DataViz.Language.packup,labelType:"span",iconClassName:"supermapol-icons-packup",onClick:this.changeTabFold.bind(this)}))}}]),t}(n.Component),G=function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"nav-tabs-header"},i.a.createElement(N,{fold:this.props.fold,changeTabFold:this.props.changeTabFold}),i.a.createElement(w,{className:"title",onBlur:this.props.changeMapInfo.changeMapTitle,value:this.props.mapInfo.mapTitle}),i.a.createElement(U,{fold:this.props.fold,changeTabFold:this.props.changeTabFold}))}}]),t}(n.Component),_=Object(o.b)((function(e){return{mapInfo:e.MapInfoReducer}}),(function(e,t){return{changeMapInfo:{changeMapTitle:function(t){return e(F(t))}}}}))(G),z=a(62),j=a.n(z),W=(a(18),function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"render",value:function(){return i.a.createElement("li",{onClick:this.props.onClick,className:"nav-icon "+(this.props.selected?"active":"")},i.a.createElement("a",{className:"nav-icon-content"},i.a.createElement("span",{className:"nav-icon-font "+this.props.iconFont}),i.a.createElement("span",{className:"nav-icon-name"},this.props.name)))}}]),t}(n.Component)),H=a(26),Y=a.n(H),K=(a(27),a(92),a(12)),X={changeTabCallback:function(e){},changeThemeCallback:function(e){}},q=a(1),J=window.DataViz.Language,Z=T.a.getRootUrl(),Q=T.a.isIE(),$=[{name:"account",title:J.userinfo,icon:"supermapol-icons-account"},{name:"skin",title:J.changeskin,icon:"supermapol-icons-skin1"},{name:"create",title:J.createMap,icon:"supermapol-icons-CreateMap"},{name:"maps",title:J.myMap,icon:"supermapol-icons-MyMaps"},{name:"home",title:J.toIndex,icon:"supermapol-icons-backhomepage"},{name:"feedback",title:J.feedback,icon:"supermapol-icons-feedback"}],ee=[{name:"light",icon:"supermapol-icons-Oval",title:J.themeLight},{name:"dark",icon:"supermapol-icons-Oval",title:J.themeDark},{name:"developing",title:J.themeDeveloping,disable:!0},{},{},{}];function te(e){var t=e.name,a=e.disable,n=e.title,r=e.icon,s=e.onClick,o=a?"user-menu disable":"user-menu";o=t?o:"".concat(o," empty");var l=Q?"onMouseDown":"onClick",c=j()({className:o,name:t},l,s);return i.a.createElement("div",c,i.a.createElement("i",{className:"".concat(r," icon")}),i.a.createElement("span",{className:"title"},n))}var ae=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isLogin:e.isLogin,isShowToolsPanel:!1,isShowSecondaryPanel:!1},a.toolsPanel=i.a.createRef(),a.showToolsPanel=a.showToolsPanel.bind(O()(a)),a.hideToolsPanel=a.hideToolsPanel.bind(O()(a)),a.toolMenuClick=a.toolMenuClick.bind(O()(a)),a.changeSkin=a.changeSkin.bind(O()(a)),a.hideSecondaryPanel=a.hideSecondaryPanel.bind(O()(a)),a}return E()(t,e),y()(t,null,[{key:"getDerivedStateFromProps",value:function(e,t){return e.isLogin!==t.isLogin?{isLogin:e.isLogin}:null}}]),y()(t,[{key:"componentDidMount",value:function(){T.a.checkReLogin()}},{key:"componentDidUpdate",value:function(){this.state.isShowToolsPanel&&this.toolsPanel.current&&this.toolsPanel.current.focus()}},{key:"getLinkUrl",value:function(e){var t,a=window.isSuperMapOL;switch(e){case"account":t="".concat(Z).concat(a?"web/mycontent/account":"web-ui/my-account/account");break;case"maps":t="".concat(Z).concat(a?"web/mycontent/maps":"web-ui/resource-center/map?scope=own&currentPage=1");break;case"create":t="".concat(Z,"apps/dataviz/edit.html");break;case"home":t=Z;break;case"feedback":t="http://wpa.qq.com/msgrd?v=3&uin=21671712690&site=qq&menu=ves"}return t}},{key:"toolMenuClick",value:function(e){var t=e.currentTarget.getAttribute("name"),a=$.find((function(e){return e.name===t}));if(t){var n=a.name;if(!a.disable)if("skin"===n)e.stopPropagation(),this.updateState(void 0,!0);else{var i=this.getLinkUrl(n);window.open(i,"_blank")}}}},{key:"changeSkin",value:function(e){e.stopPropagation();var t=e.currentTarget.getAttribute("name");t&&"developing"!==t&&(T.a.changeTheme(t),"localStorage"in window&&window.localStorage.setItem(q.a,t),X.changeThemeCallback(name))}},{key:"updateState",value:function(e,t){var a=this.state;void 0!==e&&(a.isShowToolsPanel=e),void 0!==t&&(a.isShowSecondaryPanel=t),this.setState(a)}},{key:"showToolsPanel",value:function(){var e=this;T.a.checkReLogin().then((function(){e.updateState(!0)})).catch((function(){K.a.showLoinBox({onSucceed:function(){e.updateState(!0)}})}))}},{key:"hideToolsPanel",value:function(){this.updateState(!1,!1)}},{key:"hideSecondaryPanel",value:function(){this.updateState(void 0,!1)}},{key:"renderPanel",value:function(e){var t=this;if(e){var a=j()({className:"header"},Q?"onMouseDown":"onClick",this.hideSecondaryPanel);return i.a.createElement("div",{className:"user-secondary-container"},i.a.createElement("div",a,i.a.createElement("i",{className:"supermapol-icons-return"}),i.a.createElement("span",null,J.changeskin)),i.a.createElement("div",{className:"content"},ee.map((function(e,a){var n=e.name?e.name:a;return i.a.createElement(te,Y()({key:n},e,{onClick:t.changeSkin}))}))))}return i.a.createElement("div",{className:"user-menus-container"},$.map((function(e){return"feedback"===e.name&&(e.disable=!window.isSuperMapOL),i.a.createElement(te,Y()({key:e.name},e,{onClick:t.toolMenuClick}))})))}},{key:"render",value:function(){var e=this.state,t=e.isLogin,a=e.isShowToolsPanel,n=e.isShowSecondaryPanel,r="supermapol-icons-out-head-pic user-icon".concat(t?" login":"");return i.a.createElement("li",{className:"dv-user"},i.a.createElement("i",{className:r,onClick:this.showToolsPanel}),a&&i.a.createElement("div",{ref:this.toolsPanel,className:"user-tools-panel",tabIndex:"-1",onBlur:this.hideToolsPanel},this.renderPanel(n)))}}]),t}(n.Component),ne=(a(73),a(43),a(44),a(40),a(36),a(69),a(84)),ie=a(24),re=a(61),se=(a(71),a(54),a(32),a(56)),oe=a(33),le=a.n(oe),ce=a(154),ue=(a(1673),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isRequested:!1,checkLists:a.props.inputValue.slice(),inputValue:a.props.inputValue.slice(),isLoading:!0},a.datas=[],a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){if(e.inputValue){var t=e.inputValue.slice();this.updateState({checkLists:t,inputValue:t})}}},{key:"getTagsDatas",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this,a=T.a.getIPortalUrl()+"web/tags.json?",n="userName=".concat(e,"&t=").concat((new Date).getTime());return T.a.doFetch(a+encodeURI(n),{method:"GET",withCredentials:!0}).then((function(e){e.forEach((function(e){t.datas.push(e.tag)})),t.updateState({isRequested:!0})})).catch((function(e){t.updateState({isRequested:!1})}))}},{key:"getTagsContentUI",value:function(){var e,t=this,a=[];return this.state.isRequested&&this.datas.forEach((function(n,r){var s=t.state.checkLists.indexOf(n)>-1?" checked":"";e=i.a.createElement(se.a,{className:"maptags-content-item"+s,name:n,key:r},i.a.createElement("span",null,n)),a.push(e)}),this),a}},{key:"getUIContent",value:function(){return this.state.isLoading?i.a.createElement("div",{className:"maptags-loading"},i.a.createElement(ce.a,null)):0!==this.datas.length?i.a.createElement(oe.Scrollbars,{className:"scroll-bars maptags-content"},i.a.createElement(se.b,{checkLists:this.state.checkLists,onChange:this.onSelectedItemChanged.bind(this)},this.getTagsContentUI())):i.a.createElement("div",{className:"maptags-nodata"},this.state.isRequested?DataViz.Language.noTags:DataViz.Language.tagRequestFail)}},{key:"onItemClick",value:function(e){var t=e.target.innerHTML,a=this.state.checkLists.indexOf(t);a>-1?this.state.checkLists.splice(a,1):this.state.checkLists.push(t),this.onSelectedItemChanged()}},{key:"showMapTagsModalBox",value:function(){this.refs.modal.showModal()}},{key:"saveSelectedTags",value:function(){this.refs.modal.hideModal();var e=this.state.checkLists.slice();this.updateState({inputValue:e}),this.props.onChange&&this.props.onChange(e)}},{key:"hideMapTagsModalBox",value:function(){this.refs.modal.hideModal()}},{key:"onSelectedItemChanged",value:function(){this.state.checkLists.length>6&&(this.state.checkLists.pop(),K.a.showMessage(DataViz.Language.warnMessage,q.j.WARNING)),this.updateOkButtonStatus(),this.updateState({checkLists:this.state.checkLists})}},{key:"afterOpenModal",value:function(){var e=this;this.state.isRequested?this.updateOkButtonStatus():T.a.checkReLogin().then((function(t){e.getTagsDatas(t.name).then((function(){e.updateState({isLoading:!1}),e.updateOkButtonStatus()}))})).catch((function(){e.getTagsDatas().then((function(){e.updateState({isLoading:!1}),e.updateOkButtonStatus()}))})),this.updateState({checkLists:this.state.inputValue.slice()})}},{key:"updateOkButtonStatus",value:function(){for(var e=0,t=0;t<this.state.checkLists.length;t++)this.datas.indexOf(this.state.checkLists[t])>-1&&e++;0===e?this.refs.modal.disableConfirm():this.refs.modal.enableConfirm()}},{key:"updateState",value:function(e){var t=Object.assign({},this.state,e);this.setState(t)}},{key:"changeValue",value:function(e){var t=""===e.target.value?[]:e.target.value.split(",");t.length>6&&K.a.showMessage(DataViz.Language.warnMessage,q.j.WARNING),this.updateState({inputValue:t})}},{key:"onBlur",value:function(){var e=this.state.inputValue.slice().filter((function(e,t,a){return""!==e.trim()&&a.indexOf(e)===t}));e.length>6&&(e=e.slice(0,6)),this.updateState({checkLists:e,inputValue:e}),this.props.onChange&&this.props.onChange(e)}},{key:"render",value:function(){var e=this.state.inputValue.join(",");return i.a.createElement("div",{className:this.props.className?"dataViz-maptags "+this.props.className:"dataViz-maptags"},i.a.createElement("input",{type:"text",className:"maptags-text",value:e,onChange:this.changeValue.bind(this),onBlur:this.onBlur.bind(this),title:e,placeholder:DataViz.Language.noneMapTags}),i.a.createElement("a",{className:"maptags-btn supermapol-icons-add",onClick:this.showMapTagsModalBox.bind(this)},i.a.createElement("span",null,DataViz.Language.addTags)),i.a.createElement(re.a,{ref:"modal",modalTitle:DataViz.Language.tagLibrary,okButton:DataViz.Language.useSelectedTags,modalWidth:"358px",modalHeight:"328px",okCallBack:this.saveSelectedTags.bind(this),cancelCallBack:this.hideMapTagsModalBox.bind(this),afterOpenModal:this.afterOpenModal.bind(this)},i.a.createElement("div",{className:"maptags-tip"},DataViz.Language.tagLibraryTitle,i.a.createElement("span",null,DataViz.Language.tagLibraryTitleTip)),this.getUIContent()))}}]),t}(n.Component)),de=(a(1674),a(5)),pe=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).mapInfo=a.props.mapInfo,a.state=Object.assign({isNew:!1},a.mapInfo),a}return E()(t,e),y()(t,[{key:"showModalBox",value:function(e,t,a){this.mapInfo=e;var n=Object.assign({isNew:t},this.mapInfo);this.updateState(n),this.saveBtnCallBack=a,this.refs.modal.showModal()}},{key:"onChangeTitle",value:function(e){this.updateState({mapTitle:e.target.value})}},{key:"onChangeMapTags",value:function(e){this.updateState({mapTags:e})}},{key:"onChangeDescription",value:function(e){this.updateState({mapDescription:e.target.value})}},{key:"saveMap",value:function(e){""===this.state.mapTitle&&K.a.showMessage(DataViz.Language.noneMapTitle,q.j.WARNING),0===this.state.mapTags.length&&K.a.showMessage(DataViz.Language.noMapTags,q.j.WARNING),""!==this.state.mapTitle&&this.state.mapTags.length>0&&(this.updateMapInfo(),ne.a.save(this.state,e),this.refs.modal.hideModal())}},{key:"updateMapInfo",value:function(){this.state.mapTitle!==this.mapInfo.mapTitle&&this.props.changeMapInfo.changeMapTitle(this.state.mapTitle),this.state.mapTags!==this.mapInfo.mapTags&&this.props.changeMapInfo.changeMapTags(this.state.mapTags),this.state.mapDescription!==this.mapInfo.mapDescription&&this.props.changeMapInfo.changeMapDescription(this.state.mapDescription)}},{key:"afterOpenModal",value:function(){var e=this.state.isNew?this.state.mapTitle+DataViz.Language.copy:this.state.mapTitle;this.updateState({mapTitle:e})}},{key:"updateState",value:function(e){var t=Object.assign({},this.state,e);this.setState(t)}},{key:"render",value:function(){var e=this,t={modalTitle:this.state.isNew?DataViz.Language.mapSaveAs:DataViz.Language.mapSave,okButton:this.state.isNew?DataViz.Language.saveAs:DataViz.Language.save,cancelButton:DataViz.Language.close,modalWidth:"416px",modalHeight:"200px",okCallBack:function(){e.saveMap(e.saveBtnCallBack&&e.saveBtnCallBack.bind(e))},afterOpenModal:this.afterOpenModal.bind(this)};return i.a.createElement(re.a,Y()({ref:"modal"},t),i.a.createElement("div",{style:{padding:"16px 24px 0 24px"}},i.a.createElement("div",{className:"save-title"},i.a.createElement("span",null,DataViz.Language.title),i.a.createElement("input",{type:"text",value:this.state.mapTitle,onChange:this.onChangeTitle.bind(this),placeholder:DataViz.Language.noneMapTitle})),i.a.createElement("div",{className:"save-maptags"},i.a.createElement("span",null,DataViz.Language.label),i.a.createElement("div",{className:"maptags-control"},i.a.createElement(ue,{inputValue:this.state.mapTags,onChange:this.onChangeMapTags.bind(this)}),i.a.createElement("p",{className:"maptags-tips"},DataViz.Language.tagTips))),i.a.createElement("div",{className:"save-description"},i.a.createElement("span",null,DataViz.Language.description),i.a.createElement("textarea",{value:this.state.mapDescription,onChange:this.onChangeDescription.bind(this),placeholder:DataViz.Language.noneDescription}))))}}]),t}(n.Component),he=a(136),fe=a.n(he),me=(a(1675),DataViz.Language),ye=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={dataLayerInfo:null,selectAll:!0},a.mapInfo=null,a.isNew=null,a.saveBtnCallBack=null,a.modalBox=i.a.createRef(),a.showModalBox=a.showModalBox.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this,t=ne.a.appID?DataViz.Language.save:DataViz.Language.nextStep,a={modalTitle:DataViz.Language.dataSave,okButton:t,cancelButton:DataViz.Language.close,modalWidth:"416px",modalHeight:"340px",okCallBack:function(){if(e.modalBox.current.hideModal(),ne.a.appID){var t=Object.assign({isNew:e.isNew},e.mapInfo);ne.a.save(t),e.saveBtnCallBack&&e.saveBtnCallBack()}else e.saveBtnCallBack&&e.saveBtnCallBack()}};return i.a.createElement(re.a,Y()({ref:this.modalBox},a),i.a.createElement("div",{className:"dataviz-save-data-tips"}," ",me.confirmUpdateDataSave," "),i.a.createElement(se.a,{className:"dataviz-select-all",onChange:this.changeSelectedData.bind(this,null),checked:this.state.selectAll},me.selectTips),i.a.createElement("div",{className:"dataviz-save-data-lists"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},this.getUpdateDataLayerUI())))}},{key:"getUpdateDataLayerUI",value:function(){var e=this,t=this.state.dataLayerInfo;if(!t)return"";var a=[],n=function(n){var r=[],s=t[n];if(!s.layerNames)return{v:""};s.layerNames.forEach((function(e,t){r.push(i.a.createElement("div",{key:e+t,className:"dataviz-layer-name"},"- "+e))})),a.push(i.a.createElement("div",{key:n,className:"dataviz-data-item"},i.a.createElement(se.a,{onChange:e.changeSelectedData.bind(e,n),checked:s.checked},s.dataName," "),r))};for(var r in t){var s=n(r);if("object"===fe()(s))return s.v}return 0===a.length?"":a}},{key:"showModalBox",value:function(e,t,a){this.mapInfo=e,this.isNew=t,this.saveBtnCallBack=a;var n=ie.a.updateDataLayerInfo();this.setState({dataLayerInfo:n,selectAll:this.isSelectAll(n)}),this.modalBox.current.showModal()}},{key:"changeSelectedData",value:function(e,t){var a=ie.a.dataLayerInfo;if(e)a[e].checked=t.target.checked,this.setState({dataLayerInfo:a,selectAll:this.isSelectAll(a)});else{var n=!this.state.selectAll;for(var i in this.setState({selectAll:n}),a)a[i].checked=n}}},{key:"isSelectAll",value:function(e){for(var t in e)if(!1===e[t].checked)return!1;return!0}}]),t}(n.Component),ge=a(21);a(1676);function ve(e){return i.a.createElement("div",{className:e.unShare?"side-bar-btn share-disabled":"side-bar-btn",onClick:e.onClick},i.a.createElement("span",{className:e.iconClass}),i.a.createElement("div",{className:"btn-name"},e.title))}var Se=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={focus:!1,unShare:!1},a.clickSaveBtn=a.clickSaveBtn.bind(O()(a)),a.clickShareBtn=a.clickShareBtn.bind(O()(a)),a.showModalBox=a.showModalBox.bind(O()(a)),a.showShareWindow=a.showShareWindow.bind(O()(a)),a.updateAuthorizeSetting=a.updateAuthorizeSetting.bind(O()(a)),a.shareModal=i.a.createRef(),a.parentSelector=document.querySelector(".root"),a}return E()(t,e),y()(t,[{key:"modifyState",value:function(e){var t=this;this.setState({focus:e},(function(){e&&t.modal.focus()})),e?this.refs.saveAsTriangleIcon.classList.add("active"):this.refs.saveAsTriangleIcon.classList.remove("active")}},{key:"showModalBox",value:function(e){var t=this,a=!ne.a.appID,n=!1;"saveAs"===e&&(n=!0,a=!0);var i=Object.keys(ie.a.updateFeatures),r=Object.assign({changeAuthorizeSetting:t.props.changeAuthorizeSetting,authorizeSetting:t.props.mapInfo.authorizeSetting},t.props.mapInfo),s=function(){var a=null;"share"===e&&t.shareModal.current&&(a=function(e){t.shareModal.current.showModal(window.location.href.replace("edit","view"))}),t.refs.saveModalBox.showModalBox(r,n,a)};0===i.length?a?s():ne.a.save(r):a?t.refs.saveDataModalBox.showModalBox(t.props.mapInfo,n,s):t.refs.saveDataModalBox.showModalBox(t.props.mapInfo,n)}},{key:"render",value:function(){var e=this,t=T.a.getChildToolsConfig();return i.a.createElement("li",{className:"save-btn-group"},i.a.createElement(ve,{title:DataViz.Language.share,iconClass:"supermapol-icons-share",onClick:this.clickShareBtn,unShare:this.props.unShare}),i.a.createElement("div",{className:"save-btn"},i.a.createElement(ve,{title:DataViz.Language.save,iconClass:"supermapol-icons-save",onClick:function(){e.clickSaveBtn("save")}}),i.a.createElement("span",{ref:"saveAsTriangleIcon",className:"supermapol-icons-solid-triangle rotate",onClick:function(){return e.modifyState(!e.state.focus)}})),i.a.createElement("ul",{ref:function(t){e.modal=t},className:"save-btn-list",style:{display:this.state.focus?"block":"none"},onBlur:this.modifyState.bind(this,!1),tabIndex:"-1"},i.a.createElement("li",null,i.a.createElement("a",{onClick:function(){e.clickSaveBtn("save")}},DataViz.Language.save)),i.a.createElement("li",null,i.a.createElement("a",{className:this.props.unShare?"share-disabled":"",onClick:function(){e.clickSaveBtn("saveAs")}},DataViz.Language.saveAs))),i.a.createElement(pe,{ref:"saveModalBox",mapInfo:this.props.mapInfo,changeMapInfo:this.props.changeMapInfo}),i.a.createElement(ye,{ref:"saveDataModalBox"}),i.a.createElement(ge.n,{ref:this.shareModal,name:this.props.mapInfo.mapTitle,description:this.props.mapInfo.mapDescription,mapTags:this.props.mapInfo.mapTags,authorizeSetting:this.props.mapInfo.authorizeSetting,isShareToOther:t.SHARE_TO_OTHER,isQRcordShare:t.QRCORD_SHARE,appUrl:window.location.href.replace("edit","view"),updateProjectInfo:this.updateAuthorizeSetting,parentSelector:this.parentSelector,langs:DataViz.Language.shareWindow,isPut2Post:DataViz.Plugins.isPut2Post,isDelete2Get:DataViz.Plugins.isDelete2Get}))}},{key:"clickSaveBtn",value:function(e){if("saveAs"!==e||!this.props.unShare){var t=this;T.a.checkReLogin().then((function(a){T.a.hasDatavizPermission().then((function(a){a?t.showModalBox(e):K.a.showMessage(DataViz.Language.noPermission2,q.j.ERROR)}))})).catch((function(a){K.a.showLoinBox({onSucceed:t.showModalBox.bind(t,e)})}))}}},{key:"clickShareBtn",value:function(){if(!this.props.unShare){var e=this;T.a.checkReLogin().then((function(t){e.props.unShare||e.showShareWindow()})).catch((function(t){K.a.showLoinBox({onSucceed:e.showShareWindow})}))}}},{key:"showShareWindow",value:function(){ne.a.appID?this.shareModal.current&&this.shareModal.current.showModal(window.location.href.replace("edit","view")):(K.a.showMessage(DataViz.Language.saveMapBefore,q.j.WARNING),this.showModalBox("share"))}},{key:"updateAuthorizeSetting",value:function(e){var t=Object.keys(e)[0],a=e[t];"authorizeSetting"===t&&this.props.changeAuthorizeSetting(a)}}]),t}(n.Component);function be(e){return{payload:e,type:A.u}}function Ie(e){return{isLogin:e,type:A.l}}a(1687);var Ee=function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"componentDidMount",value:function(){T.a.actions.changeLoginStatus=this.props.changeLoginStatus}},{key:"onIconClick",value:function(e){this.props.changeMenuTab(e)}},{key:"getMenuTabs",value:function(){var e=this,t=[],a=this.props.selectedId;DataViz.Plugins&&DataViz.Plugins.menus&&DataViz.Plugins.menus.length>0&&DataViz.Plugins.menus.forEach((function(n){t.push(i.a.createElement(W,{key:n.id,selected:n.id===a,onClick:e.onIconClick.bind(e,n.id),name:n.title,iconFont:n.iconClass}))}));return t}},{key:"render",value:function(){var e;return i.a.createElement("ul",{className:"nav-tabs-left"},this.getMenuTabs(),i.a.createElement(Se,(e={fold:this.props.fold,mapInfo:this.props.mapInfo,changeMapInfo:this.props.changeMapInfo,changeTabFold:this.props.changeTabFold,unShare:this.props.unShare},j()(e,"changeMapInfo",this.props.changeMapInfo),j()(e,"changeAuthorizeSetting",this.props.changeAuthorizeSetting),e)),i.a.createElement(ae,{isLogin:this.props.isLogin}))}}]),t}(n.Component),Te=Object(o.b)((function(e){return{mapInfo:e.MapInfoReducer,unShare:e.changeTabReducer.unShare,isLogin:e.changeTabReducer.isLogin}}),(function(e){return{changeMapInfo:{changeMapTitle:function(t){return e(F(t))},changeMapTags:function(t){return e(M(t))},changeMapDescription:function(t){return e(R(t))}},changeLoginStatus:function(t){return e(Ie(t))},changeAuthorizeSetting:function(t){return e(B(t))}}}))(Ee),Ce=(a(333),a(22)),Le=(a(1688),window.DataViz.Language),Ne=function(e){function t(e){var a;f()(this,t),a=v()(this,b()(t).call(this,e));var n=e.layerObj.layerInfo;a.state={selectedIndex:a.getSelectedIndex(e.themeType,n.featureType),featureType:n.featureType,layerType:n.layerType};var i=e.layerObj.features?e.layerObj.features.length:null;return a.uiInfs=a.getUIInfs(e.layerObj.layerInfo.featureType,i),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.layerObj.layerInfo;this.state.featureType!==t.featureType&&(this.uiInfs=this.getUIInfs(t.featureType,e.layerObj.features.length)),this.updateState(this.getSelectedIndex(e.themeType,t.featureType),t.featureType)}},{key:"updateState",value:function(e,t){this.setState({selectedIndex:e,featureType:t})}},{key:"getUIInfs",value:function(e,t){var a=[];switch(e){case q.p.POINT:a=[q.r.DATAFLOW,q.r.DATAFLOWHEAT].includes(this.state.layerType)?[{name:Le.baseSetting,className:"point-base",type:q.r.DATAFLOW,usable:!0},{name:Le.layerHeat,className:"point-heat",type:q.r.DATAFLOWHEAT,usable:t<=Ce.a.pointThemeLayerMaxCount}]:[{name:Le.baseSetting,className:"point-base",type:q.r.VECTOR,usable:!0},{name:Le.layerUnique,className:"point-unique",type:q.r.UNIQUE,usable:t<=Ce.a.pointThemeLayerMaxCount},{name:Le.layerRange,className:"point-range",type:q.r.RANGE,usable:t<=Ce.a.pointThemeLayerMaxCount},{name:Le.layerHeat,className:"point-heat",type:q.r.HEAT_MAP,usable:t<=Ce.a.pointThemeLayerMaxCount},{name:Le.layerRankSymbol,className:"point-ranksymbol",type:q.r.RANK_SYMBOL,usable:t<=Ce.a.pointThemeLayerMaxCount},{name:Le.layerMigration,className:"point-migration",type:q.r.MIGRATION,usable:t<=Ce.a.pointThemeLayerMaxCount}];break;case q.p.LINE:a=[{name:Le.baseSetting,className:"line-base",type:q.r.VECTOR,usable:!0},{name:Le.layerUnique,className:"line-unique",type:q.r.UNIQUE,usable:t<=Ce.a.themeLayerMaxCount},{name:Le.layerRange,className:"line-range",type:q.r.RANGE,usable:t<=Ce.a.themeLayerMaxCount}];break;case q.p.POLYGON:case q.p.REGION:a=[{name:Le.baseSetting,className:"region-base",type:q.r.VECTOR,usable:!0},{name:Le.layerUnique,className:"region-unique",type:q.r.UNIQUE,usable:t<=Ce.a.themeLayerMaxCount},{name:Le.layerRange,className:"region-range",type:q.r.RANGE,usable:t<=Ce.a.themeLayerMaxCount},{name:Le.layerMigration,className:"region-migration",type:q.r.MIGRATION,usable:t<=Ce.a.pointThemeLayerMaxCount}]}return a}},{key:"getSelectedIndex",value:function(e,t){var a=0;switch(e){case q.r.UNIQUE:case q.r.DATAFLOWHEAT:a=1;break;case q.r.RANGE:a=2;break;case q.r.HEAT_MAP:a=3;break;case q.r.RANK_SYMBOL:a=4;break;case q.r.MIGRATION:a=t===q.p.POLYGON||t===q.p.REGION?3:5}return a}},{key:"getAllLayersUI",value:function(){var e=[];return this.uiInfs.forEach((function(t,a){if(t.name){var n,r="layer-type-img "+t.className;if(t.inVisible)return;t.usable||(r+="-unable",n=Le.overThemeLayerMaxCount),a===this.state.selectedIndex&&(r+=" img-selected");var s=i.a.createElement("div",{key:a,className:"layer-type"},i.a.createElement("div",{className:r,onClick:this.changeLayerType.bind(this),index:a,title:n}),i.a.createElement("div",{className:"layer-type-text"},t.name));e.push(s)}}),this),e}},{key:"changeLayerType",value:function(e){var t=parseInt(e.currentTarget.getAttribute("index")),a=this.uiInfs[t],n=this.props.layerObj.layerInfo,i=n.dataTypes||n.dataSource&&n.dataSource.dataTypes||{},r=Object.values(i);if(a.usable){if(a.type===q.r.RANGE&&!r.includes(q.c.NUMBER))return void K.a.showMessage(Le.notSupportRange);var s=a.type;this.props.layerObj.changeLayerType(s),this.props.updateState(null,s),this.props.updateLegendView(null,(new Date).getTime())}}},{key:"render",value:function(){var e=108,t=this.uiInfs.length;return t>3&&t<7?e=202:t>6&&(e=198),this.contentHeight=e,i.a.createElement("div",{className:"layer-types",style:{height:e+"px"}},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},i.a.createElement("div",{className:"layer-types-content"},this.getAllLayersUI())))}},{key:"componentDidMount",value:function(){this.setThemeToolsHeight()}},{key:"setThemeToolsHeight",value:function(){var e=window.document.getElementsByClassName("theme-tools")[0];e&&(e.style.height="calc(100% - 52px - ".concat(this.contentHeight,"px)"))}}]),t}(n.Component);a(1689);var ke,Oe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(function(a){function n(e){var t;return f()(this,n),(t=v()(this,b()(n).call(this,e))).state={isOpened:!!e.isOpened,hideArrow:!!e.hideArrow},t.changeStatus=t.changeStatus.bind(O()(t)),t}return E()(n,a),y()(n,[{key:"changeStatus",value:function(){if(!this.props.disabled){var e=!this.state.isOpened;this.setState({isOpened:e}),this.props.onChange&&this.props.onChange(e)}}},{key:"render",value:function(){var a="supermapol-icons-legend-unfold",n="collapse-content hide";return this.state.isOpened&&(a="supermapol-icons-legend-fold",n="collapse-content"),i.a.createElement("div",{className:"collapse-contianer"},i.a.createElement("div",{className:"collapse-header".concat(this.props.disabled?" disabled":""),onClick:this.changeStatus},i.a.createElement("span",{className:"title"},t.title),!this.props.hideArrow&&i.a.createElement("a",{className:a})),i.a.createElement("div",{className:n},i.a.createElement(e,this.props)))}}]),n}(n.Component))},De=(a(112),a(207),[[{className:"supermapol-icons-Oval",name:"Oval",unicode:"&#xe69b"},{className:"supermapol-icons-Triangle",name:"Triangle",unicode:"&#xe69e"},{className:"supermapol-icons-Rectangle",name:"Rectangle",unicode:"&#xe69c"},{className:"supermapol-icons-Star",name:"Star",unicode:"&#xe69d"}],[{className:"supermapol-icons-Shape-49",name:"Shape2-1",unicode:"&#xe690"},{className:"supermapol-icons-Shape-50",name:"Shape2-2",unicode:"&#xe691"},{className:"supermapol-icons-Shape-51",name:"Shape2-3",unicode:"&#xe692"},{className:"supermapol-icons-Shape-52",name:"Shape2-4",unicode:"&#xe693"},{className:"supermapol-icons-Shape-53",name:"Shape2-5",unicode:"&#xe694"},{className:"supermapol-icons-Shape-56",name:"Shape2-6",unicode:"&#xe697"},{className:"supermapol-icons-Shape-54",name:"Shape3-1",unicode:"&#xe695"},{className:"supermapol-icons-Shape-55",name:"Shape3-2",unicode:"&#xe696"},{className:"supermapol-icons-Shape-46",name:"Shape3-3",unicode:"&#xe68d"},{className:"supermapol-icons-Shape-57",name:"Shape3-4",unicode:"&#xe698"},{className:"supermapol-icons-Shape-58",name:"Shape3-5",unicode:"&#xe699"},{className:"supermapol-icons-Shape-59",name:"Shape3-6",unicode:"&#xe69a"},{className:"supermapol-icons-Shape-38",name:"Shape4-1",unicode:"&#xe685"},{className:"supermapol-icons-Shape-36",name:"Shape4-2",unicode:"&#xe683"},{className:"supermapol-icons-Shape-39",name:"Shape4-3",unicode:"&#xe686"},{className:"supermapol-icons-Shape-37",name:"Shape4-4",unicode:"&#xe684"},{className:"supermapol-icons-Shape-40",name:"Shape4-5",unicode:"&#xe687"},{className:"supermapol-icons-Shape-41",name:"Shape4-6",unicode:"&#xe688"},{className:"supermapol-icons-Shape-42",name:"Shape5-1",unicode:"&#xe689"},{className:"supermapol-icons-Shape-45",name:"Shape5-2",unicode:"&#xe68c"},{className:"supermapol-icons-Shape-43",name:"Shape5-3",unicode:"&#xe68a"},{className:"supermapol-icons-Shape-44",name:"Shape5-4",unicode:"&#xe68b"},{className:"supermapol-icons-Shape-48",name:"Shape5-5",unicode:"&#xe68f"},{className:"supermapol-icons-Shape-47",name:"Shape5-6",unicode:"&#xe68e"},{className:"supermapol-icons-Shape-32",name:"Shape6-1",unicode:"&#xe67f"},{className:"supermapol-icons-Shape-35",name:"Shape6-2",unicode:"&#xe682"},{className:"supermapol-icons-Shape-33",name:"Shape6-3",unicode:"&#xe680"},{className:"supermapol-icons-Shape-23",name:"Shape6-4",unicode:"&#xe676"},{className:"supermapol-icons-Shape-25",name:"Shape6-5",unicode:"&#xe678"},{className:"supermapol-icons-Shape-26",name:"Shape6-6",unicode:"&#xe679"},{className:"supermapol-icons-Shape-34",name:"Shape7-1",unicode:"&#xe681"},{className:"supermapol-icons-Shape-27",name:"Shape7-2",unicode:"&#xe67a"},{className:"supermapol-icons-Shape-29",name:"Shape7-3",unicode:"&#xe67c"},{className:"supermapol-icons-Shape-30",name:"Shape7-4",unicode:"&#xe67d"},{className:"supermapol-icons-Shape-28",name:"Shape7-5",unicode:"&#xe67b"},{className:"supermapol-icons-Shape-31",name:"Shape7-6",unicode:"&#xe67e"},{className:"supermapol-icons-Shape-12",name:"Shape8-1",unicode:"&#xe66b"},{className:"supermapol-icons-Shape-14",name:"Shape8-2",unicode:"&#xe66d"},{className:"supermapol-icons-Shape-13",name:"Shape8-3",unicode:"&#xe66c"},{className:"supermapol-icons-Shape-16",name:"Shape8-4",unicode:"&#xe66f"},{className:"supermapol-icons-Shape-15",name:"Shape8-5",unicode:"&#xe66e"},{className:"supermapol-icons-Shape-18",name:"Shape8-6",unicode:"&#xe671"},{className:"supermapol-icons-Shape-17",name:"Shape9-1",unicode:"&#xe670"},{className:"supermapol-icons-Shape-19",name:"Shape9-2",unicode:"&#xe672"},{className:"supermapol-icons-Shape-20",name:"Shape9-3",unicode:"&#xe673"},{className:"supermapol-icons-Shape-21",name:"Shape9-4",unicode:"&#xe674"},{className:"supermapol-icons-Shape-24",name:"Shape9-5",unicode:"&#xe677"},{className:"supermapol-icons-Shape-22",name:"Shape9-6",unicode:"&#xe675"},{className:"supermapol-icons-Shape-1",name:"Shape10-1",unicode:"&#xe660"},{className:"supermapol-icons-Shape-",name:"Shape10-2",unicode:"&#xe65e"},{className:"supermapol-icons-Shape-4",name:"Shape10-3",unicode:"&#xe663"},{className:"supermapol-icons-Shape-2",name:"Shape10-4",unicode:"&#xe661"},{className:"supermapol-icons-Shape-3",name:"Shape10-5",unicode:"&#xe662"},{className:"supermapol-icons-Shape-8",name:"Shape10-6",unicode:"&#xe667"},{className:"supermapol-icons-Shape-7",name:"Shape11-1",unicode:"&#xe666"},{className:"supermapol-icons-Shape-5",name:"Shape11-2",unicode:"&#xe664"},{className:"supermapol-icons-Shape-6",name:"Shape11-3",unicode:"&#xe665"},{className:"supermapol-icons-Shape-9",name:"Shape11-4",unicode:"&#xe668"},{className:"supermapol-icons-Shape-11",name:"Shape11-5",unicode:"&#xe66a"},{className:"supermapol-icons-Shape-10",name:"Shape11-6",unicode:"&#xe669"}]]),we=[{className:"image-basic",num:24,title:DataViz.Language.symbolCommon,name:"basic"},{className:"image-life",num:131,title:DataViz.Language.symbolLifeService,name:"life"},{className:"image-animal",num:67,title:DataViz.Language.symbolAnimalsAndPlants,name:"animal"},{className:"image-business",num:59,title:DataViz.Language.symbolBusiness,name:"business"},{className:"image-nature",num:33,title:DataViz.Language.symbolNature,name:"nature"}],Ae=[{className:"supermapol-icons-od-circle",name:"circle",unicode:"&#xe6e0"},{className:"supermapol-icons-od-rect",name:"rect",unicode:"&#xe6de"},{className:"supermapol-icons-od-roundrect",name:"roundRect",unicode:"&#xe6df"},{className:"supermapol-icons-od-triangle",name:"triangle",unicode:"&#xe6e3"},{className:"supermapol-icons-od-diamond",name:"diamond",unicode:"&#xe6e1"},{className:"supermapol-icons-od-pin",name:"pin",unicode:"&#xe6e2"},{className:"supermapol-icons-od-arrow",name:"arrow",unicode:"&#xe6e4"}],Fe=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isShow:!1,imgSelectedIdx:0,selectedItem:e.symbolName,top:0},a.hideContainer=a.hideContainer.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({selectedItem:e.symbolName})}},{key:"componentDidUpdate",value:function(){this.container&&this.state.isShow&&this.container.focus()}},{key:"symbolClick",value:function(e,t){var a=this;if(this.state.selectedItem!==e.name)if("SYMBOL_POINT"===this.props.symbolType||e.unicode)this.props.editor("symbolInfo",e,this.props.parentKey);else{var n=new Image;n.src=e.path,n.onload=function(){a.props.editor("imageInfo",{url:e.path,img:n,size:{h:80,w:80}},a.props.parentKey)}}}},{key:"switchContent",value:function(e,t){this.stopPropagation(t),this.setState({imgSelectedIdx:e})}},{key:"getMenus",value:function(){var e=this,t=[];if("IMAGE_POINT"===this.props.symbolType)we.forEach((function(a,n){var r=e.state.imgSelectedIdx===n,s=i.a.createElement("li",{className:"item ".concat(r?" selected":""),key:n,onClick:e.switchContent.bind(e,n)},a.title);t.push(s)}));else{var a=this.props.layerType===q.r.MIGRATION;(a?Ae.slice():De[0].slice()).forEach((function(n,r){var s=e.state.selectedItem===(a?n.name:n.className),o=i.a.createElement("li",{key:r,className:"item ".concat(n.className).concat(s?" selected":""),onClick:e.symbolClick.bind(e,n)});t.push(o)}))}return t}},{key:"getContent",value:function(){var e=this,t=[];if("IMAGE_POINT"===this.props.symbolType)for(var a=we[this.state.imgSelectedIdx],n=a.className,r=a.num,s=a.name,o=0;o<r;o++){var l=parseInt(o/10),c=o%10,u="".concat(s,"-").concat(o+1),d="-".concat(36*c,"px -").concat(36*l,"px"),p="./static/imgs/layer_editor/point_imgs_v1/{name}.png".replace("{name}",u),h=this.state.selectedItem.indexOf("".concat(u,"."))>-1,f=i.a.createElement("li",{key:o,className:"item ".concat(n).concat(h?" selected":""),style:{backgroundPosition:d},onClick:this.symbolClick.bind(this,{path:p})});t.push(f)}else De[1].forEach((function(a,n){var r=e.state.selectedItem===a.className,s=i.a.createElement("li",{key:n,className:"item ".concat(a.className).concat(r?" selected":""),onClick:e.symbolClick.bind(e,a)});t.push(s)}));return t}},{key:"stopPropagation",value:function(e){e.stopPropagation()}},{key:"showContainer",value:function(e,t){var a,n=this.props.layerType===q.r.MIGRATION?"IMAGE_POINT"===this.props.symbolType?287:41:287;a=e+n>document.body.clientHeight?e-n-t/2:e+t,this.setState({isShow:!0,top:a}),this.changeCurrentMenu(this.props.symbolType,this.props.symbolName),this.props.changeIconStatus(!0)}},{key:"changeCurrentMenu",value:function(e,t){if("IMAGE_POINT"===e){var a=we.findIndex((function(e){return t.indexOf(e.name)>-1}));this.setState({imgSelectedIdx:-1===a?0:a})}}},{key:"hideContainer",value:function(e){this.stopPropagation(e),this.setState({isShow:!1}),this.props.changeIconStatus(!1)}},{key:"render",value:function(){var e=this,t=this.props.layerType===q.r.MIGRATION,a="IMAGE_POINT"===this.props.symbolType,n=t&&!a?"symbols-container migration":"symbols-container";return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{ref:function(t){e.container=t},className:n,tabIndex:"-1",onBlur:this.hideContainer,style:{display:this.state.isShow?"flex":"none",top:"".concat(this.state.top,"px")},onClick:this.stopPropagation},i.a.createElement("div",{className:"symbols-menu".concat(a?" img":" symbol")},this.getMenus()),(!t||t&&a)&&i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},i.a.createElement("div",{className:"symbols-content"},this.getContent()))))}}]),t}(n.Component),Me=window.DataViz.Language,Re=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={symbolName:e.symbolName||"supermapol-icons-Oval",symbolType:e.symbolType||"SYMBOL_POINT"},a.updateSymbol=a.updateSymbol.bind(O()(a)),a.changeIconStatus=a.changeIconStatus.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({symbolName:e.symbolName||"supermapol-icons-Oval",symbolType:e.symbolType||"SYMBOL_POINT"})}},{key:"handleClick",value:function(e){var t=e.target.getBoundingClientRect();this.symbolsContainer.showContainer(t.top,t.height)}},{key:"changeIconStatus",value:function(e){e?this.icon.classList.add("active"):this.icon.classList.remove("active")}},{key:"updateSymbol",value:function(e){this.setState({symbolName:e})}},{key:"render",value:function(){var e,t=this,a="IMAGE_POINT"!==this.state.symbolType?".svg":"image/gif, image/jpeg, image/png",n=e=this.state.symbolName;return this.props.layerType===q.r.MIGRATION&&(e="supermapol-icons-od-".concat(e.toLowerCase()),n=n.indexOf("image://")>-1?n.substring(8):n),n.indexOf("http")<0&&"IMAGE_POINT"===this.state.symbolType&&n.indexOf("point_imgs")<0&&n.indexOf("data:image")<0||n.indexOf("resources")>-1&&n.indexOf("http")<0?n="".concat(T.a.getIPortalUrl()+n,"?t=").concat((new Date).getTime()):n.indexOf("http")>-1&&n.indexOf("resources")>-1&&(n+="?t=".concat((new Date).getTime())),i.a.createElement("div",{className:"editor-tool default-point-style"},i.a.createElement("div",{className:"text"},this.props.name||Me.pointStyle),i.a.createElement("div",{ref:function(e){t.icon=e},className:"icon",id:"default-point-icon",onClick:this.handleClick.bind(this)},this.state.symbolName.indexOf("point_imgs")>-1||this.state.symbolName.indexOf("symbol-input")>-1||this.state.symbolName.indexOf("data:image/svg+xml")>-1||this.state.symbolName.indexOf("data:image")>-1?i.a.createElement("div",{className:"icon-container",style:{backgroundImage:"url(".concat(n,")")}}):i.a.createElement("div",{className:e}),i.a.createElement(Fe,{ref:function(e){return t.symbolsContainer=e},parentKey:this.props.parentKey,symbolType:this.state.symbolType,symbolName:this.state.symbolName,updateSymbol:this.updateSymbol,changeIconStatus:this.changeIconStatus,editor:this.props.editor,layerType:this.props.layerType})),i.a.createElement("div",{className:"upload-file"},i.a.createElement("label",{className:"label-for-input",htmlFor:"symbol-input"},i.a.createElement("span",{className:"upload-icon supermapol-icons-upload"}),i.a.createElement("span",{className:"upload-text"},Me.uploadVector)),i.a.createElement("input",{ref:"fileUpload",type:"file",name:"file",id:"symbol-input",className:"symbol_input",accept:a,onChange:this.getFileData.bind(this)})))}},{key:"getFileData",value:function(e){"IMAGE_POINT"===this.state.symbolType?this.handelImg(e):this.handleSVG(e)}},{key:"handleSVG",value:function(e){if(e.target.value){var t=e.target.files[0],a=t.name;if(t.name.toLowerCase().match(/(.*?).(svg)$/)){var n=this,i=new FileReader(t);i.readAsDataURL(e.target.files[0]),i.onload=function(){n.uploadImage(a,null,null,"SYMBOL_POINT")}}else K.a.showMessage(DataViz.Language.unSupportFileType,q.j.WARNING)}}},{key:"handelImg",value:function(e){var t=this;if(e.target.value){var a=e.target.value.match(/[^\\\/]+$/)[0];if(a.toLowerCase().match(/(.*?).(jpeg|png|jpg)$/)){var n=new FileReader;n.readAsDataURL(e.target.files[0]),n.onload=function(e){var n=new Image;n.src=e.target.result,n.onload=function(){this.width>500&&this.height>500?K.a.showMessage(Me.sizeIsWrong):t.uploadImage(a,{h:this.height,w:this.width},n,"IMAGE_POINT")}}}else K.a.showMessage(DataViz.Language.unSupportFileType,q.j.WARNING)}}},{key:"uploadImage",value:function(e,t,a,n){var i=this;T.a.checkReLogin().then((function(){e=i.props.layerID+"."+e.split(".")[1],T.a.uploadImageFile("symbol-input",e).then((function(e){if(void 0!==e.succeed&&!1===e.succeed)throw"400";var r=T.a.getIPortalUrl()+e.filePath;"IMAGE_POINT"===n?i.props.editor("imageInfo",{url:r,img:a,size:t},i.props.parentKey):i.props.editor("symbolInfo",{url:r},i.props.parentKey),i.setState({symbolName:a?a.src:r,symbolType:n}),i.clearInputElement()})).catch((function(e){K.a.showMessage(Me.upLoadImageFailed),i.refs.fileUpload.value=""}))})).catch((function(e){K.a.showMessage(Me.noLogin,q.j.WARNING)}))}},{key:"clearInputElement",value:function(){this.refs.fileUpload.value=""}}]),t}(n.Component),xe=window.DataViz.Language,Pe=function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"onClick",value:function(e){if(e!==this.props.symbolType){var t=this.props.parentKey||"style";this.props.editor("type",e,t)}}},{key:"render",value:function(){var e=" active",t=" ";return"IMAGE_POINT"===this.props.symbolType&&(t+="active",e=""),i.a.createElement("div",{className:"editor-tool point-symbol-container"},i.a.createElement("div",{className:"text"},xe.type),i.a.createElement("div",{className:"point-symbol point-symbol-svg"+e,onClick:this.onClick.bind(this,"SVG_POINT")},xe.symbolVector),i.a.createElement("div",{className:"point-symbol point-symbol-img"+t,onClick:this.onClick.bind(this,"IMAGE_POINT")},xe.symbolImage))}}]),t}(n.Component),Ve=a(96),Be=(a(99),a(100),a(157)),Ue=(a(1690),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).pageY=0,a.colorUIHeight=12,a.colorUIWidth=132,a.cover={position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"},a.state={useGradient:e.userGradient||!1,colors:e.colors,color:e.color||["#80ffff","#2ea7f2","#000068"],isShow:!1,updateUI:!0},a}return E()(t,e),y()(t,[{key:"componentWillMount",value:function(){this.initState(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.initState(e)}},{key:"componentDidUpdate",value:function(){if(this.state.isShow){this.updateSelectContentPosition();for(var e=this.refs.container.container.childNodes[0].childNodes,t=this.getColorIndex(),a=0;a<e.length;a++){var n=e[a];n.childNodes[1]&&n.removeChild(n.childNodes[1]),n.className="color-picker";var i=null;i=this.state.useGradient?this.createGradientCanvas(this.colorUIHeight,this.colorUIWidth,this.state.colors[a]):this.createPieceCanvas(this.colorUIHeight,this.colorUIWidth,this.state.colors[a]),t===a&&(n.className+=" color-picker-selected"),n.appendChild(i),n.setAttribute("index",a)}}this.changeSelectedUI()}},{key:"componentDidMount",value:function(){this.changeSelectedUI()}},{key:"updateSelectContentPosition",value:function(){var e=document.body.clientHeight;if(this.pageY){var t=this.refs.selectContent;if(t){for(var a,n,i=t.clientHeight,r=document.getElementsByClassName("selected-content"),s=99999999,o=0;o<r.length;o++)a=r[o].getBoundingClientRect().top,(n=this.pageY-a)>0&&n<s&&(s=a);this.pageY+i+10>e?t.style.top=s+16-i-28+"px":t.style.top=s+16+14+"px"}}this.pageY=0}},{key:"initState",value:function(e){this.setState({useGradient:e.useGradient,colors:e.colors,color:e.color})}},{key:"update",value:function(e,t,a){e&&(this.state.color=e),a&&(this.state.colors=a,this.state.updateUI=!0),this.state.isShow=t,this.setState(this.state)}},{key:"onClick",value:function(e){e.preventDefault();var t=e.currentTarget.getAttribute("index"),a=this.state.colors[t];this.update(a,!0),this.props.onColorsPickerChange(a)}},{key:"onReverseClick",value:function(e){e.stopPropagation();var t=e.target.parentNode.getAttribute("index"),a=this.state.colors[t].reverse();this.update(a,!0),this.props.onColorsPickerChange(a)}},{key:"getColorIndex",value:function(){var e=-1;for(var t in this.state.colors)this.state.color.toString()===this.state.colors[t].toString()&&(e=Number(t));return e}},{key:"getAllLineUI",value:function(){if(this.state.isShow){var e=this;return i.a.createElement("div",{ref:"selectContent",className:"select-content"},i.a.createElement("div",{className:"colors-picker-content"},i.a.createElement("div",{style:this.cover,onClick:this.closeOptions.bind(this)}),i.a.createElement(oe.Scrollbars,{className:"scroll-bars",ref:"container"},this.state.colors.map((function(t,a){return i.a.createElement("div",{className:"color-picker",key:a,onMouseDown:e.onClick.bind(e)},i.a.createElement("span",{className:"reverse supermapol-icons-color-change",onMouseDown:e.onReverseClick.bind(e)}))})))))}return null}},{key:"changeDisplay",value:function(e){this.pageY=e.pageY,this.setState({isShow:!this.state.isShow}),this.state.isShow?this.refs.dvColorsPicker.removeAttribute("style"):this.refs.dvColorsPicker.style.borderColor="#0083CB"}},{key:"closeOptions",value:function(){this.setState({isShow:!1}),this.refs.dvColorsPicker.removeAttribute("style")}},{key:"render",value:function(){return i.a.createElement("div",{ref:"dvColorsPicker",className:this.state.isShow?"dv-colors-picker chart_select drop-down-box-selected":"dv-colors-picker chart_select",onBlur:this.closeOptions.bind(this),tabIndex:"1"},i.a.createElement("div",{ref:"selected",className:"selected-content",onClick:this.changeDisplay.bind(this)}),this.getAllLineUI())}},{key:"changeSelectedUI",value:function(){var e=this.state.color||this.state.colors[0],t=null;t=this.state.useGradient?this.createGradientCanvas(this.colorUIHeight,this.colorUIWidth,e):this.createPieceCanvas(this.colorUIHeight,this.colorUIWidth,e);var a=this.refs.selected;a.childNodes.length>0&&a.removeChild(a.childNodes[0]),a.appendChild(t)}},{key:"createPieceCanvas",value:function(e,t,a){for(var n=Be.a.createCanvas(e,t),i=t/a.length,r=0,s=a.length;r<s;r++)n.fillStyle=a[r],n.fillRect(r*i,0,i,e);return n.canvas}},{key:"createGradientCanvas",value:function(e,t,a){var n=Be.a.createCanvas(e,t),i=Be.a.getLinearGradient(0,0,t,0,a);return n.fillStyle=i,n.fillRect(0,0,t,e),n.canvas}}]),t}(n.Component)),Ge=function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"onColorsPickerChange",value:function(e){this.props.editor(this.props.type,e,this.props.parentKey)}},{key:"componentWillReceiveProps",value:function(e){this.setState({color:e.color})}},{key:"render",value:function(){var e=this.props.color||this.props.colors[0];return i.a.createElement("div",{className:"editor-tool point-color"},i.a.createElement("div",{className:"text"},this.props.name),i.a.createElement(Ue,{value:"value",reverse:!0,colors:this.props.colors,color:e,useGradient:this.props.useGradient,onColorsPickerChange:this.onColorsPickerChange.bind(this)}))}}]),t}(n.Component),_e=a(55),ze=window.DataViz.Language,je=function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"editor-tool point-style"},i.a.createElement("div",{className:"text"},ze.pointStyle),i.a.createElement("div",{className:"icon"},i.a.createElement("div",{className:"icon-img"})))}}]),t}(n.Component),We=a(37),He=function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"onChange",value:function(e){var t=e,a=this.props.titles;for(var n in this.props.titles)a[n]===e&&(t=n);this.props.editor(this.props.type,t,this.props.parentKey)}},{key:"getAllValues",value:function(e,t){if(!t)return e;var a=[];return e.forEach((function(e){t[e]?a.push(t[e]):a.push(e)})),a}},{key:"getSelectedValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t[e]||e}},{key:"render",value:function(){var e=this.getAllValues(this.props.values,this.props.titles),t=this.getSelectedValue(this.props.value,this.props.titles);return i.a.createElement("div",{className:"editor-tool lable-select"},i.a.createElement("div",{className:"text"},this.props.name),i.a.createElement(We.b,{values:e,onChange:this.onChange.bind(this),selectedValue:t}))}}]),t}(n.Component),Ye=a(125),Ke=a(47),Xe=window.DataViz.Language,qe=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={symbolType:e.symbolType},a.handleTypeChange=a.handleTypeChange.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"handleTypeChange",value:function(e){this.props.editor("colorType",e,"themeSetting")}},{key:"render",value:function(){var e=this.props,t=e.colorType,a=void 0===t?"fillColor":t,n=e.symbolType,r=e.colors,s=e.fillColor,o=e.allColors,l=e.editor;return"IMAGE_POINT"===n?null:i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"editor-tool color-group"},i.a.createElement("div",{className:"text"},Xe.colorType),i.a.createElement(Ke.b,{name:"colorGroup",className:"value-container",selectedValue:a,onChange:this.handleTypeChange},i.a.createElement(Ke.a,{value:"fillColor"},Xe.singleColor),i.a.createElement(Ke.a,{value:"colors"},Xe.multiColor))),"colors"===a?i.a.createElement(Ge,{name:Xe.pointColor,type:"colors",parentKey:"themeSetting",editor:l,useGradient:!1,color:r,colors:o}):i.a.createElement(Ve.a,{name:Xe.pointColor,type:"fillColor",parentKey:"style",color:s,editor:l}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.symbolType!==t.symbolType?{symbolType:e.symbolType}:null}}]),t}(n.Component),Je=DataViz.Language,Ze=Oe(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getSymbolUI",value:function(){var e=null,t="",a=this.props.styleParameters.style,n=this.props.layerType,r=this.props.layerID+n;switch(n){case q.r.VECTOR:case q.r.GRAPHIC:case q.r.SYMBOL:case q.r.RANK_SYMBOL:case q.r.MIGRATION:t="IMAGE_POINT"===a.type?a.imageInfo&&a.imageInfo.url:a.symbolInfo&&(a.symbolInfo.className||a.symbolInfo.url),e=i.a.createElement(i.a.Fragment,null,i.a.createElement(Pe,{type:"symbolType",parentKey:"style",symbolType:a.type,editor:this.props.editor}),i.a.createElement(Re,{type:"symbol",parentKey:"style",symbolName:t,symbolType:a.type,editor:this.props.editor,layerID:r}));break;case q.r.RANGE:e=i.a.createElement(je,null);break;case q.r.UNIQUE:case q.r.DATAFLOW:t=a.symbolInfo&&(a.symbolInfo.className||a.symbolInfo.url),e=i.a.createElement(Re,{type:"symbol",parentKey:"style",symbolName:t,symbolType:a.type,editor:this.props.editor,layerID:r})}return e}},{key:"getColorUI",value:function(){var e=null,t=this.props.styleParameters;switch(this.props.layerType){case q.r.VECTOR:case q.r.GRAPHIC:case q.r.SYMBOL:case q.r.DATAFLOW:e=i.a.createElement(Ve.a,{name:Je.pointColor,type:"fillColor",parentKey:"style",color:t.style.fillColor,symbolType:t.style.type,editor:this.props.editor});break;case q.r.UNIQUE:e=i.a.createElement(Ge,{name:Je.pointColor,type:"colors",parentKey:"themeSetting",editor:this.props.editor,useGradient:!1,color:t.themeSetting.colors,colors:Ye.c});break;case q.r.RANGE:e=i.a.createElement(Ge,{name:Je.pointColor,type:"colors",parentKey:"themeSetting",editor:this.props.editor,useGradient:!1,color:t.themeSetting.colors,colors:Ye.b});break;case q.r.HEAT_MAP:e=i.a.createElement(Ge,{name:Je.pointColor,type:"colors",parentKey:"themeSetting",editor:this.props.editor,useGradient:!0,color:t.themeSetting.colors,colors:Ye.b});break;case q.r.RANK_SYMBOL:e=i.a.createElement(qe,{editor:this.props.editor,fillColor:t.style.fillColor,symbolType:t.style.type,colors:t.themeSetting.colors,colorType:t.themeSetting.colorType,allColors:Ye.b})}return e}},{key:"getRadiusUI",value:function(){var e=this.props.styleParameters;return this.props.layerType===q.r.RANK_SYMBOL?i.a.createElement(i.a.Fragment,null,i.a.createElement(_e.a,{name:Je.minRadius,type:"minRadius",parentKey:"themeSetting",editor:this.props.editor,value:e.themeSetting.minRadius,min:1,max:20,unit:"Px"}),i.a.createElement(_e.a,{name:Je.maxRadius,type:"maxRadius",parentKey:"themeSetting",editor:this.props.editor,value:e.themeSetting.maxRadius,min:1,max:20,unit:"Px"})):i.a.createElement(_e.a,{name:Je.pointSize,type:"radius",parentKey:"style",editor:this.props.editor,value:e.style.radius,min:1,max:20,unit:"Px"})}},{key:"getOffset",value:function(){var e=this.props.styleParameters,t=e.style,a=t.imageInfo,n=t.symbolInfo,r=t.type,s=t.offsetX,o=t.offsetY,l=0;return(r===q.k.IMAGE_POINT&&a||"SVG_POINT"===r&&n)&&void 0===s&&void 0===o&&(l=.5),i.a.createElement(i.a.Fragment,null,i.a.createElement(_e.a,{name:Je.pointOffsetX,type:"offsetX",parentKey:"style",editor:this.props.editor,value:e.style.offsetX||l,min:-1,max:1,isDot:!0,tooltip:DataViz.Language.pointOffsetUnitTip,tooltipClassName:"dv-point-offset-tooltip"}),i.a.createElement(_e.a,{name:Je.pointOffsetY,type:"offsetY",parentKey:"style",editor:this.props.editor,value:e.style.offsetY||l,min:-1,max:1,isDot:!0,tooltip:DataViz.Language.pointOffsetUnitTip,tooltipClassName:"dv-point-offset-tooltip"}))}},{key:"getRotation",value:function(){var e=this.props.styleParameters.style,t=e.rotation;if(e.type!==q.k.BASIC_POINT&&[q.r.VECTOR,q.r.GRAPHIC,q.r.SYMBOL,q.r.RANK_SYMBOL].includes(this.props.layerType)){var a=T.a.toAngle(t);return i.a.createElement(i.a.Fragment,null,i.a.createElement(_e.a,{name:Je.rotation,type:"rotation",parentKey:"style",editor:this.props.editor,value:a||0,min:0,max:360,unit:""}))}}},{key:"getDirectionUI",value:function(){var e=null;return this.props.layerType===q.r.DATAFLOW&&(e=i.a.createElement(He,{type:"directionField",editor:this.props.editor,name:Je.directionField,parentKey:"direction",value:this.props.directionField||this.props.directionFields[0],values:this.props.directionFields,titles:this.props.captions})),e}},{key:"render",value:function(){var e=this.props.styleParameters.style;return i.a.createElement(i.a.Fragment,null,this.getSymbolUI(),this.getColorUI(),this.getRadiusUI(),"IMAGE_POINT"!==e.type&&i.a.createElement(_e.a,{name:Je.pointOpacity,type:"fillOpacity",parentKey:"style",value:100*e.fillOpacity,max:100,editor:this.props.editor,unit:"%"}),this.getDirectionUI(),this.getOffset(),this.getRotation())}}]),t}(n.Component),{title:Je.symbolSetting}),Qe=a(214),$e=DataViz.Language,et=Oe(function(e){function t(e){var a;f()(this,t);var n=(a=v()(this,b()(t).call(this,e))).props.styleParameters.style;return a.state={isDoubleColor:n&&["pathway","roadPath"].includes(n.lineDash)},a.changeLineDash=a.changeLineDash.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.styleParameters.style,a=t&&["pathway","roadPath"].includes(t.lineDash);a!==this.state.isDoubleColor&&this.setState({isDoubleColor:a})}},{key:"changeLineDash",value:function(e,t,a){this.setState({isDoubleColor:["pathway","roadPath"].includes(t)}),this.props.editor(e,t,a)}},{key:"getColorUI",value:function(){var e=null,t=this.props.styleParameters,a=this.state.isDoubleColor,n=t.style,r=t.outlineStyle,s=void 0===r?{}:r;switch(this.props.layerType){case q.r.VECTOR:e=a?i.a.createElement(i.a.Fragment,null,i.a.createElement(Ve.a,{name:$e.lineColor,type:"strokeColor",parentKey:"style",color:n.strokeColor,editor:this.props.editor}),i.a.createElement(Ve.a,{name:$e.outlineColor,type:"strokeColor",parentKey:"outlineStyle",color:s.strokeColor||"#d69c08",editor:this.props.editor})):i.a.createElement(Ve.a,{name:$e.lineColor,type:"strokeColor",parentKey:"style",color:t.style.strokeColor,editor:this.props.editor});break;case q.r.UNIQUE:e=i.a.createElement(Ge,{name:$e.lineColor,type:"colors",parentKey:"themeSetting",useGradient:!1,color:t.themeSetting.colors,colors:Ye.c,editor:this.props.editor});break;case q.r.RANGE:e=i.a.createElement(Ge,{name:$e.lineColor,type:"colors",parentKey:"themeSetting",editor:this.props.editor,useGradient:!1,color:t.themeSetting.colors,colors:Ye.b})}return e}},{key:"render",value:function(){var e=this.props.styleParameters.style;return i.a.createElement(i.a.Fragment,null,i.a.createElement(Qe.a,{name:$e.lineStyle,type:"lineDash",parentKey:"style",strokeDashstyle:e.lineDash||"solid",editor:this.changeLineDash,dashStyle:this.props.layerType===q.r.VECTOR&&["solid","dot","dash","dashdot","longdash","longdashdot","roadPath","pathway"]}),this.getColorUI(),i.a.createElement(_e.a,{symbolType:e.type,name:$e.lineWidth,type:"strokeWidth",parentKey:"style",editor:this.props.editor,value:e.strokeWidth,min:0,max:20,unit:"Px"}),i.a.createElement(_e.a,{symbolType:e.type,name:$e.lineOpacity,type:"strokeOpacity",parentKey:"style",editor:this.props.editor,value:100*e.strokeOpacity,max:100,unit:"%"}))}}]),t}(n.Component),{title:$e.lineSetting}),tt=DataViz.Language,at=Oe(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getColorUI",value:function(){var e=null,t=this.props.styleParameters;switch(this.props.layerType){case q.r.VECTOR:e=i.a.createElement(Ve.a,{name:tt.polygonfillColor,type:"fillColor",parentKey:"style",color:t.style.fillColor,symbolType:t.style.type,editor:this.props.editor});break;case q.r.UNIQUE:e=i.a.createElement(Ge,{name:tt.polygonfillColor,type:"colors",parentKey:"themeSetting",useGradient:!1,color:t.themeSetting.colors,colors:Ye.c,editor:this.props.editor});break;case q.r.RANGE:e=i.a.createElement(Ge,{name:tt.polygonfillColor,type:"colors",parentKey:"themeSetting",useGradient:!1,color:t.themeSetting.colors,colors:Ye.b,editor:this.props.editor})}return e}},{key:"render",value:function(){var e=this.props.styleParameters.style;return i.a.createElement(i.a.Fragment,null,this.getColorUI(),i.a.createElement(_e.a,{name:tt.polygonOpacity,type:"fillOpacity",parentKey:"style",value:100*e.fillOpacity,max:100,editor:this.props.editor,unit:"%"}))}}]),t}(n.Component),{title:tt.fillSetting}),nt=(a(208),a(153)),it=window.DataViz.Language,rt=function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"onColorPickerChange",value:function(e){var t=this.props.type||"fill",a=this.props.parentKey||"labelStyle";this.props.editor(t,e.hex,a)}},{key:"render",value:function(){return i.a.createElement("div",{className:"editor-tool lable-style"},i.a.createElement("div",{className:"text"},it.lableStyle),i.a.createElement("div",{className:"icon"},i.a.createElement(nt.a,{onColorPickerChange:this.onColorPickerChange.bind(this),color:this.props.fontColor})))}}]),t}(n.Component),st=window.DataViz.Language,ot=[st.simHei,st.yaHei,st.simSun,st.fangSong],lt=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).fontFamilys=e.fontFamilys||ot,a}return E()(t,e),y()(t,[{key:"changeFontfamily",value:function(e){var t=this.props.type||"fontFamily",a=this.props.parentKey||"labelStyle";this.props.editor(t,e,a)}},{key:"render",value:function(){return i.a.createElement("div",{className:"editor-tool lable-select"},i.a.createElement("div",{className:"text"},st.font),i.a.createElement(We.b,{values:this.fontFamilys,onChange:this.changeFontfamily.bind(this),selectedValue:this.props.fontFamily||st.simHei}))}}]),t}(n.Component),ct=a(16),ut=window.DataViz.Language,dt=function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"onColorPickerChange",value:function(e){var t=this.props.type||"backgroundFill",a=this.props.parentKey||"labelStyle";this.props.editor(t,ct.a.RGB2String(e.rgb),a)}},{key:"render",value:function(){return i.a.createElement("div",{className:"editor-tool lable-style"},i.a.createElement("div",{className:"text"},ut.labelBackgroundColor),i.a.createElement("div",{className:"icon"},i.a.createElement(nt.a,{onColorPickerChange:this.onColorPickerChange.bind(this),disableAlpha:!1,color:this.props.fontBackgroundColor})))}}]),t}(n.Component),pt=DataViz.Language,ht=["top-left","top","top-right","left","center","right","bottom-left","bottom","bottom-right"],ft=function(e){var t=e.value,a=function(e){return e===t?"".concat(e," active"):e};return i.a.createElement("svg",{className:"label-anchor",width:"16px",height:"16px",viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("rect",{className:a("top-left"),x:"0",y:"0",width:"4",height:"4"}),i.a.createElement("rect",{className:a("top"),x:"6",y:"0",width:"4",height:"4"}),i.a.createElement("rect",{className:a("top-right"),x:"12",y:"0",width:"4",height:"4"}),i.a.createElement("rect",{className:a("left"),x:"0",y:"6",width:"4",height:"4"}),i.a.createElement("rect",{className:a("center"),x:"6",y:"6",width:"4",height:"4"}),i.a.createElement("rect",{className:a("right"),x:"12",y:"6",width:"4",height:"4"}),i.a.createElement("rect",{className:a("bottom-left"),x:"0",y:"12",width:"4",height:"4"}),i.a.createElement("rect",{className:a("bottom"),x:"6",y:"12",width:"4",height:"4"}),i.a.createElement("rect",{className:a("bottom-right"),x:"12",y:"12",width:"4",height:"4"}))},mt=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).changePosition=a.changePosition.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"changePosition",value:function(e){var t,a,n,i,r=this.props.style.style,s=ct.a.getLabelOffset(r);switch(e){case"top-left":n="right",i="bottom",t=-s,a=-s;break;case"top":n="center",i="bottom",t=0,a=-s;break;case"top-right":n="left",i="bottom",t=s,a=-s;break;case"left":n="right",i="middle",t=-s,a=0;break;case"center":n="center",i="middle",t=0,a=0;break;case"right":n="left",i="middle",t=s,a=0;break;case"bottom-left":n="right",i="top",t=-s,a=s;break;case"bottom":n="center",i="top",t=0,a=s;break;case"bottom-right":n="left",i="top",t=s,a=s}this.props.editor(this.props.type,{offsetX:t,offsetY:a,textAlign:n,textBaseline:i},this.props.parentKey)}},{key:"render",value:function(){return i.a.createElement("div",{className:"editor-tool lable-select anchor-select"},i.a.createElement("div",{className:"text"},pt.position),i.a.createElement(We.b,{className:"anchor-content",selectedValue:this.props.value,renderValue:function(e){return i.a.createElement(ft,{value:e})},height:86,placement:"top",onChange:this.changePosition},ht.map((function(e){return i.a.createElement(We.a,{key:e,value:e},i.a.createElement(ft,{value:e}))}))))}}]),t}(n.Component),yt=a(427),gt=window.DataViz.Language,vt=yt.a.defaultStyle,St={point:gt.labelByPoint,line:gt.labelByLine},bt={top:gt.labelTextTop,middle:gt.labelTextMiddle,bottom:gt.labelTextBottom},It=Oe(function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).editor=a.editor.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"editor",value:function(e,t,a){"fontSize"===e?t+="px":"placement"===e&&setTimeout(this.forceUpdate.bind(this),100),this.props.editor(e,t,a)}},{key:"getAnchor",value:function(e){var t=e.textBaseline,a=e.textAlign,n="top";return"left"===a&&"top"===t?n="bottom-right":"left"===a&&"middle"===t?n="right":"left"===a&&"bottom"===t?n="top-right":"center"===a&&"top"===t?n="bottom":"center"===a&&"middle"===t?n="center":"center"===a&&"bottom"===t?n="top":"right"===a&&"top"===t?n="bottom-left":"right"===a&&"middle"===t?n="left":"right"===a&&"bottom"===t&&(n="top-left"),n}},{key:"getLabelOffset",value:function(){var e,t=this.props,a=t.styleParameters,n=void 0===a?{}:a,r=t.featureType,s=t.layerType,o=n.labelStyle,l=void 0===o?{}:o;return s!==q.r.DATAFLOW&&(e=r===q.p.POINT?i.a.createElement(mt,{style:n,type:"offset",parentKey:"labelStyle",editor:this.editor,value:this.getAnchor(l)}):i.a.createElement(i.a.Fragment,null,i.a.createElement(He,{type:"placement",editor:this.editor,name:gt.labelPosition,parentKey:"labelStyle",value:l.placement,values:Object.keys(St),titles:St}),i.a.createElement(He,{type:"textBaseline",editor:this.editor,name:gt.labelTextBaseline,parentKey:"labelStyle",value:l.textBaseline||"bottom",values:Object.keys(bt),titles:bt}))),e}},{key:"render",value:function(){var e=this.props,t=e.styleParameters,a=void 0===t?{}:t,n=e.captions,r=e.lableFields,s=a.labelStyle,o=void 0===s?{}:s;return i.a.createElement("div",{className:"lable-control"},i.a.createElement(He,{type:"labelField",editor:this.editor,name:gt.lableField,parentKey:"labelStyle",value:o.labelField||r[0],titles:n,values:r}),i.a.createElement(rt,{editor:this.editor,fontColor:o.fill||vt.fill}),"line"!==o.placement&&i.a.createElement(dt,{editor:this.editor,fontBackgroundColor:o.backgroundFill||vt.backgroundFill}),i.a.createElement(Ve.a,{name:gt.labelOutlineColor,type:"outlineColor",parentKey:"labelStyle",color:o.outlineColor||vt.outlineColor,editor:this.editor}),i.a.createElement(_e.a,{name:gt.labelOutlineWidth,type:"outlineWidth",parentKey:"labelStyle",editor:this.editor,value:o.outlineWidth||vt.outlineWidth,min:0,max:10,unit:"Px"}),i.a.createElement(lt,{editor:this.editor,fontFamily:o.fontFamily||gt.simHei}),i.a.createElement(_e.a,{name:gt.fontSize,type:"fontSize",parentKey:"labelStyle",editor:this.editor,value:parseInt(o.fontSize)||14,min:10,max:33,unit:"Px"}),this.getLabelOffset())}}]),t}(n.Component),{title:gt.label}),Et=DataViz.Language,Tt=Oe(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getLineDashUI",value:function(){var e=null;return this.props.featureType===q.p.POLYGON&&(e=i.a.createElement(Qe.a,{name:Et.lineStyle,type:"lineDash",parentKey:"style",strokeDashstyle:this.props.styleParameters.style.lineDash||"solid",editor:this.props.editor})),e}},{key:"render",value:function(){var e=this.props.styleParameters.style;return i.a.createElement(i.a.Fragment,null,i.a.createElement(Ve.a,{name:Et.lineColor,type:"strokeColor",parentKey:"style",color:e.strokeColor,editor:this.props.editor}),this.getLineDashUI(),i.a.createElement(_e.a,{name:Et.lineWidth,type:"strokeWidth",parentKey:"style",editor:this.props.editor,value:e.strokeWidth,min:0,max:20,unit:"Px"}),i.a.createElement(_e.a,{name:Et.lineOpacity,type:"strokeOpacity",parentKey:"style",editor:this.props.editor,value:100*e.strokeOpacity,max:100,unit:"%"}))}}]),t}(n.Component),{title:Et.outlineSetting}),Ct=window.DataViz.Language,Lt=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={value:e.value||""},a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({value:e.value||""})}},{key:"handlerBlur",value:function(e){var t=T.a.trim(e.target.value);this.props.editor(this.props.type,t)}},{key:"handlerChange",value:function(e){this.setState({value:e.target.value})}},{key:"onKeyUp",value:function(e){13===e.keyCode&&e.target.blur()&&this.handlerBlur(e)}},{key:"render",value:function(){return i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},Ct.filterCondition),i.a.createElement("input",{className:"dv-input",type:"text",placeholder:Ct.filterTip,value:this.state.value,title:this.state.value,onBlur:this.handlerBlur.bind(this),onKeyUp:this.onKeyUp.bind(this),onChange:this.handlerChange.bind(this)}))}}]),t}(n.Component),Nt=function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},this.props.name),i.a.createElement("div",{className:"supermapol-icons-user-defined btn",onClick:function(){e.props.changeCustomPanelStatus&&e.props.changeCustomPanelStatus(!0)}}))}}]),t}(n.Component),kt=DataViz.Language,Ot={UNIQUE:kt.customValue,RANGE:kt.customRange,HEAT:kt.customColor,RANK_SYMBOL:kt.customRadius},Dt=Oe(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getCustomUI",value:function(){var e=null;return Object.keys(Ot).includes(this.props.layerType)&&(e=i.a.createElement(Nt,{name:Ot[this.props.layerType],changeCustomPanelStatus:this.props.changeCustomPanelStatus})),e}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(Lt,{type:"filterCondition",value:this.props.filterCondition,editor:this.props.editor}),this.getCustomUI())}}]),t}(n.Component),{title:kt.customSetting}),wt=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={symbolType:e.styleParameters.style.type},a.editor=a.editor.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"editor",value:function(e,t,a){"type"===e&&this.setState({symbolType:t}),this.props.editor(e,t,a)}},{key:"getVectorTools",value:function(){var e={editor:this.editor,styleParameters:this.props.styleParameters};switch(this.props.featureType){case q.p.POINT:return i.a.createElement(i.a.Fragment,null,i.a.createElement(Ze,Y()({},e,{isOpened:!0,layerID:this.props.layerID,layerType:this.props.layerType})),"IMAGE_POINT"!==this.state.symbolType&&i.a.createElement(Tt,Y()({},e,{featureType:this.props.featureType})));case q.p.LINE:case q.p.LINEARRING:return i.a.createElement(et,Y()({},e,{isOpened:!0,layerType:this.props.layerType}));case q.p.POLYGON:case q.p.REGION:return i.a.createElement(i.a.Fragment,null,i.a.createElement(at,Y()({},e,{isOpened:!0,layerType:this.props.layerType})),i.a.createElement(Tt,Y()({},e,{featureType:this.props.featureType})));default:return null}}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,this.getVectorTools(),i.a.createElement(It,{styleParameters:this.props.styleParameters,editor:this.editor,lableFields:this.props.labelFields,captions:this.props.captions,featureType:this.props.featureType}),i.a.createElement(Dt,{filterCondition:this.props.filterCondition,layerType:this.props.layerType,editor:this.editor,changeCustomPanelStatus:this.props.changeCustomPanelStatus}))}}]),t}(n.Component),At=DataViz.Language,Ft=[2,3,4,5,6,7,8,9,10,11,12,13,14,15],Mt={offset:At.offsetSegment,jenks:At.natureSegment,square:At.squareRootSegment,logarithm:At.logarithmSegment},Rt=(ke={},j()(ke,At.offsetSegment,"offset"),j()(ke,At.natureSegment,"jenks"),j()(ke,At.squareRootSegment,"square"),j()(ke,At.logarithmSegment,"logarithm"),ke),xt=Oe(function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).changeSegmentMethod=a.changeSegmentMethod.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"changeSegmentMethod",value:function(e,t,a){t=Rt[t]||"offset",this.props.editor(e,t,a)}},{key:"getContentUI",value:function(){var e=null,t=this.props.styleParameters.themeSetting;return[q.r.RANGE,q.r.RANK_SYMBOL].includes(this.props.layerType)&&(e=i.a.createElement(i.a.Fragment,null,i.a.createElement(He,{type:"segmentMethod",parentKey:"themeSetting",editor:this.changeSegmentMethod,name:At.segmentationMethod,value:Mt[t.segmentMethod]||At.offsetSegment,values:Object.values(Mt)}),i.a.createElement(He,{type:"segmentCount",parentKey:"themeSetting",editor:this.props.editor,name:At.segmentationQuantity,value:t.segmentCount,values:Ft}))),e}},{key:"render",value:function(){var e,t,a=this.props.styleParameters.themeSetting;[q.r.HEAT_MAP,q.r.DATAFLOWHEAT].includes(this.props.layerType)?(e="weight",t=At.weightField):(e="themeField",t=At.themeField);var n=a[e]||this.props.fields[0];return i.a.createElement("div",{className:"theme-control"},i.a.createElement(He,{type:e,parentKey:"themeSetting",editor:this.props.editor,values:this.props.fields,titles:this.props.captions,value:n,name:t}),this.getContentUI())}}]),t}(n.Component),{title:At.themeSetting}),Pt=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getVectorTools",value:function(){var e={editor:this.props.editor,styleParameters:this.props.styleParameters};switch(this.props.featureType){case q.p.POINT:return i.a.createElement(i.a.Fragment,null,i.a.createElement(Ze,Y()({},e,{layerID:this.props.layerID,featureType:this.props.featureType,layerType:this.props.layerType})),i.a.createElement(Tt,Y()({},e,{featureType:this.props.featureType})));case q.p.LINE:case q.p.LINEARRING:return i.a.createElement(et,Y()({},e,{layerType:this.props.layerType}));case q.p.POLYGON:case q.p.REGION:return i.a.createElement(i.a.Fragment,null,i.a.createElement(at,Y()({},e,{layerType:this.props.layerType})),i.a.createElement(Tt,Y()({},e,{featureType:this.props.featureType})));default:return null}}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(xt,{isOpened:!0,fields:this.props.fields,captions:this.props.captions,editor:this.props.editor,styleParameters:this.props.styleParameters}),this.getVectorTools(),i.a.createElement(It,{styleParameters:this.props.styleParameters,editor:this.props.editor,lableFields:this.props.labelFields,captions:this.props.captions,featureType:this.props.featureType}),i.a.createElement(Dt,{filterCondition:this.props.filterCondition,layerType:this.props.layerType,editor:this.props.editor,changeCustomPanelStatus:this.props.changeCustomPanelStatus}))}}]),t}(n.Component),Vt=DataViz.Language,Bt=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getVectorTools",value:function(){var e={editor:this.props.editor,styleParameters:this.props.styleParameters};switch(this.props.featureType){case q.p.POINT:return i.a.createElement(i.a.Fragment,null,i.a.createElement(Ze,Y()({},e,{title:Vt.symbolSetting,layerID:this.props.layerID,featureType:this.props.featureType,layerType:this.props.layerType})),i.a.createElement(Tt,Y()({},e,{title:Vt.outlineSetting,featureType:this.props.featureType})));case q.p.LINE:case q.p.LINEARRING:return i.a.createElement(et,Y()({},e,{title:Vt.lineSetting,layerType:this.props.layerType}));case q.p.POLYGON:case q.p.REGION:return i.a.createElement(i.a.Fragment,null,i.a.createElement(at,Y()({},e,{title:Vt.fillSetting,layerType:this.props.layerType})),i.a.createElement(Tt,Y()({},e,{title:Vt.outlineSetting,featureType:this.props.featureType})));default:return null}}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(xt,{isOpened:!0,fields:this.props.fields,captions:this.props.captions,editor:this.props.editor,styleParameters:this.props.styleParameters,layerType:this.props.layerType}),this.getVectorTools(),i.a.createElement(It,{styleParameters:this.props.styleParameters,editor:this.props.editor,lableFields:this.props.labelFields,captions:this.props.captions,featureType:this.props.featureType}),i.a.createElement(Dt,{filterCondition:this.props.filterCondition,layerType:this.props.layerType,editor:this.props.editor,changeCustomPanelStatus:this.props.changeCustomPanelStatus}))}}]),t}(n.Component),Ut=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={value:e.initValue},a.changeValue=a.changeValue.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({value:e.initValue})}},{key:"onChange",value:function(e){}},{key:"changeValue",value:function(e){var t=this,a=e.target.value;T.a.isNumber(a)?(this.setState({value:a}),T.a.delayCall((function(){t.props.editor("radius",a,t.props.parentKey)}),300,this)):K.a.showMessage(DataViz.Language.widthIsWrong)}},{key:"render",value:function(){return i.a.createElement("div",{className:"editor-tool heat-unit"},i.a.createElement("div",{className:"text"},this.props.name),i.a.createElement("input",{type:"text",value:this.state.value,onChange:this.changeValue}),i.a.createElement(We.b,{values:this.props.values,onChange:this.onChange.bind(this),selectedValue:this.props.values}))}}]),t}(n.Component),Gt=DataViz.Language,_t=[Gt.pixel],zt=Oe(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this.props.styleParameters.themeSetting;return i.a.createElement("div",{className:"heat-style-control"},i.a.createElement(Ge,{name:Gt.heatColor,type:"colors",parentKey:"themeSetting",useGradient:!0,colors:Ye.a,color:e.colors,editor:this.props.editor}),i.a.createElement(Ut,{name:Gt.heatRadius,initValue:e.radius,values:_t,parentKey:"themeSetting",editor:this.props.editor}))}}]),t}(n.Component),{title:Gt.heatSetting}),jt=(DataViz.Language,function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(xt,{isOpened:!0,fields:this.props.fields,captions:this.props.captions,editor:this.props.editor,styleParameters:this.props.styleParameters,layerType:this.props.layerType}),i.a.createElement(zt,{styleParameters:this.props.styleParameters,editor:this.props.editor}),i.a.createElement(Dt,{filterCondition:this.props.filterCondition,layerType:this.props.layerType,editor:this.props.editor,changeCustomPanelStatus:this.props.changeCustomPanelStatus}))}}]),t}(n.Component)),Wt=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={symbolType:e.styleParameters.style.type},a.editor=a.editor.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"editor",value:function(e,t,a){"type"===e&&this.setState({symbolType:t}),this.props.editor(e,t,a)}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(xt,{isOpened:!0,fields:this.props.fields,captions:this.props.captions,editor:this.editor,styleParameters:this.props.styleParameters,layerType:this.props.layerType}),i.a.createElement(Ze,{editor:this.editor,styleParameters:this.props.styleParameters,layerID:this.props.layerID,featureType:this.props.featureType,layerType:this.props.layerType}),"IMAGE_POINT"!==this.state.symbolType&&i.a.createElement(Tt,{editor:this.editor,styleParameters:this.props.styleParameters,featureType:this.props.featureType}),i.a.createElement(It,{styleParameters:this.props.styleParameters,editor:this.editor,lableFields:this.props.labelFields,captions:this.props.captions,featureType:this.props.featureType}),i.a.createElement(Dt,{filterCondition:this.props.filterCondition,layerType:this.props.layerType,editor:this.editor,changeCustomPanelStatus:this.props.changeCustomPanelStatus}))}}]),t}(n.Component),Ht=(a(1691),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isOpen:a.props.isOpen||!1,disabled:a.props.disabled||!1},a.onClick=a.onClick.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.isOpen!==this.state.isOpen&&this.setState({isOpen:e.isOpen})}},{key:"getClassName",value:function(){var e="switch";return this.state.disabled&&(e+=" switch-disabled"),this.state.isOpen?e+=" switch-open":e+=" switch-close",e}},{key:"onClick",value:function(){if(!this.state.disabled){var e=!this.state.isOpen;this.setState({isOpen:e}),this.props.onChange&&this.props.onChange(e)}}},{key:"render",value:function(){return i.a.createElement("div",{className:this.getClassName(),onClick:this.onClick},i.a.createElement("div",{className:"switch-button"}))}}]),t}(n.Component)),Yt=window.DataViz.Language,Kt=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isOpen:e.isOpen||!1},a.onChange=a.onChange.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.isOpen!==this.props.isOpen&&this.setState({isOpen:e.isOpen})}},{key:"onChange",value:function(e){this.props.editor(this.props.type,e,this.props.parentKey)}},{key:"render",value:function(){return i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},this.props.name||Yt.show),i.a.createElement(Ht,{isOpen:this.state.isOpen,disabled:this.props.disabled,onChange:this.onChange}))}}]),t}(n.Component),Xt=window.DataViz.Language,qt="#56b781",Jt=2,Zt=1,Qt=5,$t=Oe(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this.props.style.dataflowSetting,t=e&&e.pathStyle,a=!(!t||!t.strokeColor);return i.a.createElement("div",{className:"direction-control"},i.a.createElement(Kt,{isOpen:a,type:"pathVisible",parentKey:"pathStyle",editor:this.props.editor}),i.a.createElement(_e.a,{name:Xt.pathPointCount,parentKey:"pathStyle",type:"maxPointCount",value:t&&t.maxPointCount||Qt,min:2,max:100,editor:this.props.editor,unit:Xt.countUnit}),i.a.createElement(Ve.a,{name:Xt.pathLineColor,parentKey:"pathStyle",type:"strokeColor",color:t&&t.strokeColor||qt,editor:this.props.editor}),i.a.createElement(_e.a,{name:Xt.pathLineOpacity,parentKey:"pathStyle",type:"strokeOpacity",value:100*(t&&t.strokeOpacity||Zt),max:100,editor:this.props.editor,unit:"%"}),i.a.createElement(_e.a,{name:Xt.pathLineWidth,parentKey:"pathStyle",type:"strokeWidth",editor:this.props.editor,value:t&&t.strokeWidth||Jt,min:1,max:20,unit:"Px"}))}}]),t}(n.Component),{title:Xt.pathLine}),ea=(DataViz.Language,function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(Ze,{isOpened:!0,styleParameters:this.props.styleParameters,editor:this.props.editor,layerID:this.props.layerID,layerType:this.props.layerType,directionFields:this.props.directionFields,directionField:this.props.directionField,captions:this.props.captions}),i.a.createElement(Tt,Y()({},this.props,{featureType:this.props.featureType})),i.a.createElement($t,{style:this.props.styleParameters,editor:this.props.editor}),i.a.createElement(It,{styleParameters:this.props.styleParameters,editor:this.props.editor,lableFields:this.props.labelFields,captions:this.props.captions,featureType:this.props.featureType,layerType:this.props.layerType}),i.a.createElement(Dt,{filterCondition:this.props.filterCondition,layerType:this.props.layerType,editor:this.props.editor,changeCustomPanelStatus:this.props.changeCustomPanelStatus}))}}]),t}(n.Component)),ta=DataViz.Language,aa=["XY_FIELD","PLACE_FIELD"],na=[ta.coord,ta.division],ia=Oe(function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={locationMode:e.styleParameters.from.type||aa[0]},a.editor=a.editor.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.styleParameters.from.type!==this.state.locationMode&&this.setState({locationMode:e.styleParameters.from.type})}},{key:"editor",value:function(e,t,a){"locationMode"===e&&(t=this.getKeyFromValue(t),this.setState({locationMode:t})),this.props.editor(e,t,a)}},{key:"getContentUI",value:function(){var e=null,t=this.props.styleParameters,a=t.from,n=t.to;switch(this.state.locationMode){case aa[0]:case na[0]:e=i.a.createElement(i.a.Fragment,null,i.a.createElement(He,{type:"xField",parentKey:"from",editor:this.editor,name:ta.fromXField,value:a.xField||ta.unSetting,values:this.props.numberFields,titles:this.props.captions}),i.a.createElement(He,{type:"yField",parentKey:"from",editor:this.editor,name:ta.fromYField,value:a.yField||ta.unSetting,values:this.props.numberFields,titles:this.props.captions}),i.a.createElement(He,{type:"xField",parentKey:"to",editor:this.editor,name:ta.toXField,value:n.xField||ta.unSetting,values:this.props.numberFields,titles:this.props.captions}),i.a.createElement(He,{type:"yField",parentKey:"to",editor:this.editor,name:ta.toYField,value:n.yField||ta.unSetting,values:this.props.numberFields,titles:this.props.captions}));break;case aa[1]:case na[1]:e=i.a.createElement(i.a.Fragment,null,i.a.createElement(He,{type:"field",parentKey:"from",editor:this.editor,name:ta.fromCity,value:a.field||ta.unSetting,values:this.props.stringFields,titles:this.props.captions}),i.a.createElement(He,{type:"field",parentKey:"to",editor:this.editor,name:ta.toCity,value:n.field||ta.unSetting,values:this.props.stringFields,titles:this.props.captions}))}return e}},{key:"getKeyFromValue",value:function(e){var t=na.indexOf(e);return aa[t]}},{key:"getValueFromKey",value:function(e){var t=aa.indexOf(e);return na[t]}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(He,{type:"locationMode",editor:this.editor,name:ta.locationMode,value:this.getValueFromKey(this.state.locationMode),values:na}),this.getContentUI())}}]),t}(n.Component),{title:ta.baseSetting}),ra=window.DataViz.Language,sa=Oe(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this.props.styleParameters.labelSetting;return i.a.createElement("div",{className:"lable-control"},i.a.createElement(He,{type:"from",editor:this.props.editor,name:ra.fromLabelField,parentKey:"labelSetting",value:e.from||this.props.labelFields[0],values:this.props.labelFields,titles:this.props.captions}),i.a.createElement(He,{type:"to",editor:this.props.editor,name:ra.toLabelField,parentKey:"labelSetting",value:e.to||this.props.labelFields[0],values:this.props.labelFields,titles:this.props.captions}),i.a.createElement(rt,{type:"color",parentKey:"labelSetting",editor:this.props.editor,fontColor:e.color||"#000"}),i.a.createElement(lt,{type:"fontFamily",parentKey:"labelSetting",editor:this.props.editor,fontFamily:e.fontFamily||ra.simHei}))}}]),t}(n.Component),{title:ra.label}),oa=window.DataViz.Language,la=Oe(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this.props.styleParameters.animationSetting;return i.a.createElement("div",{className:"animation-control"},i.a.createElement(Kt,{disabled:this.props.disabled,isOpen:e.show,type:"show",parentKey:"animationSetting",editor:this.props.editor}),i.a.createElement(Pe,{type:"type",parentKey:"animationSetting",symbolType:e.type,editor:this.props.editor}),i.a.createElement(Re,{type:"symbol",name:oa.symbolStyle,parentKey:"animationSetting",layerID:this.props.layerID,symbolName:e.symbol,symbolType:e.type,editor:this.props.editor,layerType:this.props.layerType}),i.a.createElement(_e.a,{name:oa.symbolSize,type:"symbolSize",parentKey:"animationSetting",editor:this.props.editor,value:e.symbolSize,min:10,max:20,unit:"Px"}),i.a.createElement(_e.a,{name:oa.constantSpeed,type:"constantSpeed",parentKey:"animationSetting",editor:this.props.editor,value:e.constantSpeed,min:10,max:50,unit:"Px/s"}))}}]),t}(n.Component),{title:oa.animationSetting}),ca=DataViz.Language,ua=["solid","dot","dash"],da=Oe(function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).editor=a.editor.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"editor",value:function(e,t,a){"type"===e&&(t="dot"===t?"dotted":"dash"===t?"dashed":"solid"),this.props.editor(e,t,a)}},{key:"render",value:function(){var e=this.props.styleParameters.lineSetting,t=e.type;return t="dotted"===t?"dot":"dashed"===t?"dash":"solid",i.a.createElement(i.a.Fragment,null,i.a.createElement(Ve.a,{name:ca.lineColor,type:"color",parentKey:"lineSetting",color:e.color,editor:this.editor}),i.a.createElement(Qe.a,{name:ca.lineStyle,type:"type",parentKey:"lineSetting",dashStyle:ua,strokeDashstyle:t,editor:this.editor}),i.a.createElement(_e.a,{name:ca.lineWidth,type:"width",parentKey:"lineSetting",editor:this.editor,value:e.width,min:0,max:20,unit:"Px"}),i.a.createElement(_e.a,{name:ca.lineOpacity,type:"opacity",parentKey:"lineSetting",editor:this.editor,value:100*e.opacity,max:100,unit:"%"}),i.a.createElement(_e.a,{name:ca.lineCurveness,type:"curveness",parentKey:"lineSetting",editor:this.editor,value:100*e.curveness,max:100,unit:"%"}))}}]),t}(n.Component),{title:ca.lineSetting}),pa=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this.props.styleParameters;return i.a.createElement(i.a.Fragment,null,i.a.createElement(ia,j()({isOpened:!0,editor:this.props.editor,captions:this.props.captions,styleParameters:e,numberFields:this.props.numberFields,stringFields:this.props.stringFields},"isOpened",!0)),i.a.createElement(da,{editor:this.props.editor,styleParameters:e}),i.a.createElement(sa,{editor:this.props.editor,styleParameters:e,labelFields:this.props.labelFields,captions:this.props.captions,disabled:this.props.disabled}),i.a.createElement(la,{layerID:this.props.layerID,editor:this.props.editor,styleParameters:e,layerType:this.props.layerType,disabled:this.props.disabled}))}}]),t}(n.Component),ha=(a(1692),window.DataViz.Language),fa=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).editor=a.editor.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"editor",value:function(e,t,a){if("filterCondition"===e)this.props.layerObj.changeFilterCondition(t);else if("labelStyle"===a)this.props.layerObj.changeLabelStyle(e,t);else if("pathStyle"===a)this.props.layerObj.changePathStyle(e,t);else if("direction"===a)this.props.layerObj.changeDirection(e,t);else if("rotation"===e){var n=T.a.toRadians(t);this.props.layerObj.changeStyle(e,n,a)}else this.props.layerObj.changeStyle(e,t,a);(this.props.layerObj.layerInfo&&this.props.layerObj.layerInfo.layerType===q.r.UNIQUE||["type","themeField","segmentMethod","segmentCount","colors","fillColor","minRadius","maxRadius","symbolInfo","imageInfo","weight","colorType","radius","fillOpacity"].includes(e))&&this.props.updateLegendView(null,(new Date).getTime())}},{key:"getFields",value:function(){var e=this.props.layerObj.layerInfo.dataTypes||this.props.layerObj.layerInfo.dataSource&&this.props.layerObj.layerInfo.dataSource.dataTypes||[],t=[],a=[],n=[];for(var i in e)"dataviz_featureID"!==i&&(e[i]===q.c.NUMBER?a.push(i):t.push(i),n.push(i));return{stringFields:t,numberFields:a,allFields:n,labelFields:[ha.unSetting].concat(n)}}},{key:"getContentUI",value:function(e,t,a){var n=this.props.layerObj.layerInfo,r=n.featureType,s=n.layerType,o=null,l={styleParameters:e,editor:this.editor,layerType:s};switch(this.props.themeType){case q.r.VECTOR:case q.r.SYMBOL:o=i.a.createElement(wt,Y()({},l,{featureType:r,layerID:this.props.layerObj.layerInfo.id,labelFields:t.labelFields,filterCondition:a,captions:this.props.layerObj.layerInfo.captions||{}}));break;case q.r.UNIQUE:o=i.a.createElement(Pt,Y()({},l,{layerID:this.props.layerObj.layerInfo.id,featureType:r,fields:t.allFields,labelFields:t.labelFields,captions:this.props.layerObj.layerInfo.captions||{},filterCondition:a,changeCustomPanelStatus:this.props.changeCustomPanelStatus}));break;case q.r.RANGE:o=i.a.createElement(Bt,Y()({},l,{featureType:r,fields:t.numberFields,labelFields:t.labelFields,captions:this.props.layerObj.layerInfo.captions||{},filterCondition:a,changeCustomPanelStatus:this.props.changeCustomPanelStatus}));break;case q.r.HEAT_MAP:case q.r.DATAFLOWHEAT:var c=[ha.unSetting].concat(t.numberFields);o=i.a.createElement(jt,Y()({},l,{fields:c,captions:this.props.layerObj.layerInfo.captions||{},filterCondition:a,changeCustomPanelStatus:this.props.changeCustomPanelStatus}));break;case q.r.DATAFLOW:var u=[ha.unSetting].concat(t.numberFields);o=i.a.createElement(ea,Y()({},l,{layerID:this.props.layerObj.layerInfo.id,directionFields:u,directionField:e.dataflowSetting&&e.dataflowSetting.directionField,labelFields:t.labelFields,captions:this.props.layerObj.layerInfo.captions||{},filterCondition:a,changeCustomPanelStatus:this.props.changeCustomPanelStatus,featureType:r}));break;case q.r.RANK_SYMBOL:o=i.a.createElement(Wt,Y()({},l,{layerID:this.props.layerObj.layerInfo.id,featureType:r,fields:t.numberFields,labelFields:t.labelFields,captions:this.props.layerObj.layerInfo.captions||{},filterCondition:a,changeCustomPanelStatus:this.props.changeCustomPanelStatus}));break;case q.r.MIGRATION:var d=this.props.layerObj.features.length>Ce.a.migrationCount;o=i.a.createElement(pa,Y()({},l,{layerID:this.props.layerObj.layerInfo.id,numberFields:t.numberFields,stringFields:t.stringFields,labelFields:t.labelFields,captions:this.props.layerObj.layerInfo.captions||{},disabled:d}));break;default:o=i.a.createElement("div",null)}return o}},{key:"render",value:function(){var e=this.props.layerObj.getStyleParameters(),t=this.getFields(),a=this.props.layerObj.styleCache[this.props.themeType].filterCondition;return i.a.createElement("div",{className:"layers-editor-tools"},this.getContentUI(e,t,a))}}]),t}(n.Component),ma=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={value:e.value},a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({value:e.value})}},{key:"handlerBlur",value:function(e){var t=parseFloat(e.target.value);this.props.onBlurTodo&&this.props.onBlurTodo(t,this.props.type,e.target)}},{key:"handlerChange",value:function(e){this.setState({value:e.target.value}),this.props.valueChangeTodo&&this.props.valueChangeTodo(e.target.value,this.props.type)}},{key:"render",value:function(){return i.a.createElement("input",{type:"text",value:this.state.value,placeholder:this.props.placeholder||"",onBlur:this.handlerBlur.bind(this),onChange:this.handlerChange.bind(this)})}}]),t}(n.Component),ya=a(429),ga=DataViz.Language;var va=function(e){return function(t){function a(e){var t;return f()(this,a),(t=v()(this,b()(a).call(this,e))).state={value:e.data.value,value1:e.data.value1},t.inputOnBlur=t.inputOnBlur.bind(O()(t)),t.handleChangeRadius=t.handleChangeRadius.bind(O()(t)),t}return E()(a,t),y()(a,[{key:"updateState",value:function(e,t){var a=this.state;null!=e&&(a.value=e),null!=t&&(a.value1=t),this.setState(a)}},{key:"componentWillReceiveProps",value:function(e){this.updateState(e.data.value,e.data.value1)}},{key:"componentDidUpdate",value:function(){var e=this,t=document.querySelectorAll(".input-error");Array.prototype.filter.call(t,(function(t){return Number(t.getAttribute("keyWord"))===e.props.keyWord})).forEach((function(e){e.parentNode.removeChild(e)}))}},{key:"handleChangeRadius",value:function(e){this.props.changeRadius(this.props.keyWord,e)}},{key:"renderEditorComponent",value:function(){var e=this.props,t=e.keyWord,a=e.editorIndex,n=e.data,r=e.changeColor,s=e.themeType;return t===a&&s===q.r.RANK_SYMBOL?i.a.createElement(i.a.Fragment,null,i.a.createElement(ya.a,{className:"radius-values",value:n.radius,min:1,max:20,unit:"Px",onChange:this.handleChangeRadius}),"IMAGE_POINT"!==n.type&&i.a.createElement(nt.a,{className:"color-value",innerWidth:"164px",color:n.color,value:t,onColorPickerChange:r})):null}},{key:"getValueContainer",value:function(){var e=this.props.themeType,t=null;return e===q.r.UNIQUE?t=i.a.createElement("div",{className:"value",title:this.state.value},this.state.value):[q.r.RANGE,q.r.RANK_SYMBOL].includes(e)&&(t=i.a.createElement("div",{className:"values-container"},i.a.createElement("div",{className:"range-values"},i.a.createElement("div",{className:"value-start"},i.a.createElement(ma,{onBlurTodo:this.inputOnBlur,type:"start",value:this.state.value})),i.a.createElement("div",{className:"value-hr"}," - "),i.a.createElement("div",{className:"value-end"},i.a.createElement(ma,{onBlurTodo:this.inputOnBlur,type:"end",value:this.state.value1}))),this.renderEditorComponent())),t}},{key:"inputOnBlur",value:function(e,t,a){var n=this.props.keyWord,i=this.props.datas,r=i.length;if("start"===t){if(n>0&&e<=i[n-1].value||e>=i[n].value1)return this.onErrorValue(a,t),!1}else if(n<r-1&&e>=i[n+1].value1||e<=i[n].value)return this.onErrorValue(a,t),!1;a&&a.nextSibling&&a.parentNode.removeChild(a.nextSibling),this.props.changeRange(n,e,t)}},{key:"onErrorValue",value:function(e,t){if(!e||!e.nextSibling){var a=e.parentNode,n=document.createElement("div");n.classList.add("input-error"),n.setAttribute("keyWord",this.props.keyWord),n.setAttribute("title",ga.inputValueIsErroe);var i=this;n.addEventListener("click",(function(){var e=i.props.datas[i.props.keyWord];"start"===t?i.updateState(e.value,null):i.updateState(null,e.value1)})),a.appendChild(n)}}},{key:"render",value:function(){return i.a.createElement("div",{className:"field-contianer"},i.a.createElement(e,this.props),this.getValueContainer())}}]),a}(n.Component)},Sa=va(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"onColorPickerChange",value:function(e,t){this.props.onColorPickerChange&&this.props.onColorPickerChange(e,t)}},{key:"render",value:function(){var e={color:this.props.data.color},t=q.q[this.props.featureType];return i.a.createElement("div",{className:"field-color"},i.a.createElement("div",{className:"color "+t,style:e},i.a.createElement(nt.a,{onColorPickerChange:this.onColorPickerChange.bind(this),type:"customColor",color:this.props.data.color,value:this.props.keyWord})))}}]),t}(n.Component)),ba=a(1656),Ia=a.n(ba),Ea=(n.Component,va(function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isShowCustom:!1},a.showEditorPanel=a.showEditorPanel.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"getPointStyle",value:function(){var e=this.props.data,t=e.type,a={width:2*e.radius+"px",height:2*e.radius+"px"},n="";return"IMAGE_POINT"===t&&e.imageInfo?(a.backgroundImage="url(".concat(T.a.completeRelativePath(e.imageInfo.url,!0),")"),n="img"):"SVG_POINT"===t&&e.symbolInfo&&e.symbolInfo.url?(a.backgroundImage="url(".concat(T.a.completeRelativePath(e.symbolInfo.url,!0),")"),n="img"):"SYMBOL_POINT"===t&&e.symbolInfo&&e.symbolInfo.className?(a.color=e.color,a.fontSize=2*e.radius+"px",delete a.width,delete a.height,n=e.symbolInfo.className):(a.backgroundColor=e.color,n="circle"),{className:n,style:a}}},{key:"showEditorPanel",value:function(){var e=this.props,t=e.keyWord;(0,e.handleChangeEditorIndex)(t)}},{key:"render",value:function(){var e=this.getPointStyle();return i.a.createElement("div",{className:"field-rank",onClick:this.showEditorPanel},i.a.createElement("div",{className:e.className,style:e.style}))}}]),t}(n.Component))),Ta=a(51),Ca=a.n(Ta),La=window.DataViz.Language,Na=Oe(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this.props.style,t="IMAGE_POINT"===e.type?e.imageInfo&&e.imageInfo.url:e.symbolInfo&&(e.symbolInfo.className||e.symbolInfo.url);return i.a.createElement(i.a.Fragment,null,i.a.createElement(Pe,{type:"symbolType",parentKey:"style",symbolType:e.type,editor:this.props.editor}),i.a.createElement(Re,{type:"symbol",parentKey:"style",symbolName:t,symbolType:e.type,editor:this.props.editor,layerID:this.props.fileId}),i.a.createElement(Ve.a,{name:La.pointColor,type:"fillColor",parentKey:"style",color:e.fillColor,symbolType:e.type,editor:this.props.editor}),i.a.createElement(_e.a,{name:La.pointSize,type:"radius",parentKey:"style",editor:this.props.editor,value:e.radius,min:1,max:20,unit:"Px"}),"IMAGE_POINT"!==e.type&&i.a.createElement(_e.a,{name:La.pointOpacity,type:"fillOpacity",parentKey:"style",value:100*e.fillOpacity,max:100,editor:this.props.editor,unit:"%"}))}}]),t}(n.Component),{title:La.symbolSetting}),ka=window.DataViz.Language,Oa=Oe(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this.props.style,t=e.lineDash,a=e.strokeColor,n=e.strokeWidth,r=e.strokeOpacity,s=e.type;return i.a.createElement(i.a.Fragment,null,i.a.createElement(Qe.a,{name:ka.lineStyle,type:"lineDash",parentKey:"style",strokeDashstyle:t||"solid",editor:this.props.editor}),i.a.createElement(Ve.a,{name:ka.lineColor,type:"strokeColor",parentKey:"style",color:a,editor:this.props.editor}),i.a.createElement(_e.a,{symbolType:s,name:ka.lineWidth,type:"strokeWidth",parentKey:"style",editor:this.props.editor,value:n,min:0,max:20,unit:"Px"}),i.a.createElement(_e.a,{symbolType:s,name:ka.lineOpacity,type:"strokeOpacity",parentKey:"style",editor:this.props.editor,value:100*r,max:100,unit:"%"}))}}]),t}(n.Component),{title:ka.outlineSetting}),Da=window.DataViz.Language,wa=Oe(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this.props.style,t=e.fillColor,a=e.fillOpacity;return i.a.createElement(i.a.Fragment,null,i.a.createElement(Ve.a,{name:Da.polygonfillColor,type:"fillColor",parentKey:"style",color:t,editor:this.props.editor}),i.a.createElement(_e.a,{name:Da.polygonOpacity,type:"fillOpacity",parentKey:"style",editor:this.props.editor,value:100*a,max:100,unit:"%"}))}}]),t}(n.Component),{title:Da.fillSetting}),Aa=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this.props.style;return i.a.createElement(i.a.Fragment,null,i.a.createElement(wa,{style:e,editor:this.props.editor,isOpened:!0}),i.a.createElement(Oa,{style:e,editor:this.props.editor,isOpened:!0}))}}]),t}(n.Component),Fa=(a(1699),{radius:8,lineDash:"solid",strokeWidth:1,strokeColor:"#ffffff",strokeOpacity:1,fillOpacity:.9,fillColor:"#FFFFFF",type:"BASIC_POINT"}),Ma=va(function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).onEditor=a.onEditor.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"onColorPickerChange",value:function(e,t){this.props.onColorPickerChange&&this.props.onColorPickerChange(e,t)}},{key:"onEditor",value:function(e,t){var a=this.props.data.style,n=a.symbolInfo;"symbolInfo"===e?(a.symbolInfo=t,a.type=!t||t.url?q.k.SVG_POINT:q.k.SYMBOL_POINT):"type"===e?([q.k.SYMBOL_POINT,q.k.SVG_POINT].includes(t)?a.type=!n||n.url?q.k.SVG_POINT:q.k.SYMBOL_POINT:a.type=t,t!==q.k.SVG_POINT||n||(a=Ca()({},Fa,a))):"imageInfo"===e?(a.imageInfo=t,a.type=q.k.IMAGE_POINT):a[e]=t,this.props.changeStyle(this.props.keyWord,a)}},{key:"getOverlay",value:function(){var e=this.props.data.style,t=this.props.featureType;return t===q.p.POINT?i.a.createElement(i.a.Fragment,null,i.a.createElement(Na,{style:e,editor:this.onEditor,isOpened:!0,hideArrow:!0,fileId:ge.p.newGuid(6)}),"IMAGE_POINT"!==e.type&&i.a.createElement(Tt,{editor:this.onEditor,styleParameters:{style:e},featureType:this.props.featureType,isOpened:!0,hideArrow:!0})):t===q.p.LINE?i.a.createElement(Oa,{style:e,editor:this.onEditor,isOpened:!0,hideArrow:!0}):t===q.p.POLYGON?i.a.createElement(Aa,{style:e,editor:this.onEditor,isOpened:!0,hideArrow:!0}):void 0}},{key:"getIcon",value:function(){var e,t=this.props.data.style,a=this.props.featureType,n=t.type,r=t.fillColor,s=t.symbolInfo,o=t.imageInfo,l=t.strokeColor,c=t.fillOpacity,u=t.strokeOpacity,d=t.radius,p=t.strokeWidth,h=this.getIconClass(t,a),f=2*d;if(n===q.k.SYMBOL_POINT&&s)e=i.a.createElement("div",{className:t.symbolInfo.className,style:{color:r,fontSize:f,opacity:c}});else if(n===q.k.IMAGE_POINT&&o)e=i.a.createElement("img",{src:o.url,style:{width:"".concat(f,"px"),height:"".concat(f,"px")}});else if(n===q.k.SVG_POINT&&s&&s.url)e=i.a.createElement("img",{src:s.url,style:{width:"".concat(f,"px"),height:"".concat(f,"px")}});else{var m={};a===q.p.LINE?(m.color=l,m.opacity=u,m.fontSize="".concat(12+p,"px")):(m.color=r,m.opacity=c),a===q.p.POINT?m.fontSize=f:a===q.p.POLYGON&&(m.fontSize="".concat(p-1+12,"px")),e=i.a.createElement("div",{className:"color "+h,style:m})}return e}},{key:"getIconClass",value:function(e,t){var a=e.lineDash;return t===q.p.POINT||"solid"===a?q.q[this.props.featureType]:t===q.p.LINE?"supermapol-icons-line-s".concat(a):"supermapol-icons-polygon-s".concat(a)}},{key:"render",value:function(){return i.a.createElement(ge.l,{overlay:this.getOverlay(),placement:"bottomRight",overlayClassName:"theme-filed-style",destroyTooltipOnHide:!0,align:{offset:[-40,0]}},i.a.createElement("div",{className:"field-color"},this.getIcon()))}}]),t}(n.Component)),Ra=(a(1700),window.DataViz.Language),xa={UNIQUE:Ra.customValue,RANGE:Ra.customRange,HEAT:Ra.customColor,DATAFLOW_HEAT:Ra.customColor,RANK_SYMBOL:Ra.customRadius},Pa={UNIQUE:Ra.customUniqueTip,RANGE:Ra.customRangeTip,HEAT:Ra.customHeatTip,DATAFLOW_HEAT:Ra.customHeatTip,RANK_SYMBOL:Ra.customRankTip},Va=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={editorIndex:-1},a.changeColor=a.changeColor.bind(O()(a)),a.changeStyle=a.changeStyle.bind(O()(a)),a.changeRange=a.changeRange.bind(O()(a)),a.changeRadius=a.changeRadius.bind(O()(a)),a.handleChangeEditorIndex=a.handleChangeEditorIndex.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"handleChangeEditorIndex",value:function(e){e===this.state.editorIndex&&(e=-1),this.setState({editorIndex:e})}},{key:"changeColor",value:function(e,t){this.props.layerObj.changeUserDefinedAttr(t,e.hex),this.props.updateLegendView(null,(new Date).getTime())}},{key:"changeStyle",value:function(e,t){this.props.layerObj.changeUserDefinedAttr(e,t),this.props.updateLegendView(null,(new Date).getTime())}},{key:"changeRange",value:function(e,t,a){this.props.layerObj.changeRange(e,t,a),this.props.updateLegendView(null,(new Date).getTime())}},{key:"changeRadius",value:function(e,t){this.props.layerObj.changeUserDefinedAttr(e,t,"radius"),this.props.updateLegendView(null,(new Date).getTime())}},{key:"getAllFieldColor",value:function(){var e=[],t=this.props.layerObj.layer;if([q.r.UNIQUE,q.r.RANGE,q.r.RANK_SYMBOL].includes(this.props.themeType)){var a=t.get("styleSource"),n=a.styleGroups,i=a.parameters.style;this.props.themeType===q.r.RANK_SYMBOL?n.forEach((function(t){var a={type:i.type,radius:t.radius,color:t.fillColor,symbolInfo:i.symbolInfo,imageInfo:i.imageInfo,value:t.start,value1:t.end};e.push(a)})):this.props.themeType===q.r.UNIQUE?n.forEach((function(t){var a={style:t.style,value:t.value};e.push(a)})):n.forEach((function(t){var a={color:t.color,value:void 0!==t.start?t.start:t.value,value1:t.end};e.push(a)}))}else{if(![q.r.HEAT_MAP,q.r.DATAFLOWHEAT].includes(this.props.themeType))return null;e=t.getGradient()}return this.getFieldUI(e,this.props.themeType)}},{key:"getFieldUI",value:function(e,t){var a,n=this,r=[];return e.forEach((function(s,o){t===q.r.UNIQUE?a=i.a.createElement(Ma,{key:o+"  "+s.value,data:s,datas:e,keyWord:s.value,themeType:t,featureType:n.props.layerObj.layerInfo.featureType,changeStyle:n.changeStyle}):t===q.r.RANGE?a=a=i.a.createElement(Sa,{key:o+"  "+s.value,data:s,datas:e,keyWord:t===q.r.UNIQUE?s.value:o,themeType:t,featureType:n.props.layerObj.layerInfo.featureType,changeRange:n.changeRange,onColorPickerChange:n.changeColor}):t===q.r.HEAT_MAP||t===q.r.DATAFLOWHEAT?a=i.a.createElement("div",{key:o,className:"field-contianer"},i.a.createElement("div",{className:"heat-color-title"},Ra.heatColor+(o+1)),i.a.createElement("div",{className:"heat-color"},i.a.createElement(nt.a,{onColorPickerChange:n.changeColor,color:s,value:o}))):t===q.r.RANK_SYMBOL&&(a=i.a.createElement(Ea,{key:o+"  "+s.value,data:s,datas:e,keyWord:o,editorIndex:n.state.editorIndex,themeType:t,changeRange:n.changeRange,changeRadius:n.changeRadius,changeColor:n.changeColor,handleChangeEditorIndex:n.handleChangeEditorIndex})),r.push(a)})),r}},{key:"render",value:function(){return this.props.themeType===q.r.VECTOR||this.props.themeType===q.r.SYMBOL?null:i.a.createElement("div",{className:"editor-fields-color"},i.a.createElement("p",{className:"title"},xa[this.props.themeType]),i.a.createElement("p",{className:"tips"},Pa[this.props.themeType]),i.a.createElement("div",{ref:"fieldsContainer",className:"fields-container"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},this.getAllFieldColor())))}}]),t}(n.Component),Ba=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).endEditor=a.endEditor.bind(O()(a)),a.setDefaultStyle=a.setDefaultStyle.bind(O()(a)),a.changeTabFold=a.changeTabFold.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"endEditor",value:function(){this.props.isShowCustom?this.props.changeCustomPanelStatus(!1):this.props.selectedLayer(0)}},{key:"changeTabFold",value:function(e){e.stopPropagation(),this.props.changeTabFold(!this.props.fold)}},{key:"setDefaultStyle",value:function(){var e=this.props,t=e.layerObj,a=e.isShowCustom,n=e.updateState,i=e.updateLegendView;t.regainDefaultStyle(a),n(null,null,!0),i(null,(new Date).getTime())}},{key:"render",value:function(){return i.a.createElement("div",{className:"layer-editor-title"},i.a.createElement("div",{className:"left-container",onClick:this.endEditor},i.a.createElement(C.a,{placement:"bottom",tooltip:this.props.isShowCustom?DataViz.Language.toPrev:DataViz.Language.toIndex,labelType:"div",iconClassName:"end-editor supermapol-icons-return",needPropagation:!0}),i.a.createElement("span",{className:"name"},this.props.layerObj.layerInfo.name)),this.props.returnDeafult&&i.a.createElement(ge.k,{title:this.props.isShowCustom?DataViz.Language.inquiryReturnCustomDefaultStyle:DataViz.Language.inquiryReturnDefaultStyle,placement:"bottomLeft",cancelText:DataViz.Language.cancelButton,okText:DataViz.Language.ModelContinueButton,onConfirm:this.setDefaultStyle},i.a.createElement(C.a,{placement:"top",tooltip:DataViz.Language.returnDeafult,labelType:"div",iconClassName:"return-default supermapol-icons-restoredefault"})),i.a.createElement(C.a,{placement:"bottom",tooltip:DataViz.Language.packup,labelType:"div",iconClassName:"editor-hide supermapol-icons-packup",onClick:this.changeTabFold}))}}]),t}(n.Component),Ua=a(45),Ga=(a(1701),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={features:e.layerObj.features,hasValue:!1,selectedFeature:e.selectedMarkerFeature},a.clearSearch=a.clearSearch.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.layerObj.features&&(this.state.hasValue?(this.searchFeature(),this.setState({selectedFeature:e.selectedMarkerFeature})):this.setState({features:e.layerObj.features,selectedFeature:e.selectedMarkerFeature}))}},{key:"judgeType",value:function(e){switch(q.e[e.getGeometry().getType().toUpperCase()]){case q.e.POINT:return e.getProperties().useStyle&&e.getProperties().useStyle.text?"supermapol-icons-text-layer1":"supermapol-icons-point-layer1";case q.e.LINE:return"supermapol-icons-line-layer1";case q.e.POLYGON:return"supermapol-icons-polygon-layer1";default:return}}},{key:"deleteFeature",value:function(e,t){var a=de.a.getVectorLayerById(this.props.layerObj.layerInfo.id);de.a.closeAllPop(),a.removeFeature(e,t),this.props.hideMarkerPopup()}},{key:"showPopup",value:function(e){de.a.closeAllPop();var t=!this.props.layerObj.layerInfo.layerNotEditable;Ua.a.checkPopPosition(e,null,this.props.showMarkerPopup.bind(this,this.props.layerObj.layerInfo.id,e,this.props.mousePosition,t))}},{key:"zoomToFeature",value:function(e){this.props.hideMarkerPopup(),this.setState({selectedFeature:e}),de.a.map.getView().animate({center:e.getGeometry().getFirstCoordinate()}),de.a.highlightFeature(e)}},{key:"searchFeature",value:function(){var e=this.refs.searchInput.value,t=this.props.layerObj.features;if(""===e)this.setState({features:t,hasValue:!1});else if(""===e||t&&0!==t.length){var a=[];t.forEach((function(t){var n=t.get("attributes");n&&n.dataViz_title&&-1!==n.dataViz_title.indexOf(e)?a.push(t):n&&n.dataViz_description&&-1!==n.dataViz_description.indexOf(e)&&a.push(t)})),this.setState({features:a,hasValue:!0})}else this.setState({hasValue:!0})}},{key:"clearSearch",value:function(){this.refs.searchInput.value="",this.setState({features:this.props.layerObj.features,hasValue:!1})}},{key:"getDefaultTitle",value:function(e){var t=e.get("attributes");return t&&t.dataViz_title?t.dataViz_title:e.getProperties().useStyle.text?DataViz.Language.markerText:DataViz.Language.defaultMarkerName}},{key:"changeMarkerTitle",value:function(e,t){var a=this.state.features.slice(),n=a[e];if(n){var i=n.getProperties().useStyle;i&&i.text?(t=t||DataViz.Language.markerText,i.text=t,Ua.a.setStyle(i,"TEXT",n)):n.get("attributes").dataViz_title=t;var r=window.cloneDeep(n.get("attributes"))||{};r.dataViz_title=t,n.setProperties({attributes:r}),Ua.a.isClose||this.props.updataMarker(n),this.setState({features:a})}}},{key:"getContainer",value:function(){if(this.state.features&&this.state.features.length>0){var e=[];return this.state.features.forEach((function(t,a){var n=this.getDefaultTitle(t);e.push(i.a.createElement("li",{className:this.state.selectedFeature===t?"marker-feature active":"marker-feature",key:a},i.a.createElement("div",{className:"left-container",onClick:this.zoomToFeature.bind(this,t)},i.a.createElement("span",{className:this.judgeType(t)+" icon",onClick:this.zoomToFeature.bind(this,t)}),i.a.createElement(w,{placement:"top",className:"base title",onBlur:this.changeMarkerTitle.bind(this,a),value:n})),i.a.createElement(C.a,{placement:"top",labelType:"span",iconClassName:"supermapol-icons-edit",tooltip:window.DataViz.Language.editMarker,onClick:this.showPopup.bind(this,t)}),i.a.createElement(ge.k,{title:DataViz.Language.isDeleteFeature,placement:"rightTop",cancelText:DataViz.Language.cancelButton,okText:DataViz.Language.deleted,onConfirm:this.deleteFeature.bind(this,t,a)},i.a.createElement(C.a,{placement:"top",labelType:"span",tooltip:window.DataViz.Language.deleteMarker,iconClassName:"supermapol-icons-delete"}))))}),this),e}}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"marker-layer-lists"},i.a.createElement("div",{className:"search"},i.a.createElement("span",{className:"supermapol-icons-search"}),i.a.createElement("input",{ref:"searchInput",type:"text",placeholder:DataViz.Language.markerSerchPlaceholder,onChange:function(){T.a.delayCall((function(){e.searchFeature()}),800,e)}}),i.a.createElement("span",{className:"supermapol-icons-close",onClick:this.clearSearch,style:{display:this.state.hasValue?"block":"none"}})),i.a.createElement("ul",{className:"marker-feature-lists"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},this.getContainer())))}}]),t}(n.Component)),_a=a(188),za=(a(1702),window.DataViz.Language),ja=[{type:"POINT",icon:"supermapol-icons-point-layer1",title:za.drawPointType},[{type:"LINE",icon:"supermapol-icons-line-layer1",title:za.drawLineType},{type:"BEZIER",icon:"supermapol-icons-bezier-layer",title:za.drawBezier}],[{type:"POLYGON",icon:"supermapol-icons-polygon-layer1",title:za.polygonTitle},{type:"CIRCLE",icon:"supermapol-icons-circle-layer",title:za.drawCircle},{type:"ELLIPSE",icon:"supermapol-icons-oval-layer",title:za.drawEllipse},{type:"RECTANGLE",icon:"supermapol-icons-rectangle-layer",title:za.drawRec},{type:"HEXAGON",icon:"supermapol-icons-hexagon-layer",title:za.drawHex}],{type:"TEXT",icon:"supermapol-icons-text-layer1",title:za.drawText}],Wa=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={activeType:void 0},a.activeDrawControl=a.activeDrawControl.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentDidMount",value:function(){this.props.layerObj.layerInfo.triggerDrawPoint&&this.activeDrawControl(ja[0].type)}},{key:"componentWillUnmount",value:function(){_a.a.deatectiveDrawControl()}},{key:"activeDrawControl",value:function(e){this.state.activeType===e?(this.deactiveDrawControl(),_a.a.deatectiveDrawControl()):(this.state.activeType!=e&&this.setState({activeType:e}),this.setActiveControlToManager(e))}},{key:"setActiveControlToManager",value:function(e){var t=this,a=de.a.getVectorLayerById(t.props.layerObj.layerInfo.id);_a.a.activeDrawControl(e,a,(function(){t.deactiveDrawControl(),t.props.onDrawEnd(null,null,!0)}))}},{key:"deactiveDrawControl",value:function(){this.setState({activeType:""})}},{key:"getCls",value:function(e){return e.includes(this.state.activeType)?"draw-group-item draw-active":"draw-group-item"}},{key:"getContent",value:function(){var e,t=this,a=[];return ja.forEach((function(n,r){if(n.length)e=i.a.createElement(We.b,{key:r,className:t.getCls(n.map((function(e){return e.type}))),selectedValue:t.state.activeType,renderValue:function(e){var t=n.find((function(t){return t.type===e}))||n[0];return i.a.createElement("span",{className:t.icon})},onChange:t.activeDrawControl},n.map((function(e){var t=e.type,a=e.title,n=e.icon;return i.a.createElement(We.a,{key:t,value:t},i.a.createElement("span",{title:a,className:n}))})));else{var s=n.type,o=n.title,l=n.icon;e=i.a.createElement("div",{key:s,className:t.getCls([s]),title:o,onClick:function(){t.activeDrawControl(s)}},i.a.createElement("span",{className:l}))}a.push(e)})),a}},{key:"render",value:function(){return i.a.createElement("div",{className:"draw-group"},this.getContent())}}]),t}(n.Component),Ha=window.DataViz.Language,Ya=function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"shouldComponentUpdate",value:function(e){return e.selected!==this.props.selected}},{key:"render",value:function(){var e=this.props,t=e.imgSrc,a=e.disable,n=t||"./static/imgs/map/default_map.png",r=a?" dv-basemap-disable":"";return i.a.createElement("div",{className:"basemap-thumb"+r,title:a?Ha.changeBaseMapToDifferent:""},i.a.createElement("div",{onClick:this.props.onClick,className:this.props.selected?" active":"",style:{backgroundImage:"url(".concat(n,")")}}),i.a.createElement("span",{title:this.props.baseMapName},this.props.baseMapName))}}]),t}(n.Component),Ka=a(41),Xa=a(105),qa=(a(1703),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={baseMapInfo:Ka.a.dataVizConfig.buildinMaps},a.useMVTBaseLayer=a.useMVTBaseLayer.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"changeBaseMap",value:function(e){if(e!==this.props.baseLayerIndex){this.props.changeBaseMapIndex(e,this.getBaseLayerInfo(e));var t={minScale:T.a.formatScale(de.a.scales[0]),maxScale:T.a.formatScale(de.a.scales[de.a.scales.length-1])};this.props.changeMinMaxScale(t)}}},{key:"changeTabFold",value:function(){this.props.changeTabFold(!this.props.fold)}},{key:"getBaseMapThumbsElement",value:function(){var e=null,t=this;return this.state.baseMapInfo&&(e=[],this.state.baseMapInfo.forEach((function(a,n){var r=t.getBaseLayerInfo(n,!0);if(r){var s=r.projection!==t.props.baseLayerProject&&this.props.hasAddLayers;e.push(i.a.createElement(Ya,{key:n,disable:s,baseMapName:r.name,imgSrc:r.thumbnail,onClick:t.changeBaseMap.bind(t,n),selected:n==t.props.baseLayerIndex}))}}),this)),e}},{key:"useMVTBaseLayer",value:function(e){var t=Ka.a.layerCache,a=t.length-1;t[a]=e,this.props.changeBaseMapIndex(a,Ka.a.layerCache[a])}},{key:"endEditor",value:function(){this.props.selectedLayer(0)}},{key:"getBaseLayerInfo",value:function(e,t){var a,n=this.state.baseMapInfo[e];if(n.internetMapName)if(t){var i=n.internetMapName;a=Xa.a.getMapInfo(i)}else a=n;else a=Ka.a.layerCache[e];return a}},{key:"render",value:function(){var e=this.getBaseLayerInfo(this.props.baseLayerIndex,!0);return i.a.createElement("div",{className:"baselayer-contianer"},i.a.createElement("div",{className:"layer-editor-title"},i.a.createElement("div",{className:"left-container",onClick:this.endEditor.bind(this)},i.a.createElement(C.a,{placement:"bottom",tooltip:DataViz.Language.toIndex,labelType:"div",iconClassName:"end-editor supermapol-icons-return",needPropagation:!0}),i.a.createElement("span",{className:"name"},e.name)),i.a.createElement(C.a,{placement:"bottom",tooltip:DataViz.Language.packup,labelType:"div",iconClassName:"editor-hide supermapol-icons-packup",onClick:this.changeTabFold.bind(this)})),i.a.createElement("div",{className:"baselayer-content"},i.a.createElement(le.a,{className:"scroll-bars"},this.getBaseMapThumbsElement())))}}]),t}(n.Component)),Ja=(a(1704),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).layerObj=null,a.visible=!1,a.state={themeType:null,styleChange:0},a}return E()(t,e),y()(t,[{key:"updateState",value:function(e,t,a){t&&(this.state.themeType=t),a&&this.state.styleChange++,this.setState(this.state)}},{key:"changeCustomPanelStatus",value:function(e){this.props.isShowCustom!==e&&this.props.showCustomSettings(e)}},{key:"getLayerInfo",value:function(){var e=de.a.getVectorLayerById(this.props.selectedLayerId);e?e.layerInfo.getDataFaild?e=null:(this.visible=e.layerInfo.visible,this.layerType=q.i.VECTOR_LAYER,this.state.themeType=e.layerInfo.layerType):!(e=de.a.getTileLayerById(this.props.selectedLayerId))||e.layerInfo.getDataFaild?e=null:e.isBaseLayer()?this.layerType=q.i.BASE_LAYER:this.layerType=q.i.REST_LAYER,this.layerObj=e}},{key:"getContainer",value:function(){var e,t=this.props.isShowCustomSetting;switch(this.state.themeType){case q.r.MARKER:e=i.a.createElement("div",null,i.a.createElement(Ba,{layerObj:this.layerObj,returnDeafult:!1,updateState:this.updateState.bind(this),selectedLayer:this.props.selectedLayer,changeTabFold:this.props.changeTabFold,fold:this.props.fold}),i.a.createElement(Wa,{layerObj:this.layerObj,onDrawEnd:this.updateState.bind(this)}),i.a.createElement(Ga,{layerObj:this.layerObj,showMarkerPopup:this.props.showMarkerPopup,hideMarkerPopup:this.props.hideMarkerPopup,updataMarker:this.props.updataMarker,selectedMarkerFeature:this.props.selectedMarkerFeature,mousePosition:this.props.mousePosition}));break;case q.r.DATAFLOW:case q.r.DATAFLOWHEAT:e=i.a.createElement("div",null,i.a.createElement(Ba,{layerObj:this.layerObj,returnDeafult:!0,updateState:this.updateState.bind(this),selectedLayer:this.props.selectedLayer,changeTabFold:this.props.changeTabFold,isShowCustom:t,changeCustomPanelStatus:this.changeCustomPanelStatus.bind(this),updateLegendView:this.props.updateLegendView,fold:this.props.fold}),t?i.a.createElement(Va,{key:this.state.themeType,layerObj:this.layerObj,themeType:this.state.themeType,updateState:this.updateState.bind(this),updateLegendView:this.props.updateLegendView}):i.a.createElement(i.a.Fragment,null,i.a.createElement(Ne,{layerObj:this.layerObj,themeType:this.state.themeType,updateState:this.updateState.bind(this),updateLegendView:this.props.updateLegendView}),i.a.createElement("div",{className:"layer-types-shadow"}," "),i.a.createElement("div",{className:"theme-tools"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},i.a.createElement(fa,{updateState:this.updateState.bind(this),layerObj:this.layerObj,themeType:this.state.themeType,updateLegendView:this.props.updateLegendView})))));break;default:e=i.a.createElement("div",null,i.a.createElement(Ba,{layerObj:this.layerObj,returnDeafult:!0,updateState:this.updateState.bind(this),selectedLayer:this.props.selectedLayer,changeTabFold:this.props.changeTabFold,fold:this.props.fold,updateLegendView:this.props.updateLegendView,isShowCustom:t,changeCustomPanelStatus:this.changeCustomPanelStatus.bind(this)}),t?i.a.createElement(Va,{key:this.state.themeType,layerObj:this.layerObj,themeType:this.state.themeType,updateState:this.updateState.bind(this),updateLegendView:this.props.updateLegendView}):i.a.createElement(i.a.Fragment,null,i.a.createElement(Ne,{layerObj:this.layerObj,themeType:this.state.themeType,updateState:this.updateState.bind(this),updateLegendView:this.props.updateLegendView}),i.a.createElement("div",{className:"theme-tools"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},i.a.createElement(fa,{updateState:this.updateState.bind(this),layerObj:this.layerObj,themeType:this.state.themeType,updateLegendView:this.props.updateLegendView,changeCustomPanelStatus:this.changeCustomPanelStatus.bind(this)})))))}return e}},{key:"render",value:function(){if(this.getLayerInfo(),!this.layerObj)return null;switch(this.layerType){case q.i.BASE_LAYER:return i.a.createElement(qa,{selected:!0,changeBaseMapIndex:this.props.changeBaseMapIndex,changeMinMaxScale:this.props.changeMinMaxScale,selectedLayer:this.props.selectedLayer,baseLayerIndex:this.props.baseLayerIndex,changeTabFold:this.props.changeTabFold,fold:this.props.fold,baseLayerProject:de.a.getBaseLayerProj(),hasAddLayers:this.props.layersUI&&this.props.layersUI.length>1,updateBaseLayer:this.props.updateBaseLayer});case q.i.VECTOR_LAYER:return i.a.createElement("div",{className:"layers-editor"},this.getContainer());default:return null}}}]),t}(n.Component)),Za=(a(1705),a(1706),window.DataViz.Language),Qa=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={disabled:!0},a.checkReLogin=a.checkReLogin.bind(O()(a)),a.handleChange=a.handleChange.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentDidMount",value:function(){var e=this;this.isMount=!0,T.a.checkReLogin().then((function(){e.updateState(!1)})).catch((function(){e.updateState(!0)})),null===Ka.a.hasRelationship&&T.a.checkPublicServer().then((function(e){Ka.a.hasRelationship=e.hasRelationship}))}},{key:"componentWillUnmount",value:function(){this.isMount=!1}},{key:"updateState",value:function(e){this.isMount&&this.setState({disabled:!!e})}},{key:"checkReLogin",value:function(){var e=this;T.a.checkReLogin().then((function(){e.updateState(!1)})).catch((function(){e.updateState(!0),K.a.showLoinBox({onSucceed:function(){e.updateState(!1)}})}))}},{key:"handleChange",value:function(e){this.props.changeFile(e),this.updateState(!0)}},{key:"render",value:function(){var e={};return this.state.disabled?e.onClick=this.checkReLogin:e.htmlFor="file",i.a.createElement("div",null,i.a.createElement("label",Y()({className:"add-from-file-btn primary-btn"},e),i.a.createElement("span",{className:"icon supermapol-icons-uploading"}),i.a.createElement("span",null,Za.uploadFile)),i.a.createElement("input",{type:"file",id:"file",accept:"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.csv,.geojson,.json,application/zip",onChange:this.handleChange,style:{opacity:0}}))}}]),t}(n.Component),$a=function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this.props.infoName,t=this.props.type,a=this.props.author,n=this.props.isSample?this.props.dataCount:this.props.time,r="".concat(this.props.isSample?"sample title":"title");return this.props.isTilte||(r="".concat(this.props.isSample?"sample":""),n=this.props.isSample?this.props.dataCount:n),e=e.split(".")[0],i.a.createElement("div",{ref:"title",className:"datainf "+r,id:this.props.index,onClick:this.changeSelected.bind(this)},i.a.createElement("div",{className:"datainf_name",title:e},e),i.a.createElement("div",{className:"datainf_type",title:t},t),!this.props.isSample&&i.a.createElement("div",{className:"datainf_author",title:a},a),i.a.createElement("div",{className:"datainf_time",title:n},n))}},{key:"changeSelected",value:function(e){this.props.changeSelected&&this.props.changeSelected(e.currentTarget.id)}}]),t}(n.Component),en=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={selectedValue:a.props.selectedValue},a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.selectedValue!==this.state.selectedValue&&this.setState({selectedValue:e.selectedValue})}},{key:"getAllUI",value:function(){var e=this,t=[],a=this.props.dataType===q.f.SAMPLE;return this.props.datas.forEach((function(n,r){(a||["RESTMAP","RESTDATA","EXCEL","CSV","JSON","GEOJSON","SHP"].includes(n.type))&&t.push(i.a.createElement(Ke.a,{key:n.fileName+n.id,value:n.id},i.a.createElement($a,{key:r,isSample:a,dataType:e.props.dataType,infoName:n.fileName,type:n.type,time:n.lastModfiedTime,author:n.nickname,dataCount:n.lineNumber,index:n.id,selected:n.selected,changeSelected:e.changeSelected.bind(e)})))})),t}},{key:"changeSelected",value:function(e){var t=T.a.isNumber(e)?Number(e):e;this.props.onSelect(t,this.state.selectedValue)}},{key:"render",value:function(){var e=this.getAllUI(),t=this.state.selectedValue,a=this.props.dataType===q.f.SAMPLE;return i.a.createElement("div",{className:"mydata_data_infs"},i.a.createElement($a,{isTilte:!0,isSample:a,dataType:this.props.dataType,infoName:DataViz.Language.name,type:DataViz.Language.type,author:DataViz.Language.author,time:DataViz.Language.time,dataCount:DataViz.Language.dataCount}),i.a.createElement(Ke.b,{name:"datas-li",onChange:this.changeSelected.bind(this),selectedValue:t},e))}}]),t}(n.Component),tn=a(53),an=(a(1709),function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"refresh-button",onClick:this.props.onClick},i.a.createElement("span",{className:"supermapol-icons-refresh"},DataViz.Language.refreshData))}}]),t}(n.Component));a(675);var nn=function(e){var t=e.height,a=e.width;return t||(t="100%"),a||(a="100%"),i.a.createElement("div",{style:{width:a,height:t},className:"dataviz-nodata-pane"},i.a.createElement("div",{className:"dataviz-nodata-content"},i.a.createElement("div",{className:"nodata-img"}),i.a.createElement("div",{className:"nodata-text"},e.text||DataViz.Language.noDatas),e.refreshBtnClick&&i.a.createElement(an,{onClick:e.refreshBtnClick}),e.children&&e.children))},rn=(a(1710),a(246)),sn=DataViz.Language,on=["GEOJSON","EXCEL","CSV","SHP"],ln=T.a.getIPortalUrl(),cn={MYDATA:"myDataInfs",SAMPLE:"sampleDataInfs"},un=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isLoading:!0,myDataInfs:{selectedId:null,currentPage:1,total:1,datas:{}},sampleDataInfs:{selectedId:rn.b[0].id,currentPage:1,total:8,datas:{1:rn.b}},disableConfirm:!0},a.nickname="",a.pageDataServer=null,a.fileSource=cn[e.dataType],a}var n;return E()(t,e),y()(t,[{key:"open",value:function(){this.modalBox.showModal(),this.fileSource=cn[this.props.dataType],this.getPageDataServerInstance(),this.getDatas()}},{key:"getPageDataServerInstance",value:function(){this.props.dataType!==q.f.SAMPLE&&(this.pageDataServer||(this.pageDataServer=new ge.j("".concat(ln,"web/datas.json"),{types:["JSON","EXCEL","CSV","GEOJSON","SHP"],orderBy:"LASTMODIFIEDTIME",orderType:"DESC",currentPage:1,pageSize:8},{withCredentials:!0})))}},{key:"getDatas",value:(n=p()(u.a.mark((function e(t){var a,n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=window.cloneDeep(this.state[this.fileSource]),t=t||a.currentPage,!(n=a.datas[t])||!n.length){e.next=9;break}a.selectedId=n[0].id,a.currentPage=t,this.setState((i={},j()(i,this.fileSource,a),j()(i,"isLoading",!1),j()(i,"disableConfirm",!1),i)),e.next=20;break;case 9:return this.setState({isLoading:!0}),e.prev=10,e.next=13,this.getMyDatas(t);case 13:a=e.sent,this.setState(j()({disableConfirm:!a.datas[t].length,isLoading:!1},this.fileSource,a)),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),this.getDatasFaild(e.t0,t);case 20:case"end":return e.stop()}}),e,this,[[10,17]])}))),function(e){return n.apply(this,arguments)})},{key:"getMyDatas",value:function(e){var t=this,n=this.state[this.fileSource];return T.a.checkReLogin().then((function(i){return t.nickname=i.nickname,t.pageDataServer.getPageDatas(e).then((function(t){var i=t.data.content;return a.e(5).then(a.t.bind(null,1832,7)).then((function(a){var r=a.default;if("zh"===window.lang&&r.locale("zh-cn"),i&&i.length>0)for(var s in i){var o=i[s];o.lastModfiedTime=r(o.lastModfiedTime).fromNow()}return i[0]&&(n.selectedId=i[0].id),n.currentPage=e,n.datas[e]=i,n.total=t.data.total,n}))})).catch((function(){throw{getDatasInfFailed:!0}}))}))}},{key:"getDatasFaild",value:function(e,t){var a=this;e.checkReLogin?K.a.showLoinBox({onSucceed:function(){a.getDatas(t)}}):e.getDatasInfFailed&&(K.a.showMessage(DataViz.Language.getRestDataFaild,q.j.WARNING),this.nickname="",this.setState(j()({isLoading:!1,disableConfirm:!0},this.fileSource,{selectedId:null,currentPage:1,total:1,datas:{}})))}},{key:"isMyData",value:function(e){var t=this.state.myDataInfs;return t.datas[t.currentPage].find((function(t){return t.id===e})).nickname===this.nickname}},{key:"addData",value:function(){var e=this.state[this.fileSource];if(e.selectedId)if(this.props.dataType===q.f.SAMPLE){var t=this.getSelectedData(e.selectedId);this.sampleData=t,this.getDataContent(t.path,t.id)}else if(this.isMyData(this.state.myDataInfs.selectedId))this.onloadSelectedData();else{this.props.onLoading(!1);var a=e.selectedId,n=this.getSelectedData(a);K.a.showConfirmModal({modalTitle:sn.shareData,children:i.a.createElement("span",null,sn.saveShareData,i.a.createElement("b",null,sn.myData)),okButton:sn.ModelContinueButton},this.downloadSelectData.bind(this,a,n))}else K.a.showMessage(DataViz.Language.chooseOneData,q.j.WARNING,3e3)}},{key:"downloadSelectData",value:function(e,t){var a=this;T.a.doFetch("".concat(T.a.getIPortalUrl(),"web/datas/").concat(e,"/download.json"),{withCredentials:!0,method:"GET",dataType:"binary"}).then((function(e){a.addShareData(e,t)}))}},{key:"onloadSelectedData",value:function(){K.a.showMessage(DataViz.Language.analyseData,q.j.WARNING,5e4);var e=this.state[this.fileSource].selectedId;K.a.closeMessage(),this.getDataContent(null,e)}},{key:"addRelationData",value:function(e,t,a,n,i){this.props.onFileLoad({serverId:e.id,fileName:e.fileName.split(".")[0],originName:e.fileName,name:t.name,dataCount:t.recordCount,featureType:q.e[t.type.toUpperCase()],type:a,address:n,isMvt:i&&i.isMvt,bounds:i&&i.bounds,epsgCode:i&&i.epsgCode})}},{key:"addBinaryData",value:function(e,t,a,n,i){this.props.onLoading(!1),this.props.onFileLoad({serverId:e,data:t,featureType:n,name:a,originName:i.fileName,type:i.type,fileSource:this.props.dataType,sampleDataXYField:this.sampleData&&{x:this.sampleData.xField,y:this.sampleData.yField}},!0)}},{key:"addShareData",value:function(e,t){this.props.onLoading(!1);var a=t.fileName.split("."),n=a[1],i=t.fileName;n||(n=this.getDataType(t.type),i="".concat(i,".").concat(n)),this.props.changeFile({file:e,fileType:n,fileName:a[0],originName:i},!0)}},{key:"getDataType",value:function(e){return["JSON","CSV","GEOJSON","SHP"].includes(e)?e.toLowerCase():"EXCEL"===e?"xlsx":void 0}},{key:"getDataContent",value:function(e,t){var a=e||"".concat(T.a.getIPortalUrl(),"web/datas/").concat(t,"/content.json?&currentPage=1&pageSize=99999999"),n=this;n.props.onLoading(!0),T.a.doFetch(a,{method:"GET",withCredentials:!0}).then((function(e){if(!1===e.succeed)return K.a.showMessage(DataViz.Language.getRestDataFaild,q.j.WARNING),void n.props.onLoading(!1);var a,i,r=tn.a.getFileType(e).name;if("JSON"===e.type||"GEOJSON"===e.type)a=e.content,!(i=T.a.isObject(a)?a:JSON.parse(a)).type||"DataInsights"!==i.type&&"MapEditor"!==i.type||(i=i.data.recordsets&&i.data.recordsets[0].features,i=JSON.parse(i)),n.addBinaryData(t,i,r,tn.a.getGeoJsonFeatureType(i),e);else if("EXCEL"===e.type||"CSV"===e.type){e.content.colTitles=ie.a.trimBinaryTitles(e.content.colTitles);var s={titles:e.content.colTitles,rows:e.content.rows};n.addBinaryData(t,s,r,q.e.POINT,e)}else{if(e.type!==q.h.SHP)throw{getDatasInfFailed:!0};i=(a=JSON.parse(e.content)).layers[0],n.addBinaryData(t,i,r,tn.a.getGeoJsonFeatureType(i),e)}})).catch((function(e){throw K.a.showMessage(DataViz.Language.getRestDataFaild,q.j.WARNING),n.props.onLoading(!1),{getDatasInfFailed:!0}}))}},{key:"isPermission",value:function(e){var t=[],a=this.state[this.fileSource],n=e||a.selectedId;t.push(n);var i="".concat(T.a.getIPortalUrl(),"web/permissions/highestpermission.json?resourceType=DATA&resourceIds=").concat(JSON.stringify(t));return T.a.doFetch(i,{method:"GET",withCredentials:!0}).then((function(e){return"DOWNLOAD"===e[n]||"DELETE"===e[n]}))}},{key:"onSelect",value:function(e){var t=this,a=!1,n=this.state[this.fileSource];n.selectedId=e,t.setState(j()({},this.fileSource,n)),K.a.closeMessage(),this.props.dataType!==q.f.SAMPLE&&(this.isMyData(e)||t.isPermission(e).then((function(n){if(!n||!on.includes(t.getSelectedData(e).type)){var i=t.getSelectedData(e).fileName.split(".")[0];n?K.a.showMessage("".concat(DataViz.Language.shareJsonFile)):K.a.showMessage("".concat(DataViz.Language.shareDataNoPermission).concat(i)),a=!0}t.state.isLoading||t.setState({disableConfirm:a})})))}},{key:"getSelectedData",value:function(e){var t=this.state[this.fileSource];return t.datas[t.currentPage].filter((function(t){return t.id===e}))[0]}},{key:"refreshDatas",value:function(){var e,t=this;this.setState((e={},j()(e,this.fileSource,{selectedId:null,currentPage:1,total:1,datas:{}}),j()(e,"isLoading",!0),e),(function(){t.getDatas(1)}))}},{key:"getContent",value:function(e,t){return this.state.isLoading?i.a.createElement("div",{className:"window-non-data window-loading"},i.a.createElement(ce.a,null)):e&&0!==e.length?i.a.createElement(en,{datas:e,onSelect:this.onSelect.bind(this),selectedValue:t,dataType:this.props.dataType}):i.a.createElement(i.a.Fragment,null,i.a.createElement(nn,{refreshBtnClick:this.refreshDatas.bind(this)}))}},{key:"hideModal",value:function(){this.props.changeSatus&&this.props.changeSatus(!1),this.modalBox.hideModal()}},{key:"getModalTitle",value:function(e){var t;switch(e){case q.f.MYDATA:t=DataViz.Language.myData;break;default:t=DataViz.Language.sampleData}return t}},{key:"render",value:function(){var e=this,t=this,a=this.state[this.fileSource],n=a.datas[a.currentPage],r=this.props.dataType,s={modalTitle:t.getModalTitle(r),modalWidth:"520px",cancelButton:DataViz.Language.closeButton,headerChild:n&&0!==n.length&&r!==q.f.SAMPLE&&i.a.createElement(an,{onClick:this.refreshDatas.bind(this)}),cancelCallBack:function(){e.hideModal()},closeBtnCallBack:function(){e.hideModal()},okCallBack:function(){K.a.closeMessage(),r===q.f.SAMPLE?t.addData():T.a.checkReLogin().then((function(){t.addData(),t.hideModal()})).catch((function(){K.a.showLoinBox({onSucceed:t.refreshDatas.bind(t)})}))},paginationConfig:{currentPage:a.currentPage,pageSize:8,total:a.total,onPageChange:function(e){t.getDatas(e)}}};return i.a.createElement(re.a,Y()({},s,{ref:function(t){e.modalBox=t},disableConfirm:this.state.disableConfirm}),i.a.createElement("div",{className:"add_data_mydata"},this.getContent(n,a.selectedId)))}}]),t}(n.Component),dn=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).open=!1,a.changeSatus=a.changeSatus.bind(O()(a)),a.openMyDatasWindow=a.openMyDatasWindow.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"openMyDatasWindow",value:function(){var e=this;this.open||(this.changeSatus(!0),this.props.dataType!==q.f.SAMPLE||this.refs.datasModal.modalIsOpen?T.a.checkReLogin().then((function(){e.refs.datasModal.modalIsOpen||e.refs.datasModal.open()})).catch((function(){e.changeSatus(!1),K.a.showLoinBox({onSucceed:function(){e.changeSatus(!0),e.refs.datasModal.open()}})})):this.refs.datasModal.open())}},{key:"changeSatus",value:function(e){this.open=e}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{className:"add-from-file-btn secondary-btn",onClick:this.openMyDatasWindow},i.a.createElement("span",{className:"icon "+this.props.iconClass}),i.a.createElement("span",null,this.props.buttonText)),i.a.createElement(un,{ref:"datasModal",dataType:this.props.dataType,onFileLoad:this.props.onFileLoad,changeFile:this.props.changeFile,onLoading:this.props.onLoading,changeSatus:this.changeSatus}))}}]),t}(n.Component),pn=(a(1711),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).defaultWidth="400px",a.state={percent:0},a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.percent!==this.state.percent&&this.setState({percent:e.percent})}},{key:"render",value:function(){var e="".concat(DataViz.Language.loadingProgress).concat(this.state.percent,"%");return i.a.createElement("div",{style:{width:this.props.width||this.defaultWidth,textAlign:"center"}},i.a.createElement("div",{className:"progress"},i.a.createElement("div",{className:"progress-complete",style:{width:this.state.percent+"%"}})),i.a.createElement("p",{className:"progress-text"},e))}}]),t}(n.Component)),hn=a(163),fn=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={loading:!1,isDragging:!1},a.loading=!1,a.modifyLoading=a.modifyLoading.bind(O()(a)),a.afterJsonFileParserCompleted=a.afterJsonFileParserCompleted.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.progressPercent!==this.state.percent&&this.setState({percent:e.progressPercent})}},{key:"modifyLoading",value:function(e){this.loading!==e&&(this.setState({loading:e}),this.loading=e)}},{key:"onDrop",value:function(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files,a=this;T.a.checkReLogin().then((function(){a.changeFile(t),a.setState({isDragging:!1})})).catch((function(){K.a.showLoinBox(),a.setState({isDragging:!1})}))}},{key:"onDragOver",value:function(e){e.stopPropagation(),e.preventDefault(),this.setState({isDragging:!0})}},{key:"onDragLeave",value:function(e){var t=document.body.offsetWidth,a=document.body.offsetHeight,n=(t-720)/2+this.refs.addFileContent.offsetLeft,i=(a-314)/2+this.refs.addFileContent.offsetTop,r=n+this.refs.addFileContent.clientWidth,s=i+this.refs.addFileContent.clientHeight-2;if(e.clientX>=n&&e.clientX<=r&&e.clientY>=i&&e.clientY<=s)return!1;e.preventDefault(),this.setState({isDragging:!1})}},{key:"getContainer",value:function(){return this.state.isDragging?i.a.createElement("div",{className:"drag-content"},i.a.createElement("div",{className:"drag-add-file-icon supermapol-icons-upload"}),i.a.createElement("div",{className:"drag-add-file-text"},DataViz.Language.dropUplod)):this.props.isShowProgress&&this.props.fileName?i.a.createElement("div",{className:"progress-content"},i.a.createElement("div",{className:"progress-file-name"},this.props.fileName),i.a.createElement(pn,{percent:this.state.percent})):i.a.createElement("div",{className:"un-drag-content"},i.a.createElement("div",{className:"select-file-group"},i.a.createElement(Qa,{onLoading:this.modifyLoading,changeFile:this.changeFile.bind(this),onFileLoad:this.props.onFileSelected}),i.a.createElement(dn,{iconClass:"supermapol-icons-upload-myfiles",buttonText:DataViz.Language.myData,dataType:q.f.MYDATA,onFileLoad:this.props.onServiceSelected,changeFile:this.changeFile.bind(this),onLoading:this.modifyLoading}),i.a.createElement(dn,{iconClass:"supermapol-icons-sample-data",buttonText:DataViz.Language.sampleData,dataType:q.f.SAMPLE,onFileLoad:this.props.onServiceSelected,changeFile:this.changeFile.bind(this),onLoading:this.modifyLoading})),i.a.createElement("div",{className:"add-by-drag"},DataViz.Language.addByDrag),i.a.createElement("div",{className:"add-file-support"},DataViz.Language.supportFile))}},{key:"render",value:function(){return i.a.createElement("div",{className:"add-from-file"},this.state.loading&&i.a.createElement("div",{className:"loading-content"},i.a.createElement(ce.a,null)),i.a.createElement("div",{className:"add-file-content",ref:"addFileContent",onDrop:this.onDrop.bind(this),onDragEnter:this.onDragOver.bind(this),onDragOver:this.onDragOver.bind(this),onDragLeave:this.onDragLeave.bind(this)},this.getContainer()))}},{key:"changeFile",value:function(e,t){var a,n,i,r;if(this.modifyLoading(!0),t)a=e.file,n=e.fileName,i=e.fileType,r=e.originName;else{(a=e.target&&e.target.files[0]||e[0])||this.props.onFileSelected({type:"unsupported"});var s=tn.a.getFileType(a);n=s.name,i=s.type,r=a.name}if("unsupported"!==i&&i)if(q.g[i]===q.h.JSON||q.g[i]===q.h.GEOJSON){var o={uploadFile:a,type:q.g[i],fileEncoding:"UTF-8",name:n,originName:r};hn.a.readJSONData(o,this.afterJsonFileParserCompleted)}else if([q.h.XLSX,q.h.CSV].includes(q.g[i])){var l={uploadFile:a,name:n,originName:r,type:q.g[i],fileEncoding:"UTF-8",fileSuffix:i};hn.a.readCsvExcelData(l,{sheetRows:7},"read",this.afterFileParserCompleted.bind(this))}else"ZIP"===q.g[i]&&this.readShpfileData(a,q.h.SHP,n,r);else e.target&&(e.target.value=""),this.modifyLoading(!1),this.props.onFileSelected({data:null,uploadFile:null,type:i,name:n})}},{key:"readShpfileData",value:function(e,t,a,n){var i={uploadFile:e,type:q.g[t],name:a,originName:n};this.props.onFileSelected(i,null,null)}},{key:"afterFileParserCompleted",value:function(e){this.modifyLoading(!1),e.data&&this.props.onFileSelected(e,null,null)}},{key:"afterJsonFileParserCompleted",value:function(e){if(this.modifyLoading(!1),"FeatureCollection"===e.data.type)if(e.data&&e.data.features&&e.data.features[0]){var t=e.data.features[0];if(t&&t.geometry&&t.type){var a=e.data&&tn.a.getGeoJsonFeatureType(e.data)||q.p.UNKNOWN,n={data:e.data,uploadFile:e.uploadFile,type:e.type,name:e.name,originName:e.originName,featureType:a};this.modifyLoading(!1),this.props.onFileSelected(n,null,null)}else tn.a.showErrrModal(DataViz.Language.checkFileType,{errorType:"uploadJsonFile"})}else tn.a.showErrrModal(DataViz.Language.checkFileType,{errorType:"uploadJsonFile"});else tn.a.showErrrModal(DataViz.Language.checkFileType,{errorType:"uploadJsonFile"})}}]),t}(n.Component);var mn=function(e){return i.a.createElement("div",{className:"layer-proj bold"},i.a.createElement("span",null,DataViz.Language.fileProj),i.a.createElement(We.b,{onChange:function(t){e.onChange("fileCode",T.a.getEpsgCode(t))},selectedValue:T.a.getEpsgCode(e.fileCode),values:[DataViz.Language.LonLatProj,DataViz.Language.webMercatorProj]}),i.a.createElement("span",null,DataViz.Language.baseProj),i.a.createElement("span",{className:"baseCoord"},T.a.getEpsgCode(de.a.getBaseLayerProj())))};var yn=function(e){return i.a.createElement("div",{className:"add-args-json"},i.a.createElement("div",{className:"layer-type-file"},i.a.createElement("span",{className:"bold"},DataViz.Language.createLayer),i.a.createElement(Ke.b,{name:"choose-layer",onChange:function(t){e.onChange("layerType",t)},selectedValue:e.metaData.layerType},i.a.createElement(Ke.a,{disabled:e.metaData.fileSource===q.f.SAMPLE,value:q.r.MARKER},DataViz.Language.createMarkerLayer),i.a.createElement(Ke.a,{disabled:"UNKNOWN"===e.metaData.featureType,value:q.r.VECTOR},DataViz.Language.createThemeLayer))),i.a.createElement(mn,{fileCode:e.metaData.fileCode,onChange:e.onChange}))};var gn=function(e){return i.a.createElement("div",{className:"city-field bold"},i.a.createElement("span",{className:"city"},DataViz.Language.cityField),i.a.createElement(We.b,{selectedValue:e.city,onChange:function(t){e.onChange("cityField",t)},values:e.titles}),i.a.createElement("span",{className:"address"},DataViz.Language.addressField),i.a.createElement(We.b,{selectedValue:e.address,onChange:function(t){e.onChange("addressField",t)},values:e.titles}))};var vn=function(e){return i.a.createElement("div",{className:"coord-field bold"},i.a.createElement("span",{className:"x-field"},DataViz.Language.xField),i.a.createElement(We.b,{onChange:function(t,a){e.onChange("xField",t,a)},selectedValue:e.xField,values:e.titles}),i.a.createElement("span",{className:"y-field"},DataViz.Language.yField),i.a.createElement(We.b,{onChange:function(t,a){e.onChange("yField",t,a)},selectedValue:e.yField,values:e.titles}))};var Sn=function(e){var t=[DataViz.Language.province,DataViz.Language.city];return i.a.createElement("div",{className:"division-field bold"},i.a.createElement("span",{className:"type"},DataViz.Language.divisionType),i.a.createElement(We.b,{selectedValue:e.divisionType,onChange:function(t){e.onChange("divisionType",t)},values:t}),i.a.createElement("span",{className:"field"},DataViz.Language.divisionField),i.a.createElement(We.b,{selectedValue:e.divisionField,onChange:function(t){e.onChange("divisionField",t)},values:e.titles}))},bn=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"coding-field bold"},i.a.createElement("div",null,i.a.createElement("span",{className:"selectedValue1"},DataViz.Language.selectedValue1),i.a.createElement(We.b,{selectedValue:this.props.selectedValue1,onChange:function(t){e.props.onChange("selectedValue1",t)},values:this.props.titles}),i.a.createElement("span",{className:"selectedValue2"},DataViz.Language.selectedValue2),i.a.createElement(We.b,{selectedValue:this.props.selectedValue2,onChange:function(t){e.props.onChange("selectedValue2",t)},values:[DataViz.Language.notSet].concat(this.props.titles)})),i.a.createElement("div",null,i.a.createElement("span",{className:"associationTable"},DataViz.Language.associationTable),i.a.createElement(We.b,{selectedValue:this.props.selectedTable,onChange:function(t){e.props.onChange("selectedTable",t)},values:this.props.associationTable})),i.a.createElement("div",null,i.a.createElement("span",{className:"associationField1"},DataViz.Language.associationField1),i.a.createElement(We.b,{selectedValue:this.props.selectedField1,onChange:function(t){e.props.onChange("selectedField1",t)},values:this.props.associationField}),i.a.createElement("span",{className:"associationField2"},DataViz.Language.associationField2),i.a.createElement(We.b,{selectedValue:this.props.selectedField2,onChange:function(t){e.props.onChange("selectedField2",t)},values:this.props.associationField})))}}]),t}(n.Component),In=a(164),En=function(e){function t(e){var a;f()(this,t);var n=(a=v()(this,b()(t).call(this,e))).props.updateType||q.l.COORD;a.changeType=a.changeType.bind(O()(a));var i=a.getAddressMathInfo();return a.state={positionType:n,isAddressEnable:i,addressMatchCount:0},a.props.onChange("positionType",n),a.changeCSVSeparator=a.changeCSVSeparator.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"changeType",value:function(e){this.state.positionType!==e&&(this.setState({positionType:e}),this.props.onChange("positionType",e))}},{key:"checkUserInfo",value:function(){var e=this;tn.a.searchUserInfo().then((function(t){t&&t>0&&e.setState({isAddressEnable:!1,addressMatchCount:+t})}))}},{key:"getAddressMathInfo",value:function(){var e=!0;if(window.isSuperMapOL)this.checkUserInfo();else{var t=dataVizConfig.addressMatchSetting;if(!t)return!0;("RestData"===t.matchType&&t.matchUrl||"Online"===t.matchType&&t.mathOnlineKey)&&(e=!1)}return e}},{key:"getAddressTips",value:function(){return this.state.isAddressEnable&&!window.isSuperMapOL?DataViz.Language.iportalAddressNone:window.isSuperMapOL?DataViz.Language.userCount+ +this.state.addressMatchCount+")":void 0}},{key:"changeCSVSeparator",value:function(e){this.props.onChange("separator",e)}},{key:"getContentUI",value:function(){var e=null;switch(this.state.positionType){case q.l.COORD:e=i.a.createElement("div",{className:"pos-field"},i.a.createElement(mn,{fileCode:this.props.metaData.fileCode,onChange:this.props.onChange}),i.a.createElement(vn,{xField:this.props.metaData.xField,yField:this.props.metaData.yField,titles:this.props.metaData.fileData.data.titles,onChange:this.props.onChange}),"CSV"===this.props.metaData.fileData.type&&Ka.a.hasRelationship&&i.a.createElement("div",{className:"csv-separator"},i.a.createElement(In.a,{inputTips:DataViz.Language.inputSeparatorTip,title:DataViz.Language.separator,onChange:this.changeCSVSeparator,inputValue:this.props.metaData.separator})));break;case q.l.ADDRESS:e=i.a.createElement("div",{className:"pos-field"},i.a.createElement(gn,{onChange:this.props.onChange,city:this.props.metaData.cityField,address:this.props.metaData.addressField,titles:this.props.metaData.fileData.data.titles}));break;case q.l.DIVISION:e=i.a.createElement("div",{className:"pos-field"},i.a.createElement(Sn,{onChange:this.props.onChange,divisionType:this.props.metaData.divisionType,divisionField:this.props.metaData.divisionField,titles:this.props.metaData.fileData.data.titles}));break;case q.l.CODING:e=i.a.createElement("div",{className:"pos-field"},i.a.createElement(bn,{onChange:this.props.onChange,selectedValue1:this.props.metaData.selectedValue1,selectedValue2:this.props.metaData.selectedValue2,associationTable:this.props.associationTable,selectedTable:this.props.metaData.selectedTable,selectedField1:this.props.metaData.selectedField1,selectedField2:this.props.metaData.selectedField2,associationField:this.props.associationField,titles:this.props.metaData.fileData.data.titles}))}return e}},{key:"render",value:function(){var e="en"===window.lang,t=this.props.updateType;return i.a.createElement("div",{className:"add-args-excel"},i.a.createElement("div",{className:"pos-type"},i.a.createElement("span",{className:"bold"},DataViz.Language.posType),i.a.createElement(Ke.b,{name:"choose-type",onChange:this.changeType,selectedValue:this.state.positionType,className:e&&"dataViz-radio-group-en"},i.a.createElement(Ke.a,{value:q.l.COORD,isEn:e,disabled:t&&t!==q.l.COORD},DataViz.Language.byCoord),i.a.createElement(Ke.a,{value:q.l.DIVISION,isEn:e,disabled:t&&t!==q.l.DIVISION},DataViz.Language.byDivision),i.a.createElement(Ke.a,{value:q.l.ADDRESS,isEn:e,disabled:this.state.isAddressEnable||t&&t!==q.l.ADDRESS,className:e&&"thirdAndFourth"},DataViz.Language.byPos,i.a.createElement("label",{className:this.state.isAddressEnable?"disable":""},this.getAddressTips())),i.a.createElement(Ke.a,{value:q.l.CODING,isEn:e,className:e&&"thirdAndFourth",disabled:t&&t!==q.l.CODING},DataViz.Language.byCoding))),this.getContentUI())}}]),t}(n.Component);var Tn=function(e){var t=e.metaData;return i.a.createElement("div",{className:"add-args-shp"},i.a.createElement("div",{className:"layer-type-file"},i.a.createElement("span",{className:"bold"},DataViz.Language.createLayer),i.a.createElement(Ke.b,{name:"choose-layer",onChange:function(t){e.onChange("layerType",t)},selectedValue:e.metaData.layerType},i.a.createElement(Ke.a,{value:q.r.MARKER},DataViz.Language.createMarkerLayer),i.a.createElement(Ke.a,{disabled:"UNKNOWN"===e.metaData.featureType,value:q.r.VECTOR},DataViz.Language.createThemeLayer))),!t.isFromMyData&&i.a.createElement("div",{className:"csv-encode",style:{display:"block"}},i.a.createElement("div",{className:"file-encode"},DataViz.Language.fileEncode),i.a.createElement(We.b,{values:["UTF-8","GBK"],onChange:function(t){e.onChange("fileCode",t)}})))},Cn=(a(1712),function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"getTdWidth",value:function(e){var t=e.length;return t<5?(688-t+1-18*t)/t:160}},{key:"getTableContent",value:function(){for(var e,t=[],a=this.props.rows,n=this.props.titles,r=this.getTdWidth(n),s=[],o=0;o<a.length;o++){for(var l=[],c=0;c<n.length;c++){0===o&&t.push(i.a.createElement("th",{key:c,style:{minWidth:r,maxWidth:r}},n[c]));var u=a[o][c];null==u?u="":"[object Date]"===Object.prototype.toString.call(u)?u=new Date(u).toString():"number"==typeof u&&isNaN(u)&&(u=0),l.push(i.a.createElement("td",{style:{minWidth:r,maxWidth:r},key:"td".concat(o).concat(c)},u.toString()))}s.push(i.a.createElement("tr",{key:o},l))}return e=i.a.createElement("tbody",null,s),{thead:i.a.createElement("thead",{className:"table-head"},i.a.createElement("tr",null,t)),tbody:e}}},{key:"render",value:function(){var e=this.getTableContent();return i.a.createElement("div",{className:"add-file-table"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},i.a.createElement("table",{cellPadding:0,cellSpacing:0},e.thead,e.tbody)))}}]),t}(n.Component)),Ln=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={metaData:e.metaData},a.changeCSVCode=a.changeCSVCode.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"getData",value:function(){var e=this.props.metaData,t=e.fileData.type;return{height:void 0,component:e.fileSource===q.f.SAMPLE||"JSON"===t||"GEOJSON"===t?i.a.createElement(yn,{metaData:this.props.metaData,onChange:this.props.onChange}):"SHP"===t?i.a.createElement(Tn,{metaData:this.props.metaData,onChange:this.props.onChange}):i.a.createElement(En,{metaData:this.props.metaData,onChange:this.props.onChange,allData:this.props.allData,associationTable:this.props.associationTable,associationField:this.props.associationField,updateType:this.props.updateType})}}},{key:"changeCSVCode",value:function(e){var t=this.props.metaData.fileData,a={uploadFile:t.uploadFile,name:t.name,originName:t.originName,type:q.g[t.fileSuffix],fileEncoding:e,fileSuffix:t.fileSuffix};hn.a.readCsvExcelData(a,{sheetRows:7},"read",this.afterFileParserCompleted.bind(this))}},{key:"afterFileParserCompleted",value:function(e){e.data&&this.props.changeCSVCode(e,null)}},{key:"render",value:function(){var e=this,t=this.getData(),a=t.height,n=t.component,r={},s=this.props.metaData;return a&&(r.height=a),i.a.createElement("div",{className:"add-args",style:r},n,"SHP"!==s.fileData.type&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"file-name bold"},s.fileData.name),i.a.createElement(Cn,this.state.metaData.fileData.data),i.a.createElement("div",{className:"csv-encode",style:{display:"CSV"!==s.fileData.type||s.isFromMyData?"none":"block"}},i.a.createElement("div",{className:"file-encode"},DataViz.Language.fileEncode),i.a.createElement(We.b,{values:["UTF-8","GBK"],onChange:function(t){e.changeCSVCode(t)}}))))}}]),t}(n.Component);var Nn,kn=function(e){return i.a.createElement("div",{className:"step-control"+(e.on?" on":"")},i.a.createElement("span",{className:"step-number"},e.stepNumber),i.a.createElement("span",{className:"step-name"},e.stepName))},On=(a(1713),function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"shouldComponentUpdate",value:function(e){return e.current!==this.props.current}},{key:"getStepControl",value:function(){for(var e=[],t=0;t<this.props.steps.length;t++)e.push(i.a.createElement(kn,{key:t,on:t===this.props.current-1,stepName:this.props.steps[t].name,stepNumber:this.props.steps[t].number}));return e}},{key:"render",value:function(){return i.a.createElement("div",{className:"step-controls"},this.getStepControl())}}]),t}(n.Component)),Dn=(a(93),a(141),["MAP","DATA","VECTOR_MAP","SINGLE_MAP","SINGLE_VECTOR_MAP","DATASET"]),wn=window.DataViz.Language,An={mapUrls:[],root:T.a.getIPortalUrl(),pageDataServer:null,initPageDataServerInstance:function(e){this.pageDataServer=new ge.j("".concat(this.root,"web/mycontent/services.json"),{pageSize:e,orderBy:"UPDATETIME",orderType:"DESC"},{withCredentials:!0})},getMyServiceInfo:(Nn=p()(u.a.mark((function e(){var t,n,i,r,s=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=s.length>0&&void 0!==s[0]?s[0]:{}).currentPage||(t.currentPage=1),t.pageSize||(t.pageSize=10),n=this,An.initPageDataServerInstance(t.pageSize),e.next=7,a.e(5).then(a.t.bind(null,1832,7));case 7:return i=e.sent,r=i.default,"zh"===window.lang&&r.locale("zh-cn"),e.abrupt("return",T.a.checkReLogin().then((function(){return n.pageDataServer.getPageDatas(t.currentPage).then((function(e){var t=e.data.content,a=[];return t&&t.length&&t.forEach((function(e){var t=n.judgeSupportServiceAvailable(e),i=t?"":n.unavailableServiceTip(e.type),s={type:e.type,updateTime:T.a.changeTimeToData(e.updateTime),relativeTime:r(e.updateTime).fromNow(),mapInfos:e.mapInfos,serviceName:e.resTitle,linkPage:e.proxiedUrl||e.linkPage,id:e.id,available:t,tip:i};a.push(s)})),{total:e.data.total,services:a}})).catch((function(e){K.a.showMessage(wn.getMyserviceFaild)}))})));case 11:case"end":return e.stop()}}),e,this)}))),function(){return Nn.apply(this,arguments)}),unavailableServiceTip:function(e){return this.judgeSupportServiceType(e)?wn.unavailableService:"".concat(wn.unSupport," ").concat(e," ").concat(wn.dataSource)},getDataInfos:function(e,t,a,n){var i=this,r="".concat(T.a.getUrl(e+"/data/datasources.json"));return T.a.doFetch(r,{method:"GET",withCredentials:!0}).then((function(a){var r=a.datasourceNames[0],s="".concat(e,"/data/datasources/").concat(r,"/datasets"),o="".concat(T.a.getUrl(s),".json");return T.a.doFetch(o,{method:"GET",withCredentials:!0}).then((function(e){var a=[];return e.childUriList.forEach((function(e){a.push(i.getDatasetsInfo(e,t,n))})),Promise.all(a).then((function(e){return e}))})).catch((function(t){K.a.showMessage("".concat(wn.sendRequest," ").concat(r||e," ").concat(wn.faild))}))})).catch((function(t){K.a.showMessage("".concat(wn.sendRequest," ").concat(a||e," ").concat(wn.faild))}))},getDatasetsInfo:function(e,t,a){var n=this;return T.a.doFetch("".concat(T.a.getUrl(e),".json"),{method:"GET",withCredentials:!0}).then((function(i){var r=i.datasetInfo,s=r.bounds,o=r.prjCoordSys.epsgCode,l=n.isAvailableDatases(o,r.type);return{type:a,bounds:[s.left,s.bottom,s.right,s.top],coordinate:o,name:r.name,featureType:r.type,url:e,serviceId:t,available:l.available,tip:l.tip}})).catch((function(a){var n=e.split("/")[e.split("/").length-1];return K.a.showMessage("".concat(wn.sendRequest," ").concat(n," ").concat(wn.faild)),{url:e,serviceId:t,available:!1,tip:wn.getDataServiceFaild}}))},getMapInfo:function(e,t,a){var n=this;return T.a.doFetch("".concat(T.a.getUrl(e),".json"),{method:"GET",withCredentials:Ka.a.hasServiceProxy}).then(function(){var t=p()(u.a.mark((function t(i){var r,s,o,l,c,d,p,h,f,m,y,g,v;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i.error){t.next=4;break}r={error:!0,msg:i.error.errorMsg},t.next=23;break;case 4:return s=i.bounds,o=i.prjCoordSys,l=o.epsgCode,c=l,d=i.visibleScales,p=i.coordUnit,h=p,f=[s.left,s.bottom,s.right,s.top],t.next=14,n.availableRestMap(e,l,d,h);case 14:if((m=t.sent).available&&m.dynamicProj&&(y=Number(de.a.getBaseLayerProj(!0)),l=y,s=m.dynamicProj.bounds,p=m.dynamicProj.coordUnit),g="png","WebP"!==Ka.a.dataVizConfig.mapCenter.tileFormat){t.next=22;break}return t.next=20,T.a.isSupportWebp(e);case 20:v=t.sent,g=v?"webp":"png";case 22:r={bounds:[s.left,s.bottom,s.right,s.top],name:i.name,coordinate:l,url:e,type:a,available:m.available,tip:m.tip,format:g,visibleScales:d,coordUnit:p,orginEpsgCode:c,orginBounds:f,orginCoordUnit:h};case 23:return t.abrupt("return",r);case 24:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(e){K.a.showMessage("".concat(wn.sendRequest," ").concat(t," ").concat(wn.faild),q.j.ERROR,3e3)}))},isAvailableDatases:function(e,t){var a=!0,n="";if(!this.judgeIsDisabled(e))return{available:a=!1,tip:n=wn.unSupportCoordinate};var i=this.judgeSupportFeatureType(t);return"support"!==i?{available:a=!1,tip:n=i}:{available:a,tip:n}},judgeSupportServiceType:function(e){return Dn.includes(e)},judgeIsDisabled:function(e){var t=!0;return 0===e&&(t=!1),t},isDynamicProj:function(e){var t={epsgCode:+de.a.getBaseLayerProj(!0)},a="".concat(e,".json?prjCoordSys=").concat(encodeURI(JSON.stringify(t)));return a=T.a.getUrl(a,"json"),T.a.doFetch(a,{method:"GET"}).then((function(e){return!1!==e.succeed&&e})).catch((function(){return!1}))},judgeSupportServiceAvailable:function(e){return!(!this.judgeSupportServiceType(e.type)||"SUCCESSFUL"!==e.checkStatus||!e.enable||e.offline)},judgeSupportFeatureType:function(e){return["POINT","LINE","REGION"].indexOf(e)<0?"".concat(wn.unSupport," ").concat(e," ").concat(wn.fileType):"support"},availableRestMap:function(e,t,a,n){var i=this,r=this;return new Promise(function(){var s=p()(u.a.mark((function s(o){var l,c,d,p,h,f,m;return u.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(l=!0,c="",p=Number(de.a.getBaseLayerProj(!0)),!(t<=0&&p===t)){s.next=13;break}if(l=!1,c=wn.dynamicProjectionUnable,!T.a.isCustomProjection(t)){s.next=10;break}return s.next=8,T.a.getRestMapWKT(e);case 8:h=s.sent,l=T.a.wktIsEqual([de.a.epsgcodes["EPSG:".concat(t)],h]);case 10:o({available:l,tip:c,dynamicProj:d}),s.next=21;break;case 13:if(p===t){s.next=21;break}return s.next=16,r.isDynamicProj(e);case 16:(d=s.sent)||(l=!1,c=wn.dynamicProjectionUnable,o({available:l,tip:c,dynamicProj:d})),f=de.a.getScalesResolutions(d.visibleScales,d.coordUnit),d&&!i.judgeVisibleResolution(f.resolutionArray)&&(l=!1,c=wn.WithoutVisualScale),o({available:l,tip:c,dynamicProj:d});case 21:m=de.a.getScalesResolutions(a,n),i.judgeVisibleResolution(m.resolutionArray)||(l=!1,c=wn.WithoutVisualScale,o({available:l,tip:c})),o({available:l,tip:c});case 24:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}())},availableRestjsrMap:function(e,t){var a=!0,n="",i=Number(de.a.getBaseLayerProj(!0));return this.judgeIsDisabled(e)?e!==i?{available:a=!1,tip:n=wn.dynamicProjectionUnable}:this.judgeVisibleResolution(t)?{available:a,tip:n}:{available:a=!1,tip:n=wn.WithoutVisualScale}:{available:a=!1,tip:n=wn.unSupportCoordinate}},judgeVisibleResolution:function(e){if(e&&e.length>0){var t=de.a.resolutionArray;return!(t[0]<=e[e.length-1]||t[t.length-1]>=e[0])}return!1}},Fn=An,Mn=(a(1714),[{number:1,name:DataViz.Language.fileUpload},{number:2,name:DataViz.Language.setParams}]),Rn=Symbol("firstStep"),xn=Symbol("secondStep"),Pn="REST_DATA",Vn=DataViz.Language.uploadDataFaild,Bn=function(e){function t(e){var a;f()(this,t),a=v()(this,b()(t).call(this,e));var n=O()(a);return a.state={percent:0,isShowProgress:!1,current:1,encode:"UTF-8",associationField:[DataViz.Language.notSet],associationTable:[DataViz.Language.notSet],disableCancelBtn:!1},a.onArgsChange=a.onArgsChange.bind(O()(a)),a.onFileSelected=a.onFileSelected.bind(O()(a)),a.onServiceSelected=a.onServiceSelected.bind(O()(a)),a.closeModalBox=a.closeModalBox.bind(O()(a)),a.getAssociationTable=a.getAssociationTable.bind(O()(a)),a.getAssociationField=a.getAssociationField.bind(O()(a)),a.getDatasAndFields=a.getDatasAndFields.bind(O()(a)),a.getAllSelectedValue=a.getAllSelectedValue.bind(O()(a)),a[Rn]={modalWidth:"720px",modalTitle:DataViz.Language.addByFile,hideOkBtn:!0,disableCancel:n.state.disableCancelBtn,afterOpenModal:function(){a.isCancelUpload=!1,a.hasFileId=!1},cancelCallBack:function(){n.isCancelUpload=!0,n.hasFileId&&ge.o.cancelRequest(),n.closeModalBox(),a.props.cancelCallBack&&a.props.cancelCallBack()},closeBtnCallBack:function(){n.isCancelUpload=!0,n.hasFileId&&ge.o.cancelRequest(),a.props.closeBtnCallBack&&a.props.closeBtnCallBack()}},a[xn]={modalWidth:"720px",modalTitle:DataViz.Language.addByFile,okButton:DataViz.Language.add,cancelButton:DataViz.Language.prevStep,okCallBack:function(){var e=n.metaData;e.fileSource===q.f.SAMPLE?n.clickAddBtn(e):T.a.checkReLogin().then((function(){n.clickAddBtn(e)})).catch((function(t){t.XYFieldIsNaN?n.showErrorMsg(DataViz.Language.uploadDataFaild,{errorType:"XYFieldIsNaN"},e):t.checkReLogin?K.a.showLoinBox():n.showErrorMsg(DataViz.Language.uploadDataFaild,t)}))},afterOpenModal:function(){1!==a.state.step&&a.toFirstStep()},cancelCallBack:function(){a.toFirstStep(),a.props.cancelCallBack&&a.props.cancelCallBack()},closeBtnCallBack:function(){a.props.closeBtnCallBack&&a.props.closeBtnCallBack()}},a.metaData={positionType:null,layerType:q.r.VECTOR,xField:null,yField:null,cityField:null,addressField:null,divisionType:null,divisionField:null,fileCode:null,fileData:null,featureType:q.p.UNKNOWN,isBinary:!1,separator:",",selectedValue1:null,selectedValue2:null,selectedTable:null,associationTableDatasets:null,selectTableDataset:null,selectedField1:null,selectedField2:null},a.allData=null,a.fileName=null,a.isCloseModal=!1,a.isCancelUpload=!1,a.hasFileId=!1,a}var a;return E()(t,e),y()(t,[{key:"clickAddBtn",value:function(e){this.fileName=e.fileData.originName,e.positionType===q.l.CODING?this.addByCoding(e):e.layerType===q.r.MARKER&&e.type!==q.h.SHP?this.addFeatureToMap(e):e.positionType===q.l.ADDRESS?(this.toFirstStep(!0),this.uploadFileFromAddress(e)):e.positionType===q.l.DIVISION?(this.toFirstStep(!0),this.getCsvByDivision(e)):(e.dataTypes&&tn.a.isNumberFild(e.xField,e.yField,e.dataTypes),this.addByCoord(e))}},{key:"addByCoord",value:function(e){var t=e.fileData.type,a=this.getdataMetaInfoParams(e);if(e.dataMetaInfo=a,"CSV"!==t&&"EXCEL"!==t||(e.featureType=q.e.POINT,e.projection=tn.a.getCsvExcelEpsgCode({xField:e.xField,yField:e.yField},e.fileData.data.titles,e.fileData.data.rows)),!e.isFromMyData)return this.toFirstStep(!0),this.sendUploadRequest(e,e.fileData.uploadFile,e.fileData.originName,a);this.addFeatureToMap(e)}},{key:"getCsvByDivision",value:function(e){var t=this,a=e.fileData,n=this.getdataMetaInfoParams(e),i={file:a.uploadFile,fileName:a.originName,dataMetaInfo:n,callbackFunc:t.uploadCallback.bind(t),directoryName:window.dataVizConfig.directoryName};e.dataMetaInfo=n;var r=function(a){ie.a.getBinaryContent(a).then((function(a){t.isCancelUpload||(t.changePercent(),a.content.colTitles=ie.a.trimBinaryTitles(a.content.colTitles),e.fileData.content=a.content,e.fileData.originName=a.fileName,e.dataTypes=T.a.getFieldType(a.content.colTitles,e.fileData.content.rows[0]),t.getGeoJsonFromDivision(e,a))}))};e.isFromMyData?(e.fileId=e.fileData.serverId,r(e.fileData.serverId)):ge.o.uploadFile(i).then((function(t){var a=i.callbackFunc;a&&a("uploadFile",t),e.fileId=t.fileId,r(e.fileId)})).catch((function(e){throw e}))}},{key:"getdataMetaInfoParams",value:function(e){var t={fieldTypes:T.a.transformObjToArray(e.dataTypes),xIndex:e.xIndex,yIndex:e.yIndex};return"CSV"===e.fileData.type?(t.firstRowIsHead=!0,t.fileEncoding=e.fileData.fileEncoding,t.separator=e.separator):e.fileData.type===q.h.SHP&&(t.fileEncoding=e.fileData.fileEncoding||"UTF-8"),t}},{key:"getDivisionType",value:function(e){var t="";switch(e){case"":case"Province":t=q.d.PROVINCE;break;case"":case"City":t=q.d.CITY;break;case"":case"Administrative code":t=q.d.GB}return t}},{key:"getGeoJsonFromDivision",value:(a=p()(u.a.mark((function e(t,a){var n,i,r,s,o,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,t.dataTypes=T.a.getFieldType(t.fileData.data.titles,t.fileData.data.rows[0]),i=n.getDivisionType(t.divisionType),e.next=5,ie.a.excelData2FeatureByDivision(a.content,i,t.divisionField);case 5:if(r=e.sent,!n.isCancelUpload){e.next=8;break}return e.abrupt("return");case 8:n.changePercent(!0),setTimeout((function(){n.closeModalBox()}),500),K.a.closeMessage(),t.featureType=q.e.POLYGON,t.fileCode="EPSG:4326",s=t.divisionField,o={id:(new Date).getTime(),addFromFile:!0,originData:t.fileData,featureType:t.featureType,layerType:t.layerType,name:t.fileData.name,dataName:t.fileData.name,projection:t.fileCode,type:t.fileData.type,visible:!0,dataTypes:t.dataTypes,dataSource:{type:q.b.PORTAL_DATA,serverId:t.fileId,accessType:"DIRECT",administrativeInfo:{divisionType:i,divisionField:s}}},l=ie.a.parseData2Feature({allDatas:{features:r.features},fileCode:t.fileCode},"GEOJSON"),n.props.addFromFile.addFeatureFromFile({features:l,layerInfo:o,selectedLayerId:o.id});case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"addByCoding",value:function(e){var t=this,a=DataViz.Language.notSet;if(e.selectedTable!==a){var n=e.selectedValue1!==a&&e.selectedField1!==a,i=e.selectedValue2!==a&&e.selectedField2!==a;if(n||i)if(t.toFirstStep(!0),e.isFromMyData)t.matchOriginalAndAssociation(n,i,e);else{var r=this.getdataMetaInfoParams(e);e.dataMetaInfo=r,t.sendUploadRequest(e,e.fileData.uploadFile,e.fileData.originName,r,(function(e){t.isCancelUpload||(t.changePercent(),e.fileData.data={rows:e.fileData.content.rows,titles:e.fileData.content.colTitles},t.matchOriginalAndAssociation(n,i,e))}))}else K.a.showMessage(DataViz.Language.associationFieldIncomplete,q.j.WARNING)}else K.a.showMessage(DataViz.Language.PleaseSelectAssociationTable,q.j.WARNING)}},{key:"matchOriginalAndAssociation",value:function(e,t,a){var n,i,r=a.selectedValue1,s=a.selectedValue2,o=a.selectedField1,l=a.selectedField2,c=a.selectTableDataset,u=!(!e||!t),d=this.getDatasAndFields({selectedValue1:r,selectedValue2:s,selectedField1:o,selectedField2:l,isDoubleValueMatch:u,isSelectedValue1Complete:e,isSelectedValue2Complete:t},a.fileData.data),p=c.linkPage+"/data",h=c.datas[0].url,f=h.slice(h.indexOf("/datasources")+13,h.indexOf("/datasets")),m=f+":"+c.datas[0].name,y=this,g=null;if(u){g="concat(".concat(o,",',', ").concat(l,") in (");var v=[],S=d.datas1.noSingleQuoteValue,b=d.datas2.noSingleQuoteValue;S.forEach((function(e,t){v.push("'".concat(e,",").concat(b[t],"'"))})),g+=v.join(","),g+=")"}else{var I=d.datas.haveSingleQuoteValue.join(",");g=d.selectedField+" in ("+I+")"}n=new SuperMap.FilterParameter({name:c.datas[0].name+"@"+f,attributeFilter:g,fields:[o,l,"SMX","SMY"]}),i=new SuperMap.GetFeaturesBySQLParameters({queryParameter:n,datasetNames:[m],fromIndex:0,maxFeatures:Ce.a.maxRestDataCount[c.datas[0].featureType],toIndex:Ce.a.maxRestDataCount[c.datas[0].featureType]+1}),T.a.getFeatureBySQL(p,[m],(function(e){y.getTableValuesSucceed(e,a,d,u)}),(function(e){y.showErrorMsg(DataViz.Language.uploadDataFaild,{errorType:"disabledTableField"},a)}),n,i)}},{key:"getDatasAndFields",value:function(e,t){var a=e.selectedValue1,n=e.selectedValue2,i=e.selectedField1,r=e.selectedField2,s=e.isDoubleValueMatch,o=e.isSelectedValue1Complete,l=e.isSelectedValue2Complete,c=null,u=null;return!s&&o?(c=a,u=i):!s&&l&&(c=n,u=r),s?{datas1:this.getAllSelectedValue(a,t),datas2:this.getAllSelectedValue(n,t),selectedField1:i,selectedField2:r}:{datas:this.getAllSelectedValue(c,t),selectedField:u}}},{key:"getAllSelectedValue",value:function(e,t){for(var a=t.titles,n=0,i=0;i<a.length;i++)if(a[i]===e){n=i;break}var r=[],s=[];return t.rows.forEach((function(e){var t=T.a.trim(e[n]);r.push("'".concat(t,"'")),s.push(t)})),{haveSingleQuoteValue:r,noSingleQuoteValue:s}}},{key:"getTableValuesSucceed",value:function(e,t,a,n){if(!this.isCancelUpload)if(this.changePercent(),e.result.featureCount>0){var i=e.result.features.features,r=i[0].geometry.type,s=i[0].properties;t.fileCode=s.SMX&&s.SMY&&Math.abs(s.SMX)<=180&&Math.abs(s.SMY)<=90?"EPSG:4326":"EPSG:3857",t.featureType=q.e[r.toUpperCase()],t.fileData.type="GEOJSON";var o=ie.a.getFeature(e.result.features,t.fileData.data,a,n);this.fileName=t.fileData.originName.split(".")[0]+".geojson",t.fileData.originName=this.fileName,t.fileData.fileSuffix=".geojson",this.sendUploadRequest(t,o,this.fileName,{})}else this.showErrorMsg(DataViz.Language.uploadDataFaild,{errorType:"disabledTableField"},t)}},{key:"closeModalBox",value:function(){this.modalBox.hideModal(),this.setState({isShowProgress:!1})}},{key:"shouldComponentUpdate",value:function(e,t){return t.current!==this.state.current||this.state.encode!==t.encode||this.state.percent!==t.percent||this.state.isShowProgress!==t.isShowProgress||this.state.associationField!==t.associationField||this.state.associationTable!==t.associationTable}},{key:"parserCsvExcelAllData",value:function(e,t){var a=e.uploadFile,n=e.name,i=e.originName,r=e.fileSuffix;!r&&(r=i.split(".")[1]);var s={uploadFile:a,name:n,originName:i,type:q.g[r],fileEncoding:this.state.encode,fileSuffix:r};hn.a.readCsvExcelData(s,{},"read",t)}},{key:"uploadFileFromAddress",value:function(e){var t=this;e.featureType=q.e.POINT,e.isFromMyData?(e.fileData.fileSuffix=e.fileData.originName.split(".")[1],this.addressMatch(e)):this.parserCsvExcelAllData(e.fileData,(function(a){a.data,a.data=ie.a.assembleTableExcelData(a.data),e.fileData=Ca()({},a),t.addressMatch(e)}))}},{key:"addressMatch",value:function(e){var t=this;tn.a.addressMatch(e.fileData.data,e.cityField,e.addressField,(function(a,n,i,r){if(!t.isCancelUpload){if(t.changePercent(),!a||0===a.length)return K.a.showMessage(DataViz.Language.addressMatchFaild),void t.toFirstStep();e.projection="EPSG:".concat(i||4326),e.xField="dataviz_lon",e.yField="dataviz_lat",e.positionType=q.l.COORD,e.dataTypes=T.a.getFieldType(r,a[0]);var s=window.cloneDeep(a);s.unshift(r),hn.a.readCsvExcelData(s,{bookType:e.fileData.fileSuffix},"json_to_blob",(function(a){var n=t.getdataMetaInfoParams(e);e.dataMetaInfo=n,n.fileEncoding="UTF-8",e.fileData.fileEncoding="UTF-8",t.props.updateFile?t.props.updateFile(e,a,e.fileData.originName,n):t.sendUploadRequest(e,a,e.fileData.originName,n)}))}}))}},{key:"uploadCallback",value:function(e){this.changePercent(),"getUploadId"===e?(this.hasFileId=!0,this.isCancelUpload&&ge.o.cancelRequest()):"getDatasetsByID"===e?this.setState({disableCancelBtn:!0}):"publicService"===e&&this.setState({disableCancelBtn:!1})}},{key:"sendUploadRequest",value:function(e,t,a,n,i){var r=this;return r.isCancelUpload=!1,r.hasFileId=!1,T.a.uploadFileWithoutService(t,a,n,r.uploadCallback.bind(r)).then((function(t){e.fileData.serverId=t.fileId,r.changePercent(),r.uploadFileBinaryCompleted(e,i)})).catch((function(t){r.UploadFileFaild(t,e)}))}},{key:"uploadFileBinaryCompleted",value:function(e,t){var a,n=this,i=e.fileData;ie.a.getBinaryContent(i.serverId).then((function(i){var r,s,o;if(!i.content)throw{errorType:"upLoadFileFailed"};if(e.fileData.originName=i.fileName,"GEOJSON"===i.type||"JSON"===i.type)a=JSON.parse(i.content),n.allData=a,e.fileData.content=a,r=a.features[0].properties||{},s=Object.keys(r),o=Object.values(r);else if("SHP"===i.type){var l=(a=JSON.parse(i.content)).layers[0];n.allData=e.fileData.content=l,r=l.features[0].properties||{},s=Object.keys(r),o=Object.values(r),e.fileData.data={rows:l,titles:s},l.crs&&l.crs.properties?e.projection=l.crs.properties.name:e.projection=de.a.getBaseLayerProj(),e.featureType=l.features&&l.features.length>0?q.e[l.features[0].geometry.type.toUpperCase()]:q.e.POINT}else s=i.content.colTitles=ie.a.trimBinaryTitles(i.content.colTitles),e.fileData.content=i.content,n.allData=i.content.rows,o=i.content.rows[0];e.dataTypes=T.a.getFieldType(s,o),t?t(e):(n.changePercent(!0),n.addFeatureToMap(e))})).catch((function(t){n.UploadFileFaild(t,e)}))}},{key:"UploadFileFaild",value:function(e,t){this.setState({disableCancelBtn:!1}),"cancelByUser"===e.errorType?e.fileId&&T.a.deleteServerData(e.fileId):this.showErrorMsg(DataViz.Language.uploadDataFaild,e,t)}},{key:"onUploadFileSuccess",value:function(e,t){if(!this.isCancelUpload){var a=this;a.changePercent();var n=t.dataItemServices,i=n.length;e.featureType=q.e[t.featureType.toUpperCase()];var r=t.datasetName,s=tn.a.getService(n,"RESTDATA");i>1?tn.a.isMvt(s.address,r).then((function(i){i&&i.isMvt?(s.serverId=t.fileId,s.bounds=i.bounds,s.epsgCode=i.epsgCode,s.address=i.url,a.addTileFeatureToMap(s,e)):(s=tn.a.getService(n,"RESTMAP"),a.addTileToMap(s,e,t.fileId))})):this.addServiceToMap(s,t.fileId,r,e)}}},{key:"changePercent",value:function(e){this.setState({percent:e?100:this.state.percent+10})}},{key:"showErrorMsg",value:function(e,t,a){tn.a.showErrrModal(e,t),K.a.closeMessage(),a&&"SHP"===a.fileData.type?this.toSecondStep(a):this.toFirstStep()}},{key:"toSecondStep",value:function(e){this.metaData=e,this.stopWorker(),this.setState({current:2})}},{key:"addTileToMap",value:function(e,t,a){if(!this.isCancelUpload){var n=this;T.a.getTileLayerInfo(e.address,de.a.getBaseLayerProj(!0),n.changePercent.bind(n)).then((function(e){n.isCancelUpload||e.forEach((function(e){n.changePercent(!0),K.a.closeMessage(),n.closeModalBox();var i=e.bounds,r={id:(new Date).getTime(),layerType:"TILE",overLayer:!0,epsgCode:de.a.getBaseLayerProj(),projection:"EPSG:".concat(e.prjCoordSys.epsgCode),units:e.coordUnit&&e.coordUnit.toLowerCase(),extent:[i.left,i.bottom,i.right,i.top],name:t.fileData.name,visibleScales:e.visibleScales,url:e.url,sourceType:"TILE",visible:!0,featureType:t.featureType,serverId:a.toString()};n.props.addFromFile.addRestMapOverLayer(r,r.id)}))})).catch((function(){!n.isCancelUpload&&n.showErrorMsg(DataViz.Language.uploadDataFaild,{errorType:"getDataServiceFaild"})}))}}},{key:"getDataTypes",value:function(e){var t=[],a=[];for(var n in e)t.push(n),a.push(e[n]);return T.a.getFieldType(t,a)}},{key:"addServiceToMap",value:function(e,t,a,n){if(!this.isCancelUpload){var i=this,r=e.address;T.a.getDatasources(r).then((function(e){if(!i.isCancelUpload){i.changePercent();var s=e+":"+a,o="".concat(r,"/data");T.a.getFeatureBySQL(o,[s],(function(e){if(!i.isCancelUpload){i.changePercent(!0),setTimeout((function(){i.closeModalBox()}),500),K.a.closeMessage();var a=(new Date).getTime();if(e){var r=e.result.features.features;r[0].properties.NEW_SMX&&r.forEach((function(e){delete e.properties.NEW_SMX,delete e.properties.NEW_SMY}));var l=i.getDataTypes(r[0].properties);n.fileCode||(n.fileCode=tn.a.getGeoJsonEpsgCode(r[0]));var c=ie.a.parseData2Feature({allDatas:{features:r},fileCode:n.fileCode},"JSON");i.props.addFromFile.addFeatureFromFile({features:c,layerInfo:{id:a,addFromFile:!0,featureType:n.featureType,layerType:n.layerType,name:n.fileData.name,dataName:n.fileData.name,projection:n.fileCode,type:n.fileData.type,visible:!0,dataTypes:l,dataSource:{url:o,dataSourceName:s,type:q.b.PORTAL_DATA,serverId:t,accessType:Pn}},selectedLayerId:a})}}}),(function(){!i.isCancelUpload&&i.showErrorMsg(DataViz.Language.uploadDataFaild,{errorType:"getDataServiceFaild"})}))}})).catch((function(){!i.isCancelUpload&&i.showErrorMsg(DataViz.Language.uploadDataFaild,{errorType:"getDataServiceFaild"})}))}}},{key:"addTileFeatureToMap",value:function(e,t){var a=this;a.changePercent(!0),setTimeout((function(){a.closeModalBox()}),500),K.a.closeMessage();var n=e.bounds,i={id:(new Date).getTime(),layerType:q.i.VECTOR_TILE,overLayer:!0,epsgCode:e.epsgCode,projection:"EPSG:".concat(e.epsgCode),bounds:n,extent:[n.left,n.bottom,n.right,n.top],name:t.fileData.name,url:e.address,visible:!0,featureType:t.featureType,serverId:e.serverId.toString()};a.props.addFromFile.addVectorTileLayer(i)}},{key:"addFeatureToMap",value:function(e){var t=e.fileData;this.allData&&(t.data.rows=this.allData);var a={id:(new Date).getTime(),projection:e.projection||e.fileCode||"EPSG:4326",originData:t,layerType:e.layerType||q.r.VECTOR,featureType:e.featureType,addFromFile:!0,visible:!0,name:t.name,origionName:t.originName,type:t.type,dataSource:{dataTypes:e.dataTypes},dataMetaInfo:e.dataMetaInfo},n=t.serverId;n&&(T.a.isNumber(n)?(a.dataSource=Object.assign(a.dataSource,{type:q.b.PORTAL_DATA,serverId:t.serverId,accessType:"DIRECT"}),a.isFromShare=e.isFromShare):a.dataSource=Object.assign(a.dataSource,{type:q.b.SAMPLE_DATA,name:t.serverId})),(e.layerType===q.r.VECTOR&&e.positionType===q.l.COORD||a.dataSource.type===q.b.SAMPLE_DATA)&&(a.xyField={xField:e.xField,yField:e.yField});try{var i=ie.a.parseData2Feature(a);this.props.addFromFile.addFeatureFromFile({features:i,layerInfo:a,selectedLayerId:a.id}),this.closeModalBox()}catch(e){this.showErrorMsg(DataViz.Language.addFeatureFaild,{errorType:"XYFieldIsWrong"})}}},{key:"onServiceSelected",value:function(e,t){if(this.hasFileId=!0,this.isCancelUpload=!1,this.setState({isShowProgress:!0,percent:0}),t)this.metaData.isBinary=t,this.onFileSelected(e,!0);else if(e.address)this.closeModalBox(),this.addService(e);else{var a=this,n=e.serverId;this.fileName=e.originName,K.a.closeMessage(),a.toFirstStep(!0),T.a.checkPublicServer().then((function(){a.setState({disableCancelBtn:!0}),ge.o.publicService(n,e.type,a.changePercent.bind(a)).then((function(){a.setState({disableCancelBtn:!1}),ge.o.getDataInfo(n).then((function(t){a.changePercent();var i=t.dataItemServices,r=e.name,s=tn.a.getService(i,"RESTDATA"),o={fileName:e.fileName,time:e.lastModfiedTime,serverId:n,name:e.name,dataCount:e.dataCount,featureType:e.featureType};e.dataCount>Ce.a.maxRestDataCount[e.featureType]?void 0===e.isMvt?tn.a.isMvt(s.address,r).then((function(t){if(t&&t.isMvt){e.type="RESTDATA";var n=Object.assign(e,t);n.address=t.url,a.addService(n)}else o.type="RESTMAP",s=tn.a.getService(i,o.type),o.address=s.address,a.addService(o)})):(o.type="RESTMAP",s=tn.a.getService(i,o.type),o.address=s.address,a.addService(o)):(o.type="RESTDATA",s=tn.a.getService(i,o.type),o.address=s.address,a.addService(o))}))}))})).catch((function(e){a.toFirstStep(),tn.a.showErrrModal(DataViz.Language.unRestData,e)}))}}},{key:"addService",value:function(e){if(!this.isCancelUpload){var t={isFromMyData:!0};"RESTDATA"===e.type&&e.isMvt?(t.fileData={name:e.fileName},t.featureType=e.featureType,this.addTileFeatureToMap(e,t)):"RESTDATA"===e.type?(t.layerType=q.r.VECTOR,t.featureType=e.featureType,t.fileData={name:e.fileName,type:"restdata"},this.addServiceToMap(e,e.serverId,e.name,t)):(t.layerType="TILE",t.fileCode=de.a.getBaseLayerProj(),t.fileData={name:e.fileName,type:"restmap"},t.featureType=e.featureType,this.addTileToMap(e,t,e.serverId))}}},{key:"onFileSelected",value:function(e,t){var a=e.data;if("unsupported"===e.type)return tn.a.showErrrModal(Vn,"".concat(DataViz.Language.unSupportFileType)),void this.toFirstStep();if("empty"===e.type)return tn.a.showErrrModal(Vn,"".concat(DataViz.Language.emptyFile).concat(e.name)),void this.toFirstStep();if([q.h.JSON,q.h.GEOJSON].includes(e.type))this.metaData.type=e.type,this.metaData.projection=tn.a.getGeoJsonEpsgCode(e.data.features[0]),this.allData=window.cloneDeep(a),e.data=ie.a.assembleTableJSONData(a);else if(e.type===q.h.SHP)this.metaData.type=e.type,t&&(this.allData=window.cloneDeep(a),e.data.crs&&e.data.crs.properties?this.metaData.projection=e.data.crs.properties.name:this.metaData.projection=de.a.getBaseLayerProj(),e.data=ie.a.assembleTableJSONData(a),this.metaData.dataTypes=T.a.getFieldType(e.data.titles,e.data.rows[0]));else if("CSV"===e.type||"EXCEL"===e.type){if("SAMPLE"===e.fileSource||t||(e.data=ie.a.assembleTableExcelData(e.data)),!e.data.rows[0])return tn.a.showErrrModal(Vn,"".concat(DataViz.Language.emptyFile," -- ").concat(e.name)),void this.toFirstStep();var n=e.fileSource===q.f.SAMPLE?e.sampleDataXYField:tn.a.getExcelLonLatField(e.data.titles,e.data.rows[0]);this.metaData.fileCode=n.code,this.metaData.xField=n.x,this.metaData.yField=n.y,this.metaData.xIndex=n.xIndex,this.metaData.yIndex=n.yIndex,this.metaData.cityField=n.city,this.metaData.addressField=n.address,this.metaData.divisionType=DataViz.Language.province,this.metaData.divisionField=n.city,this.metaData.selectedValue1=n.selectedValue1,this.metaData.selectedValue2=n.selectedValue2,this.metaData.selectedField1=DataViz.Language.notSet,this.metaData.selectedField2=DataViz.Language.notSet,this.metaData.selectTableDataset=null,this.metaData.selectedTable=DataViz.Language.notSet,this.setState({associationField:[DataViz.Language.notSet]})}e.type!==q.h.SHP&&(this.metaData.dataTypes=T.a.getFieldType(e.data.titles,e.data.rows[0])),this.metaData.layerType=e.featureType===q.p.UNKNOWN?q.r.MARKER:q.r.VECTOR,this.metaData.featureType=e.featureType,this.metaData.fileData=e,this.metaData.isFromMyData=t,this.metaData.isFromShare=e.isFromShare,this.metaData.fileSource=e.fileSource,this.csvFileInfo=e.csvFileInfo,this.setState({current:2,encode:e.fileEncoding||this.state.encode})}},{key:"getAssociationTable",value:function(){var e=[DataViz.Language.notSet],t=[];return Fn.getMyServiceInfo({pageSize:1e6}).then((function(a){return a.services.forEach((function(a){"DATA"===a.type&&(e.push(a.serviceName),Fn.getDataInfos(a.linkPage,a.id,a.serviceName,a.type).then((function(e){a.datas=[],e.forEach((function(e){T.a.isSupportRestDataType(e.featureType)&&a.datas.push(e)})),t.push(a)})))})),{associationTable:e,associationTableDatasets:t}}))}},{key:"stopWorker",value:function(){tn.a.readExcelWorker&&tn.a.readExcelWorker.terminate(),tn.a.readExcelWorker=null}},{key:"toFirstStep",value:function(e){this.data=null,this.metaData={layerType:q.r.VECTOR,xField:null,yField:null,cityField:null,addressField:null,fileCode:null,fileData:null,featureType:q.p.UNKNOWN,isBinary:!1,separator:",",selectedValue1:null,selectedValue2:null,selectedTable:null,associationTableDatasets:null,selectedField1:null,selectedField2:null},this.stopWorker(),this.setState({current:1,percent:0,isShowProgress:e||!1}),e||(this.fileName=null,this.allData=null)}},{key:"onArgsChange",value:function(e,t,a){if(this.metaData[e]=t,"xField"===e&&a&&(this.metaData.xIndex=a),"yField"===e&&a&&(this.metaData.yIndex=a),"selectedTable"===e){if(t===DataViz.Language.notSet)return;this.getAssociationField(t);var n=this.metaData.associationTableDatasets.filter((function(e){return e.serviceName===t}));n.length>0&&(this.metaData.selectTableDataset=n[0])}else"fileCode"===e&&(this.metaData.fileData.fileEncoding=t);if(t===q.l.CODING){var i=this;this.getAssociationTable().then((function(e){i.setState({associationTable:e.associationTable}),i.metaData.associationTableDatasets=e.associationTableDatasets}))}}},{key:"getAssociationField",value:function(e){var t=this.metaData.associationTableDatasets.filter((function(t){return t.serviceName===e}))[0];if(t&&t.datas[0]){var a=this;T.a.getAllFields(t.datas[0].url).then((function(e){e.unshift(DataViz.Language.notSet),a.setState({associationField:e})}))}}},{key:"render",value:function(){var e=this,t=1===this.state.current?this[Rn]:this[xn];return this.state.current&&t.disableCancel!==this.state.disableCancelBtn&&(t.disableCancel=this.state.disableCancelBtn,t.disableCloseBtn=this.state.disableCancelBtn),this.props.updateType&&1===this.state.current&&this.state.isShowProgress&&(t.disableCancel=!0),i.a.createElement(re.a,Y()({},t,{ref:function(t){e.modalBox=t},metaData:this.metaData}),1===this.state.current?i.a.createElement(fn,{onFileSelected:this.onFileSelected,isShowProgress:this.state.isShowProgress,progressPercent:this.state.percent,fileName:this.fileName,onServiceSelected:this.onServiceSelected}):i.a.createElement(Ln,{onChange:this.onArgsChange,csvFileInfo:this.csvFileInfo,changeCSVCode:this.onFileSelected,metaData:this.metaData,allData:this.allData,associationTable:this.state.associationTable,associationField:this.state.associationField,updateType:this.props.updateType}),i.a.createElement(On,{current:this.state.current,steps:Mn}))}}]),t}(n.Component),Un=a(63),Gn=a(57),_n=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).HandleChangeEvent=a.HandleChangeEvent.bind(O()(a)),a.state={token:!1,layerType:null,tooltip:i.a.createElement(i.a.Fragment,null," ",i.a.createElement("div",null,"http://<server>:<port>/iserver/services/{component}/rest/maps/{mapName}"),i.a.createElement("div",null,"http://<server>:<port>/iserver/services/{component}/restjsr/maps/{mapName}")),placeholder:"http://<server>:<port>/iserver/services/{component}/rest/maps/{mapName}",title:"http://<server>:<port>/iserver/services/{component}/rest/maps/{mapName}"},e.url&&a.HandleChangeEvent(e.url),a.addRestMapFailed=a.addRestMapFailed.bind(O()(a)),a.addRestMapLayer=a.addRestMapLayer.bind(O()(a)),a.addRestjsrServiceLayer=a.addRestjsrServiceLayer.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"HandleChangeEvent",value:function(e){if(e||this.refs.UrlInput){var t=this,a=T.a.handleInputUrl(e)||this.refs.UrlInput.value;if(this.props.changeUrl(a),Gn.a.checkUrl(a))if(this.state.token&&""===this.refs.KeyInput.value)t.props.onSourceLoad(null),K.a.showMessage(DataViz.Language.inputToken,q.j.WARNING);else{K.a.showMessage(DataViz.Language.verifyingDataSource,q.j.WARNING,5e3);var n=this.state.token?this.refs.KeyInput.value:"";Gn.a.isRestjsrServiceUrl(decodeURIComponent(a),n).then((function(e){var i=!1;e&&e[0]&&(i="vectortile"===e[0].resourceConfigID);if(t.state.layerType){var r=i?q.i.VECTOR_TILE:q.i.TILE;if(t.state.layerType!==r)return void K.a.showMessage(DataViz.Language.noTileLayer,q.j.WARNING,5e3)}i?t.addRestjsrServiceLayer(a,n):t.addRestMapLayer(a,n)})).catch((function(e){t.addRestMapFailed(e)}))}else t.props.onSourceLoad(null),K.a.showMessage(DataViz.Language.noTileLayer)}}},{key:"addRestMapLayer",value:function(e,t){var a=this;Gn.a.getRestLayerInfo(e,t,q.s.RESTMAP).then(function(){var n=p()(u.a.mark((function n(i){var r,s,o,l;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a.props.onSourceLoad(null),K.a.closeMessage(),(i.dynamicProjection||i.wkt)&&(!i.wkt||T.a.wktIsEqual([i.wkt,de.a.epsgcodes[de.a.getBaseLayerProj()]]))){n.next=5;break}return K.a.showMessage(DataViz.Language.coordinateSystemInconformity),n.abrupt("return");case 5:if(r=i.bounds,s="png","WebP"!==Ka.a.dataVizConfig.mapCenter.tileFormat){n.next=11;break}return n.next=9,T.a.isSupportWebp(e,t);case 9:o=n.sent,s=o?"webp":"png";case 11:l={layerType:"TILE",overLayer:!0,epsgCode:de.a.getBaseLayerProj(),projection:de.a.getBaseLayerProj(),units:i.coordUnit&&i.coordUnit.toLowerCase(),extent:[r.left,r.bottom,r.right,r.top],name:i.name,visibleScales:i.visibleScales,coordUnit:i.coordUnit,url:e,sourceType:"TILE",visible:!0,format:s},a.state.token&&(l.credential=t),a.props.onSourceLoad(l);case 14:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(e){a.addRestMapFailed(e)}))}},{key:"addRestjsrServiceLayer",value:function(e,t){var a=this;Gn.a.getRestLayerInfo(e,t,q.s.MAPBOXSTYLE).then((function(n){var i=n.prjCoordSys.epsgCode;if(i===Number(de.a.getBaseLayerProj(!0))){var r={epsgCode:i,url:e,name:n.name,visibleScales:n.visibleScales,coordUnit:n.coordUnit,scale:n.scale,bounds:n.bounds};a.state.token&&(r.credential={token:t}),a.props.onSourceLoad(null),Un.a.getMapboxStyle(r).then((function(e){e&&e.styles?a.props.onSourceLoad(e):K.a.showMessage(DataViz.Language.restMapRequestFailed)})).catch((function(e){a.addRestMapFailed(e)}))}else a.props.onSourceLoad(null),K.a.showMessage(DataViz.Language.coordinateSystemInconformity,q.j.WARNING)})).catch((function(e){a.addRestMapFailed(e)}))}},{key:"addRestMapFailed",value:function(e){this.props.onSourceLoad(null),e.error?"{0}"===e.error.errorMsg?K.a.showMessage(DataViz.Language.coordinateSystemInconformity):K.a.showMessage(e.error.errorMsg):K.a.showMessage(DataViz.Language.loadFailed)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"add-rest-map"},i.a.createElement(Ke.b,{onChange:function(t){e.setState({token:"has-token"===t})},name:"tokenGroup",selectedValue:this.state.token?"has-token":"no-token"},i.a.createElement(Ke.a,{value:"has-token"},DataViz.Language.hasToken),i.a.createElement(Ke.a,{value:"no-token"},DataViz.Language.noToken)),i.a.createElement("div",{className:"rest-url-input"},i.a.createElement("label",null,DataViz.Language.serviceUrl),i.a.createElement("input",{ref:"UrlInput",onChange:function(t){T.a.delayCall(e.HandleChangeEvent,1e3,e)},type:"text",title:this.state.title,placeholder:this.state.placeholder,defaultValue:this.props.url}),i.a.createElement(C.a,{iconClassName:"supermapol-icons-query",trigger:"click",tooltip:this.state.tooltip})),this.state.token&&i.a.createElement("div",{className:"rest-token-input"},i.a.createElement("label",null,DataViz.Language.token),i.a.createElement("input",{ref:"KeyInput",onChange:function(){T.a.delayCall(e.HandleChangeEvent,1e3,e)},type:"text"})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a=e.layerID;if(a){var n=de.a.getLayerById(a).layerInfo,i=t.tooltip,r=t.title,s=t.placeholder,o=t.layerType;return n&&(o=n.layerType,q.i.VECTOR_TILE===o?(r=i="http://<server>:<port>/iserver/services/{component}/restjsr/maps/{mapName}",s=i):q.i.TILE===o&&(i="http://<server>:<port>/iserver/services/{component}/rest/maps/{mapName}")),{tooltip:i,title:r,placeholder:s,layerType:o}}return null}}]),t}(n.Component),zn=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).HandleChangeEvent=a.HandleChangeEvent.bind(O()(a)),a.getResource=a.getResource.bind(O()(a)),a.state={wmsInfo:null,wmsLayer:null},e.url&&a.HandleChangeEvent(e.url),a}var a;return E()(t,e),y()(t,[{key:"getWMSBounds",value:function(e,t,a){var n=e[t];if(!n){for(var i,r=Object.keys(e),s=0;s<r.length;s++)if(ol.proj.get(r[s])){i=r[s];break}i&&(n=ol.proj.transformExtent(e[i].bbox,i,t))}var o=n.bbox||n;return"1.3.0"===a&&["EPSG:4326","EPSG:4490"].includes(t)&&(o=[o[1],o[0],o[3],o[2]]),o}},{key:"getResource",value:(a=p()(u.a.mark((function e(t,a){var n,i,r,s,o,l,c,d,p,h,f,m,y;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=a-1,i=this.state.wmsInfo,r=i.capability,s=r.layers,o=r.request,l=s[n],c=null,this.setState({wmsLayer:l.title}),n>-1?(d=l.bbox,p=l.srs,h=l.name,f=l.title,m=de.a.getBaseLayerProj(),y=T.a.isSupportedEpsg(Object.keys(p),m),d=this.getWMSBounds(d,m,i.version),y&&d?c={layerType:"TILE",overLayer:!0,url:o.getmap.href,sourceType:"WMS",extent:d,subLayers:h,name:f,epsgCode:m,orginEpsgCode:m,version:i.version}:K.a.showMessage(DataViz.Language.coordinateSystemInconformity)):K.a.showMessage(DataViz.Language.wrongEPSGCode),this.props.onSourceLoad(null),this.props.onSourceLoad(c);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"HandleChangeEvent",value:function(e){var t=T.a.handleInputUrl(e)||this.refs.UrlInput.value,a=this;this.props.changeUrl(t),this.setState({wmsInfo:null,wmsLayer:null}),this.props.onSourceLoad(null),Gn.a.checkUrl(t)?(K.a.showMessage(DataViz.Language.verifyingDataSource,q.j.WARNING,5e3),Gn.a.getCapabilities(t,q.s.WMS).then((function(e){var t=e.capability,n=t.layers,i=t.request,r=n[n.length-1],s=i.getmap.href.match(/.+?MAP=(.+)&$/);s&&r.title===decodeURIComponent(s[1])&&e.capability.layers.pop(),a.setState({wmsInfo:e}),K.a.closeMessage()})).catch((function(e){e.error?K.a.showMessage(e.error.errorMsg):K.a.showMessage(DataViz.Language.loadFailed)}))):K.a.showMessage(DataViz.Language.urlUnChecked)}},{key:"getSelectContent",value:function(){var e=[];this.state.wmsInfo&&(e=[DataViz.Language.selectedLayer],this.state.wmsInfo.capability.layers.forEach((function(t,a){e.push(t.title)})));return e}},{key:"render",value:function(){var e=this,t=this.getSelectContent();return i.a.createElement("div",{className:"add-wms-map"},i.a.createElement("div",{className:"wms-url-input"},i.a.createElement("label",null,DataViz.Language.serviceUrl),i.a.createElement("input",{type:"text",ref:"UrlInput",onChange:function(){T.a.delayCall(e.HandleChangeEvent,1e3,e)},title:"http://<server>:<port>/path",placeholder:"http://<server>:<port>/path",defaultValue:this.props.url}),i.a.createElement(C.a,{iconClassName:"supermapol-icons-query",trigger:"click",tooltip:"http://<server>:<port>/path"})),this.state.wmsInfo&&i.a.createElement("div",{className:"wms-layers-select"},i.a.createElement("label",null,DataViz.Language.wmsLayers),i.a.createElement(We.b,{onChange:this.getResource,values:t,selectedValue:this.state.wmsLayer})))}}]),t}(n.Component),jn=(a(252),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).getLayerResource=a.getLayerResource.bind(O()(a)),a.getScalesResource=a.getScalesResource.bind(O()(a)),a.source=null,a.state={kvp:!0,wmtsInfo:null,scaleInfo:null,selectedLayerName:null,dpi:null},e.url&&a.HandleChangeEvent(e.url),a}return E()(t,e),y()(t,[{key:"getLayersSelectContent",value:function(){var e=[];if(this.state.wmtsInfo){var t=this.state.wmtsInfo.Contents.Layer;e=[DataViz.Language.selectedLayer],t.forEach((function(t,a){e.push(t.Title)}))}return e}},{key:"getScalesSelectContent",value:function(){var e=[];return this.state.scaleInfo&&(e=[DataViz.Language.selectedScales],this.state.scaleInfo.scale.forEach((function(t,a){e.push(t.Identifier)}))),e}},{key:"getLayerResource",value:function(e,t){if((t-=1)>-1){for(var a=this.state.wmtsInfo.Contents,n=a.TileMatrixSet,i=a.Layer[t],r=i.TileMatrixSetLink,s=[],o="default",l=i.Format[0],c=0,u=r.length;c<u;c++)for(var d=r[c],p=0,h=n.length;p<h;p++)if(d.TileMatrixSet==n[p].Identifier){s.push(n[p]);break}i&&i.Style&&i.Style.forEach((function(e){e.isDefault&&(o=e.Identifier)})),this.state.scaleInfo&&this.props.onSourceLoad(null);var f=Gn.a.getTileUrl(this.state.wmtsInfo.OperationsMetadata.GetTile.DCP.HTTP.Get,i,l,this.state.kvp);this.setState({selectedLayerName:i.Title,scaleInfo:{scale:s,layerIdentifier:i.Identifier,layerBounds:i.WGS84BoundingBox,layerTitle:i.Title,tileUrl:f,style:o,format:l},selectedScale:[DataViz.Language.selectedScales]})}else this.setState({scaleInfo:null}),this.props.onSourceLoad(null)}},{key:"getDpiFromWellKnownScaleSet",value:function(e){return["ChinaPublicServices","ChinaPublicServicesCGCS2000"].includes(e)?96:Ce.a.dpi.iServerWMTS}},{key:"isInExtent",value:function(e){return ol.extent.containsExtent([-181,-91,181,91],e)}},{key:"correctBounds",value:function(e){if(!T.a.isArray(e))return[];if(e.length<4)return[];var t=e.slice();return t[0]=e[0]<-180?-180:e[0],t[1]=e[1]<-90?-90:e[1],t[2]=e[2]>180?180:e[2],t[3]=e[3]>90?90:e[3],t}},{key:"getScalesResource",value:function(e,t){var a;if(this.resource=null,(t-=1)>-1){var n=this.state.scaleInfo,i=n.scale,r=this.correctBounds(n.layerBounds),s=i[t].SupportedCRS.lastIndexOf(":"),o="EPSG:".concat(i[t].SupportedCRS.substring(s+1)),l=de.a.getBaseLayerProj(),c=T.a.isSupportedEpsg(o,l),u=this.state.scaleInfo.layerIdentifier,d=i[t].Identifier,p=i[t].WellKnownScaleSet;if(a=this.getDpiFromWellKnownScaleSet(p),c){var h=ol.proj.transformExtent(r,"EPSG:4326",l),f=i[t].TileMatrix[0].TopLeftCorner,m=["EPSG:4326","EPSG:4490"].includes(o),y=m?[f[1],f[0]]:f;this.resource={sourceType:"WMTS",layerType:"WMTS",overLayer:!0,layer:u,name:u,unit:m?"degrees":"m",url:this.refs.UrlInput.value,tileUrl:n.tileUrl,title:n.layerIdentifier,identifier:d,format:n.format,style:n.style,extent:h,matrixSet:i[t],orginEpsgCode:l,epsgCode:l,requestEncoding:this.state.kvp?"KVP":"REST",origin:y,dpi:a}}else K.a.showMessage(DataViz.Language.WMTSUnSupport)}this.setState({selectedScale:e,dpi:a}),this.props.onSourceLoad(null),this.props.onSourceLoad(this.resource)}},{key:"HandleChangeEvent",value:function(e){var t=e||this.refs.UrlInput.value,a=this;this.props.changeUrl(t),t=decodeURIComponent(t),this.setState({wmtsInfo:null,selectedLayerName:null,scaleInfo:null}),this.props.onSourceLoad(null),Gn.a.checkUrl(t)?(K.a.showMessage(DataViz.Language.verifyingDataSource,q.j.WARNING,5e3),Gn.a.getCapabilities(t,q.s.WMTS,this.state.kvp).then((function(e){K.a.closeMessage(),a.setState({wmtsInfo:e,selectedLayerName:null,scaleInfo:null}),a.props.onSourceLoad(null)})).catch((function(e){e.error?K.a.showMessage(e.error.errorMsg):K.a.showMessage(DataViz.Language.loadFailed)}))):K.a.showMessage(DataViz.Language.urlUnChecked)}},{key:"dpiChange",value:function(e){this.resource.dpi=e||this.refs.dpiInput.value,this.props.onSourceLoad(null),this.props.onSourceLoad(this.resource)}},{key:"render",value:function(){var e=this,t=this.getLayersSelectContent(),a=this.getScalesSelectContent(),n=this.state.selectedLayerName,r=this.state.selectedScale;return i.a.createElement("div",{className:"add-wmts-map"},i.a.createElement(Ke.b,{onChange:function(t){e.setState({kvp:"KVP"===t,wmtsInfo:null,scaleInfo:null})},name:"wmtsTypeGroup",selectedValue:this.state.kvp?"KVP":"REST"},i.a.createElement(Ke.a,{value:"KVP"},"KVP"),i.a.createElement(Ke.a,{value:"REST"},"REST")),i.a.createElement("div",{className:"wmts-url-input"},i.a.createElement("label",null,DataViz.Language.serviceUrl),i.a.createElement("input",{type:"text",ref:"UrlInput",onChange:function(){T.a.delayCall(e.HandleChangeEvent,1e3,e)},placeholder:"http://<server>:<port>/path",title:"http://<server>:<port>/path",defaultValue:this.props.url}),i.a.createElement(C.a,{iconClassName:"supermapol-icons-query",trigger:"click",tooltip:"http://<server>:<port>/path"})),this.state.wmtsInfo&&i.a.createElement("div",{className:"wmts-layers-select"},i.a.createElement("label",null,DataViz.Language.wmsLayers),i.a.createElement(We.b,{onChange:this.getLayerResource,values:t,selectedValue:n})),this.state.wmtsInfo&&this.state.scaleInfo&&i.a.createElement("div",{className:"wmts-scales-select"},i.a.createElement("label",null,DataViz.Language.scales),i.a.createElement(We.b,{onChange:this.getScalesResource,values:a,selectedValue:r})),this.state.wmtsInfo&&this.state.scaleInfo&&this.resource&&i.a.createElement("div",{className:"wmts-dpi-input"},i.a.createElement("label",null,DataViz.Language.dpi),i.a.createElement("input",{type:"text",ref:"dpiInput",onChange:function(){T.a.delayCall(e.dpiChange,1e3,e)},defaultValue:this.state.dpi})))}}]),t}(n.Component)),Wn=(a(259),"http://<server>:<port>/iserver/services/{data-provider}/rest/data/datasources/{dataSourceName}\nhttp://<server>:<port>/iserver/services/{data-provider}/rest/data/datasources/{dataSourceName}/datasets/{dataSetName}"),Hn=window.DataViz.Language,Yn=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).HandleChangeEvent=a.HandleChangeEvent.bind(O()(a)),a.state={checkLists:[],update:!1},a.datasets=[],a.formatDatasets=[],a.dataSourceName=null,e.url&&a.HandleChangeEvent(e.url),a}return E()(t,e),y()(t,[{key:"HandleChangeEvent",value:function(e){e=e||this.refs.UrlInput.value;var t=T.a.handleInputUrl(e),a=this;this.props.changeUrl(t),this.datasets=[],Gn.a.checkUrl(t)?(K.a.showMessage(DataViz.Language.verifyingDataSource,q.j.WARNING,5e3),Gn.a.getRestDataInfo(t).then((function(e){if(a.props.onSourceLoad(),Gn.a.isDataSourceRespond(e))a.HandleChangeEvent(e.childUriList[0]);else if(e.datasetNames){var n=e.datasetNames;n.forEach((function(t,i){var r={name:n[i],url:e.childUriList[i]};a.datasets.push(r)})),a.getDatasetInfo()}else{var i=a.judgeSupport(e.datasetInfo.type);if(i)return void K.a.showMessage(i);e.url=t.trim(),a.addDataset(!0,e),K.a.closeMessage()}})).catch((function(e){a.getFaild(Hn.getRestDataFaild)}))):a.getFaild(DataViz.Language.noTileLayer)}},{key:"getFaild",value:function(e){this.datasets=[],this.props.onSourceLoad(),K.a.showMessage(e.message||e)}},{key:"getDatasetInfo",value:function(){var e=this.datasets,t=this;e.forEach((function(a,n){Gn.a.getRestDataInfo(a.url).then(function(a){return function(n){e[a].datasetInfo=n,a===e.length-1&&(t.setState({update:!0}),K.a.closeMessage())}}(n)).catch((function(e){t.getFaild(e)}))}),this)}},{key:"judgeSupport",value:function(e){if(["POINT","LINE","REGION"].indexOf(e)<0)return Hn.unSupport+" "+e+" "+Hn.fileType}},{key:"getDatasetFromName",value:function(e){for(var t=0;t<this.datasets.length;t++)if(e===this.datasets[t].name)return this.datasets[t]}},{key:"addDataset",value:function(e,t){e?this.addSingleDataset(t):(this.removeCheckFromLists(t),this.props.onSourceLoad(null,this.dataSourceName+":"+t))}},{key:"addSingleDataset",value:function(e){var t=this.getDatasetFromName(e)||e,a=t.datasetInfo.datasetInfo||t.datasetInfo,n={featureType:q.e[a.type],epsgCode:de.a.getBaseLayerProj(),orginEpsgCode:"EPSG:".concat(a.prjCoordSys.epsgCode),layerType:"VECTOR",name:a.dataSourceName+":"+a.name,url:t.url.substr(0,t.url.search("/datasources")),serviceType:"DATA",id:(new Date).getTime(),visible:!0};this.dataSourceName=a.dataSourceName,this.props.onSourceLoad(n)}},{key:"addAllDatasets",value:function(e){var t=[],a=this;e.target.checked?this.datasets.forEach((function(e){this.judgeSupport(e.datasetInfo.datasetInfo.type)||(t.push(e.name),a.addDataset(!0,e.name))}),this):this.props.onSourceLoad(),this.setState({checkLists:t})}},{key:"removeCheckFromLists",value:function(e){var t=this.state.checkLists;t.forEach((function(a,n){a===e&&t.splice(n,1)})),this.setState({checkLists:t})}},{key:"getDatasetLists",value:function(){var e=[];return this.formatDatasets=[],this.datasets.forEach((function(t,a){if(t.datasetInfo&&t.datasetInfo.datasetInfo.type){var n=this.judgeSupport(t.datasetInfo.datasetInfo.type);n||this.formatDatasets.push(t.name),this.props.isRadio?e.push(i.a.createElement(Ke.a,{key:a,value:t.name,disabled:!!n},t.name,i.a.createElement("label",null,n))):e.push(i.a.createElement(se.a,{key:a,name:t.name,disabled:!!n},t.name,i.a.createElement("label",null,n)))}}),this),e}},{key:"getGroup",value:function(){return this.props.isRadio?i.a.createElement(Ke.b,{name:"datas-li",className:"dataset-radio-group",onChange:this.addSingleDataset.bind(this)},this.getDatasetLists()):i.a.createElement(se.b,{checkLists:this.state.checkLists,onChange:this.addDataset.bind(this)},this.getDatasetLists())}},{key:"getContainer",value:function(){var e;return this.datasets&&this.datasets.length>0&&(e=i.a.createElement("div",{className:"rest-data-container"},!this.props.isRadio&&i.a.createElement("div",{className:"check-all"},i.a.createElement("label",null,Hn.datasetTable),i.a.createElement(se.a,{onChange:this.addAllDatasets.bind(this),checked:this.state.checkLists.length>0&&this.state.checkLists.length===this.formatDatasets.length},Hn.selectAll)),i.a.createElement("div",{className:"datasets"},this.props.isRadio&&i.a.createElement("label",null,Hn.datasetTable),i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},this.getGroup())))),e}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"add-rest-data"},i.a.createElement("div",{className:"rest-url-input"},i.a.createElement("label",null,DataViz.Language.serviceUrl),i.a.createElement("input",{ref:"UrlInput",onChange:function(t){T.a.delayCall(e.HandleChangeEvent,1e3,e)},type:"text",title:Wn,placeholder:Wn,defaultValue:this.props.url}),i.a.createElement(C.a,{iconClassName:"supermapol-icons-query",trigger:"click",tooltip:i.a.createElement(i.a.Fragment,null,i.a.createElement("span",null,"http://<server>:<port>/iserver/services/{data-provider}/rest/data/datasources/{dataSourceName}"),i.a.createElement("br",null),i.a.createElement("span",null,"http://<server>:<port>/iserver/services/{data-provider}/rest/data/datasources/{dataSourceName}/datasets/{dataSetName}"),i.a.createElement("br",null))})),this.getContainer())}}]),t}(n.Component),Kn=DataViz.Language,Xn=[Kn.LonLatProj,Kn.webMercatorProj],qn=["EPSG:4326","EPSG:3857"],Jn="http://<server>:<port>/iserver/services/{serviceName}/dataflow",Zn=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isUrlHasValue:!!a.props.url,isTokenHasValue:!1,projection:Xn[0],featureFields:null,selectField:null},a.source={layerType:q.r.DATAFLOW,visible:!0,url:null,identifyField:null,projection:qn[0],token:null,featureType:"POINT",wsUrl:null,name:null},e.url&&a.HandleChangeEvent(e.url),a}return E()(t,e),y()(t,[{key:"HandleChangeEvent",value:function(e){var t=e||this.refs.UrlInput.value;if(this.props.changeUrl(t),t=decodeURIComponent(t),Gn.a.checkUrl(t)){var a=this.refs.KeyInput&&this.refs.KeyInput.value;this.setState({isUrlHasValue:!0}),this.source.url=t,this.state.isTokenHasValue&&this.getServiceInfo(T.a.trim(t),a)}else this.source.url=null,K.a.showMessage(Kn.dataflowUrlIsWrong,q.j.ERROR),this.props.onSourceLoad(),this.setState({isUrlHasValue:!1})}},{key:"getServiceInfo",value:function(e,t){if(e&&""!==e){var a;t&&(a="".concat(T.a.handleInputUrl(e),".json?token=").concat(t));var n=this;T.a.doFetch("".concat(T.a.getUrl(a)),{method:"GET",withCredentials:!0}).then((function(e){if(n.source.wsUrl=e.urls[0].url,n.source.name=e.urls[0].url.split("iserver/services/")[1].split("/dataflow")[0],e&&e.featureMetaData){var t=n.formatDataTypes(e.featureMetaData.fieldInfos);n.source.dataTypes=t.dataTypes,n.source.enableFields=t.enableFields,n.source.featureType=e.featureMetaData.featureType.toUpperCase(),n.isStandard()}else null!==n.source.identifyField&&void 0!==n.source.identifyField?n.isStandard():(n.setState({featureFields:null}),n.props.onSourceLoad())})).catch((function(e){n.setState({featureFields:null}),n.props.onSourceLoad(),"401"===e?K.a.showMessage(Kn.urlNeedToken,q.j.WARNING):K.a.showMessage(Kn.loadFailed,q.j.ERROR)}))}}},{key:"formatDataTypes",value:function(e){var t={},a=[];return e.forEach((function(e){var n=e.name.trim();a.push(n),"TEXT"===e.type?t[n]=q.c.STRING:["DOUBLE","INT","INT32","FLOAT","LONG","SHORT"].includes(e.type)?t[n]=q.c.NUMBER:t[n]=q.c.UNKNOWN})),a&&a.length>0&&(this.setState({featureFields:a}),this.changeField(a[0])),{dataTypes:t,enableFields:a}}},{key:"changeTokenValue",value:function(){var e=this.refs.KeyInput.value;""===e?(this.setState({isTokenHasValue:!1}),this.props.onSourceLoad(null),K.a.showMessage(DataViz.Language.inputToken,q.j.WARNING)):(this.source.token=e,this.setState({isTokenHasValue:!0}),this.state.isUrlHasValue&&this.getServiceInfo(T.a.trim(this.refs.UrlInput.value),e))}},{key:"isStandard",value:function(){for(var e in this.source)if(!this.source[e]||""===this.source[e])return void this.props.onSourceLoad();this.props.onSourceLoad(),K.a.closeMessage(),this.state.isUrlHasValue&&this.state.isTokenHasValue&&this.props.onSourceLoad(this.source)}},{key:"changeProjection",value:function(e){this.setState({projection:e}),this.source.projection=qn[Xn.indexOf(e)],this.isStandard()}},{key:"changeField",value:function(e){e&&""!==e?(this.source.identifyField=e,this.setState({selectField:e}),this.isStandard()):(K.a.showMessage(Kn.mustUniqueField),this.props.onSourceLoad())}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"add-dataflow-data"},i.a.createElement("div",{className:"rest-url-input"},i.a.createElement("label",null,Kn.serviceUrl),i.a.createElement("input",{ref:"UrlInput",onChange:function(){e.HandleChangeEvent()},type:"text",title:Jn,placeholder:Jn,defaultValue:this.props.url}),i.a.createElement(C.a,{iconClassName:"supermapol-icons-query",trigger:"click",tooltip:Jn})),i.a.createElement("div",{className:"rest-token-input"},i.a.createElement("label",null,Kn.token),i.a.createElement("input",{ref:"KeyInput",onChange:function(t){T.a.delayCall(e.changeTokenValue(t),3e3,e)},type:"text"})),i.a.createElement("div",{className:"rest-token-input"},i.a.createElement("label",null,Kn.projectionInformation),i.a.createElement(We.b,{selectedValue:this.state.projection,values:Xn,onChange:function(t){e.changeProjection(t)}})),this.state.isUrlHasValue&&i.a.createElement("div",{className:"unique-field-input"},i.a.createElement("label",null,Kn.uniqueField),this.state.featureFields&&this.state.featureFields.length>0?i.a.createElement(We.b,{selectedValue:this.state.selectField,values:this.state.featureFields,onChange:function(t){T.a.delayCall(e.changeField(t),3e3,e)}}):i.a.createElement("input",{ref:"uniqueField",type:"text",onChange:function(){T.a.delayCall(e.changeField(e.refs.uniqueField.value),3e3,e)}})))}}]),t}(n.Component),Qn=window.DataViz.Language,$n=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={fileCode:DataViz.Language.LonLatProj,proxy:!1},a.datasets=[],a.formatDatasets=[],a.dataSourceName=null,a.changeProjection=a.changeProjection.bind(O()(a)),a.changeProxyState=a.changeProxyState.bind(O()(a)),a.fileCode=a.state.fileCode,a.proxy=!1,a}return E()(t,e),y()(t,[{key:"HandleChangeEvent",value:function(){var e=this.refs.UrlInput.value;this.props.changeUrl(e),this.updateSource(e)}},{key:"updateSource",value:function(e){this.props.onSourceLoad(null);var t=T.a.handleInputUrl(e)||this.refs.UrlInput.value;if(t&&""!==t){var a={layerType:q.r.VECTOR,serviceType:"GEOJSON",url:this.proxy?"".concat(T.a.getProxy()).concat(encodeURIComponent(t)):t,orginEpsgCode:T.a.getEpsgCode(this.fileCode)};this.props.disabledName?this.props.onSourceLoad(a):(a.name=this.refs.NameInput.value,a.name&&this.props.onSourceLoad(a))}}},{key:"changeProjection",value:function(e){this.setState({fileCode:e}),this.fileCode=e,this.updateSource()}},{key:"changeProxyState",value:function(e){this.proxy=e.target.checked,this.setState({proxy:this.proxy}),this.updateSource()}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"add-geojson-data"},i.a.createElement("div",{className:"rest-url-input"},i.a.createElement("label",null,Qn.serviceUrl),i.a.createElement("input",{ref:"UrlInput",onChange:function(){T.a.delayCall(e.HandleChangeEvent,1e3,e)},type:"text",defaultValue:this.props.url})),i.a.createElement("div",{className:"rest-url-input"},i.a.createElement("label",null,Qn.proxySetting),i.a.createElement(se.a,{onChange:this.changeProxyState,checked:this.state.proxy},Qn.hasProxy),i.a.createElement(C.a,{iconClassName:"supermapol-icons-query",trigger:"click",placement:"right",tooltip:i.a.createElement("span",null,Qn.proxyTooltip)})),!this.props.disabledName&&i.a.createElement("div",{className:"rest-url-input"},i.a.createElement("label",null,Qn.name),i.a.createElement("input",{ref:"NameInput",onChange:function(){T.a.delayCall(e.updateSource,1e3,e)},type:"text"})),i.a.createElement("div",{className:"rest-token-input"},i.a.createElement("label",null,Qn.projectionInformation),i.a.createElement(We.b,{onChange:this.changeProjection,selectedValue:this.state.fileCode,values:[Qn.LonLatProj,Qn.webMercatorProj]})))}}]),t}(n.Component),ei=(a(1715),function(e){function t(e){var a;f()(this,t),(a=v()(this,b()(t).call(this,e))).parmasType=a.getPaneParams();var n=a.parmasType.type.indexOf(e.serviceType);return a.state={index:n>-1?n:0,loaded:!1},a.source=[],a.loaded=a.loaded.bind(O()(a)),a.ModalConfig={closeBtnCallBack:a.toInitState.bind(O()(a)),cancelCallBack:a.cancelButtonEvent.bind(O()(a)),okCallBack:a.okButtonEvent.bind(O()(a)),modalWidth:"520px",modalTitle:DataViz.Language.addByWeb,okButton:DataViz.Language.add,cancelButton:DataViz.Language.cancel},a.url="",a}return E()(t,e),y()(t,[{key:"toInitState",value:function(){this.source=[];var e=this.parmasType.type.length>0?0:-1;if(this.props.serviceType){var t=this.parmasType.type.indexOf(this.props.serviceType);e=t>-1?t:e}this.setState({loaded:!1,index:e}),this.url=""}},{key:"cancelButtonEvent",value:function(){this.modalBox.hideModal(),this.toInitState()}},{key:"okButtonEvent",value:function(e){var t=this,a=0,n=0,i=this.source.length;K.a.showMessage(DataViz.Language.loading,q.j.WARNING,5e4),this.source.forEach((function(e){if(e.layerType===q.r.VECTOR)if("DATA"===e.serviceType){var r;if(!T.a.isDynamicRestData(e.orginEpsgCode))return void K.a.showMessage(DataViz.Language.unSupportCoordinate);r=de.a.getBaseLayerProj(!0),T.a.getFeatureBySQL(e.url,[e.name],(function(s){var o=s.result.features.features;if(0!==o.length){s.someRequestFailed&&K.a.showMessage(DataViz.Language.someFeatureRequestFailed,q.j.WARNING,3e3),e.dataTypes=Gn.a.getDataTypes(o[0].properties);var l={id:(new Date).getTime(),projection:e.orginEpsgCode,originData:o,layerType:e.layerType,featureType:e.featureType,visible:!0,name:e.name,dataTypes:e.dataTypes,dataSource:{type:"REST_DATA",url:e.url,dataSourceName:e.name}};r&&t.addRestDataFeature2Map(l,o,r,a,i,n)}else K.a.showMessage(DataViz.Language.featureIsEmpty,q.j.WARNING,3e3)}),(function(){n++,a++,K.a.changeMessage(a,i,n)}),null,null,r)}else"GEOJSON"===e.serviceType&&t.addGeojsonData(e);else if(e.layerType===q.r.DATAFLOW)e.id=e.id||(new Date).getTime(),t.props.addFromWeb.addFromDataflow(e,e.id),K.a.showMessage(DataViz.Language.loadend,q.j.SUCCESS,3e3);else{e.id=t.props.layerID||(new Date).getTime();var s={visible:!0};for(var o in e)"orginEpsgCode"===o?s.projection=e[o]:s[o]=e[o];if(s.layerType=e.sourceType,[q.s.WMS,q.s.WMTS].includes(e.sourceType))t.props.addFromWeb.addRestMapOverLayer(s,s.id),K.a.showMessage(DataViz.Language.loadend,q.j.SUCCESS,3e3);else Un.a.isRestjsrMapboxStyle({dataSource:{url:e.url},layerType:e.layerType})?de.a.addProjection(s.projection).then((function(){t.props.addFromWeb.addVectorTileLayer(s,s.id),K.a.showMessage(DataViz.Language.loadend,q.j.SUCCESS,3e3)})).catch((function(e){K.a.showMessage(DataViz.Language.faild,q.j.ERROR,3e3)})):T.a.getSublayers(e.url,null,{token:e.credential}).then((function(e){s.subLayers=e,t.props.addFromWeb.addRestMapOverLayer(s,s.id),K.a.showMessage(DataViz.Language.loadend,q.j.SUCCESS,3e3)}))}})),this.modalBox.hideModal(),this.toInitState()}},{key:"addRestDataFeature2Map",value:function(e,t,a,n,i,r){var s={features:ie.a.parseData2Feature({allDatas:{features:t},fileCode:a},"JSON"),layerInfo:e,selectedLayerId:e.id};this.props.addFromWeb.addFromRestData(s),n++,K.a.changeMessage(n,i,r)}},{key:"addGeojsonData",value:function(e){var t=e.url,a=this;T.a.doFetch(t,{method:"GET"}).then((function(t){if(!1===t.succeed)K.a.showMessage(DataViz.Language.faild,q.j.ERROR,3e3);else{var n=ie.a.parseData2Feature({allDatas:t,fileCode:e.orginEpsgCode},"JSON"),i={id:(new Date).getTime(),projection:e.orginEpsgCode,layerType:e.layerType,featureType:q.e[n[0].getGeometry().getType().toUpperCase()],visible:!0,name:e.name,dataTypes:Gn.a.getDataTypes(n[0].get("attributes")),dataSource:{type:"USER_DATA",url:e.url}};a.props.addFromWeb.addFromRestData({features:n,layerInfo:i,selectedLayerId:i.id}),K.a.showMessage(DataViz.Language.loadend,q.j.SUCCESS,3e3)}})).catch((function(e){K.a.showMessage(DataViz.Language.faild,q.j.ERROR,3e3)}))}},{key:"getPaneParams",value:function(){var e={selectedValue:[],type:[],ph:[]};return this.props.childrens.forEach((function(t,a){if("ADD_REST"===t.id&&t.isCheck)e.selectedValue.push("SuperMap REST Map Service"),e.type.push(q.s.RESTMAP);else if("ADD_WMTS"===t.id&&t.isCheck)e.selectedValue.push("OGC WMTS Service"),e.type.push(q.s.WMTS);else if("ADD_WMS"===t.id&&t.isCheck)e.selectedValue.push("OGC WMS Service"),e.type.push(q.s.WMS);else if("ADD_MAP_SERVICE"===t.id&&t.isCheck)e.selectedValue.push("SuperMap REST Data Service"),e.type.push(q.s.RESTDATA);else if("ADD_DATAFLOW_SERVICE"===t.id&&t.isCheck)e.selectedValue.push("SuperMap DataFlow Service"),e.type.push(q.s.DATAFLOW);else{if("ADD_GEOJSON_DATA"!==t.id||!t.isCheck)return!1;e.selectedValue.push("GeoJSON Data"),e.type.push(q.s.GEOJSON)}})),e}},{key:"loaded",value:function(e,t){e?(this.source.push(e),this.setState({loaded:!0})):(t?this.removeSource(t):this.source=[],0===this.source.length&&this.setState({loaded:!1}))}},{key:"removeSource",value:function(e){var t=this;this.source.forEach((function(a,n){a.name===e&&t.source.splice(n,1)}),this)}},{key:"getWebUrlContent",value:function(){var e=this;switch(this.parmasType.type[this.state.index]){case q.s.RESTMAP:return i.a.createElement(_n,{onSourceLoad:this.loaded,url:this.url,layerID:this.props.layerID,changeUrl:function(t){e.url=t}});case q.s.WMS:return i.a.createElement(zn,{onSourceLoad:this.loaded,url:this.url,changeUrl:function(t){e.url=t}});case q.s.WMTS:return i.a.createElement(jn,{onSourceLoad:this.loaded,url:this.url,changeUrl:function(t){e.url=t}});case q.s.RESTDATA:return i.a.createElement(Yn,{onSourceLoad:this.loaded,url:this.url,changeUrl:function(t){e.url=t},isRadio:this.props.selectDisabled});case q.s.DATAFLOW:return i.a.createElement(Zn,{onSourceLoad:this.loaded,url:this.url,changeUrl:function(t){e.url=t}});case q.s.GEOJSON:return i.a.createElement($n,{onSourceLoad:this.loaded,url:this.url,changeUrl:function(t){e.url=t},disabledName:this.props.disabledName});default:return null}}},{key:"render",value:function(){var e=this;return i.a.createElement(re.a,Y()({disableConfirm:!this.state.loaded},this.ModalConfig,{ref:function(t){e.modalBox=t}}),i.a.createElement("div",{className:"add-web-content"},i.a.createElement("div",{className:"add-web-type"},i.a.createElement("label",null,DataViz.Language.dataSource),i.a.createElement(We.b,{selectedValue:this.parmasType.selectedValue[this.state.index],values:this.parmasType.selectedValue,onChange:function(t,a){e.setState({index:a,loaded:!1}),e.source=[]},disabled:this.props.selectDisabled})),i.a.createElement("div",{className:"add-web-url"},this.getWebUrlContent())))}}]),t}(n.Component)),ti=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getMenus",value:function(){var e=[],t=this.props.menus;return t&&t.forEach((function(t,a){var n=this;e.push(i.a.createElement("li",{key:a,className:a===this.props.tabIndex?"active":"",onClick:function(){n.props.onChange(a)},title:t},t))}),this),e}},{key:"render",value:function(){return i.a.createElement("div",{className:"menu"},this.getMenus())}}]),t}(n.Component),ai=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"no-data"},i.a.createElement("div",{className:"nodata-img"}),i.a.createElement("div",{className:"text"},this.props.tip?this.props.tip:window.DataViz.Language.noDatas))}}]),t}(n.Component),ni=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getTableHead",value:function(){var e=[];return this.props.tableHeads.forEach((function(t,a){"checkbox"===t.type?e.push(i.a.createElement("div",{className:t.className,key:a},i.a.createElement(se.a,{onChange:this.props.onSelected,checked:this.props.checked,disabled:this.props.disabled},t.title))):e.push(i.a.createElement("div",{className:t.className,key:a},t.title))}),this),e}},{key:"render",value:function(){return i.a.createElement("div",{className:"table"},i.a.createElement("div",{className:"table-head"},this.getTableHead()),i.a.createElement("div",{className:"table-body"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},this.props.children)))}}]),t}(n.Component),ii=a(241),ri=function(e){function t(e){var a;f()(this,t),a=v()(this,b()(t).call(this,e));var n=O()(a);return a.config={modalWidth:"1024px",modalHeight:"566px",modalTitle:window.DataViz.Language.preview,hideOkBtn:!0,hideCancelBtn:!0,hideFooter:!0,afterOpenModal:function(){K.a.showMessage(DataViz.Language.loading,q.j.WARNING,5e4),n.createMap();var e=n.mapInfo.orginEpsgCode;de.a.addProjection(e,n.mapInfo.url).then((function(){n.createLayer(n.mapInfo)})).catch((function(e){}))},cancelCallBack:function(){K.a.closeMessage()},closeBtnCallBack:function(){K.a.closeMessage()}},a}return E()(t,e),y()(t,[{key:"createMap",value:function(){var e=this.map=new ol.Map({target:"preview-map",controls:ol.control.defaults({attributionOptions:{collapsed:!1},zoom:!1,attribution:!1})}),t=new ol.control.Zoom({zoomInTipLabel:DataViz.Language.zoomIn,zoomOutTipLabel:DataViz.Language.zoomOut});e.addControl(t)}},{key:"createLayer",value:function(e){var t=this,a=new ol.View({center:[0,0],zoom:1,projection:e.orginEpsgCode});if(this.map.setView(a),e.extent&&this.map.getView().fit(e.extent),"DATA"===e.type||"DATASET"===e.type){var n=e.url.slice(0,e.url.indexOf("/datasources")),i=e.url.slice(e.url.indexOf("/datasources")+13,e.url.indexOf("/datasets"))+":"+e.name,r=this;T.a.getFeatureBySQL(n,[i],(function(t){var a=ie.a.parseData2Feature({allDatas:{features:t.result.features.features},fileCode:e.orginEpsgCode,featureProjection:e.orginEpsgCode},"JSON"),n=new ol.layer.Vector({source:new ol.source.Vector({features:a,wrapX:!1})});r.map.addLayer(n),K.a.closeMessage()}))}else if(["SINGLE_VECTOR_MAP","VECTOR_MAP"].includes(e.type)){var s=new ii.a(e);s.createLayer(!1).then((function(){var a=Un.a.creatMapViewOption(e,!0);t.map.setView(new ol.View(Ca()({},a))),t.map.addLayer(s.layer),K.a.closeMessage()}))}else{var o={transparent:!0,url:e.url,extent:e.extent,wrapX:!1};if(["SINGLE_MAP","MAP"].includes(e.type)){var l={left:e.extent[0],right:e.extent[2],bottom:e.extent[1],top:e.extent[3]},c=de.a.getScalesResolutions(e.visibleScales,e.coordUnit,null,null,l).resolutionArray,u=new ol.tilegrid.TileGrid({extent:e.extent,resolutions:c});o.tileGrid=u}SuperMap.Util.isInTheSameDomain(e.url)||(o.tileProxy=T.a.getProxy("png"));var d=new ol.layer.Tile({source:new ol.source.TileSuperMapRest(o)});this.map.addLayer(d),K.a.closeMessage()}}},{key:"setMapInfo",value:function(e){this.mapInfo=e}},{key:"render",value:function(){var e=this;return i.a.createElement(re.a,Y()({},this.config,{ref:function(t){e.modalBox=t}}),i.a.createElement("div",{id:"preview-map",className:"preview-map"}))}}]),t}(n.Component),si=[{title:window.DataViz.Language.serviceName,className:"name"},{title:window.DataViz.Language.projection,className:"coordinate"}],oi=function(e){function t(e){var a;f()(this,t),(a=v()(this,b()(t).call(this,e))).state={datas:[],checkLists:[]},a.disabledMaps=[],a.name=null,a.addMap=a.addMap.bind(O()(a));var n=O()(a);return a.config={modalWidth:"520px",modalHeight:"287px",modalTitle:window.DataViz.Language.addDataSet,hideOkBtn:!1,hideCancelBtn:!1,hideFooter:!1,okCallBack:function(){n.modalBox.hideModal(),n.props.changeSelectDatas(n.state.checkLists,n.name)},cancelCallBack:function(){n.modalBox.hideModal()}},a}return E()(t,e),y()(t,[{key:"getClassName",value:function(e,t){var a="";return this.state.checkLists.indexOf(t)>-1&&(a="active"),!e.available&&(a+=" disabled"),a}},{key:"getTableBody",value:function(){var e=this.state.datas,t=this.props.index,a=[];if(this.disabledMaps=[],e&&0!==e.length&&null!==t)return e.forEach((function(e,t){if(!T.a.isNumber(e)){var n=!e.available;n&&this.disabledMaps.push(t);var r=n?"service-name not-support":"service-name";a.push(i.a.createElement(se.a,{name:e.name,key:t,className:this.getClassName(e,t),disabled:n},i.a.createElement("div",{className:r,onClick:n?null:this.previewMap.bind(this,e)},e.name),i.a.createElement("div",null,e.orginEpsgCode||e.coordinate),i.a.createElement("div",{className:"service-tips",title:e.tip},e.tip)))}}),this),a}},{key:"previewMap",value:function(e,t){if(t.stopPropagation(),t.nativeEvent.stopImmediatePropagation(),e.available){this.previewModal.modalBox.showModal();var a={type:e.type,name:e.name,orginEpsgCode:"EPSG:".concat(e.orginEpsgCode||e.coordinate),url:e.url,extent:e.orginBounds,visibleScales:e.visibleScales,coordUnit:e.orginCoordUnit};["SINGLE_VECTOR_MAP","VECTOR_MAP"].includes(e.type)&&Object.assign(a,e),this.previewModal.setMapInfo(a)}}},{key:"addMap",value:function(e,t){var a=this.state.checkLists;e?a.push(t):a.splice(a.indexOf(t),1),this.setState({checkLists:a})}},{key:"showModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0;this.modalBox.showModal(),this.name=a,this.setState({datas:e,checkLists:t.slice()})}},{key:"render",value:function(){var e=this;return i.a.createElement(re.a,Y()({},this.config,{ref:function(t){e.modalBox=t}}),this.state.datas.length?i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"dataSet"},i.a.createElement(ni,{tableHeads:si,onSelected:this.addAllMaps,checked:this.state.datas&&this.state.datas.length===this.state.checkLists.length+this.disabledMaps.length},i.a.createElement(se.b,{checkLists:[].concat(this.state.checkLists),onChange:this.addMap},this.getTableBody()))),i.a.createElement(ri,{ref:function(t){e.previewModal=t}})):i.a.createElement("div",{className:"available-service-datasets"},i.a.createElement(ai,{tip:this.state.datas?DataViz.Language.noDatas:DataViz.Language.someDataRequestedFailed})))}}]),t}(n.Component),li=window.DataViz.Language,ci=[{title:li.serviceName,type:"checkbox",className:"name"},{title:li.dataSource,className:"type"},{title:li.updataTime,className:"updateTime"}],ui=function(e){function t(e){var a;f()(this,t),a=v()(this,b()(t).call(this,e));var n=e.publicInfo,i=n.dataInfs[n.currentPage];return a.state=Ca()({isLoading:!0},i),a.previewMap=a.previewMap.bind(O()(a)),a.changeServiceChecked=a.changeServiceChecked.bind(O()(a)),a.selectedServices=a.selectedServices.bind(O()(a)),a.selectAllSources=a.selectAllSources.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentDidMount",value:function(){var e=this.props.baseLayerEpsgcode,t=de.a.getBaseLayerProj();e&&e===t||this.props.updatePublicInfo()}},{key:"componentWillReceiveProps",value:function(e){var t=e.publicInfo,a=t.dataInfs[t.currentPage];a&&this.setState(Ca()({},a,{isLoading:!1}))}},{key:"getServices",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this;if(this.props.publicInfo.dataInfs[e]){var a=this.props.publicInfo.dataInfs[e];t.props.updatePublicInfo(a,e)}else{var n=[];this.setState({isLoading:!0});var i={currentPage:e};Fn.getMyServiceInfo(i).then((function(a){var i,r=a.total,s=a.services,o=[];s.forEach((function(e){e.available?["MAP","SINGLE_MAP"].includes(e.type)&&e.mapInfos.length>0?e.mapInfos.forEach((function(t){i=Fn.getMapInfo(t.mapUrl,e.serviceName,e.type).then((function(t){t?(e.datas||(e.datas=[]),t.serviceId=e.id,["SINGLE_MAP"].includes(e.type)&&e.available&&(e.available=t.available,e.tip=t.tip),e.datas.push(t)):(e.available=!1,e.tip=li.getDataServiceFaild)})),o.push(i)})):["SINGLE_VECTOR_MAP","VECTOR_MAP"].includes(e.type)?(e.datas||(e.datas=[]),e.mapInfos.map((function(t){var a={name:t.mapTitle,dataSource:{url:t.mapUrl,type:"EXTERNAL"},layerType:"MAPBOXSTYLE",serviceId:t.serviceId};i=Un.a.getMapboxStyleLayer(a).then((function(t){var n=t.bounds,i=t.coordUnit,r=t.styles&&t.styles.metadata&&t.styles.metadata.indexbounds,s=Un.a.createVisibleResolution(t.visibleScales,r,n,i),o=Fn.availableRestjsrMap(t.epsgCode,s);a.available=o.available,a.tip=o.tip,a.type=e.type,a.coordinate=t.epsgCode,Object.assign(a,t),["SINGLE_VECTOR_MAP"].includes(e.type)&&e.available&&(e.available=a.available,e.tip=a.tip),e.datas.push(a)})).catch((function(e){K.a.showMessage("".concat(li.sendRequest," ").concat(t.mapTitle," ").concat(li.faild),q.j.ERROR,3e3),a.available=!1,a.tip=li.getDataServiceFaild})),o.push(i)}))):"DATA"===e.type?(i=Fn.getDataInfos(e.linkPage,e.id,e.serviceName,e.type).then((function(t){if(!t)throw"error";e.datas=t})).catch((function(){e.available=!1,e.tip=li.getDataServiceFaild})),o.push(i)):["DATASET"].includes(e.type)&&(i=Fn.getDatasetsInfo(e.linkPage,e.id,e.type).then((function(t){e.datas=[t],e.available&&(e.available=t.available,e.tip=t.tip)})).catch((function(t){e.available=!1,e.tip=li.getDataServiceFaild})),o.push(i)):K.a.showMessage("".concat(li.sendRequest," ").concat(e.serviceName," ").concat(li.faild),q.j.ERROR,3e3),n.push(e)})),Promise.all(o).then((function(){var a=t.collectionCount(n);t.props.updatePublicInfo({datas:n,datasetsCount:a,selectedDatas:{},selectedCount:0},e,r)}))})).catch((function(e){e.checkReLogin&&K.a.showLoinBox({onSucceed:t.getServices.bind(t)}),t.setState({isLoading:!1,datas:[]})}))}}},{key:"collectionCount",value:function(e){var t=0;return e.length>0&&e.forEach((function(e){e.datas&&e.datas.forEach((function(e){e.available&&t++}))})),t}},{key:"getClassName",value:function(e,t){var a="",n=this.state.selectedDatas[t]&&this.state.selectedDatas[t].length;return e.available?n&&(a="active"):a="un-available",a}},{key:"onClickServiceName",value:function(e,t,a){a.stopPropagation(),a.nativeEvent&&a.nativeEvent.stopImmediatePropagation(),e.available&&(["VECTOR_MAP","DATA","MAP"].includes(e.type)?this.dataSetModal.showModal(e.datas,this.state.selectedDatas[t],t):e.datas&&1===e.datas.length&&this.previewMap(e.datas[0],a))}},{key:"previewMap",value:function(e){var t={type:e.type,name:e.name,orginEpsgCode:"EPSG:".concat(e.orginEpsgCode||e.coordinate),url:e.url,extent:e.orginBounds,visibleScales:e.visibleScales,coordUnit:e.orginCoordUnit};["SINGLE_VECTOR_MAP","VECTOR_MAP"].includes(e.type)&&Object.assign(t,e),this.previewModal.modalBox.showModal(),this.previewModal.setMapInfo(t)}},{key:"getTableBody",value:function(){var e=this;if(0!==this.state.datas.length){var t=[];return this.state.datas.forEach((function(a,n){var r="".concat(a.serviceName,"_").concat(n);t.push(i.a.createElement(se.a,{name:r,key:n,className:e.getClassName(a,n),disabled:!a.available,onChange:e.checkService},i.a.createElement("div",{className:"service-name",onClick:e.onClickServiceName.bind(e,a,r),title:a.serviceName},a.serviceName),i.a.createElement("div",{className:"service-type",title:a.tip},a.type),i.a.createElement("div",{className:"service-updateTime",title:a.updateTime},a.relativeTime)))}),this),t}}},{key:"changeSelectDatas",value:function(e,t){if(e){var a=this.props.publicInfo,n=a.dataInfs[a.currentPage];e.length?n.selectedDatas[t]=e:delete n.selectedDatas[t];var i=this.getSelectedDsts(n.selectedDatas);n.selectedCount=i.selectedCount,this.props.updatePublicInfo(n),this.props.onSourceLoad(i.allDsts,"aval")}}},{key:"getSelectedDsts",value:function(e){var t=[],a=0,n=this.state.datas,i=function(i){var r=e[i],s=n[Number(i.substring(i.lastIndexOf("_"))[1])];s=s&&s.datas?s.datas:[],a+=r.length||0,r.forEach((function(e){var a=s.find((function(t){return t.name===e}));a&&t.push(Object.assign({},a))}))};for(var r in e)i(r);return{selectedCount:a,allDsts:t}}},{key:"selectAllSources",value:function(e){var t=this.props.publicInfo,a=t.dataInfs[t.currentPage];if(e){var n={};this.state.datas.forEach((function(e,t){if(e.datas){var i="".concat(e.serviceName,"_").concat(t);n[i]=[],e.datas&&e.datas.forEach((function(e){e.available&&n[i].push(e.name)})),n[i].length&&(a.selectedDatas[i]=n[i])}}))}else a&&a.selectedDatas&&(a.selectedDatas={});this.changeServiceChecked(a)}},{key:"selectedServices",value:function(e,t){var a=this.props.publicInfo,n=a.dataInfs[a.currentPage],i=Number(t.substring(t.lastIndexOf("_"))[1]),r=this.state.datas[i];if(r){var s=r.datas;if(e&&s&&s.length>0){var o={};o[t]=[],s.map((function(e){e.available&&o[t].push(e.name)})),o[t].length&&(n.selectedDatas[t]=o[t])}else n&&n.selectedDatas&&delete n.selectedDatas[t];this.changeServiceChecked(n)}}},{key:"changeServiceChecked",value:function(e){var t=this.getSelectedDsts(e.selectedDatas);e.selectedCount=t.selectedCount,this.props.updatePublicInfo(e),this.props.onSourceLoad(t.allDsts,"aval")}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,this.state.isLoading?i.a.createElement("div",{className:"loading"},i.a.createElement(ce.a,null)):this.state.datas.length?i.a.createElement("div",{className:"available-service"},i.a.createElement(ni,{tableHeads:ci,onSelected:function(t){e.selectAllSources(t.target.checked)},checked:0!==this.state.datasetsCount&&this.state.datasetsCount===this.state.selectedCount,disabled:0===this.state.datasetsCount},i.a.createElement(se.b,{checkLists:Object.keys(this.state.selectedDatas),onChange:this.selectedServices},this.getTableBody())),i.a.createElement(ri,{ref:function(t){e.previewModal=t}}),i.a.createElement(oi,{ref:function(t){e.dataSetModal=t},changeSelectDatas:this.changeSelectDatas.bind(this)})):i.a.createElement(i.a.Fragment,null,i.a.createElement(ai,{tip:li.noService}),i.a.createElement(an,{onClick:function(){e.props.updatePublicInfo()}})))}}]),t}(n.Component),di=[window.DataViz.Language.availableService],pi=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={tabIndex:0},a}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"public-service container"},i.a.createElement(ti,{menus:di,tabIndex:this.state.tabIndex,onChange:function(t){e.setState({tabIndex:t})}}),0===this.state.tabIndex?i.a.createElement(ui,{onSourceLoad:this.props.onSourceLoad,ref:function(t){e.availableService=t},transferDatas:this.props.transferDatas,publicInfo:this.props.publicInfo,updatePublicInfo:this.props.updatePublicInfo,baseLayerEpsgcode:this.props.baseLayerEpsgcode,datas:this.props.datas}):i.a.createElement("button",{className:"public-btn",onClick:function(){window.open("".concat(T.a.getIPortalUrl(),"web/mycontent/datas"))}},window.DataViz.Language.toPulicService))}}]),t}(n.Component),hi=window.DataViz.Language,fi="https://www.supermapol.com/iserver/services/map_ShiLiShuJu/rest/maps/",mi={public:[["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","LINE",hi.beijing,fi+"@"],["","LINE",hi.beijing,fi+"@"]],industry:[["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["_","POINT",hi.beijing,fi+"_@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"],["","POINT",hi.beijing,fi+"@"]],nature:[["5_19002016","POINT",hi.allCountry,fi+"5_19002016@"],["671","POINT",hi.allCountry,fi+"671@"]],administrative:[["","REGION",hi.allCountry,fi+"@"],["","REGION",hi.allCountry,fi+"@"],["_","REGION",hi.heilongjiang,fi+"_@"],["_","REGION",hi.jilin,fi+"_@"],["_","REGION",hi.liaoning,fi+"_@"],["_","REGION",hi.xinjiang,fi+"_@"],["_","REGION",hi.tibet,fi+"_@"],["_","REGION",hi.qinghai,fi+"_@"],["_","REGION",hi.yunnan,fi+"_@"],["_","REGION",hi.hainan,fi+"_@"],["_","REGION",hi.taiwan,fi+"_@"],["_","REGION",hi.guangxi,fi+"_@"],["_","REGION",hi.guangdong,fi+"_@"],["_","REGION",hi.guizhou,fi+"_@"],["_","REGION",hi.sichuan,fi+"_@"],["_","REGION",hi.chongqing,fi+"_@"],["_","REGION",hi.hunan,fi+"_@"],["_","REGION",hi.fujian,fi+"_@"],["_","REGION",hi.zhejiang,fi+"_@"],["_","REGION",hi.shanghai,fi+"_@"],["_","REGION",hi.jiangxi,fi+"_@"],["_","REGION",hi.hubei,fi+"_@"],["_","REGION",hi.anhui,fi+"_@"],["_","REGION",hi.jiangsu,fi+"_@"],["_","REGION",hi.shandong,fi+"_@"],["_","REGION",hi.henan,fi+"_@"],["_","REGION",hi.shanxi,fi+"_@"],["_","REGION",hi.shaanxi,fi+"_@"],["_","REGION",hi.gansu,fi+"_@"],["_","REGION",hi.ningxia,fi+"_@"],["_","REGION",hi.beijing,fi+"_@"],["_","REGION",hi.tianjin,fi+"_@"],["_","REGION",hi.hebei,fi+"_@"],["_","REGION",hi.innerMongolia,fi+"_@"]]},yi=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isActive:!1},a.updateState=a.updateState.bind(O()(a)),a.onClick=a.onClick.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"updateState",value:function(){this.setState({isActive:!0})}},{key:"onClick",value:function(){this.updateState(),this.props.onClick(this.props.index)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:this.props.isSelected?"active sample-data":"sample-data",onMouseOver:this.updateState,onMouseOut:function(){e.setState({isActive:!1})},onClick:this.onClick},i.a.createElement("span",{className:this.props.iconName}),i.a.createElement("div",null,this.props.name),i.a.createElement("div",null,this.props.city),i.a.createElement("span",{className:"supermapol-icons-preview",title:window.DataViz.Language.preview,style:{display:this.state.isActive||this.props.isSelected?"inline-block":"none"},onClick:function(){e.props.previewMap(e.props.index)}}))}}]),t}(n.Component),gi=[window.DataViz.Language.publicData,window.DataViz.Language.industryData,window.DataViz.Language.natureData,window.DataViz.Language.administrativeData],vi=["","","",""],Si=[{title:window.DataViz.Language.type},{title:window.DataViz.Language.name},{title:window.DataViz.Language.position},{title:window.DataViz.Language.preview}],bi=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={tabIndex:0,hoverIndex:null,seletedIndex:null},a.datas=[],a.onClick=a.onClick.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"onClick",value:function(e){this.setState({seletedIndex:e});var t=this.datas[e],a={featureType:q.e[t[1]],epsgCode:de.a.getBaseLayerProj(),orginEpsgCode:"EPSG:3857",layerType:"VECTOR",name:t[0]+"@"+this.getDatasourceName(),url:t[3],visible:!0};this.props.onSourceLoad(),this.props.onSourceLoad(a,!0)}},{key:"getDatasourceName",value:function(){return 3===this.state.tabIndex?vi[0]:vi[this.state.tabIndex]}},{key:"previewMap",value:function(e){var t={orginEpsgCode:"EPSG:3857",url:this.datas[e][3]};this.props.previewMap(t)}},{key:"getContainer",value:function(e){var t=[];return this.datas=e,e.forEach((function(e,a){t.push(i.a.createElement(yi,{key:a,isSelected:this.state.seletedIndex===a,iconName:this.getIconClassName(e[1]),name:e[0],city:e[2],index:a,onClick:this.onClick,previewMap:this.previewMap.bind(this)}))}),this),t}},{key:"getIconClassName",value:function(e){var t;switch(e){case"POINT":t="supermapol-icons-point-layer1";break;case"LINE":t="supermapol-icons-line-layer1";break;default:t="supermapol-icons-polygon-layer1"}return t}},{key:"render",value:function(){var e,t=this;switch(this.state.tabIndex){case 0:e=mi.public;break;case 1:e=mi.industry;break;case 2:e=mi.nature;break;default:e=mi.administrative}return i.a.createElement("div",{className:"sample-services container"},i.a.createElement(ti,{menus:gi,tabIndex:this.state.tabIndex,onChange:function(e){t.setState({tabIndex:e,seletedIndex:null}),t.props.onSourceLoad()}}),i.a.createElement(ni,{tableHeads:Si},this.getContainer(e)))}}]),t}(n.Component),Ii=(a(1716),{MY_PUBLIC_SERVICE:window.DataViz.Language.myPublicService,SAMPLE_SERVICE:window.DataViz.Language.sampleService}),Ei=function(e){function t(e){var a;f()(this,t),a=v()(this,b()(t).call(this,e));var n=O()(a);return a.state={tabIndex:0,loaded:!1,publicInfo:{dataInfs:{},total:0,currentPage:1},baseLayerEpsgcode:null},a.onSourceLoad=a.onSourceLoad.bind(O()(a)),a.updatePublicInfo=a.updatePublicInfo.bind(O()(a)),a.sources=[],a.config={modalWidth:"820px",modalHeight:"405px",modalTitle:window.DataViz.Language.addFromSearch,okButton:window.DataViz.Language.add,cancelButton:window.DataViz.Language.closeButton,okCallBack:function(){T.a.checkReLogin().then((function(){K.a.showMessage(DataViz.Language.loading,q.j.WARNING,5e4),n.addLayerFromSearch()})).catch((function(){K.a.showLoinBox({onSucceed:n.updatePublicInfo.bind(n)})}))},cancelCallBack:function(){n.toInitState(),n.modalBox.hideModal()},closeBtnCallBack:function(){n.toInitState()},afterOpenModal:function(){n.setState({checkListsTemp:[]})}},a}return E()(t,e),y()(t,[{key:"addLayerFromSearch",value:function(){var e=this,t=[];0!==e.sources.length&&(t=e.sources),e.sourceLength=t.length,e.sourceAdded=0,e.sourceError=0,t.forEach((function(t,a){t.url=T.a.handleInputUrl(t.url),t.id=t.id||(new Date).getTime()+a,"VECTOR"===t.layerType&&"DATA"!==t.type&&"DATASET"!==t.type?e.getFields(t):"DATA"===t.type||"DATASET"===t.type?e.checkServiceState(t.serviceId).then((function(a){a&&e.addRestData(t)})):["VECTOR_MAP","SINGLE_VECTOR_MAP"].includes(t.type)?e.checkServiceState(t.serviceId).then((function(a){if(a){var n={extent:t.extent,layerType:t.layerType,bounds:t.bounds,name:t.name,id:t.id,projection:t.projection,styles:t.styles,url:t.url,dataSource:t.dataSource,coordUnit:t.coordUnit,visibleScales:t.visibleScales,scale:t.scale,visible:!0,serviceId:t.serviceId};e.props.addFromSearch.addVectorTileLayer(n),K.a.changeMessage(++e.sourceAdded,e.sourceLength,e.sourceError)}})).catch((function(e){})):e.checkServiceState(t.serviceId).then(function(){var a=p()(u.a.mark((function a(n){var i,r,s,o,l,c,d,p;return u.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,T.a.getSublayers(t.url);case 4:i=a.sent,r=t.bounds,s=t.coordinate,o=t.url,l=t.format,c=t.visibleScales,d=t.coordUnit,p={extent:r,layerType:"TILE",name:t.name,id:t.id,projection:"EPSG:".concat(s),url:o,visible:!0,format:l,subLayers:i,visibleScales:c,coordUnit:d},e.props.addFromSearch.addRestMapOverLayer(p,p.id),K.a.changeMessage(++e.sourceAdded,e.sourceLength,e.sourceError);case 9:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()),e.modalBox.hideModal()})),e.toInitState()}},{key:"checkServiceState",value:function(e){return T.a.doFetch("".concat(T.a.getIPortalUrl(),"web/services/").concat(e,".json"),{method:"GET",withCredentials:!0}).then((function(e){return!e.error||(K.a.showMessage(DataViz.Language.serviceDeleted,q.j.WARNING),!1)}))}},{key:"addRestData",value:function(e){var t=this,a=e.url.slice(0,e.url.indexOf("/datasources")),n=e.url.slice(e.url.indexOf("/datasources")+13,e.url.indexOf("/datasets"))+":"+e.name;T.a.getFeatureBySQL(a,[n],(function(i){var r=i.result.features.features,s=e.coordinate?"EPSG:".concat(e.coordinate):tn.a.getGeoJsonEpsgCode(r[0]);e.dataTypes=t.getDataTypes(r[0].properties);var o=tn.a.getFeatureType(e.featureType),l={id:(new Date).getTime(),projection:s,originData:r,layerType:"VECTOR",featureType:o,visible:!0,name:e.name,dataTypes:e.dataTypes,dataSource:{type:"REST_DATA",url:a,dataSourceName:n}},c={features:ie.a.parseData2Feature({allDatas:{features:r},fileCode:s},"JSON"),layerInfo:l,selectedLayerId:l.id};de.a.addProjection(l.projection).then((function(){t.props.addFromSearch.addFromRestData(c),K.a.changeMessage(++t.sourceAdded,t.sourceLength,t.sourceError)})).catch((function(e){}))}),(function(){++t.sourceError,K.a.changeMessage(++t.sourceAdded,t.sourceLength,t.sourceError)}))}},{key:"getDataTypes",value:function(e){var t=[],a=[];for(var n in e)t.push(n),a.push(e[n]);return T.a.getFieldType(t,a)}},{key:"getFields",value:function(e){var t=this;T.a.queryFeatureBySQL(e.url,e.name,"smid=1",null,null,(function(a){var n=a&&a.result.recordsets,i=n&&n[0];if(i&&i.fields){var r=i.fields,s=[];for(var o in r){var l=r[o];0===l.indexOf("Sm")&&"SmID"!==l||s.push(l)}t.getFeatures(e,s)}}),(function(){++t.sourceError,K.a.changeMessage(++t.sourceAdded,t.sourceLength,t.sourceError)}))}},{key:"getFeatures",value:function(e,t){var a=this,n=e.orginEpsgCode;T.a.queryFeatureBySQL(e.url,e.name,null,t,null,(function(t){var i=t.result.recordsets[0],r=i.features.features;e.dataTypes=T.a.getFieldType(i.fields,a.getAttributeValue(r[0].properties)),e.dataSourseName=e.name,e.serviceType="MAP",e.name=e.name.split("@")[0];var s={id:e.id,projection:n,layerType:e.layerType,featureType:e.featureType,visible:!0,name:e.name,dataTypes:e.dataTypes,type:"FEATURE",dataSource:{type:"REST_MAP",url:e.url,layerName:e.dataSourseName}},o={features:ie.a.parseData2Feature({allDatas:{features:r},projection:n},"JSON"),layerInfo:s,selectedLayerId:s.id};a.props.addFromSearch.addFromRestData(o),K.a.changeMessage(++a.sourceAdded,a.sourceLength,a.sourceError)}),(function(){++a.sourceError,K.a.changeMessage(++a.sourceAdded,a.sourceLength,a.sourceError)}))}},{key:"getAttributeValue",value:function(e){var t=[];for(var a in e)t.push(e[a]);return t}},{key:"toInitState",value:function(){this.sources=[];var e=this.state.publicInfo;for(var t in e.currentPage=1,e.dataInfs)e.dataInfs[t].selectedDatas={},e.dataInfs[t].selectedCount=0;this.setState({publicInfo:e})}},{key:"onSourceLoad",value:function(e,t){"aval"===t?this.sources=e:(e?t?(this.sources.push(e),this.setState({loaded:!0})):this.sources.forEach((function(t,a){t.url===e.url&&this.sources.splice(a,1)}),this):this.sources=[],0===this.sources.length&&this.setState({loaded:!1}))}},{key:"previewMap",value:function(e){this.previewModal.modalBox.showModal(),this.previewModal.setMapInfo(e)}},{key:"updatePublicInfo",value:function(e,t,a){if(0===arguments.length)this.refreshDatas();else{var n=this.state.publicInfo;a&&(n.total=a),t=t||n.currentPage,n.currentPage=t,n.dataInfs[t]=e,this.setState({publicInfo:n,loaded:e.selectedCount>0})}}},{key:"getContainer",value:function(){var e,t=this;switch(this.menusIds[this.state.tabIndex]){case"SAMPLE_SERVICE":this.state.checkListsTemp=[],e=i.a.createElement(bi,{onSourceLoad:this.onSourceLoad,previewMap:this.previewMap.bind(this)});break;case"MY_PUBLIC_SERVICE":e=i.a.createElement(pi,{onSourceLoad:this.onSourceLoad,ref:function(e){t.publicService=e},publicInfo:this.state.publicInfo,updatePublicInfo:this.updatePublicInfo,baseLayerEpsgcode:this.state.baseLayerEpsgcode});break;default:e=null}return e}},{key:"refreshDatas",value:function(){var e=this;this.setState({baseLayerEpsgcode:de.a.getBaseLayerProj(),publicInfo:{total:0,currentPage:1,dataInfs:{}},loaded:!1},(function(){e.publicService.availableService.getServices()}))}},{key:"getMenus",value:function(){var e=this.props.childrens;this.menus=[],this.menusIds=[],e.forEach((function(e){var t=e.isCheck,a=e.id,n=Ii[e.id];t&&n&&(this.menus.push(n),this.menusIds.push(a))}),this)}},{key:"render",value:function(){var e=this,t=this;return this.getMenus(),this.menusIds.length&&"MY_PUBLIC_SERVICE"===this.menusIds[this.state.tabIndex]?this.config.paginationConfig={currentPage:t.state.publicInfo.currentPage,total:t.state.publicInfo.total,pageSize:10,className:"add-from-search-pagination",onPageChange:function(e){t.state.publicInfo.currentPage=e,t.setState({publicInfo:t.state.publicInfo}),t.publicService.availableService.getServices(e)}}:delete this.config.paginationConfig,this.config.headerChild="MY_PUBLIC_SERVICE"===this.menusIds[this.state.tabIndex]&&this.state.publicInfo&&this.state.publicInfo.total>0&&this.publicService&&i.a.createElement(an,{onClick:function(){e.refreshDatas()}}),i.a.createElement(re.a,Y()({},this.config,{ref:function(t){e.modalBox=t},disableConfirm:!this.state.loaded}),i.a.createElement("div",{className:"add-from-search"},i.a.createElement(ti,{menus:this.menus,tabIndex:this.state.tabIndex,onChange:function(t){e.setState({tabIndex:t})}}),this.getContainer()),i.a.createElement(ri,{ref:function(t){e.previewModal=t}}))}}]),t}(n.Component),Ti=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getModal",value:function(){var e=this,t=null,a=null,n=null;switch(this.props.type){case"FILE_ADD":t=i.a.createElement(Bn,{addFromFile:this.props.addFromFile,ref:function(t){e.modal=t}}),a=DataViz.Language.addByFile,n=this.onAddBtnClick.bind(this);break;case"SEARCH_ADD":t=i.a.createElement(Ei,{addFromSearch:this.props.addFromSearch,childrens:this.props.childrens,ref:function(t){e.modal=t}}),a=DataViz.Language.addFromSearch,n=this.onAddBtnClick.bind(this);break;case"ADD_MARKER_LAYER":a=DataViz.Language.createMarkerLayer,n=this.onAddMarkerLayerBtnClick.bind(this);break;case"WEB_ADD":a=DataViz.Language.addByWeb,t=i.a.createElement(ei,{addFromWeb:this.props.addFromWeb,childrens:this.props.childrens,ref:function(t){e.modal=t}}),n=this.onAddBtnClick.bind(this)}return{modal:t,name:a,onClick:n}}},{key:"onAddBtnClick",value:function(){this.modal.modalBox.showModal(),this.props.hideItemLists()}},{key:"onAddMarkerLayerBtnClick",value:function(){this.props.addMarkerLayer({layerType:q.r.MARKER,id:(new Date).getTime(),name:window.DataViz.Language.defaultMarkerLayer+(de.a.markerLayers.length+1),visible:!0}),this.props.hideItemLists()}},{key:"render",value:function(){var e=this.getModal(),t=e.modal,a=e.name,n=e.onClick;return i.a.createElement("div",{className:"add-layer-list-item"},i.a.createElement("span",{onMouseDown:n},a),t)}}]),t}(n.Component),Ci=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={showList:!1},a}return E()(t,e),y()(t,[{key:"getConfig",value:function(){for(var e=Ka.a.dataVizConfig.layerLists,t=[],a=0;a<e.length;a++)e[a].isCheck&&t.push(i.a.createElement(Ti,{key:a,addFromWeb:"WEB_ADD"===e[a].id?this.props.addFromWeb:"",addFromFile:"FILE_ADD"===e[a].id?this.props.addFromFile:"",addFromSearch:"SEARCH_ADD"===e[a].id?this.props.addFromSearch:"",type:e[a].id,childrens:e[a].children,addMarkerLayer:"ADD_MARKER_LAYER"===e[a].id?this.props.addMarkerLayer:"",selectedLayer:this.props.selectedLayer,hideItemLists:this.modifyState.bind(this,!1)}));return t}},{key:"modifyState",value:function(e){this.setState({showList:e})}},{key:"render",value:function(){return i.a.createElement("div",{onBlur:this.modifyState.bind(this,!1),tabIndex:"-1",className:"add-layer-container "+(this.state.showList?"active":"")},i.a.createElement("div",{className:"add-layer-tag",onClick:this.modifyState.bind(this,!this.state.showList)},i.a.createElement("span",{className:"supermapol-icons-add"}),i.a.createElement("span",null,DataViz.Language.addLayer)),i.a.createElement("div",{className:"add-layer-list",style:{display:this.state.showList?"block":"none"}},this.getConfig()))}}]),t}(n.Component),Li=(a(673),a(335)),Ni=a.n(Li),ki=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={selectIndex:0},a.menus=a.props.menus,a}return E()(t,e),y()(t,[{key:"getMeuns",value:function(){var e=this,t=null,a=[];return this.menus.forEach((function(n,r){t=i.a.createElement("li",{key:r,className:r===e.state.selectIndex?"attr-menu-item active":"attr-menu-item"},i.a.createElement("a",null,n)),a.push(t)})),a}},{key:"render",value:function(){return i.a.createElement("div",{className:"attr-menu"},this.getMeuns())}}]),t}(n.Component),Oi=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isEnable:e.isEnable,caption:e.captions[e.field]||e.field,isEdit:!1},a}return E()(t,e),y()(t,[{key:"setCaption",value:function(e,t){this.setState({caption:t,isEdit:!1}),this.props.setCaption(e,t)}},{key:"render",value:function(){var e=this,t="NUMBER"===this.props.type?DataViz.Language.isNumber:DataViz.Language.isText,a={itemClass:"item enable",toggleClass:"item-enable"};return this.state.isEnable||(a={itemClass:"item",toggleClass:"item-disable supermapol-icons-invisible"}),i.a.createElement("div",{className:a.itemClass},i.a.createElement("span",{className:"item-field"},this.props.field),i.a.createElement(w,{disabled:!this.state.isEnable,className:"item-field",value:this.state.caption,onBlur:function(t){e.setCaption(e.props.field,t)},tipValue:this.props.field,trigger:"trigger",isEdit:this.state.isEdit}),i.a.createElement("span",{className:"item-enable supermapol-icons-user-defined",onClick:function(t){e.setState({isEdit:!0}),t&&t.stopPropagation()}}),i.a.createElement("span",{className:"item-type"},t),i.a.createElement("i",{className:a.toggleClass}))}}]),t}(n.Component),Di=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getContentUI",value:function(){var e=null,t=[],a=0;for(var n in this.props.dataTypes){var r=!(this.props.enableFields.indexOf(n)<0);e=i.a.createElement(Oi,{key:a,field:n,type:this.props.dataTypes[n],isEnable:r,captions:this.props.captions,setCaption:this.props.setCaption,changeEnableFields:this.props.changeEnableFields}),"dataviz_featureID"!==n&&t.push(e),a++}return t}},{key:"render",value:function(){return i.a.createElement("div",{className:"field-container"},i.a.createElement("div",{className:"field-container-title"},i.a.createElement("span",{className:"title-name"},DataViz.Language.name),i.a.createElement("span",{className:"title-name"},DataViz.Language.fieldCaption),i.a.createElement("span",{className:"title-type"},DataViz.Language.type),i.a.createElement("span",{className:"title-enable"},DataViz.Language.showOrHide,i.a.createElement(C.a,{iconClassName:"supermapol-icons-question-circle",trigger:"click",placement:"right",tooltip:DataViz.Language.setFieldShowOrHideTip,overlayClassName:this.props.tooltipClassName}))),i.a.createElement("div",{className:"field-container-content"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},this.getContentUI())))}}]),t}(n.Component),wi=(a(1717),a(192)),Ai=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={selectIndex:0},a.menus=[DataViz.Language.field],a.enableFields=[],a.captions={},a.setCaption=a.setCaption.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"showModal",value:function(){this.refs.attributeModal.showModal()}},{key:"setCaption",value:function(e,t){this.captions||(this.captions={}),this.captions[e]=t}},{key:"getContentUI",value:function(){var e=null,t=de.a.getVectorLayerById(this.props.layerID),a={};switch(t&&t.layerInfo&&(a=t.layerInfo.dataSource&&t.layerInfo.dataSource.dataTypes||t.layerInfo.dataTypes,this.enableFields=t.layerInfo.enableFields,this.captions=t.layerInfo.captions||{}),this.state.selectIndex){case 0:e=i.a.createElement(Di,{layerID:this.props.layerID,dataTypes:a,enableFields:this.enableFields,captions:this.captions,setCaption:this.setCaption,changeEnableFields:this.changeEnableFields.bind(this)});break;default:e=null}return e}},{key:"changeEnableFields",value:function(e){var t=this.enableFields.indexOf(e);t<0?this.enableFields.push(e):this.enableFields.splice(t,1)}},{key:"saveDisableFields",value:function(){var e=this,t=de.a.getVectorLayerById(this.props.layerID).layerInfo;t.enableFields=this.enableFields,t.captions=this.captions,this.refs.attributeModal.hideModal(),0!==this.props.showATLayerID&&this.props.showAttributeTable(this.props.layerID);var a=de.a.getOnlySelectedFeature();if(a){if(!a.get("attributes"))return;var n=ie.a.getEditFeatureInfo(this.props.layerID,a);wi.a.showThemePop(a,null,this.enableFields,this.captions,n,(function(){e.props.showAttributeTable(e.props.layerID)}),this.props.layerID)}}},{key:"render",value:function(){return i.a.createElement(re.a,{ref:"attributeModal",modalWidth:"770px",modalHeight:"300px",modalTitle:DataViz.Language.layerArribute,cancelButton:DataViz.Language.closeButton,okCallBack:this.saveDisableFields.bind(this)},i.a.createElement(ki,{menus:this.menus}),this.getContentUI())}}]),t}(n.Component),Fi=(a(627),a(81)),Mi=a.n(Fi),Ri=a(107),xi=(a(677),a(1719),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={visible:!1},a.onSelect=a.onSelect.bind(O()(a)),a.changeVisible=a.changeVisible.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"onSelect",value:function(e){this.props.onSelect&&this.props.onSelect(e),this.changeVisible(!1)}},{key:"getItems",value:function(e){var t=this;return e&&e.map((function(e,a){return i.a.createElement("div",{key:e+a,onClick:t.onSelect.bind(t,a)},e)}))}},{key:"changeVisible",value:function(e){this.setState({visible:e})}},{key:"render",value:function(){var e=this.props,t=e.options,a=e.text,n=void 0===a?"":a;return i.a.createElement(ge.l,{overlayClassName:"dv-add-type",overlay:this.getItems(t),placement:"bottom",align:{offset:[24,0]},onVisibleChange:this.changeVisible,visible:this.state.visible},i.a.createElement(ge.b,{type:"empty",theme:"primary",size:"small",onClick:this.changeVisible.bind(this,!0)}," ",n," "))}}]),t}(n.Component)),Pi=(a(1720),DataViz.Language),Vi=[Pi.isText,Pi.media,Pi.field],Bi=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={selectIndex:0},a.getMenus=a.getMenus.bind(O()(a)),a.addMenu=a.addMenu.bind(O()(a)),a.scrollbarsRef=i.a.createRef(),a}return E()(t,e),y()(t,[{key:"componentDidMount",value:function(){var e=this;Ri.a.createSortable(".dv-tab-menu-editor .dv-tab-menu-items",(function(t,a){e.props.changeMenuIndex(t,a)}))}},{key:"addMenu",value:function(e){this.props.addMenu(e)}},{key:"changeMenuIndex",value:function(e,t){this.props.changeMenuIndex(e,t),this.changeSelectedMenu(t)}},{key:"changeSelectedMenu",value:function(e){this.props.changeSelectedMenu(e),this.setState({selectIndex:e})}},{key:"deleteMenu",value:function(e){this.props.deleteMenu(e)}},{key:"componentDidUpdate",value:function(){this.props.menus&&this.state.selectIndex===this.props.menus.length-1&&this.scrollbarsRef&&this.scrollbarsRef.current&&this.scrollbarsRef.current.scrollToBottom()}},{key:"getMenus",value:function(e){if(!e)return"";var t=this;return e.map((function(e,a){var n="dv-tab-menu-item "+(a===t.state.selectIndex?"dv-active":"");return i.a.createElement("div",{key:e+a,onClick:t.changeSelectedMenu.bind(t,a),className:n},i.a.createElement(C.a,{needPropagation:!0,iconClassName:"supermapol-icons-adjust-order handle"},e),i.a.createElement(C.a,{iconClassName:"supermapol-icons-delete",onClick:t.deleteMenu.bind(t,a)}))}))}},{key:"render",value:function(){return i.a.createElement("div",{className:"dv-tab-menu-editor"},i.a.createElement(xi,{options:Vi,text:Pi.addContent,onSelect:this.addMenu}),i.a.createElement("div",{className:"dv-tab-menus"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars",autoHide:!0,ref:this.scrollbarsRef,renderTrackHorizontal:function(e){return i.a.createElement("div",Y()({},e,{style:{display:"none"},className:"track-horizontal"}))}},i.a.createElement("div",{className:"dv-tab-menu-items"},this.getMenus(this.props.menus)))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return void 0!==e.selectIndex&&e.selectIndex!==t.selectIndex?{selectIndex:e.selectIndex}:null}}]),t}(n.Component),Ui=(a(625),a(1611),DataViz.Language),Gi=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={allFields:null},a.changeSelectedFields=a.changeSelectedFields.bind(O()(a)),a.selectAllFields=a.selectAllFields.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"selectAllFields",value:function(){var e=[];this.props.fields.length===this.props.selectedFields.length||(e=this.props.fields),this.props.changeSelectedFields(e)}},{key:"changeSelectedFields",value:function(e){var t=this.props.selectedFields,a=[];a=t.includes(e)?t.filter((function(t){return t!==e})):[].concat(Mi()(t),[e]),this.props.changeSelectedFields(a)}},{key:"componentDidMount",value:function(){var e=this;Ri.a.createSortable(".dv-panel-items",(function(t,a){e.props.changeFieldsIndex(t,a)}))}},{key:"getFieldsItems",value:function(e,t){if(e){var a=this;return e.map((function(e,n){var r=t.includes(e),s=r?" checked":"";return i.a.createElement("div",{className:"dv-panel-item "+s,key:e+n},i.a.createElement(C.a,{iconClassName:"supermapol-icons-adjust-order handle"},i.a.createElement("div",null,e)),i.a.createElement(se.a,{onChange:a.changeSelectedFields.bind(a,e),checked:r}))}))}}},{key:"render",value:function(){var e=this.props,t=e.defaultSelectedFields,a=e.selectedFields,n=this.state.allFields;return a||(a=t),i.a.createElement("div",{className:"dv-popup-config-panel"},i.a.createElement("div",{className:"dv-panel-title"},i.a.createElement("div",null,Ui.name),i.a.createElement(se.a,{name:"selectAll",onChange:this.selectAllFields,checked:n.length===a.length},Ui.showHide)),i.a.createElement(ge.d,null),i.a.createElement("div",{className:"dv-popup-panel-content"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars",autoHide:!0,renderTrackHorizontal:function(e){return i.a.createElement("div",Y()({},e,{style:{display:"none"},className:"track-horizontal"}))}},i.a.createElement("div",{className:"dv-panel-items"},this.getFieldsItems(n,a)))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.fields?{allFields:e.fields}:null}}]),t}(n.Component),_i=(a(1721),DataViz.Language),zi=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isShow:!1,title:"",value:"",type:"IMAGE",selectedIndex:-1},a.formatRef=i.a.createRef(""),a.okCallBack=a.okCallBack.bind(O()(a)),a.changeSelectedValue=a.changeSelectedValue.bind(O()(a)),a.changeSelectedTitle=a.changeSelectedTitle.bind(O()(a)),a.changeMediaType=a.changeMediaType.bind(O()(a)),a.closeBtnCallBack=a.closeBtnCallBack.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"okCallBack",value:function(){var e=this.state,t=e.title,a=void 0===t?"":t,n=e.value,i=void 0===n?"":n,r=e.type,s=this.props.fields,o=void 0===s?[]:s;a&&i?(a=ge.f.convertValueToSave(o,a),i=ge.f.convertValueToSave(o,i),this.props.okCallBack({title:a,value:i,type:r}),this.closeBtnCallBack()):K.a.showMessage(_i.titleValueNotNull,q.j.WARNING)}},{key:"closeBtnCallBack",value:function(){this.props.colseInfoModal(),this.setState({isShow:!1,title:"",value:"",type:"IMAGE",selectedIndex:-1})}},{key:"changeMediaType",value:function(e){this.setState({type:e})}},{key:"changeSelectedTitle",value:function(e){this.setState({title:"".concat(e)})}},{key:"changeSelectedValue",value:function(e){this.setState({value:"".concat(e)})}},{key:"render",value:function(){var e=this.props.fields,t=void 0===e?[]:e;return i.a.createElement(re.a,{modalWidth:"308px",modalHeight:"90px",modalIsOpen:this.state.isShow,modalTitle:this.props.modalTitle||_i.mediaInfo,cancelButton:DataViz.Language.closeButton,okCallBack:this.okCallBack.bind(this),closeBtnCallBack:this.closeBtnCallBack,cancelCallBack:this.closeBtnCallBack},i.a.createElement("div",{className:"dv-media-info-item"},i.a.createElement("span",{className:"dv-media-info-title"},_i.type),i.a.createElement(Ke.b,{onChange:this.changeMediaType,selectedValue:this.state.type},i.a.createElement(Ke.a,{value:"IMAGE"},_i.symbolImage),i.a.createElement(Ke.a,{value:"VIDEO"},_i.video))),i.a.createElement("div",{className:"dv-media-info-item"},i.a.createElement("span",{className:"dv-media-info-title"},_i.title),i.a.createElement(ge.g,{defaultValue:this.state.title,fields:t,format:this.formatRef.current,placeholder:_i.enterTitle,onChange:this.changeSelectedTitle,autoFocus:!0})),i.a.createElement("div",{className:"dv-media-info-item"},i.a.createElement("span",{className:"dv-media-info-title"},_i.URL),i.a.createElement(ge.g,{defaultValue:this.state.value,fields:t,format:this.formatRef.current,placeholder:_i.enterUrl,onChange:this.changeSelectedValue,autoFocus:!0})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a=e.mediaInfo,n=void 0===a?{}:a,i=t.title||ge.f.getUIStringValue(n.title),r=t.value||ge.f.getUIStringValue(n.value);return e.selectedIndex!==t.selectedIndex&&e.modalIsOpen?{type:n.type||t.type,title:i,value:r,isShow:e.modalIsOpen,selectedIndex:e.selectedIndex}:{isShow:e.modalIsOpen}}}]),t}(n.Component),ji=DataViz.Language,Wi={IMAGE:DataViz.Language.symbolImage,VIDEO:DataViz.Language.video},Hi=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={selectedFields:[],mediaInfo:{},isShowInfoModal:!1,selectedIndex:0},a.getAddUI=a.getAddUI.bind(O()(a)),a.changeMediaInfo=a.changeMediaInfo.bind(O()(a)),a.sortable=null,a.colseInfoModal=a.colseInfoModal.bind(O()(a)),a.scrollbarsRef=i.a.createRef(),a.createSortable=a.createSortable.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"deleteMediaInfo",value:function(e){this.props.changeMediaInfo(e,null)}},{key:"showModal",value:function(e,t){var a=this.props.mediaInfos[e]||{};this.setState({mediaInfo:a,modalTitle:t,selectedIndex:e,isShowInfoModal:!0})}},{key:"changeMediaInfo",value:function(e){this.props.changeMediaInfo(this.state.selectedIndex,e),this.colseInfoModal()}},{key:"colseInfoModal",value:function(){this.setState({isShowInfoModal:!1})}},{key:"componentDidMount",value:function(){this.createSortable()}},{key:"getAddUI",value:function(e){var t=this.state,a=t.isShowInfoModal,n=t.mediaInfo,r=t.modalTitle,s=t.selectedIndex;return i.a.createElement("div",{className:"dv-add"},i.a.createElement(ge.b,{type:"empty",theme:"primary",size:"small",onClick:this.showModal.bind(this,-1,ji.mediaInfo)},ji.addMedia),i.a.createElement(zi,{modalIsOpen:a,mediaInfo:n,modalTitle:r,fields:e,colseInfoModal:this.colseInfoModal,selectedIndex:s,okCallBack:this.changeMediaInfo}))}},{key:"getMediasItems",value:function(e){var t=this;if(e)return e.map((function(e,a){if(e){var n="".concat(Wi[e.type]," ").concat(ji.information),r=ge.f.getUIStringValue(e.title);return i.a.createElement("div",{className:"dv-panel-item checked",key:e.title+a},i.a.createElement(C.a,{iconClassName:"supermapol-icons-adjust-order handle"},i.a.createElement("div",null,r)),i.a.createElement(C.a,{iconClassName:"supermapol-icons-user-defined",onClick:t.showModal.bind(t,a,n)}),i.a.createElement(C.a,{iconClassName:"supermapol-icons-delete",onClick:t.deleteMediaInfo.bind(t,a)}))}}))}},{key:"createSortable",value:function(){var e=this;this.sortable||(this.sortable=Ri.a.createSortable(".dv-panel-items",(function(t,a){e.props.changeMediaIndex(t,a)})))}},{key:"componentDidUpdate",value:function(){this.createSortable(),-1===this.state.selectedIndex&&this.scrollbarsRef&&this.scrollbarsRef.current&&this.scrollbarsRef.current.scrollToBottom()}},{key:"render",value:function(){var e=this.props,t=e.mediaInfos,a=void 0===t?[]:t,n=e.fields,r=void 0===n?[]:n;return i.a.createElement("div",{className:"dv-popup-config-panel dv-media-panel"},0===a.length?i.a.createElement(nn,{text:ji.no+ji.mediaInfo},this.getAddUI(r)):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"dv-panel-title"},i.a.createElement("div",null,ji.name),i.a.createElement("div",null,ji.editItem),i.a.createElement("div",null,ji.deleted)),i.a.createElement(ge.d,null),i.a.createElement("div",{className:"dv-popup-panel-content"},this.getAddUI(r),i.a.createElement(oe.Scrollbars,{className:"scroll-bars",autoHide:!0,ref:this.scrollbarsRef,renderTrackHorizontal:function(e){return i.a.createElement("div",Y()({},e,{style:{display:"none"},className:"track-horizontal"}))}},i.a.createElement("div",{className:"dv-panel-items"},this.getMediasItems(a,r))))))}}]),t}(n.Component),Yi=a(182),Ki=a.n(Yi),Xi=(a(1722),a(1724),DataViz.Language),qi={TEXT:DataViz.Language.isText,MEDIA:DataViz.Language.media,FIELD:DataViz.Language.field},Ji=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={selectIndex:0,isShowModal:!1,configElements:null},a.popupConfigModalRef=i.a.createRef(),a.closeModal=a.closeModal.bind(O()(a)),a.getNewConfigElements=a.getNewConfigElements.bind(O()(a)),a.changeSelectedMenu=a.changeSelectedMenu.bind(O()(a)),a.changeMenuIndex=a.changeMenuIndex.bind(O()(a)),a.deleteMenu=a.deleteMenu.bind(O()(a)),a.addMenu=a.addMenu.bind(O()(a)),a.savePopupConfig=a.savePopupConfig.bind(O()(a)),a.changeSelectedFields=a.changeSelectedFields.bind(O()(a)),a.changeFieldsIndex=a.changeFieldsIndex.bind(O()(a)),a.changeMediaInfo=a.changeMediaInfo.bind(O()(a)),a.changeMediaIndex=a.changeMediaIndex.bind(O()(a)),a.getTextInfos=a.getTextInfos.bind(O()(a)),a.textRef=i.a.createRef(),a}return E()(t,e),y()(t,[{key:"showModal",value:function(){this.setState({isShowModal:!0})}},{key:"closeModal",value:function(){this.setState({configElements:null,selectIndex:0,isShowModal:!1})}},{key:"savePopupConfig",value:function(){var e=this.getNewConfigElements(),t=Ri.a.getWebmapPopupElements(e),a=Ri.a.getSaveConfigElements(e);this.props.changePopupConfigElements(a),this.props.changePopupInfos({elements:t,title:this.props.title}),this.closeModal()}},{key:"changeMediaIndex",value:function(e,t){var a=Mi()(this.state.configElements),n=a[this.state.selectIndex];n&&n.infos&&(Ri.a.changeArrayIndex(e,t,n.infos),this.setState({configElements:a}))}},{key:"changeFieldsIndex",value:function(e,t){var a=Mi()(this.state.configElements),n=a[this.state.selectIndex];if(Ri.a.changeArrayIndex(e,t,n.sortsFields),n&&n.infos){var i=n.infos.map((function(e){return e.fieldName}));n.infos=Ri.a.getFieldInfos(n.sortsFields,i),this.setState({configElements:a})}}},{key:"changeSelectedFields",value:function(e){var t=Mi()(this.state.configElements),a=t[this.state.selectIndex];if(0===e.length)a.infos=[];else{var n=a.type;a.infos=e.map((function(e){return{type:n,fieldName:e}}))}this.setState({configElements:t})}},{key:"changeMenuIndex",value:function(e,t){var a=this.getNewConfigElements();a=Ri.a.changeArrayIndex(e,t,a),this.setState({configElements:a,selectIndex:t})}},{key:"changeSelectedMenu",value:function(e){var t=this.getNewConfigElements();this.setState({selectIndex:e,configElements:t})}},{key:"deleteMenu",value:function(e){var t=Mi()(this.state.configElements);if(t.splice(e,1),e<=this.state.selectIndex){var a=this.state.selectIndex-1;a=a>-1?a:0,this.setState({selectIndex:a})}this.setState({configElements:t})}},{key:"addMenu",value:function(e){var t=this.getNewConfigElements();t.push({type:Object.keys(qi)[e],infos:[]}),this.setState({configElements:t,selectIndex:t.length-1})}},{key:"changeMediaInfo",value:function(e,t){var a=Mi()(this.state.configElements),n=a[this.state.selectIndex];t?e<0?n.infos.push(t):n.infos.splice(e,1,t):n.infos.splice(e,1),this.setState({configElements:a})}},{key:"getNewConfigElements",value:function(){var e=Mi()(this.state.configElements),t=this.getTextInfos(),a=e[this.state.selectIndex];return t&&t.ops&&(a.infos=Mi()(t.ops)),e}},{key:"getTextInfos",value:function(){return this.textRef.current?this.textRef.current.getContents():null}},{key:"getConfigPanel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=this.props.allFields,n=this.state.selectIndex;switch(e.type){case"TEXT":return i.a.createElement("div",{className:"dv-popup-config-panel"},i.a.createElement(ge.e,{key:"dv-text"+n,id:"dv-text"+n,ref:this.textRef,theme:"custom",locales:{enterUrl:Xi.enterUrl,enterOk:Xi.okButton,enterRemove:Xi.remove},value:{ops:e.infos},fields:a,modules:{clipboard:{matchers:[["img",function(){return new ge.c}]]}}}));case"MEDIA":return i.a.createElement(Hi,{key:"dv-media"+n,mediaInfos:e.infos,changeMediaIndex:this.changeMediaIndex,changeMediaInfo:this.changeMediaInfo,fields:a});case"FIELD":e.sortsFields||(e.sortsFields=Mi()(a));var r=e.infos?e.infos.map((function(e){return e&&e.fieldName})):[];return i.a.createElement(Gi,{fields:e.sortsFields,changeFieldsIndex:this.changeFieldsIndex,changeSelectedFields:this.changeSelectedFields,selectedFields:r,defaultSelectedFields:t});default:return i.a.createElement(nn,null)}}},{key:"render",value:function(){var e=this.props.defaultSelectedFields,t=this.state.configElements||[],a=(t.map((function(e){return e.type}))||[]).map((function(e){return qi[e]}))||[],n=t[this.state.selectIndex];return i.a.createElement(re.a,{ref:this.popupConfigModalRef,modalWidth:"720px",modalHeight:"348px",hideCancelBtn:!0,modalIsOpen:this.state.isShowModal,modalTitle:Xi.popupInfoConfig,okCallBack:this.savePopupConfig,closeBtnCallBack:this.closeModal},i.a.createElement("div",{className:"dv-popup-config-modal"},i.a.createElement(Bi,{menus:a,deleteMenu:this.deleteMenu,selectIndex:this.state.selectIndex,addMenu:this.addMenu,changeMenuIndex:this.changeMenuIndex,changeSelectedMenu:this.changeSelectedMenu}),this.getConfigPanel(n,e||[])))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a,n=e.popupConfigElements;if(n){var i=e.popupInfo&&Ki()(e.popupInfo.elements);a=Ri.a.getLayoutConfigElements(n,i)}else a=Ri.a.getDefaultConfigElements(e.defaultSelectedFields);return!t.configElements&&t.isShowModal?{configElements:a}:null}}]),t}(n.Component),Zi=a(82),Qi=a(247),$i=(a(1725),DataViz.Language),er=function(e){function t(e){var a;f()(this,t),(a=v()(this,b()(t).call(this,e))).scales=de.a.scales,a.initScale();var n=a.getMaxScaleArr(),i=n.maxScales,r=n.maxScalesLabel,s=a.getMinScaleArr(),o=s.minScales,l=s.minScalesLabel;return a.state={maxScaleLabelArr:r,minScaleLabelArr:l,maxScaleArr:i,minScaleArr:o,currentScale:a.props.scale},a.changeMaxScale=a.changeMaxScale.bind(O()(a)),a.changeMinScale=a.changeMinScale.bind(O()(a)),a.onConfirm=a.onConfirm.bind(O()(a)),a.initScale=a.initScale.bind(O()(a)),a.onVisibleChange=a.onVisibleChange.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"getMaxScaleArr",value:function(){if(de.a.scales&&de.a.scales.length>0){var e=de.a.scales.indexOf(this.minScale),t=de.a.scales.slice(e+1),a=t.map((function(e,t){return T.a.toLocalScale(e)}));return t.push($i.clearMeasure),a.push($i.clearMeasure),{maxScales:t,maxScalesLabel:a}}}},{key:"getMinScaleArr",value:function(){if(de.a.scales&&de.a.scales.length>0){var e=de.a.scales.indexOf(this.maxScale),t=de.a.scales.slice(0,e),a=t.map((function(e,t){return T.a.toLocalScale(e)}));return t.push($i.clearMeasure),a.push($i.clearMeasure),{minScales:t,minScalesLabel:a}}}},{key:"updateScaleArr",value:function(){var e=this.getMaxScaleArr(),t=e.maxScales,a=e.maxScalesLabel,n=this.getMinScaleArr(),i=n.minScales,r=n.minScalesLabel;this.setState({maxScaleLabelArr:a,minScaleLabelArr:r,maxScaleArr:t,minScaleArr:i})}},{key:"changeMaxScale",value:function(e){e===$i.clearMeasure?this.maxScale=de.a.scales[de.a.scales.length-1]:this.maxScale=e,this.updateScaleArr()}},{key:"changeMinScale",value:function(e){e===$i.clearMeasure?this.minScale=de.a.scales[0]:this.minScale=e,this.updateScaleArr()}},{key:"onConfirm",value:function(){var e=de.a.getLayerById(this.props.layerID),t=e.layerInfo;t.visibleScale={maxScale:T.a.formatScale(this.maxScale),minScale:T.a.formatScale(this.minScale)},e.setVisibleScale(t.visibleScale),de.a.selectedFeature&&de.a.selectedFeature.layerID===t.id&&de.a.highLightLayer.getSource().clear()}},{key:"initScale",value:function(){var e=de.a.getLayerById(this.props.layerID);if(e){var t=e.layerInfo.visibleScale;t?(t={maxScale:t.maxScale,minScale:t.minScale},this.maxScale=t.maxScale,this.minScale=t.minScale):de.a.scales&&de.a.scales.length>0&&(this.maxScale=de.a.scales[de.a.scales.length-1],this.minScale=de.a.scales[0])}}},{key:"onVisibleChange",value:function(e){if(Ce.a.isVisiblePopOpen=e,e){var t=de.a.getBaseLayer().layerInfo,a=de.a.getBaseLayerProjUnit(t),n="WMTS"===t.layerType?Ce.a.dpi.iServerWMTS:Ce.a.dpi.default,i=de.a.map.getView().getResolution();a||(a="EPSG:3857"===de.a.getBaseLayerProj()?"m":"degree");var r=T.a.getScaleFromRes(i,a,n);r!==this.props.scale&&(this.props.changeCurrentScale(r),this.initScale(),this.updateScaleArr())}this.props.onVisibleChange(e)}},{key:"getOverlay",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"item"},i.a.createElement("span",{className:"title"},$i.currentScale),i.a.createElement("span",{className:"current"},T.a.toLocalScale(this.props.scale))),i.a.createElement("div",{className:"item"},i.a.createElement("span",{className:"title"},$i.maxScale),i.a.createElement(We.b,{values:this.state.maxScaleArr,labels:this.state.maxScaleLabelArr,selectedValue:this.maxScale,onChange:this.changeMaxScale,isBubble:!0})),i.a.createElement("div",{className:"item"},i.a.createElement("span",{className:"title"},$i.minScale),i.a.createElement(We.b,{values:this.state.minScaleArr,labels:this.state.minScaleLabelArr,selectedValue:this.minScale,onChange:this.changeMinScale,isBubble:!0})))}},{key:"render",value:function(){return i.a.createElement(ge.k,{header:$i.visibleScaleRange,placement:"rightTop",cancelText:DataViz.Language.cancelButton,okText:DataViz.Language.okButton,onCancel:this.initScale,onConfirm:this.onConfirm,onVisibleChange:this.onVisibleChange,overlayClassName:"scale-popup",content:this.getOverlay(),hideAnimate:!0},i.a.createElement("div",{onClick:function(e){e.stopPropagation()}},i.a.createElement("span",{className:"supermapol-icons-plotting-scale"},window.DataViz.Language.visibleScale)))}}]),t}(n.Component),tr=(a(1726),a(1727),DataViz.Language),ar=function(e){function t(e){var a;f()(this,t),a=v()(this,b()(t).call(this,e));var n=de.a.getLayerById(a.props.layerID),i=(n&&n.layerInfo||{}).autoUpdateTime;return a.state={isOpen:!!i,value:i/60/1e3||""},i&&a.setAutoTime(i),a.changeTime=a.changeTime.bind(O()(a)),a.changeSwitch=a.changeSwitch.bind(O()(a)),a.onBlur=a.onBlur.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"changeTime",value:function(e){var t=e.target.value;""===t?this.setState({isOpen:!1,value:t}):T.a.isNumber(t)?this.setState({value:t,isOpen:t>0}):K.a.showMessage(tr.maxScaleTips)}},{key:"changeSwitch",value:function(e){var t={isOpen:e};e||(t.value="",de.a.getLayerById(this.props.layerID).layerInfo.autoUpdateTime=null);this.setState(t)}},{key:"onBlur",value:function(){var e=this.state,t=e.isOpen,a=e.value;t&&a?a=60*a*1e3:""===a&&(a=null),this.setAutoTime(a)}},{key:"setAutoTime",value:function(e){de.a.getLayerById(this.props.layerID).layerInfo.autoUpdateTime=e}},{key:"getOverlay",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"dv-header"},tr.layerAutoUpdate),i.a.createElement("div",{className:"dv-item"},i.a.createElement("span",{className:"dv-item-title"},tr.autoUpdate),i.a.createElement(Ht,{isOpen:this.state.isOpen,onChange:this.changeSwitch})),i.a.createElement("div",{className:"dv-item"},i.a.createElement("span",{className:"dv-item-title"},tr.autoUpdateTime),i.a.createElement("input",{type:"text",onChange:this.changeTime,value:this.state.value,onBlur:this.onBlur}),i.a.createElement("span",null,tr.minutes)))}},{key:"render",value:function(){return i.a.createElement(ge.l,{placement:"rightTop",overlayClassName:"auto-update-pop",overlay:this.getOverlay(),onVisibleChange:this.props.onVisibleChange},i.a.createElement("div",null,i.a.createElement("span",{className:"supermapol-icons-data-updating"},tr.autoUpdate)))}}]),t}(n.Component),nr=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).isUpdate=!1,a.state={isShowLists:a.props.isShow,opacity:1,scale:e.scale},a.popupConfigModalRef=i.a.createRef(),a.getPopupConfigInfo=a.getPopupConfigInfo.bind(O()(a)),a.changePopupInfos=a.changePopupInfos.bind(O()(a)),a.changePopupConfigElements=a.changePopupConfigElements.bind(O()(a)),a.layerAttrModalRef=i.a.createRef(),a.showLayerStyle=a.showLayerStyle.bind(O()(a)),a.addFromWeb={addRestMapOverLayer:a.updateRestMapOverLayer.bind(O()(a)),addFromRestData:a.updateFromRestData.bind(O()(a)),addFromDataflow:a.updateFromDataflow.bind(O()(a)),addVectorTileLayer:a.updateRestjsrMapOverLayer.bind(O()(a))},a.updateFeatureFromAddress=a.updateFeatureFromAddress.bind(O()(a)),a.onVisibleChange=a.onVisibleChange.bind(O()(a)),a.afterFileParserCompleted=a.afterFileParserCompleted.bind(O()(a)),a.updateData=a.updateData.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"shouldComponentUpdate",value:function(){return!!this.isUpdate&&(this.isUpdate=!1,!0)}},{key:"componentWillReceiveProps",value:function(e){e.isShowLists===this.state.isShowLists&&e.scale===this.state.scale&&e.isVisibe===this.state.isVisibe||(this.isUpdate=!0,this.setState({isShowLists:e.isShowLists,scale:e.scale,isVisibe:e.isVisibe}))}},{key:"setListsVisible",value:function(e,t){t.stopPropagation(),this.props.config.renameDisabled&&this.props.config.opacityDisabled&&this.props.config.styleDisabled&&this.props.config.attributeDisabled||(this.updateState({isShowLists:e}),this.isUpdate=!0)}},{key:"showLayerStyle",value:function(e){e.stopPropagation(),this.props.isVisibe&&(this.props.config.styleDisabled||(K.a.showMarkerLayerPop(this.props.layerID),this.setListsVisible(!1,e)))}},{key:"editor",value:function(e,t,a){if("opacity"===e){var n=de.a.getLayerById(this.props.layerID),i=n.layer,r=n.layerInfo;"TILE"===i.type&&r.sourceType&&r.sourceType.indexOf("TIANDITU")>-1&&n.labelLayer&&n.labelLayer.setOpacity(t),i.setOpacity(t)}}},{key:"showOpacityModal",value:function(e){e.stopPropagation(),this.props.isVisibe&&!this.props.config.opacityDisabled&&(this.refs.opacityModal.showModal(),this.setListsVisible(!1,e))}},{key:"changeName",value:function(e){this.props.isVisibe&&(this.props.changeLayerName(e,this.props.config.renameDisabled),this.setListsVisible(!1,e))}},{key:"updateAddFile",value:function(){var e=this.props,t=e.layerID,a=e.dataSourceType,n=de.a.getLayerById(t).layerInfo;if(!n.serverId&&a!==q.b.PORTAL_DATA||"VECTOR_TILE"===n.layerType)this.addWebModal.modalBox.showModal();else{var i=document.getElementById("update-file");i.onchange=this.checkFileTypeAndFields.bind(this),i.click()}}},{key:"checkFileTypeAndFields",value:function(e){var t=e.target.files[0];if(t){K.a.showLoadingBox(DataViz.Language.updating);var a=t.name.split(".")[1],n=q.g[a],i={uploadFile:t,type:n,name:t.name.split(".")[0],originName:t.name};"EXCEL"===n||"CSV"===n?hn.a.readCsvExcelData(i,{sheetRows:2},"read",this.afterFileParserCompleted):hn.a.readJSONData(i,this.afterFileParserCompleted)}}},{key:"afterFileParserCompleted",value:function(e){var t=de.a.getLayerById(this.props.layerID).layerInfo,a=Object.keys(t.dataSource.dataTypes||t.dataTypes),n=t.serverId||t.dataSource.serverId,i=T.a.filterDatavizFields(a),r=e.data;if(r){var s="",o=r.features;s=o?Object.keys(o[0].properties):r[0],T.a.judgeArrayEqual(i,s)?this.updateData(n,e.uploadFile,e):this.updateDataFailed({errorType:"isDifferentDataStructure"})}else this.updateDataFailed({errorType:"isDifferentDataStructure"})}},{key:"updateData",value:function(e,t,a){var n=this,i=n.props.dataSourceType;ge.o.getDataInfo(e).then((function(r){var s=de.a.getLayerById(n.props.layerID).layerInfo;if(s.xyField&&"dataviz_lon"===s.xyField.xField&&"dataviz_lat"===s.xyField.yField)return n.addFileModal.modalBox.showModal(),void n.addFileModal.onFileSelected(a);var o=JSON.stringify(r.dataMetaInfo),l=new FormData;l.append("file",t);var c={file:l,fileName:t.name,dataID:e,dataMetaInfo:o};ge.o.updateData(c).then((function(e){var t=e.childID;ge.o.getDatasetsByID(t).then((function(e){e&&!1!==e.succeed||n.updateDataFailed({errorType:"getNewDataFailed"}),e.length>0?ge.o.getDataInfo(t).then((function(a){if(0===a.dataItemServices.length)n.updateDataContent(t);else{var r=i===q.b.PORTAL_DATA?"RESTDATA":"RESTMAP",s=tn.a.getService(a.dataItemServices,r).address;"RESTDATA"===r?n.updateServiceToMap(s,e[0].name):n.updateTileToMap(s)}})):n.updateDataContent(t)})).catch((function(e){n.updateDataContent(t)}))})).catch((function(e){n.updateDataFailed(e)}))})).catch((function(e){n.updateDataFailed(e)}))}},{key:"updateServiceToMap",value:function(e,t){var a=this,n=this;T.a.getDatasources(e).then((function(a){var i=a+":"+t,r="".concat(e,"/data");n.updateFeatures(r,i),K.a.showMessage(DataViz.Language.updateSuccess,q.j.SUCCESS)})).catch((function(){a.updateDataFailed({errorType:"getDataServiceFaild"})}))}},{key:"updateFeatures",value:function(e,t){var a,n=this,i=this.props.layerID,r=de.a.getLayerById(i),s=r.layerInfo;T.a.isDynamicRestData(s.projection)?(a=de.a.getBaseLayerProj(!0),T.a.getFeatureBySQL(e,[t],(function(e){if(e){var t=e.result.features.features,i=[];for(var o in t[0].properties)i.push(o.trim());var l=ie.a.parseData2Feature({allDatas:{features:t},fileCode:a||s.projection},"JSON");r.features=l,r.changeLayerType(s.layerType),n.updateDataSuccess(s.id)}else n.updateDataFailed({errorType:"getDataServiceFaild"})}),null,null,null,a)):K.a.showMessage(DataViz.Language.unSupportCoordinate)}},{key:"updateTileToMap",value:function(e){var t=this,a=de.a.getLayerById(this.props.layerID),n=a.layer,i=a.layerInfo;de.a.map.removeLayer(n),T.a.getTileLayerInfo(e,de.a.getBaseLayerProj(!0)).then((function(e){e.forEach((function(e){var a=e.bounds,n={projection:"EPSG:".concat(e.prjCoordSys.epsgCode),units:e.coordUnit&&e.coordUnit.toLowerCase(),extent:[a.left,a.bottom,a.right,a.top],visibleScales:e.visibleScales,url:e.url};Object.assign(i,n),K.a.closeLoadingBox();var r=new Qi.a(i);de.a.map.addLayer(r.createLayer()),t.props.updateLayerInfo(r,"tile"),K.a.showMessage(DataViz.Language.updateSuccess,q.j.SUCCESS)}))})).catch((function(){t.updateDataFailed({errorType:"getDataServiceFaild"})}))}},{key:"updateDataContent",value:function(e){var t=this,a=[],n=de.a.getLayerById(this.props.layerID),i=n.layerInfo;ie.a.getBinaryContent(e).then(function(){var e=p()(u.a.mark((function e(r){var s,o,l,c,d,p,h;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1===r.succeed&&t.updateDataFailed({errorType:"getNewDataFailed"}),!1,"JSON"!==r.type&&"GEOJSON"!==r.type){e.next=15;break}s=r.content,!(o=T.a.isObject(s)?s:JSON.parse(s)).type||"DataInsights"!==o.type&&"MapEditor"!==o.type||(o=o.data.recordsets&&o.data.recordsets[0].features,o=JSON.parse(o)),a=Object.keys(o.features[0].properties),l=ie.a.parseData2Feature({allDatas:{features:o.features},fileCode:i.projection},"JSON"),n.features=l,T.a.isOverThemeMaxCount(l.length,i.featureType)&&(i.layerType=q.r.VECTOR),n.changeLayerType(i.layerType),K.a.closeLoadingBox(),e.next=33;break;case 15:if("EXCEL"!==r.type&&"CSV"!==r.type){e.next=33;break}if(r.content.colTitles=ie.a.trimBinaryTitles(r.content.colTitles),a=r.content.colTitles,!i.dataSource||!i.dataSource.administrativeInfo){e.next=26;break}return c=i.dataSource.administrativeInfo,d=c.divisionType,p=c.divisionField,e.next=22,ie.a.excelData2FeatureByDivision(r.content,d,p);case 22:h=e.sent,n.features=ie.a.parseData2Feature({allDatas:{features:h.features},fileCode:i.projection},"GEOJSON"),e.next=30;break;case 26:return i.projection=tn.a.getCsvExcelEpsgCode(i.xyField,a,r.content.rows),e.next=29,Zi.a.excelData2Feature(r.content,i);case 29:n.features=e.sent;case 30:n.changeLayerType(i.layerType),K.a.closeLoadingBox(),t.updateDataSuccess(i.id);case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.updateDataFailed({errorType:"getNewDataFailed"})}))}},{key:"updateFeatureFromAddress",value:function(e,t,a,n){n=JSON.stringify(n);var i=new FormData,r=this,s=de.a.getLayerById(this.props.layerID).layerInfo,o=s.serverId||s.dataSource.serverId;i.append("file",t);var l={file:i,fileName:a,dataID:o,dataMetaInfo:n};ge.o.updateData(l).then((function(e){var t=e.childID;r.updateDataContent(t),r.addFileModal.modalBox.hideModal()}))}},{key:"updateDataFailed",value:function(e){K.a.closeLoadingBox(),tn.a.showErrrModal(DataViz.Language.updateDataFailed,e)}},{key:"updateRestMapOverLayer",value:function(e){var t=de.a.getLayerById(this.props.layerID),a=t.layer,n=t.layerInfo,i={id:n.id,zIndex:n.zIndex,name:n.name,opacity:n.opacity};de.a.map.removeLayer(a),Object.assign(e,i);var r=new Qi.a(e);de.a.map.addLayer(r.createLayer()),this.props.updateLayerInfo(r,"tile")}},{key:"updateRestjsrMapOverLayer",value:function(e){var t=de.a.getLayerById(this.props.layerID),a=this,n=t.layer,i=t.layerInfo,r={id:i.id,zIndex:i.zIndex,name:i.name,opacity:i.opacity};de.a.map.removeLayer(n),Object.assign(e,r);var s=new ii.a(e);s.createLayer(!1).then((function(){de.a.map.addLayer(s.layer),a.props.updateLayerInfo(s,"tile")}))}},{key:"updateFromRestData",value:function(e){K.a.showLoadingBox(DataViz.Language.updating);var t=de.a.getLayerById(this.props.layerID),a=t.layerInfo,n=a.id,i={id:n,zIndex:a.zIndex,name:a.name,opacity:a.opacity,enableFields:a.enableFields};Object.assign(e.layerInfo,i),Object.assign(t,e),t.changeLayerType(a.layerType),this.props.updateLayerInfo(e.layerInfo),this.updateDataSuccess(n)}},{key:"updateDataSuccess",value:function(e){0!==this.props.showATLayerID&&this.props.showAttributeTable(e);var t=de.a.getVectorLayerById(e),a=t.layerInfo,n=t.features;T.a.isOverThemeMaxCount(n.length,a.featureType)&&(a.layerType=q.r.VECTOR,t.changeLayerType(a.layerType)),K.a.closeLoadingBox(),K.a.showMessage(DataViz.Language.updateSuccess,q.j.SUCCESS)}},{key:"updateFromDataflow",value:function(e){K.a.showLoadingBox(DataViz.Language.updating);var t=de.a.getLayerById(this.props.layerID),a=t.layerInfo;e.id=a.id,e.zIndex=a.zIndex,e.name=a.name,t.changeLayerType(a.layerType),this.props.updateLayerInfo(e),this.updateDataSuccess(a.id)}},{key:"onVisibleChange",value:function(e){Ce.a.isVisiblePopOpen=e,this.props.setConfirmVisible("list",e)}},{key:"getInitialOpacity",value:function(){var e=de.a.getLayerById(this.props.layerID).layer.getOpacity();this.updateState({opacity:e}),this.isUpdate=!0}},{key:"saveOpacity",value:function(){var e=de.a.getLayerById(this.props.layerID),t=e.layerInfo,a=e.layer.getOpacity();t.opacity=a,this.updateState({opacity:a}),this.refs.opacityModal.hideModal()}},{key:"closeOpacityModal",value:function(){de.a.getLayerById(this.props.layerID).layer.setOpacity(this.state.opacity),this.updateState({opacity:this.state.opacity}),this.refs.opacityModal.hideModal()}},{key:"showLayerAttrModal",value:function(e){e.stopPropagation(),this.props.isVisibe&&!this.props.config.attributeDisabled&&(this.layerAttrModalRef.current.showModal(),this.setListsVisible(!1,e))}},{key:"showPopupConfigModal",value:function(e){e.stopPropagation(),this.props.isVisibe&&!this.props.config.popupConfigDisabled&&(this.popupConfigModalRef.current.showModal(),this.setListsVisible(!1,e))}},{key:"updateState",value:function(e){var t=Object.assign({},this.state,e);this.setState(t)}},{key:"getServiceType",value:function(){var e=de.a.getLayerById(this.props.layerID);if(!e)return null;var t=e.layerInfo,a=t.layerType,n=t.dataSource;switch(a){case q.r.VECTOR:case q.r.GRAPHIC:case q.r.SYMBOL:case q.r.UNIQUE:case q.r.RANGE:case q.r.RANK_SYMBOL:case q.r.HEAT_MAP:case q.r.MIGRATION:return n.type===q.b.USER_DATA?q.s.GEOJSON:q.s.RESTDATA;case"TILE":return q.s.RESTMAP;case"DATAFLOW_POINT_TRACK":case"DATAFLOW_HEAT":return q.s.DATAFLOW;default:return a}}},{key:"isShpFile",value:function(){var e=de.a.getVectorLayerById(this.props.layerID),t=e&&e.layerInfo;if(t&&T.a.isThemeLayer(t.layerType)){var a=t.type,n=t.originData,i=a||n&&n.type;return i&&i.toUpperCase()===q.h.SHP}return!1}},{key:"getPopupConfigInfo",value:function(){var e,t,a,n,i,r,s=de.a.getLayerById(this.props.layerID);if(s){var o=s.layerInfo;if(o){e=o.enableFields,t=o.captions,n=o.popupInfo,r=o.popupConfig&&o.popupConfig.configElements,i=o.name;var l=o.dataSource&&o.dataSource.dataTypes||o.dataTypes;a=T.a.getFieldsByObj(l)}}return{defaultSelectedFields:e,allFields:a||[],popupInfo:n,captions:t,title:i,popupConfigElements:r}}},{key:"changePopupInfos",value:function(e){var t=de.a.getLayerById(this.props.layerID);if(t){var a=t.layerInfo,n=Object.keys(e);a&&(a.popupInfo||(a.popupInfo={}),n.forEach((function(t){a.popupInfo[t]=e[t]})))}de.a.closeThemePop()}},{key:"changePopupConfigElements",value:function(e){var t=de.a.getLayerById(this.props.layerID);if(t){var a=t.layerInfo;a&&(a.popupConfig={configElements:e})}}},{key:"render",value:function(){var e=this,t=this.props,a=t.config,n=t.dataSourceType,r=t.isVisibe,s=a.renameDisabled,o=a.opacityDisabled,l=a.styleDisabled,c=a.attributeDisabled,u=a.popupConfigDisabled,d=a.updateDisabled,p=a.autoUpdateDisabled,h=a.visibleScaleDisabled,f=s&&o&&l&&c&&u||this.props.disabled;(["SAMPLE_DATA","REST_MAP"].includes(n)||!this.props.isVisibe||"USER_DATA"===n||window.isSuperMapOL||this.isShpFile())&&(d=!0);var m=Ka.a.dataVizConfig.layerLists[2].children;return i.a.createElement("span",null,i.a.createElement("span",{className:f?"supermapol-icons-more disabled":"supermapol-icons-more",onClick:f||!r?null:this.setListsVisible.bind(this,!this.state.isShowLists),style:{cursor:f?"not-allowed":"pointer"}}),i.a.createElement("div",{className:"lists",ref:"lists",style:{display:this.state.isShowLists?"block":"none"}},i.a.createElement("div",{className:s?"disabled":"",onClick:this.changeName.bind(this)},i.a.createElement("span",{className:"supermapol-icons-rename"},window.DataViz.Language.rename),i.a.createElement(ei,{serviceType:this.getServiceType(),selectDisabled:!0,disabledName:!0,addFromWeb:this.addFromWeb,childrens:m,layerID:this.props.layerID,ref:function(t){e.addWebModal=t}}),i.a.createElement(Bn,{updateFile:this.updateFeatureFromAddress,cancelCallBack:function(){K.a.closeLoadingBox()},closeBtnCallBack:function(){K.a.closeLoadingBox()},ref:function(t){e.addFileModal=t},updateType:q.l.ADDRESS})),i.a.createElement("div",{className:o?"disabled":"",onClick:this.showOpacityModal.bind(this)},i.a.createElement("span",{className:"supermapol-icons-opacity"},window.DataViz.Language.opacity),i.a.createElement(re.a,{ref:"opacityModal",modalTitle:DataViz.Language.layerOpacity,modalWidth:"416px",modalHeight:"68px",cancelButton:DataViz.Language.closeButton,afterOpenModal:this.getInitialOpacity.bind(this),okCallBack:this.saveOpacity.bind(this),cancelCallBack:this.closeOpacityModal.bind(this),closeBtnCallBack:this.closeOpacityModal.bind(this)},i.a.createElement("div",{className:"opacity-pop"},i.a.createElement(_e.a,{type:"opacity",name:DataViz.Language.layerOpacity,editor:this.editor.bind(this),value:100*this.state.opacity,min:0,max:100,unit:"%"})))),h?i.a.createElement("div",{className:"disabled",onClick:function(e){e.stopPropagation()}},i.a.createElement("span",{className:"supermapol-icons-plotting-scale"},window.DataViz.Language.visibleScale)):i.a.createElement(er,Y()({},this.props,{onVisibleChange:this.onVisibleChange})),d?i.a.createElement("div",{className:"disabled",onClick:function(e){e.stopPropagation()}},i.a.createElement("span",{className:"supermapol-icons-refresh"},window.DataViz.Language.update)):i.a.createElement(ge.k,{title:DataViz.Language.updateModelContent,placement:"rightTop",cancelText:DataViz.Language.cancelButton,okText:DataViz.Language.ModelContinueButton,onConfirm:this.updateAddFile.bind(this),onVisibleChange:this.onVisibleChange,hideAnimate:!0},i.a.createElement("div",null,i.a.createElement("span",{className:"supermapol-icons-refresh"},window.DataViz.Language.update))),p||n===q.b.SAMPLE_DATA?i.a.createElement("div",{className:"disabled",onClick:function(e){e.stopPropagation()}},i.a.createElement("span",{className:"supermapol-icons-data-updating"},window.DataViz.Language.autoUpdate)):i.a.createElement(ar,Y()({},this.props,{onVisibleChange:this.onVisibleChange})),i.a.createElement("div",{className:l?"disabled":"",onClick:this.showLayerStyle},i.a.createElement("span",{className:"supermapol-icons-layer-style"},window.DataViz.Language.layerStyle)),i.a.createElement("div",{className:c?"disabled":"",onClick:this.showLayerAttrModal.bind(this)},i.a.createElement("span",{className:"supermapol-icons-layer-info"},window.DataViz.Language.layerArribute),i.a.createElement(Ai,{ref:this.layerAttrModalRef,layerID:this.props.layerID,showATLayerID:this.props.showATLayerID,showAttributeTable:this.props.showAttributeTable})),i.a.createElement("div",{className:u?"disabled":"",onClick:this.showPopupConfigModal.bind(this)},i.a.createElement("span",{className:"supermapol-icons-popup-set"},window.DataViz.Language.popupInfoConfig),i.a.createElement(Ji,Y()({ref:this.popupConfigModalRef},this.getPopupConfigInfo(),{changePopupInfos:this.changePopupInfos,changePopupConfigElements:this.changePopupConfigElements})))))}}]),t}(n.Component),ir={Base:{arrTableDisabled:!0,outputDisabled:!0,deleteDisabled:!0,styleDisabled:!0,attributeDisabled:!0,popupConfigDisabled:!0,renameDisabled:!0,legendDisabled:!0,opacityDisabled:!0,autoUpdateDisabled:!0,updateDisabled:!0},DATAFLOW_POINT_TRACK:{styleDisabled:!0,arrTableDisabled:!0,outputDisabled:!0,autoUpdateDisabled:!0},DATAFLOW_HEAT:{styleDisabled:!0,arrTableDisabled:!0,popupConfigDisabled:!0,outputDisabled:!0,autoUpdateDisabled:!0},VECTOR:{styleDisabled:!0},HEAT:{styleDisabled:!0,popupConfigDisabled:!0},UNIQUE:{styleDisabled:!0},RANGE:{styleDisabled:!0},SYMBOL:{styleDisabled:!0},RANK_SYMBOL:{styleDisabled:!0},MIGRATION:{styleDisabled:!0,opacityDisabled:!0,visibleScaleDisabled:!0,popupConfigDisabled:!0},MARKER:{arrTableDisabled:!0,attributeDisabled:!0,popupConfigDisabled:!0,zoomDisabled:!0,legendDisabled:!0,updateDisabled:!0,autoUpdateDisabled:!0},TILE:{arrTableDisabled:!0,outputDisabled:!0,styleDisabled:!0,attributeDisabled:!0,popupConfigDisabled:!0,legendDisabled:!0},VECTOR_TILE:{arrTableDisabled:!0,outputDisabled:!0,styleDisabled:!0,attributeDisabled:!0,popupConfigDisabled:!0,legendDisabled:!0,autoUpdateDisabled:!0},WMS:{arrTableDisabled:!0,outputDisabled:!0,styleDisabled:!0,attributeDisabled:!0,popupConfigDisabled:!0,legendDisabled:!0,autoUpdateDisabled:!0},WMTS:{arrTableDisabled:!0,outputDisabled:!0,styleDisabled:!0,attributeDisabled:!0,popupConfigDisabled:!0,legendDisabled:!0,autoUpdateDisabled:!0},NOT_EDITABLE_MARKER:{arrTableDisabled:!0,zoomDisabled:!0,updateDisabled:!0,autoUpdateDisabled:!0,styleDisabled:!0,attributeDisabled:!0,popupConfigDisabled:!0,legendDisabled:!0},NOT_EDITABLE_VECTOR:{updateDisabled:!0,autoUpdateDisabled:!0,styleDisabled:!0},NOT_EDITABLE_MIGRATION:{styleDisabled:!0,opacityDisabled:!0,visibleScaleDisabled:!0,popupConfigDisabled:!0,updateDisabled:!0,autoUpdateDisabled:!0},NOT_EDITABLE_HEAT:{updateDisabled:!0,autoUpdateDisabled:!0,popupConfigDisabled:!0,styleDisabled:!0},NOT_EDITABLE_UNIQUE:{updateDisabled:!0,autoUpdateDisabled:!0,styleDisabled:!0},NOT_EDITABLE_RANGE:{updateDisabled:!0,autoUpdateDisabled:!0,styleDisabled:!0},NOT_EDITABLE_SYMBOL:{updateDisabled:!0,autoUpdateDisabled:!0,styleDisabled:!0},NOT_EDITABLE_RANK_SYMBOL:{updateDisabled:!0,autoUpdateDisabled:!0,styleDisabled:!0}},rr=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isShowIcon:!1,isShowLists:!1,isShowTianditu:void 0===e.layerInfo.labelLayerVisible||e.layerInfo.labelLayerVisible,deleteFromMyData:!1,showDeletePop:!1},a.setTiandituLabelVisible=a.setTiandituLabelVisible.bind(O()(a)),a.showAttributeTable=a.showAttributeTable.bind(O()(a)),a.onVisibleChange=a.onVisibleChange.bind(O()(a)),a.removeCurrentLayer=a.removeCurrentLayer.bind(O()(a)),a.changeDeleteStatus=a.changeDeleteStatus.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(){var e=de.a.getBaseLayer().layerInfo.labelLayerVisible;this.setState({isShowTianditu:void 0===e||e})}},{key:"setTiandituLabelVisible",value:function(){this.props.isVisibe&&(de.a.changeTiandituLabelVisible(!this.state.isShowTianditu),this.setState({isShowTianditu:!this.state.isShowTianditu}))}},{key:"getBaseLayerContainer",value:function(){return this.props.isTianditu?i.a.createElement(C.a,{placement:"top",labelType:"span",tooltip:window.DataViz.Language.label,iconClassName:this.state.isShowTianditu?"supermapol-icons-roadnetwork visible":"supermapol-icons-roadnetwork",onClick:this.setTiandituLabelVisible}):null}},{key:"showAttributeTable",value:function(){this.props.isVisibe&&this.props.showAttributeTable(this.props.layerInfo.id)}},{key:"updateLegendView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.props.isVisibe){var t=this.props.layerInfo.id,a=de.a.getVectorLayerById(t).layerInfo;e?(a.legendSetting={isShow:!1,isFold:!1},t=-this.props.layerInfo.id):a.legendSetting={isShow:!0,isFold:!1},this.props.updateLegendView(t)}}},{key:"zoomToExtent",value:function(){if(this.props.isVisibe){var e=de.a.getLayerById(this.props.layerInfo.id);de.a.zoomToExtent(e.getBounds())}}},{key:"removeCurrentLayer",value:function(){var e=de.a.getLayerById(this.props.layerInfo.id);if((this.props.isVisibe||this.props.layerInfo.getDataFaild)&&e){var t=e.layerInfo,a=t.serverId||t.dataSource&&t.dataSource.serverId;"MARKER"===this.props.layerInfo.layerType&&this.props.layerInfo.id===de.a.getOnlySelectedFeatureLayerId()?(this.props.hideMarkerPopup(),de.a.highLightLayer.getSource().clear()):T.a.isThemeLayer(t.layerType)||T.a.isDataflowLayer(t.layerType)?(this.updateLegendView(!0),de.a.closeThemePop(),ie.a.deleteUpdateFeaLayer(this.props.layerInfo.id)):de.a.getTileLayerById(this.props.layerInfo.id)&&de.a.isSelectedTileLayer(this.props.layerInfo.id)?(de.a.map.getOverlayById("tile-pop").setPosition(void 0),de.a.highLightLayer.getSource().clear()):T.a.isVectorTileLayer(t.layerType)&&(de.a.closeThemePop(),de.a.highLightLayer.getSource().clear()),0!==this.props.showATLayerID&&this.props.showATLayerID===this.props.layerInfo.id&&this.props.showAttributeTable(0);var n=this.state.deleteFromMyData;this.props.removeCurrentLayer(this.props.layerInfo.id,n),n&&T.a.deleteServerData(a,K.a.showMessage)}}},{key:"onVisibleChange",value:function(e){(this.props.isVisibe||this.props.layerInfo.getDataFaild)&&(this.setState({showDeletePop:e}),this.props.setConfirmVisible("icon",e))}},{key:"changeDeleteStatus",value:function(e){this.setState({deleteFromMyData:e.target.checked})}},{key:"getExtraContent",value:function(){var e=de.a.getLayerById(this.props.layerInfo.id);if(e){var t=e.layerInfo;return(t.serverId||t.dataSource&&t.dataSource.serverId)&&"VECTOR_TILE"!==t.layerType?i.a.createElement(se.a,{onChange:this.changeDeleteStatus,checked:this.state.deleteFromMyData},DataViz.Language.deleteServerData):null}}},{key:"getLayerContainer",value:function(e){var t=this,a=this.props.layerInfo.getDataFaild;if(void 0!==ir[e])return i.a.createElement("span",null,i.a.createElement(C.a,{placement:"top",labelType:"span",tooltip:window.DataViz.Language.output,iconClassName:"supermapol-icons-output",disabled:ir[e].outputDisabled||a,onClick:function(){t.props.isVisibe&&K.a.showOutputModal(t.props.layerInfo)}}),i.a.createElement(C.a,{placement:"top",labelType:"span",tooltip:window.DataViz.Language.attributeTable,iconClassName:"supermapol-icons-attribute",disabled:ir[e].arrTableDisabled||a,onClick:this.showAttributeTable}),i.a.createElement(C.a,{placement:"top",labelType:"span",tooltip:window.DataViz.Language.legend,iconClassName:"supermapol-icons-legend-small",disabled:ir[e].legendDisabled||a,onClick:this.updateLegendView.bind(this,!1)}),i.a.createElement(ge.k,{title:DataViz.Language.ModelContent,placement:"rightTop",visible:this.state.showDeletePop,cancelText:DataViz.Language.cancelButton,okText:DataViz.Language.deleted,onConfirm:this.removeCurrentLayer,content:this.getExtraContent(),onVisibleChange:this.onVisibleChange,overlayClassName:"delete-layer-popConfirm"},i.a.createElement(C.a,{placement:"top",labelType:"span",tooltip:window.DataViz.Language.deleted,iconClassName:"supermapol-icons-delete",disabled:ir[e].deleteDisabled})))}},{key:"render",value:function(){var e=this.props.layerInfo.id&&de.a.getVectorLayerById(this.props.layerInfo.id),t=e?e.layerInfo.layerType:this.props.layerInfo.layerType,a=1===this.props.layerInfo.id||0===this.props.layerInfo.zIndex||!1===this.props.overLayer,n=this.props.layerInfo.getDataFaild,r=e&&e.layerInfo.dataSource&&e.layerInfo.dataSource.type,s=this.props.layerInfo.layerNotEditable?"NOT_EDITABLE_".concat(t):t;return i.a.createElement("div",{className:"secound-line",style:{display:this.props.isShow?"block":"none"}},i.a.createElement(C.a,{placement:"top",labelType:"span",tooltip:window.DataViz.Language.zoomTo,iconClassName:"supermapol-icons-zoom-to",onClick:this.zoomToExtent.bind(this),disabled:(ir[s]?ir[s].zoomDisabled:ir.Base.zoomDisabled)||n}),a?this.getBaseLayerContainer():this.getLayerContainer(s),i.a.createElement(nr,{isVisibe:this.props.isVisibe,showATLayerID:this.props.showATLayerID,showAttributeTable:this.props.showAttributeTable,layerID:this.props.layerInfo.id,changeLayerName:this.props.changeLayerName,isShowLists:this.props.isShowLists,config:!a&&ir[s]?ir[s]:ir.Base,disabled:n,dataSourceType:r,setConfirmVisible:this.props.setConfirmVisible,updateLayerInfo:this.props.updateLayerInfo,scale:this.props.scale,changeCurrentScale:this.props.changeCurrentScale,addVectorTileLayer:this.props.addVectorTileLayer}))}}]),t}(n.Component),sr=DataViz.Language,or="".concat(T.a.getRootUrl(),"apps/dataviz/static/imgs/baselayer_default.png"),lr=function(e){function t(e){var a;f()(this,t);return(a=v()(this,b()(t).call(this,e))).state={isVisibe:e.value.visible,selected:e.selected,layerName:e.value.name,isShowIcon:!1,isShowLists:!1,canEditLayerName:!1,inputType:null,twinkle:e.twinkle},a.confirmVisible=!1,a.setConfirmVisible=a.setConfirmVisible.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.state;e.selected!==this.state.selected&&(t.selected=e.selected),e.value.name!==this.state.layerName&&(t.layerName=e.value.name),e.twinkle!==this.state.twinkle&&(t.twinkle=e.twinkle),this.setState()}},{key:"setInvisibleState",value:function(e){if(this.props.value&&this.props.value.getDataFaild)return!1;e.stopPropagation(),this.setState({isVisibe:!this.state.isVisibe}),this.props.changeLayerVisible(this.props.value.zIndex,!this.state.isVisibe),this.props.value.id===de.a.getOnlySelectedFeatureLayerId()?this.props.value.layerType===q.r.MARKER?(this.props.hideMarkerPopup(),de.a.highLightLayer.getSource().clear()):(T.a.isThemeLayer(this.props.value.layerType)||T.a.isDataflowLayer(this.props.value.layerType))&&de.a.closeThemePop():de.a.getTileLayerById(this.props.value.id)&&de.a.isSelectedTileLayer(this.props.value.id)&&(de.a.map.getOverlayById("tile-pop").setPosition(void 0),de.a.highLightLayer.getSource().clear())}},{key:"getLayerIcon",value:function(){var e,t=this.props.value.featureType,a=this.props.value.layerType;if(this.props.value.thumbnail||0===this.props.value.zIndex&&1===this.props.value.id)return i.a.createElement("div",{className:"layer-icon"},i.a.createElement("img",{src:this.props.value.thumbnail||or}));if(T.a.isThemeLayer(a))switch(t){case q.p.POINT:e="supermapol-icons-point-layer1";break;case q.p.LINE:e="supermapol-icons-line-layer1";break;case q.p.POLYGON:case q.p.REGION:e="supermapol-icons-polygon-layer1";break;default:e="supermapol-icons-point-layer1"}else e=a===q.r.MARKER?"supermapol-icons-plot":a===q.r.DATAFLOW?"supermapol-icons-streaming-data":"supermapol-icons-overlay";return i.a.createElement("div",{className:"layer-icon"},i.a.createElement("span",{className:e}))}},{key:"getClassName",value:function(){var e=this,t=this.props.value.getDataFaild,a=this.state.isVisibe?"":"invisible ";return a+=this.state.selected?"seleted ":"",a+=this.state.isShowIcon?"largeSize ":"",a+=this.state.twinkle?"twinkle-yellow ":"",a+=t?"error"===t?"error ":"no-permission ":"draggable ",e.state.twinkle&&setTimeout((function(){e.props.twinkleLayer()}),4e3),a}},{key:"setSelectedState",value:function(e){e.stopPropagation(),!this.state.isVisibe||this.confirmVisible||this.props.value&&this.props.value.layerNotEditable&&"MARKER"===this.props.value.layerType||this.props.onClick(this.props.value.id,this.props.value.zIndex)}},{key:"setIconsVisible",value:function(e){if(!this.confirmVisible){var t={isShowIcon:e};!e&&(t.isShowLists=!1),this.setState(t)}}},{key:"setConfirmVisible",value:function(e,t){this.confirmVisible=t,"icon"===e?this.setState({isShowIcon:t,isShowLists:!1}):this.setState({isShowIcon:t,isShowLists:t})}},{key:"changeTitle",value:function(e){""===e||null==e?(K.a.showMessage(DataViz.Language.noLayerName),this.setState({layerName:this.state.layerName})):(K.a.closeMessage(),this.setState({layerName:e,canEditLayerName:!1,inputType:null}),this.props.changeLayerName(this.props.value.zIndex,e),this.props.updateLegendView(null,(new Date).getTime()))}},{key:"editTitle",value:function(e,t,a){t||this.setState({canEditLayerName:!0,inputType:a})}},{key:"render",value:function(){var e=this.state.isVisibe?"supermapol-icons-visible":"supermapol-icons-invisible",t=this.state.layerName,a=this.props.value;a&&a.getDataFaild&&(e="supermapol-icons-invisible icon-forbidden",t="error"===a.getDataFaild?"[".concat(sr.getSourceFaild,"]").concat(this.state.layerName):"[".concat(sr.sourceNoPermission,"]").concat(this.state.layerName));var n=a&&a.layerNotEditable&&"MARKER"===a.layerType;return i.a.createElement("li",{className:this.getClassName(),onClick:this.setSelectedState.bind(this),onMouseEnter:this.setIconsVisible.bind(this,!0),onMouseLeave:this.setIconsVisible.bind(this,!1)},i.a.createElement("div",{className:"first-line"},this.getLayerIcon(),i.a.createElement(w,{className:"title",value:t,disabled:!0,onBlur:this.changeTitle.bind(this),isEdit:this.state.canEditLayerName,tipValue:t,ref:"layerName"}),n&&i.a.createElement(C.a,{iconClassName:"supermapol-icons-question-circle",trigger:"hover",placement:"right",tooltip:this.props.notEditableTip,overlayClassName:this.props.tooltipClassName}),i.a.createElement("span",{className:e,style:{opacity:this.state.isShowIcon||!this.state.isVisibe?1:0},onClick:this.setInvisibleState.bind(this)})),i.a.createElement(rr,{isVisibe:this.state.isVisibe,layerInfo:this.props.value,isBaseLayer:this.props.value.thumbnail,isTianditu:this.props.value.layerType&&this.props.value.layerType.indexOf("TIANDITU")>-1,isShow:this.state.isShowIcon,isShowLists:this.state.isShowLists,showATLayerID:this.props.showATLayerID,showAttributeTable:this.props.showAttributeTable,removeCurrentLayer:this.props.removeCurrentLayer,changeLayerName:this.editTitle.bind(this),hideMarkerPopup:this.props.hideMarkerPopup,updateLegendView:this.props.updateLegendView,updateLayerInfo:this.props.updateLayerInfo,setConfirmVisible:this.setConfirmVisible,scale:this.props.scale,changeCurrentScale:this.props.changeCurrentScale,addVectorTileLayer:this.props.addVectorTileLayer}))}}]),t}(n.Component),cr=(a(1728),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).vectorLayers=[],a.webLayers=[],a.baseLayers=[],a.setLayerSelected=a.setLayerSelected.bind(O()(a)),a.changeLayerVisible=a.changeLayerVisible.bind(O()(a)),a.changeLayerName=a.changeLayerName.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentDidMount",value:function(){var e=this,t=document.getElementsByClassName("vector-layers");Ni.a.create(t[0],{animation:100,draggable:".draggable",onEnd:function(t){if(e.props.twinkleLayerId&&e.props.twinkleLayer(),t.oldIndex!==t.newIndex){var a=e.props.layersUI.length,n=a-t.oldIndex-1,i=a-t.newIndex-1;e.changeLayerIndex(n,i,"VECTOR")}}});var a=document.getElementsByClassName("web-layers");Ni.a.create(a[0],{animation:100,draggable:".draggable",onEnd:function(t){if(e.props.twinkleLayerId&&e.props.twinkleLayer(),t.oldIndex!==t.newIndex){var a=e.props.layersUI.length,n=e.vectorLayers.length,i=a-t.oldIndex-1-n,r=a-t.newIndex-1-n;e.changeLayerIndex(i,r,"WEB")}}})}},{key:"changeLayerIndex",value:function(e,t,a){var n,i=this.props.layersUI;if(i[e].zIndex=i[t].zIndex,de.a.updateZindex(i[e],!0),e>t)for(n=t;n<e;n++)i[n].zIndex++,de.a.updateZindex(i[n],!1,!0);else for(n=e+1;n<=t;n++)i[n].zIndex--,de.a.updateZindex(i[n],!1,!1);this.props.changeLayerIndex(i)}},{key:"changeLayerVisible",value:function(e,t){for(var a=this.props.layersUI,n=0;n<a.length;n++)a[n].zIndex===e&&(a[n].visible=t,de.a.changeLayerVisible(a[n]));this.props.changeLayerIndex(a)}},{key:"changeLayerName",value:function(e,t){for(var a=this.props.layersUI,n=0;n<a.length;n++)a[n].zIndex===e&&(a[n].name=t,de.a.changeLayerName(a[n]));this.props.changeLayerIndex(a)}},{key:"setLayerSelected",value:function(e,t){1!==e&&e===this.props.selectedLayerId?this.props.selectedLayer():e&&this.props.selectedLayer(e);var a=de.a.getLayerById(e);if(a){var n=a.features,i=a.layerInfo;n&&(i.featureType===q.e.POINT&&n.length>Ce.a.pointThemeLayerMaxCount||i.featureType!==q.e.POINT&&n.length>Ce.a.themeLayerMaxCount)&&K.a.showMessage(DataViz.Language.overThemeLayerMaxCount,q.j.WARNING)}}},{key:"classifyLayers",value:function(){var e=this.props.layersUI;if(e&&0!==e.length){this.sortLayers(e);for(var t=this.vectorLayers=[],a=this.webLayers=[],n=this.baseLayers=[],i=0;i<e.length;i++)T.a.isVectorLayer(e[i].layerType)?t.push(e[i]):0===e[i].zIndex?(e[i].thumbnail||(e[i].thumbnail=""),n.push(e[i])):(T.a.isTileLayer(e[i].layerType)||T.a.isVectorTileLayer(e[i].layerType))&&0!==e[i].zIndex&&a.push(e[i])}}},{key:"sortLayers",value:function(e){var t;e.sort((t="zIndex",function(e,a){return e[t]-a[t]}))}},{key:"getLayerContainer",value:function(e){var t=[];return e.length>0&&e.forEach((function(e,a){t.unshift(i.a.createElement(lr,{key:e.id,value:e,selected:e.id===this.props.selectedLayerId,twinkle:e.id===this.props.twinkleLayerId,onClick:this.setLayerSelected,changeLayerVisible:this.changeLayerVisible,changeLayerName:this.changeLayerName,notEditableTip:DataViz.Language.unsupportedEditMaker,showATLayerID:this.props.showATLayerID,showAttributeTable:this.props.showAttributeTable,removeCurrentLayer:this.props.removeCurrentLayer,hideMarkerPopup:this.props.hideMarkerPopup,updateLegendView:this.props.updateLegendView,twinkleLayer:this.props.twinkleLayer,updateLayerInfo:this.props.updateLayerInfo,scale:this.props.scale,changeCurrentScale:this.props.changeCurrentScale,addVectorTileLayer:this.props.addVectorTileLayer}))}),this),t}},{key:"render",value:function(){return this.classifyLayers(),i.a.createElement("div",{className:"layers-container"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},i.a.createElement("div",{className:"vector-layers layer-sort-container"},this.getLayerContainer(this.vectorLayers)),i.a.createElement("div",{className:"web-layers layer-sort-container"},this.getLayerContainer(this.webLayers)),i.a.createElement("div",{className:"base-layers layer-sort-container"},this.getLayerContainer(this.baseLayers))),i.a.createElement("input",{type:"file",id:"update-file",className:"add_data_input"}))}}]),t}(n.Component)),ur=a(49);function dr(e,t,a,n){return{layerId:e,feature:t,mousePosition:a,type:A.B,layerNotEditable:n}}function pr(e){return{feature:e,type:A.v}}function hr(e){return{payload:e,type:A.A}}a(1729);var fr=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"componentWillUnmount",value:function(){this.props.twinkleLayer()}},{key:"selectedLayer",value:function(e){this.props.changeSelectedLayer(e)}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(Ci,{addFromWeb:{addRestMapOverLayer:this.props.addRestMapOverLayer,addFromRestData:this.props.addFromRestData,addFromDataflow:this.props.addFromDataflow,addVectorTileLayer:this.props.addVectorTileLayer},addFromFile:{addRestMapOverLayer:this.props.addRestMapOverLayer,addFeatureFromFile:this.props.addFeatureFromFile,addVectorTileLayer:this.props.addVectorTileLayer,setLayerServerId:this.props.setLayerServerId},addFromSearch:{addRestMapOverLayer:this.props.addRestMapOverLayer,addFromRestData:this.props.addFromRestData,addVectorTileLayer:this.props.addVectorTileLayer},addMarkerLayer:this.props.addMarkerLayer,selectedLayer:this.selectedLayer.bind(this)}),i.a.createElement(cr,{layersUI:this.props.layersUI,selectedLayerId:this.props.selectedLayerId,twinkleLayerId:this.props.twinkleLayerId,selectedLayer:this.selectedLayer.bind(this),changeLayerIndex:this.props.changeLayerIndex,baseLayerIndex:this.props.baseLayerIndex,showATLayerID:this.props.showATLayerID,showAttributeTable:this.props.showAttributeTable,removeCurrentLayer:this.props.removeCurrentLayer,hideMarkerPopup:this.props.hideMarkerPopup,updateLegendView:this.props.updateLegendView,twinkleLayer:this.props.twinkleLayer,updateLayerInfo:this.props.updateLayerInfo,scale:this.props.scale,addVectorTileLayer:this.props.addVectorTileLayer,changeCurrentScale:this.props.changeCurrentScale}),i.a.createElement(Ja,{fold:this.props.fold,layersUI:this.props.layersUI,changeTabFold:this.props.changeTabFold,selectedLayerId:this.props.selectedLayerId,selectedLayer:this.selectedLayer.bind(this),changeTabInf:this.props.changeTabInf,changeBaseMapIndex:this.props.changeBaseMapIndex,changeMinMaxScale:this.props.changeMinMaxScale,baseLayerIndex:this.props.baseLayerIndex,updateBaseLayer:this.props.updateBaseLayer,showMarkerPopup:this.props.showMarkerPopup,hideMarkerPopup:this.props.hideMarkerPopup,updateLegendView:this.props.updateLegendView,updataMarker:this.props.updataMarker,selectedMarkerFeature:this.props.selectedMarkerFeature,mousePosition:this.props.mousePosition,showCustomSettings:this.props.showCustomSettings,isShowCustomSetting:this.props.isShowCustomSetting}))}}]),t}(n.Component),mr=Object(o.b)((function(e){return{baseLayerIndex:e.layerGroupReducer.baseLayerIndex,changeTabInf:e.changeTabReducer,layersUI:e.layerGroupReducer.tileLayers.concat(e.layerGroupReducer.vectorLayers),selectedLayerId:e.layerGroupReducer.selectedLayerId,showATLayerID:e.layerGroupReducer.showATLayerID,selectedMarkerFeature:e.manageMarkerLayerReducer.feature,twinkleLayerId:e.layerGroupReducer.twinkleLayerId,scale:e.MapInfoReducer.scale,mousePosition:e.manageMarkerLayerReducer.mousePosition,isShowCustomSetting:e.layerEditorReducer.isShowCustomSetting}}),(function(e,t){return{addMarkerLayer:function(t){return e(ur.d(t))},addFeatureFromFile:function(t){return e(ur.b(t))},addRestMapOverLayer:function(t,a){return e(ur.e(t,a))},addVectorTileLayer:function(t){return e(ur.f(t))},addFromRestData:function(t){return e(ur.c(t))},addFromDataflow:function(t,a){return e(ur.a(t,a))},setLayerServerId:function(t){return e(ur.l(t))},changeSelectedLayer:function(t){return e(ur.i(t))},changeLayerIndex:function(t){return e(ur.h(t))},changeBaseMapIndex:function(t,a){return e(ur.g(t,a))},showAttributeTable:function(t){return e(ur.m(t))},showMarkerPopup:function(t,a,n){return e(dr(t,a,n))},hideMarkerPopup:function(){e(pr())},updataMarker:function(t){return e(function(e){return{feature:e,type:A.B}}(t))},removeCurrentLayer:function(t){return e(ur.j(t))},updateLegendView:function(t,a){return e(ur.p(t,a))},twinkleLayer:function(t){e(ur.n(t))},updateLayerInfo:function(t,a){e(ur.o(t,a))},changeCurrentScale:function(t){e(V(t))},showCustomSettings:function(t){e(hr(t))},changeMinMaxScale:function(t){e(P(t))}}}))(fr),yr=(a(1730),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isShow:!1},a}return E()(t,e),y()(t,[{key:"updateFoldStatus",value:function(){this.setState({isShow:!this.state.isShow})}},{key:"render",value:function(){var e=this.state.isShow?" img-fold":" img-unfold";return i.a.createElement("div",{className:"openSource"},i.a.createElement("div",{className:"openSource-title"},i.a.createElement("span",{className:"title-name"},this.props.licenseName),i.a.createElement("a",{href:this.props.homePage,target:"_blank",className:"title-homePage"},DataViz.Language.homePage),i.a.createElement("span",{className:"protocol-name"},DataViz.Language.protocol),i.a.createElement("span",{className:"protocol-img"+e,onClick:this.updateFoldStatus.bind(this)})),i.a.createElement("div",{className:"openSource-content",style:{display:this.state.isShow?"block":"none"}},i.a.createElement("div",{className:"content"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},this.props.licenseContent))))}}]),t}(n.Component)),gr=(a(1731),[{id:2,licenseName:"file-saver",licenseContent:'The MIT LicenseCopyright  2016 Eli Grey.Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"https://github.com/eligrey/FileSaver.js"},{id:3,licenseName:"jszip",licenseContent:'The MIT LicenseCopyright (c) 2009-2016 Stuart Knightley, David Duponchel, Franz Buchinger, Antnio AfonsoPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"https://stuk.github.io/jszip/"},{id:4,licenseName:"lodash.clonedeep",licenseContent:"The MIT LicenseCopyright JS Foundation and other contributors <https://js.foundation/>Based on Underscore.js, copyright Jeremy Ashkenas,DocumentCloud and Investigative Reporters & Editors <http://underscorejs.org/>This software consists of voluntary contributions made by manyindividuals. For exact contribution history, see the revision historyavailable at https://github.com/lodash/lodash",homePage:"https://github.com/lodash/lodash"},{id:5,licenseName:"qrcode.react",licenseContent:'ISC LicenseCopyright (c) 2015, Paul OShannessyPermission to use, copy, modify, and/or distribute this software for anypurpose with or without fee is hereby granted, provided that the abovecopyright notice and this permission notice appear in all copies.THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITHREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY ANDFITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROMLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OROTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE ORPERFORMANCE OF THIS SOFTWARE.',homePage:"https://github.com/zpao/qrcode.react"},{id:6,licenseName:"rc-slider",licenseContent:'The MIT License (MIT)Copyright (c) 2015-present Alipay.com, https://www.alipay.com/Permission is hereby granted, free of charge, to any person obtaining a copyof this software and associated documentation files (the "Software"), to dealin the Software without restriction, including without limitation the rightsto use, copy, modify, merge, publish, distribute, sublicense, and/or sellcopies of the Software, and to permit persons to whom the Software isfurnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included inall copies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"https://github.com/schrodinger/rc-slider"},{id:7,licenseName:"react",licenseContent:'MIT LicenseCopyright (c) 2013-present, Facebook, Inc.Permission is hereby granted, free of charge, to any person obtaining a copyof this software and associated documentation files (the "Software"), to dealin the Software without restriction, including without limitation the rightsto use, copy, modify, merge, publish, distribute, sublicense, and/or sellcopies of the Software, and to permit persons to whom the Software isfurnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included inall copies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS ORIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THEAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHERLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS INTHE SOFTWARE.',homePage:"https://reactjs.org/"},{id:8,licenseName:"react-bootstrap-table",licenseContent:'The MIT License (MIT)Copyright (c) 2015 SparkMonitorPermission is hereby granted, free of charge, to any person obtaining a copyof this software and associated documentation files (the "Software"), to dealin the Software without restriction, including without limitation the rightsto use, copy, modify, merge, publish, distribute, sublicense, and/or sellcopies of the Software, and to permit persons to whom the Software isfurnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in allcopies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS ORIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THEAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHERLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THESOFTWARE.',homePage:"http://allenfang.github.io/react-bootstrap-table/"},{id:9,licenseName:"react-color",licenseContent:'The MIT License (MIT)Copyright (c) 2015 Case SandbergPermission is hereby granted, free of charge, to any person obtaining a copyof this software and associated documentation files (the "Software"), to dealin the Software without restriction, including without limitation the rightsto use, copy, modify, merge, publish, distribute, sublicense, and/or sellcopies of the Software, and to permit persons to whom the Software isfurnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included inall copies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESSOR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OFMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANYCLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THESOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"http://casesandberg.github.io/react-color"},{id:10,licenseName:"react-copy-to-clipboard",licenseContent:'The MIT License (MIT)Copyright (c) 2016 Nik ButenkoPermission is hereby granted, free of charge, to any person obtaining a copyof this software and associated documentation files (the "Software"), to dealin the Software without restriction, including without limitation the rightsto use, copy, modify, merge, publish, distribute, sublicense, and/or sellcopies of the Software, and to permit persons to whom the Software isfurnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in allcopies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS ORIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THEAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHERLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THESOFTWARE.',homePage:"https://github.com/nkbt/react-copy-to-clipboard"},{id:11,licenseName:"react-custom-scrollbars",licenseContent:'The MIT License (MIT)Copyright (c) 2015 react-custom-scrollbarsPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"https://github.com/malte-wessel/react-custom-scrollbars"},{id:12,licenseName:"react-modal",licenseContent:'Copyright (c) 2017 Ryan FlorencePermission is hereby granted, free of charge, to any person obtaining a copy ofthis software and associated documentation files (the "Software"), to deal inthe Software without restriction, including without limitation the rights touse, copy, modify, merge, publish, distribute, sublicense, and/or sell copiesof the Software, and to permit persons to whom the Software is furnished to doso, subject to the following conditions:The above copyright notice and this permission notice shall be included in allcopies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS ORIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THEAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHERLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THESOFTWARE.',homePage:"https://github.com/reactjs/react-modal"},{id:13,licenseName:"react-redux",licenseContent:'The MIT License (MIT)Copyright (c) 2015-present Dan AbramovPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"https://github.com/reduxjs/react-redux"},{id:15,licenseName:"react-sortable-hoc",licenseContent:'The MIT License (MIT)Copyright (c) 2016, Claudric DemersPermission is hereby granted, free of charge, to any person obtaining a copyof this software and associated documentation files (the "Software"), to dealin the Software without restriction, including without limitation the rightsto use, copy, modify, merge, publish, distribute, sublicense, and/or sellcopies of the Software, and to permit persons to whom the Software isfurnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in allcopies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS ORIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THEAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHERLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THESOFTWARE.',homePage:"https://github.com/clauderic/react-sortable-hoc"},{id:16,licenseName:"reactcss",licenseContent:'The MIT License (MIT)Copyright (c) 2015 Case SandbergPermission is hereby granted, free of charge, to any person obtaining a copyof this software and associated documentation files (the "Software"), to dealin the Software without restriction, including without limitation the rightsto use, copy, modify, merge, publish, distribute, sublicense, and/or sellcopies of the Software, and to permit persons to whom the Software isfurnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in allcopies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS ORIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THEAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHERLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THESOFTWARE.',homePage:"https://github.com/casesandberg/reactcss"},{id:17,licenseName:"redux",licenseContent:'The MIT License (MIT) Copyright (c) 2015-present Dan Abramov Permission is hereby granted,free of charge, to any person obtaining a copy of this software and associated documentation files(the "Software"), to deal in the Software without restriction, including without limitation the rightsto use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and topermit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OROTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTIONWITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"https://reduxframework.com/"},{id:18,licenseName:"redux-thunk",licenseContent:'The MIT License (MIT)Copyright (c) 2015-present Dan AbramovPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"https://github.com/reduxjs/redux-thunk"},{id:19,licenseName:"sortablejs",licenseContent:'Copyright 2013-2017 Lebedev Konstantin ibnRubaXa@gmail.com http://rubaxa.github.io/Sortable/Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.THIS SOFTWARE IS PROVIDED "AS IS",WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDINGBUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"http://sortablejs.github.io/Sortable/"},{id:21,licenseName:"rc-tooltip",licenseContent:'The MIT License (MIT)\n        Copyright (c) 2015-present Alipay.com, https://www.alipay.com/\n        Permission is hereby granted, free of charge, to any person obtaining a copy\n        of this software and associated documentation files (the "Software"), to deal\n        in the Software without restriction, including without limitation the rights\n        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n        copies of the Software, and to permit persons to whom the Software is\n        furnished to do so, subject to the following conditions:\n        The above copyright notice and this permission notice shall be included in\n        all copies or substantial portions of the Software.\n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS \n        OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF \n        MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. \n        IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY \n        CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, \n        TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE \n        SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"https://github.com/react-component/tooltip"},{id:22,licenseName:"react-dom",licenseContent:'Copyright (c) Facebook, Inc. and its affiliates.\n        Permission is hereby granted, free of charge, to any person obtaining a copy\n        of this software and associated documentation files (the "Software"), to deal\n        in the Software without restriction, including without limitation the rights\n        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n        copies of the Software, and to permit persons to whom the Software is\n        furnished to do so, subject to the following conditions:\n        The above copyright notice and this permission notice shall be included in all\n        copies or substantial portions of the Software.\n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n        SOFTWARE.',homePage:"https://reactjs.org/"},{id:23,licenseName:"react-js-pagination",licenseContent:'CC0 1.0 Universal\n        CREATIVE COMMONS CORPORATION IS NOT A LAW FIRM AND DOES NOT PROVIDE\n        LEGAL SERVICES. DISTRIBUTION OF THIS DOCUMENT DOES NOT CREATE AN\n        ATTORNEY-CLIENT RELATIONSHIP. CREATIVE COMMONS PROVIDES THIS\n        INFORMATION ON AN "AS-IS" BASIS. CREATIVE COMMONS MAKES NO WARRANTIES\n        REGARDING THE USE OF THIS DOCUMENT OR THE INFORMATION OR WORKS\n        PROVIDED HEREUNDER, AND DISCLAIMS LIABILITY FOR DAMAGES RESULTING FROM\n        THE USE OF THIS DOCUMENT OR THE INFORMATION OR WORKS PROVIDED\n        HEREUNDER.\n        Statement of Purpose',homePage:"https://github.com/vayser/react-js-pagination"},{id:24,licenseName:"viewerjs",licenseContent:"Apache License\n        Version 2.0, January 2004\n        http://www.apache.org/licenses/\n        TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION",homePage:"https://viewerjs.org/"},{id:25,licenseName:"xlsx",licenseContent:"Apache License\n        Version 2.0, January 2004\n        http://www.apache.org/licenses/\n        TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION",homePage:"http://sheetjs.com/opensource"},{id:26,licenseName:"@turf/bbox",licenseContent:'The MIT License (MIT)\n        Copyright (c) 2019 Morgan Herlocker\n\n        Permission is hereby granted, free of charge, to any person obtaining a copy of\n        this software and associated documentation files (the "Software"), to deal in\n        the Software without restriction, including without limitation the rights to\n        use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n        the Software, and to permit persons to whom the Software is furnished to do so,\n        subject to the following conditions:\n\n        The above copyright notice and this permission notice shall be included in all\n        copies or substantial portions of the Software.\n\n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n        FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n        COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n        IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n        CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"http://turfjs.org/"},{id:27,licenseName:"@turf/bezier-spline",licenseContent:'The MIT License (MIT)\n        Copyright (c) 2019 Morgan Herlocker\n\n        Permission is hereby granted, free of charge, to any person obtaining a copy of\n        this software and associated documentation files (the "Software"), to deal in\n        the Software without restriction, including without limitation the rights to\n        use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n        the Software, and to permit persons to whom the Software is furnished to do so,\n        subject to the following conditions:\n\n        The above copyright notice and this permission notice shall be included in all\n        copies or substantial portions of the Software.\n\n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n        FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n        COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n        IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n        CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"http://turfjs.org/"},{id:28,licenseName:"@turf/inside",licenseContent:'The MIT License (MIT)\n        Copyright (c) 2019 Morgan Herlocker\n\n        Permission is hereby granted, free of charge, to any person obtaining a copy of\n        this software and associated documentation files (the "Software"), to deal in\n        the Software without restriction, including without limitation the rights to\n        use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n        the Software, and to permit persons to whom the Software is furnished to do so,\n        subject to the following conditions:\n\n        The above copyright notice and this permission notice shall be included in all\n        copies or substantial portions of the Software.\n\n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n        FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n        COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n        IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n        CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"http://turfjs.org/"},{id:29,licenseName:"html2canvas",licenseContent:'The MIT License (MIT)\n        Copyright (c) 2012 Niklas von Hertzen\n\n        Permission is hereby granted, free of charge, to any person\n        obtaining a copy of this software and associated documentation\n        files (the "Software"), to deal in the Software without\n        restriction, including without limitation the rights to use,\n        copy, modify, merge, publish, distribute, sublicense, and/or sell\n        copies of the Software, and to permit persons to whom the\n        Software is furnished to do so, subject to the following\n        conditions:\n\n        The above copyright notice and this permission notice shall be\n        included in all copies or substantial portions of the Software.\n\n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,\n        EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n        OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n        NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n        HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n        WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n        FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n        OTHER DEALINGS IN THE SOFTWARE.',homePage:"https://html2canvas.hertzen.com/"},{id:30,licenseName:"moment",licenseContent:'The MIT License (MIT)\n        Copyright (c) JS Foundation and other contributors\n\n        Permission is hereby granted, free of charge, to any person\n        obtaining a copy of this software and associated documentation\n        files (the "Software"), to deal in the Software without\n        restriction, including without limitation the rights to use,\n        copy, modify, merge, publish, distribute, sublicense, and/or sell\n        copies of the Software, and to permit persons to whom the\n        Software is furnished to do so, subject to the following\n        conditions:\n\n        The above copyright notice and this permission notice shall be\n        included in all copies or substantial portions of the Software.\n\n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,\n        EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n        OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n        NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n        HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n        WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n        FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n        OTHER DEALINGS IN THE SOFTWARE.',homePage:"https://momentjs.com/"},{id:31,licenseName:"react-bootstrap-table-next",licenseContent:'The MIT License (MIT)\n        Copyright (c) 2018 react-bootstrap-table2\n\n        Permission is hereby granted, free of charge, to any person obtaining a copy\n        of this software and associated documentation files (the "Software"), to deal\n        in the Software without restriction, including without limitation the rights\n        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n        copies of the Software, and to permit persons to whom the Software is\n        furnished to do so, subject to the following conditions:\n\n        The above copyright notice and this permission notice shall be included in all\n        copies or substantial portions of the Software.\n\n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n        SOFTWARE.',homePage:"https://react-bootstrap-table.github.io/react-bootstrap-table2/"},{id:32,licenseName:"react-bootstrap-table2-editor",licenseContent:'The MIT License (MIT)\n        Copyright (c) 2018 react-bootstrap-table2\n\n        Permission is hereby granted, free of charge, to any person obtaining a copy\n        of this software and associated documentation files (the "Software"), to deal\n        in the Software without restriction, including without limitation the rights\n        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n        copies of the Software, and to permit persons to whom the Software is\n        furnished to do so, subject to the following conditions:\n\n        The above copyright notice and this permission notice shall be included in all\n        copies or substantial portions of the Software.\n\n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n        SOFTWARE.',homePage:"https://react-bootstrap-table.github.io/react-bootstrap-table2/"},{id:33,licenseName:"react-bootstrap-table2-filter",licenseContent:'The MIT License (MIT)\n        Copyright (c) 2018 react-bootstrap-table2\n\n        Permission is hereby granted, free of charge, to any person obtaining a copy\n        of this software and associated documentation files (the "Software"), to deal\n        in the Software without restriction, including without limitation the rights\n        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n        copies of the Software, and to permit persons to whom the Software is\n        furnished to do so, subject to the following conditions:\n\n        The above copyright notice and this permission notice shall be included in all\n        copies or substantial portions of the Software.\n\n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n        SOFTWARE.',homePage:"https://react-bootstrap-table.github.io/react-bootstrap-table2/"},{id:34,licenseName:"react-bootstrap-table2-paginator",licenseContent:'The MIT License (MIT)\n        Copyright (c) 2018 react-bootstrap-table2\n\n        Permission is hereby granted, free of charge, to any person obtaining a copy\n        of this software and associated documentation files (the "Software"), to deal\n        in the Software without restriction, including without limitation the rights\n        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n        copies of the Software, and to permit persons to whom the Software is\n        furnished to do so, subject to the following conditions:\n\n        The above copyright notice and this permission notice shall be included in all\n        copies or substantial portions of the Software.\n\n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n        SOFTWARE.',homePage:"https://react-bootstrap-table.github.io/react-bootstrap-table2/"},{id:35,licenseName:"react-bootstrap-table2-toolkit",licenseContent:'The MIT License (MIT)\n        Copyright (c) 2018 react-bootstrap-table2\n\n        Permission is hereby granted, free of charge, to any person obtaining a copy\n        of this software and associated documentation files (the "Software"), to deal\n        in the Software without restriction, including without limitation the rights\n        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n        copies of the Software, and to permit persons to whom the Software is\n        furnished to do so, subject to the following conditions:\n\n        The above copyright notice and this permission notice shall be included in all\n        copies or substantial portions of the Software.\n\n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n        SOFTWARE.',homePage:"https://react-bootstrap-table.github.io/react-bootstrap-table2/"},{id:36,licenseName:"simple-statistics",licenseContent:'ISC License\n        Copyright (c) 2014, Tom MacWright\n\n        Permission to use, copy, modify, and/or distribute this software for any\n        purpose with or without fee is hereby granted, provided that the above\n        copyright notice and this permission notice appear in all copies.\n\n        THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\n        REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND\n        FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\n        INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\n        LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\n        OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\n        PERFORMANCE OF THIS SOFTWARE.',homePage:"https://simplestatistics.org/"},{id:37,licenseName:"proj4",licenseContent:'Copyright (c) 2014, Mike Adair, Richard Greenwood, Didier Richard, Stephen Irons, Olivier Terral and Calvin Metcalf\n\n        Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n        \n        The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n        \n        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',homePage:"http://proj4js.org/"}]),vr=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getOpenSourceUI",value:function(){for(var e,t=[],a=0;a<gr.length;a++)e=i.a.createElement(yr,{key:gr[a].id,licenseName:gr[a].licenseName,licenseContent:gr[a].licenseContent,homePage:gr[a].homePage}),t.push(e);return t}},{key:"showMapTagsModalBox",value:function(){this.refs.openSourceModal.showModal()}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{className:"aboutDataViz-top"},i.a.createElement("img",{src:dataVizConfig.logoUrl}),i.a.createElement("span",{className:"title"},DataViz.Language.aboutDataVizTitle),i.a.createElement("span",{className:"version"},"V10.2.0.101215")),i.a.createElement("p",{className:"aboutDataViz-info"},DataViz.Language.aboutDataVizInfo,i.a.createElement("a",{onClick:this.showMapTagsModalBox.bind(this)},DataViz.Language.openSourceSoftWare)),i.a.createElement(re.a,{ref:"openSourceModal",modalTitle:DataViz.Language.openSourceProtocol,modalWidth:"584px",modalHeight:"320px",cancelButton:DataViz.Language.close,hideOkBtn:"true"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars",style:{width:"calc(100% - 48px)",padding:"0 24px"}},this.getOpenSourceUI())))}}]),t}(n.Component),Sr=(a(1732),{lbX:0,lbY:3,rtX:2,rtY:1}),br=Object.keys(Sr).map((function(e){return{title:DataViz.Language[e],key:e}})),Ir=function(e){var t=e.title,a=e.value;return i.a.createElement("div",{className:"map-extent-item"},i.a.createElement("span",{className:"title"},t),i.a.createElement("span",{className:"value"},a))},Er=function(e){var t=e.extent;return i.a.createElement("div",{className:"map-extent-pop"},br.map((function(e){var a=e.title,n=e.key,r=Sr[n];return i.a.createElement(Ir,{key:n,title:a,value:t[r]})})))},Tr=[-180,-90,180,90],Cr=DataViz.Language,Lr=window.DataViz.Language,Nr=[{title:Lr.title,inputTips:Lr.noneMapTitle},{title:Lr.label,tips:Lr.tagPrompt},{title:Lr.description,inputTips:Lr.noneDescription,type:"textarea"}],kr=[{title:Lr.longitude,key:"centerX"},{title:Lr.latitude,key:"centerY"},{title:Lr.mapLevel,key:"level"}],Or=function(e){function t(e){var a;f()(this,t),(a=v()(this,b()(t).call(this,e))).handleChangeMapCenter=a.handleChangeMapCenter.bind(O()(a)),a.handleChangeMapExtent=a.handleChangeMapExtent.bind(O()(a)),a.handleChangeMapShowType=a.handleChangeMapShowType.bind(O()(a)),a.changeMaxScale=a.changeMaxScale.bind(O()(a)),a.changeMinScale=a.changeMinScale.bind(O()(a)),de.a.scales&&de.a.scales.length&&(a.minScale=de.a.minScale||de.a.scales&&de.a.scales[0],a.maxScale=de.a.maxScale||de.a.scales&&de.a.scales[de.a.scales.length-1],a.minZoom=de.a.scales.indexOf(a.minScale),a.maxZoom=de.a.scales.indexOf(a.maxScale));var n=a.getMaxScaleArr(),i=n.maxScales,r=n.maxScalesLabel,s=a.getMinScaleArr(),o=s.minScales,l=s.minScalesLabel;return a.state={maxScaleLabelArr:r,minScaleLabelArr:l,maxScaleArr:i,minScaleArr:o},a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){(e.minScale||e.maxScale)&&(this.minScale=e.minScale||de.a.scales&&de.a.scales[0],this.maxScale=e.maxScale||de.a.scales&&de.a.scales[de.a.scales.length-1],this.minZoom=de.a.scales.indexOf(this.minScale),this.maxZoom=de.a.scales.indexOf(this.maxScale),this.updateScaleArr())}},{key:"handleChangeMapCenter",value:function(e,t){var a=this.props.mapSetting.center;if(isNaN(e))"level"===t?K.a.showMessage(Lr.levelIsWrong):K.a.showMessage(Lr.centerIsWrong),this.forceUpdate();else if(this.judgeLonlat(e,t)){switch(t){case"centerX":a[0]=+e;break;case"centerY":a[1]=+e;break;default:a[2]=+e}this.props.changeMapSetting({center:a},"level")}else K.a.showMessage(Lr.overBaseLayer),this.forceUpdate()}},{key:"handleChangeMapExtent",value:function(e,t){var a=this.props.mapSetting.extent;if(isNaN(e))return K.a.showMessage(Lr.extentIsWrong),void this.forceUpdate();var n=BboxExtentMapping[t];n>-1&&(a[n]=+e,this.props.changeMapSetting({extent:a},"extent"))}},{key:"handleChangeMapShowType",value:function(e){var t=e.target.getAttribute("name");this.props.changeMapSetting({type:t})}},{key:"judgeLonlat",value:function(e,t){var a=!1;return"centerX"===t?+e>=Tr[0]&&+e<=Tr[2]&&(a=!0):+e>=Tr[1]&&+e<=Tr[3]&&(a=!0),a}},{key:"changeMinScale",value:function(e){e=e.split(" ")[1]+"";var t=T.a.formatScale(e);de.a.setMinScale(t),this.minZoom=de.a.scales.indexOf(e),de.a.setMinZoom(this.minZoom),this.props.changeMinMaxScale({minScale:t}),this.updateScaleArr()}},{key:"changeMaxScale",value:function(e){e=e.split(" ")[1]+"";var t=T.a.formatScale(e);de.a.setMaxScale(t),this.maxZoom=de.a.scales.indexOf(e),de.a.setMaxZoom(this.maxZoom),this.props.changeMinMaxScale({maxScale:t}),this.updateScaleArr()}},{key:"updateScaleArr",value:function(){var e=this.getMaxScaleArr(),t=e.maxScales,a=e.maxScalesLabel,n=this.getMinScaleArr(),i=n.minScales,r=n.minScalesLabel;this.setState({maxScaleLabelArr:a,minScaleLabelArr:r,maxScaleArr:t,minScaleArr:i})}},{key:"getMaxScaleArr",value:function(){if(de.a.scales&&de.a.scales.length>0){var e=de.a.scales.indexOf(this.minScale),t=de.a.scales.slice(e+1),a=[],n=[];return t.forEach((function(t,i){a.push("".concat(Cr.level.replace("{num}",e+i+1)," ").concat(t)),n.push("".concat(Cr.level.replace("{num}",e+i+1)," ").concat(T.a.toLocalScale(t)))})),{maxScales:a,maxScalesLabel:n}}}},{key:"getMinScaleArr",value:function(){if(de.a.scales&&de.a.scales.length>0){var e=de.a.scales.indexOf(this.maxScale),t=de.a.scales.slice(0,e),a=[],n=[];return t.forEach((function(e,t){a.push("".concat(Cr.level.replace("{num}",t)," ").concat(e)),n.push("".concat(Cr.level.replace("{num}",t)," ").concat(T.a.toLocalScale(e)))})),{minScales:a,minScalesLabel:n}}}},{key:"render",value:function(){var e=this,t=this.props.mapSetting,a=t.type,n=t.center,r=t.extent;return i.a.createElement(le.a,{className:"scroll-bars"},i.a.createElement("div",{className:"mapsetting-content"},i.a.createElement(In.a,{title:Nr[0].title,inputTips:Nr[0].inputTips,inputValue:this.props.mapTitle,onBlur:this.props.changeMapTitle}),i.a.createElement("div",{className:"span-text-button"},i.a.createElement("span",null,Nr[1].title),i.a.createElement("span",{className:"tips"},Nr[1].tips),i.a.createElement(ue,{className:"setting-maptags",inputValue:this.props.mapTags,onChange:this.props.changeMapTags})),i.a.createElement(In.a,{title:Nr[2].title,inputTips:Nr[2].inputTips,inputValue:this.props.mapDescription,type:Nr[2].type,onBlur:this.props.changeMapDescription}),i.a.createElement("hr",null),kr.map((function(t,a){var r=t.title,s=t.key,o=t.inputTips;return i.a.createElement(In.a,{key:s,title:r,inputTips:o,inputValue:n[a],attribute:s,onChange:e.handleChangeMapCenter})})),i.a.createElement("hr",null),i.a.createElement("div",{className:"span-text"},i.a.createElement("span",{className:"title"},Cr.currentScale),i.a.createElement("span",{className:"current"},T.a.toLocalScale(this.props.scale))),i.a.createElement("div",{className:"span-text"},i.a.createElement("span",{className:"title"},Cr.maxScale),i.a.createElement(We.b,{values:this.state.maxScaleArr,labels:this.state.maxScaleLabelArr,selectedValue:"".concat(Cr.level.replace("{num}",this.maxZoom)," ").concat(this.maxScale),onChange:this.changeMaxScale,style:{width:"246px",marginTop:"8px"},isBubble:!0})),i.a.createElement("div",{className:"span-text"},i.a.createElement("span",{className:"title"},Cr.minScale),i.a.createElement(We.b,{values:this.state.minScaleArr,labels:this.state.minScaleLabelArr,selectedValue:"".concat(Cr.level.replace("{num}",this.minZoom)," ").concat(this.minScale),onChange:this.changeMinScale,style:{width:"246px",marginTop:"8px"},isBubble:!0})),i.a.createElement("p",{className:"group-title"},Lr.saveMapType),i.a.createElement("div",{className:"radio-title"},i.a.createElement(Ke.a,{name:"level",value:"level",selectedValue:a,onChange:this.handleChangeMapShowType},Lr.saveWithZoom)),i.a.createElement("div",{className:"radio-title"},i.a.createElement(Ke.a,{name:"extent",value:"extent",selectedValue:a,onChange:this.handleChangeMapShowType},Lr.saveWithExtent),i.a.createElement(C.a,{tooltip:i.a.createElement(Er,{extent:r}),trigger:"click",placement:"right",iconClassName:"supermapol-icons-query"})),i.a.createElement("hr",null),i.a.createElement(vr,null)))}}]),t}(n.Component),Dr=Object(o.b)((function(e){return{mapTitle:e.MapInfoReducer.mapTitle,mapTags:e.MapInfoReducer.mapTags,mapDescription:e.MapInfoReducer.mapDescription,mapSetting:e.MapInfoReducer.mapSetting,scale:e.MapInfoReducer.scale,minScale:e.MapInfoReducer.minScale,maxScale:e.MapInfoReducer.maxScale}}),(function(e,t){return{changeMapTitle:function(t){return e(F(t))},changeMapTags:function(t){return e(M(t))},changeMapDescription:function(t){return e(R(t))},changeMapSetting:function(t,a){return e(x(t,a))},changeMinMaxScale:function(t){return e(P(t))}}}))(Or),wr=(a(443),window.DataViz.Language),Ar=Oe(function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).changeTemplate=a.changeTemplate.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"changeTemplate",value:function(e){this.props.onEdit(this.props.parentKey,"templateName",e)}},{key:"changeInput",value:function(e,t){var a=t.target.value;this.props.onEdit(this.props.parentKey,e,a)}},{key:"render",value:function(){var e=this,t=this.props,a=t.title,n=t.subTitle,r=t.copyright,s=t.author,o=t.templates,l=t.templateName,c=t.hasTitle,u=t.hasSubtitle,d=t.hasCopyright,p=t.hasAuthor;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},wr.layoutTemplate),i.a.createElement(We.b,{values:o,className:"dv-select",onChange:this.changeTemplate,selectedValue:l})),c&&i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},wr.title),i.a.createElement(ge.h,{className:"dv-input",defaultValue:a,onBlur:function(t){e.changeInput("title",t)}})),u&&i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},wr.subTitle),i.a.createElement(ge.h,{className:"dv-input",defaultValue:n,onBlur:function(t){e.changeInput("subTitle",t)}})),d&&i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},wr.copyRight),i.a.createElement(ge.h,{className:"dv-input",defaultValue:r,onBlur:function(t){e.changeInput("copyright",t)}})),p&&i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},wr.user),i.a.createElement(ge.h,{className:"dv-input",defaultValue:s,onBlur:function(t){e.changeInput("author",t)}})))}}]),t}(n.Component),{title:wr.baseMapInfo}),Fr=a(74),Mr=(a(1733),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={imgSrc:null},a.fileName=a.props.fileName,a.inputElement=a.props.inputElement,a}return E()(t,e),y()(t,[{key:"changeImage",value:function(e){var t=this;if(e.target.value){var a=e.target.files[0],n=a.name;if(a.name.toLowerCase().match(/(.*?).(jpeg|png|jpg)$/))if(a.size<=2097152){var i=new FileReader;i.readAsDataURL(e.target.files[0]),i.onload=function(e){t.setState({imgSrc:e.target.result}),t.props.onChange(e.target.result,{fileName:n,file:a})}}else K.a.showMessage(DataViz.Language.sizeIsWrong);else K.a.showMessage(DataViz.Language.unSupportFileType,q.j.WARNING)}}},{key:"getUploadContent",value:function(){return this.props.uploadContent?this.props.uploadContent:i.a.createElement(i.a.Fragment,null,i.a.createElement("span",{className:"supermapol-icons-upload"}),i.a.createElement("span",null,DataViz.Language.uploadImg))}},{key:"render",value:function(){return i.a.createElement("div",{className:"upload-image"},i.a.createElement("div",{className:"upload"},i.a.createElement("input",{type:"file",id:this.props.inputId,name:"file",className:"upload-input",onChange:this.changeImage.bind(this),accept:"image/jpeg,image/png,image/jpg",title:this.fileName||DataViz.Language.noFilesSelected}),this.state.imgSrc||this.props.value?i.a.createElement("img",{src:this.state.imgSrc||this.props.value}):i.a.createElement("label",{className:"label-for-input",htmlFor:this.props.inputId},this.getUploadContent())),i.a.createElement("span",null,DataViz.Language.customImage))}}]),t}(n.Component)),Rr=window.DataViz.Language,xr=Oe(function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isChecked:Fr.a.isPrintLegend,type:"default"},a.uploadFileOption=null,a.onCheckedChange=a.onCheckedChange.bind(O()(a)),a.onImageChange=a.onImageChange.bind(O()(a)),a.onRadioChange=a.onRadioChange.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"onCheckedChange",value:function(e){var t=e.target.checked;t?this.updateLegendView():(this.uploadFileOption=null,this.props.updateLegendView(0)),this.setState({isChecked:t}),this.props.changePrintLegendStatus(t,this.state.type)}},{key:"onImageChange",value:function(e,t){this.uploadFileOption=t,this.props.changePrintLegendStatus(this.state.isChecked,this.state.type,this.uploadFileOption)}},{key:"updateLegendView",value:function(){var e=this;de.a.vectorLayers.forEach((function(t){var a=t.layerInfo;"MARKER"!==a.layerType&&(a.legendSetting={isShow:!0,isFold:!1},setTimeout((function(){e.props.updateLegendView(a.id,null,!1)}),0))}))}},{key:"onRadioChange",value:function(e){var t=this.state.isChecked;"default"===e?(this.updateLegendView(),this.props.changePrintLegendStatus(t,e)):this.props.changePrintLegendStatus(t,e,this.uploadFileOption),this.setState({type:e})}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"print-legend-setting"},i.a.createElement(se.a,{onChange:this.onCheckedChange,checked:this.state.isChecked},Rr.openLegend),this.state.isChecked&&i.a.createElement(Ke.b,{selectedValue:this.state.type,className:"legend-radio-group",onChange:this.onRadioChange},i.a.createElement(Ke.a,{key:"default",value:"default"},Rr.printCurrentLegend),i.a.createElement(Ke.a,{key:"custom",value:"custom"},Rr.customPrintLegend,i.a.createElement("div",{className:"radio-content"},"custom"===this.state.type&&i.a.createElement(Mr,{uploadContent:i.a.createElement("span",null,Rr.upload),isShowClear:!0,onChange:this.onImageChange}))))))}}]),t}(n.Component),{title:Rr.legend}),Pr=(a(1734),window.DataViz.Language),Vr=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this;return i.a.createElement("span",{className:"local-input"},i.a.createElement(ge.h,this.props),i.a.createElement(C.a,{iconClassName:"supermapol-icons-current input-icon",placement:"right",tooltip:Pr.getCurrentLocal,onClick:function(){e.props.onClick&&e.props.onClick()}}))}}]),t}(n.Component),Br=window.DataViz.Language,Ur=Oe(function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={scale:e.scale,center:e.center},a.getCurrentScale=a.getCurrentScale.bind(O()(a)),a.getCurrentCenter=a.getCurrentCenter.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"getCurrentScale",value:function(){var e=Fr.a.getCurrentScale();this.setState({scale:e}),this.props.onEdit(this.props.parentKey,"scale",e)}},{key:"getCurrentCenter",value:function(){var e=Fr.a.getCurrentCenter();this.setState({center:e}),this.props.onEdit(this.props.parentKey,"center",e)}},{key:"render",value:function(){var e=this.state,t=e.scale,a=e.center;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},Br.scales),i.a.createElement(Vr,{value:t,title:t,onClick:this.getCurrentScale})),i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},Br.centerPoint),i.a.createElement(Vr,{value:a,title:a,onClick:this.getCurrentCenter})))}}]),t}(n.Component),{title:Br.littleMap}),Gr=window.DataViz.Language,_r=function(e){function t(e){var a;f()(this,t);var n=(a=v()(this,b()(t).call(this,e))).props.defaultValue||a.props.value;return a.state={value:T.a.isNumber(n)?parseInt(n):""},a.onChange=a.onChange.bind(O()(a)),a.onBlur=a.onBlur.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"onChange",value:function(e){var t=e.target.value;t!==this.state.value&&(""===t?this.setState({value:""}):T.a.isNumber(t)?(t<this.props.min?(t=this.props.min,K.a.showMessage(Gr.overMinDPI)):t>this.props.max?(t=this.props.max,K.a.showMessage(Gr.overMaxDPI)):t=parseInt(t),this.setState({value:t}),this.props.onChange&&this.props.onChange(t)):this.setState({value:this.state.value}))}},{key:"onBlur",value:function(){var e=this.state.value;""===e&&(e=this.props.defaultValue||this.props.value,this.setState({value:e})),this.props.onBlur&&this.props.onBlur(e)}},{key:"getInputProps",value:function(){var e=this.props,t=Object.keys(e).filter((function(e){return!["onChange","onBlur","value","min","max"].includes(e)})),a={};return t.forEach((function(t){a[t]=e[t]})),a}},{key:"render",value:function(){var e=this.getInputProps();return i.a.createElement(ge.h,Y()({value:this.state.value,onBlur:this.onBlur,onChange:this.onChange},e))}}]),t}(n.Component),zr=window.DataViz.Language,jr={left:"VERTICALLABELSLEFT",right:"VERTICALLABELSRIGHT",bottom:"HORIZONTALLABELSBELOW",top:"HORIZONTALLABELSABOVE"},Wr={VERTICALLABELSLEFT:"left",VERTICALLABELSRIGHT:"right",HORIZONTALLABELSBELOW:"bottom",HORIZONTALLABELSABOVE:"top"},Hr=Oe(function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={scalePosition:Wr[a.props.orientation]||"top",scaleText:e.scaleText},a.changeScaleLength=a.changeScaleLength.bind(O()(a)),a.changePosition=a.changePosition.bind(O()(a)),a.getCurrentScale=a.getCurrentScale.bind(O()(a)),a.changeScaleStyle=a.changeScaleStyle.bind(O()(a)),a.changeUnit=a.changeUnit.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"changePosition",value:function(e){T.a.isNumber(e)?this.setState({scalePosition:this.state.scalePosition}):(this.setState({scalePosition:e}),this.props.onEdit(this.props.parentKey,"orientation",jr[e]))}},{key:"getCurrentScale",value:function(){var e=Fr.a.getCurrentScale();this.setState({scaleText:e}),this.props.onEdit(this.props.parentKey,"scaleText",e)}},{key:"changeScaleStyle",value:function(e){this.props.onEdit(this.props.parentKey,"type",e)}},{key:"changeScaleLength",value:function(e){this.props.onEdit(this.props.parentKey,"intervals",e)}},{key:"changeUnit",value:function(e){this.props.onEdit(this.props.parentKey,"unit",e)}},{key:"changeInput",value:function(e,t){var a=t.target.value;this.props.onEdit(this.props.parentKey,e,a)}},{key:"getScaleUnit",value:function(e){var t;switch(e){case"METER":t=zr.METER;break;case"FOOT":t=zr.FOOT;break;case"DEGREES":t=zr.DEGREES}return t}},{key:"render",value:function(){var e=this,t=this.state.scaleText,a=this.props,n=a.type,r=a.unit;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},zr.scaleText),i.a.createElement(ge.h,{className:"dv-input",defaultValue:t,onBlur:function(t){e.changeInput("scaleText",t)}})),i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},zr.symbolStyle),i.a.createElement(We.b,{className:"scale-select",selectedValue:n,hideTriangle:!0,renderValue:function(e){return i.a.createElement("div",{className:e})},onChange:this.changeScaleStyle},i.a.createElement(We.a,{value:"LINE"},i.a.createElement("div",{className:"LINE"})),i.a.createElement(We.a,{value:"BAR"},i.a.createElement("div",{className:"BAR"})),i.a.createElement(We.a,{value:"BAR_SUB"},i.a.createElement("div",{className:"BAR_SUB"})))),i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},zr.scaleLength),i.a.createElement(_r,{className:"dv-input",onBlur:this.changeScaleLength,value:this.props.intervals,min:1,max:20})),i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},zr.type),i.a.createElement(We.b,{className:"scale-select",selectedValue:r,renderValue:this.getScaleUnit,onChange:this.changeUnit},i.a.createElement(We.a,{value:"METER"},zr.METER),i.a.createElement(We.a,{value:"FOOT"},zr.FOOT),i.a.createElement(We.a,{value:"DEGREES"},zr.DEGREES))))}}]),t}(n.Component),{title:zr.scales}),Yr=window.DataViz.Language,Kr=["PDF","PNG"],Xr=Oe(function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.format,n=t.dpi,r=t.maxDPI;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},Yr.exportFormat),i.a.createElement(We.b,{values:Kr,selectedValue:a,className:"dv-select",onChange:function(t){e.props.onEdit(e.props.parentKey,"format",t)}})),i.a.createElement("div",{className:"editor-tool"},i.a.createElement("div",{className:"text"},"DPI"),i.a.createElement(_r,{className:"dv-input",defaultValue:n,onBlur:function(t){e.props.onEdit(e.props.parentKey,"dpi",t)},max:r,min:1})))}}]),t}(n.Component),{title:Yr.OutputSettings}),qr=(a(1735),window.DataViz.Language),Jr=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).showLoinBox=a.showLoinBox.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"showLoinBox",value:function(){K.a.showLoinBox({onSucceed:this.props.changeLoginStatus})}},{key:"getUnavailableTips",value:function(){return this.props.isLogin?i.a.createElement("div",{className:"unavalible-tip"},qr.printUnavalible):i.a.createElement("div",{className:"unavalible-tip"},qr.printUnavalibleWithLogin,i.a.createElement("a",{onClick:this.showLoinBox},qr.login))}},{key:"render",value:function(){return i.a.createElement("div",{className:"print-unavailable"},i.a.createElement("div",{className:"print-unavailable-image"}),this.getUnavailableTips())}}]),t}(n.Component),Zr=a(221),Qr=a.n(Zr),$r=window.DataViz.Language,es={WMTS:"WMTS".concat($r.layerManagement),HEAT:$r.layerHeat,DATAFLOW_POINT_TRACK:$r.DATAFLOW_POINT_TRACK,DATAFLOW_HEAT:$r.DATAFLOW_HEAT,MAPBOXSTYLE:$r.MAPBOXSTYLE,MARKER:$r.MARKER,MIGRATION:"".concat($r.layerMigration).concat($r.layerManagement),BAIDU:$r.baiduMap,GOOGLE:$r.google,GOOGLE_CN:$r.google,CLOUD:$r.cloud,CLOUD_BLACK:$r.cloudBlueBlack,OSM:$r.osm,BING:$r.bing,JAPAN_RELIEF:$r.japan_relief,JAPAN_ORT:$r.japan_ort,JAPAN_PALE:$r.japan_pale,JAPAN_STD:$r.japan_std},ts=function(e){function t(e){var a;f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isPrinting:!1,isLoading:!0,isAvalible:!1,templateName:null},a.author=null,a.templates=null,a.intervalTimes=0,a.isDownload=!1,a.checkPrintSetting=a.checkPrintSetting.bind(O()(a)),a.onEdit=a.onEdit.bind(O()(a)),a.isLogin=a.isLogin.bind(O()(a)),a.changePrintLegendStatus=a.changePrintLegendStatus.bind(O()(a));var n,i,r=a.props.mapTitle,s=Fr.a.printOptions.layoutOptions,o=s.scaleBarOptions,l=s.littleMapOptions;return s.title||(s.title=r),de.a.map&&(n=Fr.a.getCurrentScale(),i=Fr.a.getCurrentCenter()),!o.scaleText&&n&&(o.scaleText=n),!l.scale&&n&&(l.scale=n),!l.center&&i&&(l.center=i),a.isLogin(),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.isLogin&&this.isLogin()}},{key:"isLogin",value:function(){var e=this;Fr.a.isLogin().then((function(t){"GUEST"===t.nickName?e.setState({isAvalible:!1,isLoading:!1}):(e.author=Fr.a.printOptions.layoutOptions.author=t.userName,e.getPrintSettings())})).catch((function(){e.requestFaild()}))}},{key:"getPrintSettings",value:function(){var e=this;Fr.a.getPrintSettings().then((function(t){t&&Array.isArray(t)&&t.length?e.getTemplate():e.setState({isAvalible:!1,isLoading:!1})})).catch((function(){e.requestFaild()}))}},{key:"getTemplate",value:function(){var e=this;Fr.a.getPrintTemplates().then((function(t){e.templates=t,Fr.a.printOptions.layoutOptions.templateName=t[0],e.setState({isAvalible:!0,isLoading:!1,templateName:t[0]})})).catch((function(){e.requestFaild()}))}},{key:"requestFaild",value:function(){this.setState({isAvalible:!1,isLoading:!1})}},{key:"checkPrintSetting",value:function(){var e=this,t=this;T.a.checkReLogin().then((function(){var a=Fr.a.checkLayers();if(a.length>0){var n=e.getTips(a);K.a.showConfirmModal({children:n,hideCancelBtn:!0,modalTitle:$r.faild})}else{var i=Fr.a.getWebMap();i?t.saveApp(i,(function(){t.printMap(i)})):t.saveApp(i,(function(){i=Fr.a.getWebMap(),t.printMap(i)}))}})).catch((function(){K.a.showLoinBox({onSucceed:function(){t.props.changeLoginStatus();var e=Fr.a.getWebMap();t.saveApp(e,(function(){e=Fr.a.getWebMap(),t.printMap(e)}))}})}))}},{key:"printMap",value:function(e){var t=this;t.setState({isPrinting:!0}),t.isDownload=!1,K.a.showMessage($r.printing,q.j.WARNING),Fr.a.printMap(e,this.state.templateName).then((function(e){t.isDownload||(Qr.a.saveAs(e),t.isDownload=!0,t.setState({isPrinting:!1}),K.a.showMessage($r.printSuccess,q.j.SUCCESS))})).catch((function(){t.setState({isPrinting:!1}),K.a.showMessage($r.printFaild)}))}},{key:"saveApp",value:function(e,t){var a=this,n=a.props.mapInfo,i=Object.keys(ie.a.updateFeatures),r=Object.assign({changeAuthorizeSetting:a.props.changeAuthorizeSetting,authorizeSetting:n.authorizeSetting},n);0===i.length?e?ne.a.save(r,t):a.refs.saveModalBox.showModalBox(n,!1,t):a.refs.saveDataModalBox.showModalBox(n,!1,(function(){e?ne.a.save(r,t):a.refs.saveModalBox.showModalBox(n,!1,t)}))}},{key:"changePrintLegendStatus",value:function(e,t,a){Fr.a.isPrintLegend=e,Fr.a.preLegendOptions=e?{type:t,options:a}:null}},{key:"getTips",value:function(e){var t=$r.printUnSupportLayer,a="";return e.forEach((function(e){a+="".concat(es[e]).concat($r.comma)})),t.replace("{layerType}",a)}},{key:"onEdit",value:function(e,t,a){["scaleBarOptions","littleMapOptions"].includes(e)?Fr.a.changeLayoutOptions(e,t,a):("templateName"===t&&this.setState({templateName:a}),Fr.a.changeOptions(e,t,a))}},{key:"getContent",value:function(){var e=this,t=this.state,a=t.isLoading,n=t.isPrinting,r=t.isAvalible,s=t.templateName,o=Fr.a.printOptions,l=o.layoutOptions,c=o.exportOptions,u=l.scaleBarOptions,d=l.littleMapOptions,p=Fr.a.getTemplateFromName(s);if(a)return i.a.createElement("div",{className:"map-printing-loading"},i.a.createElement(ce.a,null));if(r&&p&&p.layoutOptions){var h=p.layoutOptions,f=h.hasCopyright,m=h.hasSubtitle,y=h.hasAuthor,g=h.hasScaleBar,v=h.hasTitle,S=h.hasLegend,b=h.hasLittleMap,I=Fr.a.isSupportLegend();return i.a.createElement("div",{className:"map-printing"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},i.a.createElement("div",{className:"dv-print-content"},i.a.createElement(Ar,Y()({parentKey:"layoutOptions",onEdit:this.onEdit},l,{templates:this.templates,hasTitle:v,hasSubtitle:m,hasCopyright:f,hasAuthor:y,isOpened:!0})),S&&I&&i.a.createElement(xr,{changePrintLegendStatus:this.changePrintLegendStatus,updateLegendView:this.props.updateLegendView}),b&&i.a.createElement(Ur,Y()({parentKey:"littleMapOptions",onEdit:this.onEdit},d)),g&&i.a.createElement(Hr,Y()({parentKey:"scaleBarOptions",onEdit:this.onEdit},u)),i.a.createElement(Xr,Y()({parentKey:"exportOptions",onEdit:this.onEdit},c,{maxDPI:p.maxDPI})))),i.a.createElement(ge.d,null),i.a.createElement(ge.b,{theme:"primary",loading:n,onClick:this.checkPrintSetting},n?$r.printing:$r.print))}return i.a.createElement(Jr,{isLogin:!!this.author,changeLoginStatus:function(){e.isLogin(),e.props.changeLoginStatus(!0)}})}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,this.getContent(),i.a.createElement(pe,{ref:"saveModalBox",mapInfo:this.props.mapInfo,changeMapInfo:this.props.changeMapInfo}),i.a.createElement(ye,{ref:"saveDataModalBox"}))}}]),t}(n.Component),as=Object(o.b)((function(e){return{mapTitle:e.MapInfoReducer.mapTitle,mapInfo:e.MapInfoReducer,isLogin:e.changeTabReducer.isLogin}}),(function(e){return{changeMapInfo:{changeMapTitle:function(t){return e(F(t))},changeMapTags:function(t){return e(M(t))},changeMapDescription:function(t){return e(R(t))}},changeAuthorizeSetting:function(t){return e(B(t))},updateLegendView:function(t,a){return e(ur.p(t,a))},changeLoginStatus:function(t){return e(Ie(t))}}}))(ts),ns=function(e){var t=e.id;return Object(n.useEffect)((function(){X.changeTabCallback(t)}),[t]),i.a.createElement("div",{id:t})},is=function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"getContent",value:function(){var e;switch(this.props.selectedId){case"dv-layers":e=i.a.createElement(mr,{selected:"dv-layers"===this.props.selectedId,fold:this.props.fold,changeTabFold:this.props.changeTabFold});break;case"dv-settings":e=i.a.createElement(Dr,{selected:"dv-settings"===this.props.selectedId});break;case"dv-print":e=i.a.createElement(as,null);break;default:e=i.a.createElement(ns,{id:this.props.selectedId})}return e}},{key:"render",value:function(){return i.a.createElement("div",{className:"nav-tabs-content"},this.getContent())}}]),t}(n.Component),rs=(a(1736),function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this.props.fold?{width:"52px",overflow:"hidden"}:{width:"344px"};return i.a.createElement("div",{style:e,className:"nav-tabs"},i.a.createElement(_,{fold:this.props.fold,changeTabFold:this.props.changeTabFold}),i.a.createElement(Te,{selectedId:this.props.selectedId,changeMenuTab:this.props.changeMenuTab}),i.a.createElement(is,{selectedId:this.props.selectedId,fold:this.props.fold,changeTabFold:this.props.changeTabFold}))}}]),t}(n.Component)),ss=Object(o.b)((function(e){return{selectedId:e.changeTabReducer.selectedId,fold:e.changeTabReducer.fold}}),(function(e,t){return{changeMenuTab:function(t){return e(function(e){return{payload:e,type:A.r}}(t))},changeTabFold:function(t){return e(be(t))}}}))(rs),os=a(670),ls=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).closePop=a.closePop.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"itemOnClick",value:function(e){this.props.changeStep(1,e)}},{key:"getContentUI",value:function(){var e=this,t=[];return this.props.tileLayers.forEach((function(a,n){var r=a.layerInfo.name,s=i.a.createElement("li",{key:n,onMouseUp:e.itemOnClick.bind(e,n)},i.a.createElement("span",{title:r},r),i.a.createElement("i",{className:"supermapol-icons-return"}));t.push(s)})),t}},{key:"closePop",value:function(){this.props.closePop()}},{key:"render",value:function(){var e=30*this.props.tileLayers.length;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"header"},i.a.createElement("p",null,DataViz.Language.selectIServerLayer),i.a.createElement("a",{className:"supermapol-icons-close",onMouseUp:this.closePop})),i.a.createElement("div",{className:"content",style:{height:"".concat(e,"px")}},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},this.getContentUI())))}}]),t}(n.Component),cs=new ol.format.WMSGetFeatureInfo;function us(e){return i.a.createElement("li",{className:"item"},i.a.createElement("span",{className:"field",title:e.field},e.field),i.a.createElement("span",{className:"value"},e.value))}var ds=["SmID","SmX","SmY","SmLibTileID","SmUserID","SmGeometrySize","SmGeoPosition","SmLength","SmSdriW","SmSdriN","SmSdriE","SmSdriS","SmTopoError","SmArea","SmPerimeter"],ps=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={datas:[],loading:!0,currentLayerIdx:0,nextEnable:!1,prevEnable:!1},a.closePop=a.closePop.bind(O()(a)),a.queryCompleted=a.queryCompleted.bind(O()(a)),a}var a,n;return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.coordinate!==this.props.coordinate&&this.getDatas()}},{key:"componentDidMount",value:function(){this.highLightSource||(this.highLightSource=de.a.highLightLayer.getSource()),de.a.highLightLayer.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point(this.props.coordinate)})),this.getDatas()}},{key:"getDatas",value:function(){var e=this.props,t=e.tileLayer,a=e.coordinate;if("WMS"===t.layerInfo.layerType)this.getWMSData(t,a);else{var n=t.layerInfo?t.layerInfo:t;this.getRESTData(n,a)}}},{key:"getWMSData",value:function(e,t){var a=this,n=e.layer,i=de.a.map.getView(),r=n.getSource().getFeatureInfoUrl(t,i.getResolution(),i.getProjection().getCode(),{INFO_FORMAT:"text/xml",FEATURE_COUNT:5});r&&T.a.doFetch(r,{method:"GET",dataType:"text",withCredentials:T.a.isIportalProxyServiceUrl(r)}).then((function(e){if(e.includes("ServiceException")){var t=e.match(/\<ServiceException\>(.*)\<\/ServiceException\>/)[1]||DataViz.Language.queryFailed;return K.a.showMessage(t),a.highLightSource.clear(),void a.closePop()}var n=cs.readFeatures(e,{}),i=[];n.forEach((function(e){e.getGeometry()&&i.push({name:e.getId(),feature:e})})),a.setState({datas:i,loading:!1,nextEnable:i.length>1})}))}},{key:"getRESTData",value:(n=p()(u.a.mark((function e(t,a){var n,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],e.t0=!t.subLayers,!e.t0){e.next=5;break}return e.next=5,T.a.getSublayers(t.url,null,{token:t.credential}).then((function(e){t.subLayers=e}));case 5:t.subLayers&&t.subLayers.forEach((function(e){var t=e.subLayers&&e.subLayers.layers;if(t&&t.length)t=t.filter((function(e){return"CAD"!==e.datasetInfo.type})),n=n.concat(t);else{if("CAD"===e.datasetInfo.type)return;n=n.concat(e)}})),n.length>0?(i=n.map((function(e){return{name:e.name}})),this.query(i,a)):this.setState({loading:!1});case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"query",value:(a=p()(u.a.mark((function e(t,a){var n,i,r,s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.props.tileLayer.layerInfo,i=n.url,this.epsgCode=de.a.getBaseLayerProj(),r=this.getQueryPolygon(a),s=new SuperMap.QueryByGeometryParameters({queryParams:t,geometry:r,prjCoordSys:{epsgCode:this.epsgCode.split(":")[1]},returnFeatureWithFieldCaption:!0}),o={withCredentials:T.a.isIportalProxyServiceUrl(i)},T.a.isInTheSameDomain(i)&&(o.proxy=T.a.getProxy()),new ol.supermap.QueryService(i,o).queryByGeometry(s,this.queryCompleted);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"queryCompleted",value:function(e){var t=[];e.result&&"processCompleted"===e.type?(e.result.recordsets.forEach((function(e){var a=e.features.features;if(a.length){var n=a.map((function(t){return{name:e.datasetName,feature:T.a.translateTools.readFeature(t)}}));t=t.concat(n)}})),this.setState({datas:t,loading:!1,nextEnable:e.result.currentCount>1})):(K.a.showMessage(DataViz.Language.queryFailed),this.highLightSource.clear(),this.closePop())}},{key:"getQueryPolygon",value:function(e){var t=de.a.map.getPixelFromCoordinate(e),a=de.a.map.getCoordinateFromPixel([t[0]-3,t[1]-3]),n=de.a.map.getCoordinateFromPixel([t[0]+3,t[1]-3]),i=de.a.map.getCoordinateFromPixel([t[0]+3,t[1]+3]),r=de.a.map.getCoordinateFromPixel([t[0]-3,t[1]+3]);return new ol.geom.Polygon([[a,n,i,r]])}},{key:"getContentUI",value:function(){var e=this.state.datas,t="",a=null;if(this.state.loading)t=DataViz.Language.querying,a=i.a.createElement(ce.a,null);else if(e.length){var n=this.getAttriUI();t=n.name,a=n.UIs.length?i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},n.UIs):i.a.createElement(nn,{text:DataViz.Language.noQueryResult})}else t=DataViz.Language.noQueryResult,a=i.a.createElement(nn,{text:t});return{name:t,UI:a}}},{key:"getAttriUI",value:function(){var e=this.state.datas[this.state.currentLayerIdx],t=e.feature,a=t.getProperties(),n=[];for(var r in a){var s=a[r];if(!(s instanceof ol.geom.Geometry||ds.includes(r))){var o=i.a.createElement(us,{key:r,field:r,value:JSON.stringify(s)});n.push(o)}}return this.highLightFeatures(t),{name:e.name,UIs:n}}},{key:"highLightFeatures",value:function(e){this.highLightSource.clear(),e&&this.highLightSource.addFeature(e)}},{key:"toggleLayer",value:function(e){var t=this.state.nextEnable,a=this.state.prevEnable,n=this.state.currentLayerIdx;e&&!t||!e&&!a||(n=e?n+1:n-1,this.setState({prevEnable:n>0,nextEnable:n<this.state.datas.length-1,currentLayerIdx:n}))}},{key:"closePop",value:function(){this.props.closePop()}},{key:"render",value:function(){var e=this.getContentUI(),t=this.state.datas.length?this.state.datas.length:0;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"header"},i.a.createElement("div",null,i.a.createElement("i",{className:"supermapol-icons-solid-triangle prev ".concat(this.state.prevEnable?"":" disable"),onMouseUp:this.toggleLayer.bind(this,!1)}),i.a.createElement("span",{className:"pages".concat(this.state.loading||!this.state.datas.length?" hide":"")},"(".concat(this.state.currentLayerIdx+1,"/").concat(t,")")),i.a.createElement("span",{className:"title",title:e.name},e.name),i.a.createElement("i",{className:"supermapol-icons-solid-triangle next ".concat(this.state.nextEnable?"":" disable"),onMouseUp:this.toggleLayer.bind(this,!0)})),i.a.createElement("a",{className:"supermapol-icons-close",onMouseUp:this.closePop})),i.a.createElement("div",{className:"content".concat(this.state.loading?" loading":"")},e.UI))}}]),t}(n.Component),hs=(a(674),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={step:0,currentLayer:null},a.changeStep=a.changeStep.bind(O()(a)),a.closePop=a.closePop.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.coordinate!==this.props.coordinate&&this.setState({step:0})}},{key:"closePop",value:function(){de.a.map.getOverlayById("tile-pop").setPosition(null),de.a.highLightLayer.getSource().clear()}},{key:"changeStep",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e?(de.a.selectedTileLayers=[this.props.tileLayers[t]],this.setState({step:e,currentLayer:this.props.tileLayers[t]})):this.setState({step:e})}},{key:"render",value:function(){return i.a.createElement("div",{className:"tile-pop ".concat(this.state.step?"tile-attr-second":"tile-attr-first")},this.state.step?i.a.createElement(ps,{tileLayer:this.state.currentLayer,changeStep:this.changeStep,coordinate:this.props.coordinate,closePop:this.closePop}):i.a.createElement(ls,{tileLayers:this.props.tileLayers,changeStep:this.changeStep,closePop:this.closePop}))}}]),t}(n.Component)),fs=a(431),ms=a(193),ys=a(85),gs=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={featureType:a.props.feature.getGeometry().getType()},a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){this.state.featureType!=e.feature.getGeometry().getType()&&this.setState({featureType:e.feature.getGeometry().getType()})}},{key:"getDefaultStyle",value:function(e){var t=this.props.feature.getProperties().useStyle,a={strokeOpacity:t.strokeOpacity,strokeColor:t.strokeColor,strokeWidth:t.strokeWidth,lineCap:t.lineCap,lineDash:t.lineDash};return"Polygon"===e&&(a.fillColor=t.fillColor,a.fillOpacity=t.fillOpacity),a}},{key:"getStyleContent",value:function(){var e,t;switch(q.e[this.state.featureType.toUpperCase()]){case q.e.POINT:var a=this.props.feature.getProperties().useStyle,n=a.src?"Symbol":"Style";e=i.a.createElement(fs.a,{feature:this.props.feature,type:n});break;case q.e.LINE:a=this.getDefaultStyle("LineString"),t=ys.a.getUIConfig(a,"LineString"),e=i.a.createElement(ms.a,{type:"LineString",config:t,feature:this.props.feature,style:a});break;case q.e.POLYGON:a=this.getDefaultStyle("Polygon"),t=ys.a.getUIConfig(a,"Polygon"),e=i.a.createElement(ms.a,{type:"Polygon",config:t,feature:this.props.feature,style:a})}return e}},{key:"render",value:function(){return i.a.createElement("div",{className:"feature-style"},this.getStyleContent())}}]),t}(n.Component),vs=(a(1737),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={selectedIndex:0},a}return E()(t,e),y()(t,[{key:"changeTab",value:function(e,t){this.state.selectedIndex!=t&&(this.setState({selectedIndex:t}),this.props.onChange(e))}},{key:"getContainer",value:function(){var e=[];return this.props.navs.forEach((function(t,a){e.push(i.a.createElement("div",{className:this.state.selectedIndex===a?"active":"",onClick:this.changeTab.bind(this,t.key,a),key:t.key},t.title))}),this),e}},{key:"render",value:function(){return i.a.createElement("div",{className:"nav"},this.getContainer())}}]),t}(n.Component)),Ss=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={imageType:"local",featureInfo:e.featureInfo},a.navs=[{title:DataViz.Language.local,key:"local"},{title:DataViz.Language.network,key:"network"}],a.changeImageType=a.changeImageType.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.featureInfo!==this.state.featureInfo&&this.setState({featureInfo:e.featureInfo})}},{key:"changeImageType",value:function(e){e!==this.state.imageType&&this.setState({imageType:e})}},{key:"checkUrl",value:function(e){return null==e||""===e||(!(!T.a.isMatchUrl(e)&&e.indexOf("data:image")<0)||(K.a.showMessage(DataViz.Language.urlIsWrong),!1))}},{key:"changeValue",value:function(e,t,a){if(!["dataViz_imgUrl","dataViz_videoUrl","dataViz_url"].includes(e)||this.checkUrl(t)){var n=this.state.featureInfo;n[e]=t,this.setState({featureInfo:n}),"dataViz_imgUrl"===e&&a&&this.props.saveImgFile(a)}}},{key:"isUploadImage",value:function(e){var t=!1;if(e&&e.dataViz_imgUrl){var a=e.dataViz_imgUrl;return a.indexOf(T.a.getIPortalUrl())>-1?t=!0:a.indexOf("data:image")>-1&&(t=!0),t}}},{key:"render",value:function(){var e=this,t=this.state.featureInfo,a=this.isUploadImage(t);return i.a.createElement("div",{className:"feature-info"},i.a.createElement(In.a,{title:DataViz.Language.title,inputValue:t.dataViz_title,inputTips:DataViz.Language.defaultMarkerName,ref:"titleText",onBlur:this.changeValue.bind(this,"dataViz_title")}),i.a.createElement(In.a,{title:DataViz.Language.description,inputValue:t.dataViz_description,type:"textarea",ref:"desText",onBlur:this.changeValue.bind(this,"dataViz_description")}),i.a.createElement("div",{className:"image"},i.a.createElement("div",null,DataViz.Language.symbolImage),i.a.createElement("div",null,i.a.createElement(vs,{navs:this.navs,onChange:this.changeImageType,selectedIndex:a?0:1}),"local"===this.state.imageType?i.a.createElement(Mr,{inputId:"marker-upload-image",value:a?t.dataViz_imgUrl:"",onChange:this.changeValue.bind(this,"dataViz_imgUrl")}):i.a.createElement("textarea",{placeholder:"http(s)://",ref:"imgUrl",defaultValue:a?"":t.dataViz_imgUrl,onChange:function(t){e.changeValue("dataViz_imgUrl",t.target.value)}}))),i.a.createElement(In.a,{title:DataViz.Language.videoUrl,inputTips:"http(s)://",ref:"videoLink",inputValue:t.dataViz_videoUrl||"",onChange:this.changeValue.bind(this,"dataViz_videoUrl")}),i.a.createElement(In.a,{title:DataViz.Language.otherUrl,inputTips:"http(s)://",ref:"urlText",inputValue:t.dataViz_url,onChange:this.changeValue.bind(this,"dataViz_url")}))}}]),t}(n.Component),bs=(a(334),new RegExp(/^dataViz_/,"i")),Is=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"feature-name"},i.a.createElement("label",{title:this.props.attrName},this.props.attrName),i.a.createElement("input",{ref:function(t){e.input=t},onChange:function(t){T.a.delayCall(e.onChange,500,e)},type:"text",defaultValue:this.props.attrValue}))}},{key:"onChange",value:function(){var e=this.input.value&&this.input.value.trim();this.props.onChange&&this.props.onChange(this.props.attrName,e)}}]),t}(n.Component),Es=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={feature:e.feature},a.onChange=a.onChange.bind(O()(a)),a.attrCache=Object.assign({},e.feature.get("attributes")),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){"feature"in e&&(this.setState({feature:e.feature}),this.attrCache=Object.assign({},e.feature.get("attributes")))}},{key:"getContent",value:function(){var e=this.state.feature.get("attributes"),t=[],a=Object.keys(e);return(a=a.filter((function(e){return!bs.test(e)}))).forEach((function(a){var n=e[a];(T.a.isNumber(n)||T.a.isString(n))&&t.push(i.a.createElement(Is,{onChange:this.onChange,key:a,attrName:a,attrValue:e[a]}))}),this),0==t.length&&t.push(i.a.createElement(nn,{key:"no-data"})),t}},{key:"getChangeCache",value:function(){return Object.assign({},this.attrCache)}},{key:"onChange",value:function(e,t){this.attrCache[e]=t}},{key:"render",value:function(){return i.a.createElement("div",{className:"feature-attr"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},this.getContent()))}}]),t}(n.Component),Ts=a(150),Cs=window.DataViz.Language,Ls=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={selectedTab:1,isShow:!0,setFeaturesStyle:!1},a.feature=null,a.featureInfo=window.cloneDeep(Object.assign(Ts.a.getDefaultAttribute(),a.props.featureInfo)),a.confirm=a.confirm.bind(O()(a)),a.close=a.close.bind(O()(a)),a.deleteFeature=a.props.deleteFeature.bind(O()(a)),a.applyToFeatures=a.applyToFeatures.bind(O()(a)),a.changePreviewState=a.changePreviewState.bind(O()(a)),a.imgFile=null,a.saveImgFile=a.saveImgFile.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"confirm",value:function(){var e=this;if(e.featureInfo){var t=e.featureInfo;if(!t)return;if(t.dataViz_imgUrl.indexOf("data:image")>-1){var a=e.props.feature.getProperties().index||0,n=this.imgFile||e.props.imgFileObj,i="".concat(e.feature.layerId,"-").concat(a,".").concat(n.fileName.split(".")[1]),r=n.file;e.uploadImage(i,r,(function(a){t.dataViz_imgUrl=T.a.getIPortalUrl()+a,e.setAttribute2Feature(t)}))}else e.setAttribute2Feature(t)}else if(e.refs.featureAttr){var s=this.refs.featureAttr.getChangeCache(),o=Object.assign(this.props.feature.get("attributes"),s);this.props.feature.setProperties({attributes:o})}e.close()}},{key:"setAttribute2Feature",value:function(e){var t=this.props.feature.get("attributes"),a=Object.assign(t,e);this.props.feature.setProperties({attributes:a})}},{key:"uploadImage",value:function(e,t,a){T.a.checkReLogin().then((function(){var n="".concat(T.a.getIPortalUrl(),"web/uploadfile.json");return n+=encodeURI("?toFile=".concat("./resources/portal/dataviz/markericon/").concat(e)),T.a.doFetch(n,{method:"POST",withCredentials:!0,file:!0,uploadFile:t}).then((function(e){a(e.filePath)})).catch((function(){K.a.showMessage(Cs.uploadDataFaild,q.j.WARNING,3e3)}))})).catch((function(){K.a.showMessage(Cs.noLogin,q.j.WARNING,3e3)}))}},{key:"close",value:function(){this.props.close(),this.feature=null}},{key:"applyToFeatures",value:function(){this.setState({setFeaturesStyle:!this.state.setFeaturesStyle})}},{key:"changePreviewState",value:function(e){this.props.onPreview(e,this.featureInfo)}},{key:"saveImgFile",value:function(e){e&&(this.imgFile=e,this.props.changeImgFile(e))}},{key:"getContainer",value:function(){var e;switch(this.state.selectedTab){case 0:e=i.a.createElement(Ss,{ref:"featureInfo",featureInfo:this.featureInfo,onload:this.props.updateMarkerInfo,saveImgFile:this.saveImgFile});break;case 1:e=i.a.createElement(gs,{feature:this.props.feature});break;default:e=i.a.createElement(Es,{ref:"featureAttr",feature:this.props.feature})}return e}},{key:"render",value:function(){var e=this;return this.props.feature&&this.props.feature.getProperties().useStyle?(Ua.a.setLayerId(this.props.feature.layerId),this.state.setFeaturesStyle?Ua.a.setApplyToLayer(this.state.setFeaturesStyle,this.props.feature):Ua.a.setApplyToLayer(this.state.setFeaturesStyle),this.feature=this.props.feature,i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"marker-pop-head"},i.a.createElement("div",null,Cs.markerEdit),i.a.createElement("span",{className:"supermapol-icons-close",onClick:this.close})),i.a.createElement("div",{className:"marker-feature-pop"},i.a.createElement("div",{className:"marker-pop-content"},i.a.createElement("div",{className:"head"},i.a.createElement("div",{className:0===this.state.selectedTab?"active tab":"tab",onClick:function(){e.setState({selectedTab:0})}},Cs.information),i.a.createElement("div",{className:1===this.state.selectedTab?"active tab":"tab",onClick:function(){e.setState({selectedTab:1})}},Cs.markerStyle),i.a.createElement("div",{className:2===this.state.selectedTab?"active tab":"tab",onClick:function(){e.setState({selectedTab:2})}},Cs.markerAttribute),i.a.createElement("div",{style:{display:1===this.state.selectedTab?"inline-block":"none"}},i.a.createElement(se.a,{checked:this.state.setFeaturesStyle,onChange:this.applyToFeatures},Cs.applyToFeatures))),this.getContainer()),i.a.createElement("div",{className:"marker-pop-foot"},i.a.createElement(ge.k,{title:DataViz.Language.isDeleteFeature,placement:"top",cancelText:DataViz.Language.cancelButton,okText:DataViz.Language.deleted,onConfirm:this.deleteFeature},i.a.createElement("div",{className:"delete"},Cs.deleted)),i.a.createElement("div",{className:"preview",onClick:function(){e.changePreviewState(!0)}},Cs.preview),i.a.createElement("div",{className:"confirm",onClick:this.confirm},Cs.okButton))))):null}}]),t}(n.Component),Ns=(a(1738),a(15)),ks=a.n(Ns),Os=a(430),Ds=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={position:null,showColorPicker:!1,background:e.color||"#FFA500"},a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){this.updateState(e.color,!1,!0)}},{key:"createReactCSS",value:function(){var e={default:{color:{width:this.props.iconClassName?"11px":"14px",height:this.props.iconClassName?"2px":"14px",margin:this.props.iconClassName?"0px 0px 0px 3px":"6px 6px 6px 6px",background:"".concat(this.state.background),boxSizing:"border-box",border:""},swatch:{padding:"5px",background:"#fff",borderRadius:"1px",boxShadow:"0 0 0 1px rgba(0,0,0,.1)",display:"inline-block",cursor:"pointer"},popover:{position:"fixed",zIndex:"3002",marginTop:"18px"},cover:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}}};if("#FFFFFF"===this.state.background.toUpperCase()&&(e.default.color.border="1px solid #D9D9D9"),null!==this.state.position){for(var t,a,n=document.getElementsByClassName("select-name"),i=9999,r=0;r<n.length;r++)t=n[r].getBoundingClientRect().top,(a=this.clickY-t)>0&&a<i&&(i=t);"top"===this.state.position?(e.default.popover.top=i-18-320+"px",e.default.swatch.boxShadow="0 0 0 0 rgba(0,0,0,.1)"):e.default.popover.top=i-16+24+"px"}return ks()(e)}},{key:"getColorPicker",value:function(e){return this.state.showColorPicker?i.a.createElement("div",{style:e.popover},i.a.createElement("div",{style:e.cover,onClick:this.handleClose.bind(this)}),i.a.createElement(Os.SketchPicker,{color:this.state.background,onChange:this.handlerChange.bind(this)})):null}},{key:"render",value:function(){var e=this.createReactCSS();return i.a.createElement("div",{className:"colors-picker-wrapper"},i.a.createElement(C.a,{placement:"top",trigger:"hover",tooltip:this.props.tooltip,iconClassName:this.state.showColorPicker?"colors-picker chart_select drop-down-box-selected":"colors-picker chart_select",onClick:this.handleClick.bind(this)},this.props.iconClassName?i.a.createElement("div",{ref:"selected",className:"select-name"},i.a.createElement("div",{className:this.props.iconClassName}),i.a.createElement("div",{style:e.color})):i.a.createElement("div",{ref:"selected",className:"select-name"},i.a.createElement("div",{style:e.color}))),this.getColorPicker(e))}},{key:"handlerChange",value:function(e){var t=ct.a.RGB2String(e.rgb);this.updateState(t,null);var a=this;T.a.delayCall((function(){a.props.onColorPickerChange(t,this.props.value)}),800,a)}},{key:"handleClick",value:function(e){var t=e.pageY,a="bottom";t+320>document.body.clientHeight&&(a="top"),this.clickY=t,this.updateState(null,!0,!1,a)}},{key:"handleClose",value:function(){this.updateState(null,!1)}},{key:"updateState",value:function(e,t,a,n){var i={};e?(i.background=e,a&&(i.showColorPicker=t)):i.showColorPicker=t,n&&(i.position=n),this.setState(i)}}]),t}(n.Component),ws=(a(1739),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).onClick=e.onClick.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"getButtons",value:function(){var e=[];return this.props.buttons.forEach((function(t,a){e.push(i.a.createElement("label",{className:t.isActive?"active":"",key:a},i.a.createElement("span",{className:"contorl-span-input"},i.a.createElement("input",null),i.a.createElement("span",null)),i.a.createElement(C.a,{placement:"top",labelType:"span",iconClassName:t.iconClass,tooltip:t.tooltip,onClick:this.props.onClick.bind(this,t.key,t.value?t.value:!t.isActive),style:{fontSize:"16px"}})))}),this),e}},{key:"render",value:function(){return i.a.createElement("div",{className:"text-control"},this.getButtons())}}]),t}(n.Component)),As=(a(1740),a(1742),window.DataViz.Language),Fs=["Microsoft YaHei","SimSun","SimHei","KaiTi","FangSong","Arial","Times-New-Roman","sans-serif"],Ms=["small","normal","large","huge"],Rs={small:"10px",normal:"13px",large:"20px",huge:"33px"},xs=[358,416,520],Ps=["bold","italic"],Vs=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={bold:!1,italic:!1,underline:!1,strike:!1,align:null,font:null,size:null},a.style=Object.assign({},a.props.style),a.editor=e.editor,a.close=a.close.bind(O()(a)),a.deleteFeature=a.props.deleteFeature.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentDidMount",value:function(){var e=this;e.editor=new ge.m("#markerText",{modules:{toolbar:"#markerToolbar"}});var t=ge.m.import("formats/font");t.whitelist=Fs,ge.m.register(t,!0),e.resetStyle(),e.editor.on("text-change",(function(){T.a.delayCall((function(){e.setFeature()}),300,e)})),e.editor.root.addEventListener("keydown",(function(e){e.stopPropagation()})),e.editor.root.addEventListener("keypress",(function(e){e.stopPropagation()}))}},{key:"componentWillReceiveProps",value:function(e){e.style!==this.style&&(this.style=e.style,this.resetStyle())}},{key:"setFeature",value:function(){if(this.editor.getContents()&&this.editor.getContents().ops[0]){var e=this.getText();if(!e||0===e.length)return void K.a.showMessage(As.contentIsNull,q.j.WARNING);e=e.replace(/\s+$/g,"");var t=this.editor.getFormat(),a=this.style.font;t&&"{}"!==JSON.stringify(t)&&(a="",t.bold&&(a+="bold "),t.italic&&(a+="italic "),t.size?a+="".concat(Rs[t.size]," "):a+="".concat(Rs.normal," "),t.font?a+=t.font:a+=Fs[0]);var n=this.state.align||this.style.textAlign,i={text:e.toString(),font:a,placement:"point",textAlign:n,fillColor:t.color||this.style.fillColor,backgroundFill:t.background||this.style.backgroundFill,borderColor:"rgba(255,255,255,0)",borderWidth:4,padding:[8,8,8,8],maxWidth:this.maxWidth||this.style.maxWidth,canvas:this.style.canvas};Ua.a.setStyle(i,"TEXT",this.props.feature),this.props.feature.setProperties({attributes:{dataViz_title:i.text}})}this.editor&&this.props.getEditor(this.editor)}},{key:"getText",value:function(){if("\n"!==this.editor.getText()&&""!==this.editor.getText().trim()){for(var e=this.editor.getContents().ops,t="",a=0;a<e.length;a++)e[a].insert&&"\n"!==e[a].insert?t+=e[a].insert:"\n"===e[a].insert&&(t+="\r\n");return t}}},{key:"close",value:function(){this.props.close()}},{key:"changeText",value:function(e,t){if(this.editor.setSelection(0,this.editor.getLength()),"size"===e){var a=Number(Rs[t].replace(/[^0-9]/gi,""));a+16>Number(this.maxWidth)&&(this.maxWidth=a+16)}this.setState(j()({},e,t)),"size"===e&&t===Ms[1]||"font"===e&&t===Fs[0]?t=!1:"align"===e&&"left"===t&&(t=!1),this.editor.format(e,t,"user")}},{key:"changeColor",value:function(e,t){"color"===t?this.style.fillColor=e:"background"===t&&(this.style.backgroundFill=e),this.editor.setSelection(0,this.editor.getLength()),this.editor.format(t,e,"user")}},{key:"changeWidth",value:function(e){this.maxWidth=e,this.setFeature()}},{key:"judgeWidth",value:function(e){if(T.a.isNumber(e)){var t=this.editor.getFormat(),a=Number(Rs[t.size||"normal"].replace(/[^0-9]/gi,""))+16;return!(e<a)||(K.a.showMessage(As.lessThanWidth+a),!1)}return K.a.showMessage(As.widthIsWrong),!1}},{key:"resetStyle",value:function(){var e=this.style;if(this.editor){this.editor.setText(e.text),this.editor.setSelection(0,this.editor.getLength());var t=e.textAlign;"left"===t&&(t=!1),this.editor.format("align",t,"user"),this.setState({align:e.textAlign}),this.editor.format("background",e.backgroundFill,"user"),this.editor.format("color",e.fillColor,"user"),e.font.split(" ").forEach((function(e){if(e.indexOf("px")>-1)for(var t in Rs)Rs[t]===e&&(t===Ms[1]?this.editor.format("size",!1):this.editor.format("size",t),this.editor.format("size",t),this.setState({size:t}));else Fs.indexOf(e)>-1?(this.editor.format("font",e),this.setState({font:e})):Ps.indexOf(e)>-1&&(this.editor.format(e,!0),this.setState(j()({},e,!0)))}),this),this.editor.setSelection()}}},{key:"render",value:function(){Ua.a.setApplyToLayer(!1);var e=[{isActive:this.state.bold,iconClass:"supermapol-icons-bold",tooltip:As.bold,key:"bold"},{isActive:this.state.italic,iconClass:"supermapol-icons-italics",tooltip:As.italic,key:"italic"}],t=[{isActive:"left"===this.state.align,iconClass:"supermapol-icons-left-alignment",tooltip:As.alignLeft,key:"align",value:"left"},{isActive:"right"===this.state.align,iconClass:"supermapol-icons-right-alignment",tooltip:As.alignRight,key:"align",value:"right"},{isActive:"center"===this.state.align,iconClass:"supermapol-icons-middle-alignmen",tooltip:As.alignCenter,key:"align",value:"center"},{isActive:"justify"===this.state.align,iconClass:"supermapol-icons-justify-align",tooltip:As.alignJustify,key:"align",value:"justify"}];return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"marker-pop-head"},i.a.createElement("div",null,As.textEdit),i.a.createElement("span",{className:"supermapol-icons-close",onClick:this.close})),i.a.createElement("div",{className:"marker-text-pop"},i.a.createElement("div",{className:"marker-pop-content"},i.a.createElement("div",{id:"markerToolbar"},i.a.createElement(We.b,{iconClassName:"supermapol-icons-font",values:Fs,tooltip:As.font,onChange:this.changeText.bind(this,"font"),selectedValue:this.state.font}),i.a.createElement(We.b,{iconClassName:"supermapol-icons-font-size",values:Ms,tooltip:As.fontSize,onChange:this.changeText.bind(this,"size"),selectedValue:this.state.size}),i.a.createElement(Ds,{iconClassName:"supermapol-icons-font-color",color:this.style.fillColor,value:"color",onColorPickerChange:this.changeColor.bind(this),tooltip:As.fontColor}),i.a.createElement(We.b,{iconClassName:"supermapol-icons-textbox-maxwidth",values:xs,onChange:this.changeWidth.bind(this),selectedValue:null,customPlaceholder:DataViz.Language.width,customValue:this.style.maxWidth,valueLimitFun:this.judgeWidth.bind(this),height:"150px",listClassName:"width",tooltip:As.fontMaxWidth}),i.a.createElement(Ds,{color:this.style.backgroundFill,value:"background",onColorPickerChange:this.changeColor.bind(this),tooltip:As.backgroundColor}),i.a.createElement(ws,{buttons:e,onClick:this.changeText.bind(this)}),i.a.createElement(ws,{buttons:t,onClick:this.changeText.bind(this)})),i.a.createElement("div",{id:"markerText"})),i.a.createElement("div",{className:"marker-pop-foot"},i.a.createElement(ge.k,{title:DataViz.Language.isDeleteFeature,placement:"top",cancelText:DataViz.Language.cancelButton,okText:DataViz.Language.deleted,onConfirm:this.deleteFeature},i.a.createElement("div",{className:"footer-button delete"},As.deleted)),i.a.createElement("div",{className:"footer-button confirm",onClick:this.close},As.closeButton))))}}]),t}(n.Component),Bs=(a(620),window.DataViz.Language);var Us=function(){return i.a.createElement("div",{className:"load-failed"},i.a.createElement("svg",{width:"48px",height:"44px",viewBox:"139 52 48 44"},i.a.createElement("path",{d:"M152.714286,68.9230769 C154.610286,68.9230769 156.142857,67.4101538 156.142857,65.5384615 C156.142857,63.6667692 154.610286,62.1538462 152.714286,62.1538462 C150.818286,62.1538462 149.285714,63.6667692 149.285714,65.5384615 C149.285714,67.4101538 150.818286,68.9230769 152.714286,68.9230769 Z M175.843429,82.6104615 C167.995429,77.7975385 157.980571,77.7975385 150.136,82.6104615 C149.368,83.0809231 149.100571,84.1301538 149.532571,84.9627692 C149.961143,85.7953846 150.928,86.0864615 151.696,85.616 C158.590857,81.3886154 167.385143,81.3886154 174.283429,85.616 C174.526857,85.7683077 174.797714,85.8393846 175.061714,85.8393846 C175.617143,85.8393846 176.155429,85.5212308 176.446857,84.9593846 C176.878857,84.1301538 176.608,83.0809231 175.843429,82.6104615 Z M180.142857,52 L145.857143,52 C142.072,52 139,55.0326154 139,58.7692308 L139,89.2307692 C139,92.9673846 142.072,96 145.857143,96 L180.142857,96 C183.928,96 187,92.9673846 187,89.2307692 L187,58.7692308 C187,55.0326154 183.928,52 180.142857,52 Z M183.571429,89.2307692 C183.571429,91.1024615 182.038857,92.6153846 180.142857,92.6153846 L145.857143,92.6153846 C143.961143,92.6153846 142.428571,91.1024615 142.428571,89.2307692 L142.428571,58.7692308 C142.428571,56.8975385 143.961143,55.3846154 145.857143,55.3846154 L180.142857,55.3846154 C182.038857,55.3846154 183.571429,56.8975385 183.571429,58.7692308 L183.571429,89.2307692 Z M173.285714,62.1538462 C171.389714,62.1538462 169.857143,63.6667692 169.857143,65.5384615 C169.857143,67.4101538 171.389714,68.9230769 173.285714,68.9230769 C175.181714,68.9230769 176.714286,67.4101538 176.714286,65.5384615 C176.714286,63.6667692 175.181714,62.1538462 173.285714,62.1538462 Z",id:"Shape",fill:"#D9D9D9",fillRule:"nonzero",mask:"url(#mask-2)"})),i.a.createElement("div",null,Bs.loadFaild))},Gs=(a(676),a(217)),_s=a.n(Gs),zs=window.DataViz.Language,js=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).customStyles={content:{top:"50%",left:"50%",right:0,bottom:0,transform:"translate(-50%, -50%)",border:"none",padding:0,borderRadius:0,backgroundColor:"transparent",height:"75%",width:"75%",textAlign:"center"}},a.play=a.play.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"render",value:function(){return i.a.createElement(_s.a,{shouldFocusAfterRender:!0,shouldReturnFocusAfterClose:!1,isOpen:this.props.isShow,parentSelector:function(){return document.querySelector(".app-root")},onAfterOpen:this.play,style:this.customStyles},"video"===this.props.type?i.a.createElement("video",{id:"full-screen-video",className:"video-player",autoPlay:!0,controls:!0},i.a.createElement("source",{src:this.props.url,type:"video/webm"}),i.a.createElement("source",{src:this.props.url,type:"video/mp4"}),i.a.createElement("source",{src:this.props.url,type:"video/ogg"}),i.a.createElement("p",null,zs.notSupportVideo)):i.a.createElement("img",{id:"full-screen-img",src:this.props.url,alt:""}),i.a.createElement("div",{className:"close-btn supermapol-icons-close",onClick:this.props.showFullscreenPlay.bind(null,!1)}))}},{key:"play",value:function(){this.videoDom=document.querySelector("#full-screen-video .video-player"),this.videoDom&&this.videoDom.play()}}]),t}(n.Component),Ws=window.DataViz.Language,Hs=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isShow:!1},a.startPlay=a.startPlay.bind(O()(a)),a.videoDom=null,a.errorEvent=a.errorEvent.bind(O()(a)),a.showFullscreenPlay=a.showFullscreenPlay.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentDidMount",value:function(){this.startPlay()}},{key:"render",value:function(){return i.a.createElement("div",{id:"video-box"},i.a.createElement("svg",{className:"play-btn div-center",viewBox:"10 8 144 144",onClick:this.showFullscreenPlay.bind(this,!0)},i.a.createElement("path",{d:"M144.496875,52.7515625 C130.497656,19.5071875 93.5848438,2.2796875 59.1126563,12.9025 C24.640625,23.5253125 3.82671875,58.5414063 10.9676563,93.8992187 C18.1085938,129.257031 50.8804688,153.450781 86.7732813,149.862656 C122.666094,146.274375 150.000067,116.071719 150.000067,80 C150.012936,70.6399051 148.14138,61.3729966 144.496875,52.7515625 Z",id:"",fill:"#0081E2"}),i.a.createElement("path",{d:"M110.984375,73.8875 L74.53125,45.98125 C72.2650478,44.246161 69.2104428,43.9477378 66.6512734,45.2114064 C64.0921041,46.4750751 62.4718588,49.0817815 62.4718588,51.9359375 L62.4718588,107.751562 C62.465951,110.608455 64.0852749,113.22006 66.6469038,114.484943 C69.2085327,115.749826 72.26655,115.447803 74.53125,113.70625 L110.984375,85.8 C112.838911,84.3809001 113.926625,82.178948 113.926625,79.84375 C113.926625,77.508552 112.838911,75.3065999 110.984375,73.8875 Z",id:"",fill:"#FFFFFF"})),i.a.createElement("div",{className:"loading-img-gif div-center"}),i.a.createElement("video",{width:"250",id:"marker-video-url",onError:this.errorEvent},i.a.createElement("source",{src:this.props.url,type:"video/webm"}),i.a.createElement("source",{src:this.props.url,type:"video/mp4"}),i.a.createElement("p",null,Ws.notSupportVideo)),i.a.createElement(js,{showFullscreenPlay:this.showFullscreenPlay,url:this.props.url,type:"video",isShow:this.state.isShow}))}},{key:"showFullscreenPlay",value:function(e){this.setState({isShow:e})}},{key:"startPlay",value:function(){this.videoDom=document.querySelector("#video-box");var e=this;if(this.videoDom){var t=this.videoDom.childNodes[0],a=this.videoDom.childNodes[1],n=this.videoDom.childNodes[2];e.videoEvent(n,t,a,(function(){e.showFullscreenPlay(!0)}))}}},{key:"errorEvent",value:function(){var e=this.videoDom.childNodes[0],t=this.videoDom.childNodes[1],a=this.videoDom.childNodes[2];t.classList.add("hide"),e.classList.add("hide"),a.setAttribute("poster","".concat(T.a.getIPortalUrl(),"apps/dataviz/static/imgs/no_image.png")),a.onmouseover=null,a.onclick=null}},{key:"videoEvent",value:function(e,t,a,n){e.addEventListener("ended",(function(){t.classList.remove("hide")})),e.addEventListener("error",(function(){e.setAttribute("poster","".concat(T.a.getIPortalUrl(),"apps/dataviz/static/imgs/no_image.png")),a.classList.add("hide"),t.classList.add("hide"),e.onmouseover=null,e.onclick=null})),e.addEventListener("loadstart",(function(){e.setAttribute("poster",""),a.classList.remove("hide"),t.classList.add("hide")})),e.addEventListener("loadeddata",(function(){e.setAttribute("poster",""),a.classList.add("hide"),t.classList.remove("hide"),e.onmouseover=function(){e.play(),t.classList.add("hide")},e.onclick=n}))}}]),t}(n.Component),Ys=(a(444),window.DataViz.Language),Ks=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={imageStatus:!0,isShow:!1},a.fullscreenPlay=null,a.showFullscreenPlay=a.showFullscreenPlay.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"getAttribute",value:function(){var e=this.props.attributes,t=Object.keys(e),a=["dataViz_title","dataViz_description","dataViz_imgUrl","dataViz_url","dataViz_videoUrl","dataviz_featureID"],n=[];return t.forEach((function(t){a.indexOf(t)>-1||!t||n.push(i.a.createElement("tr",{className:"attributes-tr",key:t},i.a.createElement("td",null,t),i.a.createElement("td",null,e[t])))})),n}},{key:"changeImageStatus",value:function(e){this.setState({imageStatus:e})}},{key:"showFullscreenPlay",value:function(e){this.setState({isShow:e})}},{key:"render",value:function(){var e=this.props.attributes,t=e.dataViz_title?e.dataViz_title:Ys.lackOfTitle,a=e.dataViz_imgUrl?e.dataViz_imgUrl:null,n=e.dataViz_videoUrl?e.dataViz_videoUrl:null,r=e.dataViz_description?e.dataViz_description:Ys.noneDescription,s=e.dataViz_url?e.dataViz_url:null;return i.a.createElement("div",{className:"marker-pop pop-preview marker-pop-side"},i.a.createElement("div",{className:"marker-head"},i.a.createElement("span",{className:"head-title"},t),i.a.createElement("span",{className:"supermapol-icons-close",onClick:this.props.close})),i.a.createElement("div",{className:"marker-content ps"},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},n?i.a.createElement(Hs,{url:n}):"",a&&this.state.imageStatus?i.a.createElement(i.a.Fragment,null,i.a.createElement("img",{id:"marker-img-url",src:a,onClick:this.showFullscreenPlay.bind(this,!0),onLoad:this.changeImageStatus.bind(this,!0),onError:this.changeImageStatus.bind(this,!1)}),i.a.createElement(js,{url:a,type:"image",isShow:this.state.isShow,showFullscreenPlay:this.showFullscreenPlay})," "):this.state.imageStatus?"":i.a.createElement(Us,null),i.a.createElement("div",{className:"marker-description"},r),s?i.a.createElement("a",{href:s,target:"_blank"},s):"",i.a.createElement("table",{className:"marker-attribute"},i.a.createElement("tbody",{className:"attributes-table"},this.getAttribute())))),i.a.createElement("div",{className:"marker-pop-foot"},!this.props.hideCloseBtn&&i.a.createElement("div",{className:"exit-preview",onClick:this.props.onChange.bind()},Ys.exitPreview)))}}]),t}(n.Component),Xs=(a(1618),function(e){function t(e){var a;f()(this,t),a=v()(this,b()(t).call(this,e));var n=e.feature,i=e.layerNotEditable,r=n?n.get("attributes"):null;return a.state={feature:n,markerInfo:r,isPreview:i},a.previewInfo=null,a.close=a.close.bind(O()(a)),a.imgFileObj=null,a.changeImgFile=a.changeImgFile.bind(O()(a)),a.onPreview=a.onPreview.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"changeImgFile",value:function(e){this.imgFileObj=e}},{key:"close",value:function(){this.props.hideMarkerPopup(),Ua.a.isClose=!0,this.setState({feature:null,markerInfo:null,isPreview:!1})}},{key:"deleteFeature",value:function(){var e=this.props.feature;de.a.getVectorLayerById(e.layerId).removeFeature(e),this.close()}},{key:"onPreview",value:function(e,t){this.setState({isPreview:e,markerInfo:t})}},{key:"getComponent",value:function(e){var t=this,a=this.props.feature.getProperties().useStyle,n=this.state.markerInfo,r=n||Ts.a.getDefaultAttribute();return{TextEdit:i.a.createElement(Vs,{feature:this.props.feature,style:a,close:this.close,deleteFeature:this.deleteFeature,editor:this.editor,getEditor:function(e){t.editor=e}}),DefaultEdit:i.a.createElement(Ls,{feature:this.props.feature,close:this.close,deleteFeature:this.deleteFeature,featureInfo:this.state.markerInfo,imgFileObj:this.imgFileObj,changeImgFile:this.changeImgFile,onPreview:this.onPreview,isLayerPreview:this.state.isPreview}),DefaultView:i.a.createElement(Ks,{attributes:r,onChange:function(){t.onPreview(!1,n)},hideCloseBtn:this.props.layerNotEditable,close:this.close})}[e]}},{key:"render",value:function(){var e=this.props,t=e.feature,a=e.layerNotEditable;Ua.a.isClose=!1;var n=t.getProperties().useStyle,r=n&&n.text?a?"TextView":"TextEdit":a?"DefaultView":this.state.isPreview?"DefaultView":"DefaultEdit";return"TextView"===r?"":i.a.createElement("div",{id:"dataviz-marker-pop",className:"en"===window.lang?"dataviz-marker-pop-en":""},i.a.createElement("div",{className:this.state.isPreview?"marker-pop-side rotateYshow":"marker-pop-side"},this.getComponent(r),i.a.createElement("div",{className:"marker-pop-arrow"},i.a.createElement("div",{className:"arrow"}))))}}]),t}(n.Component)),qs=(a(1619),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={fold:!0},a.overviewMapControl=null,a}return E()(t,e),y()(t,[{key:"updateState",value:function(e){"undefined"!==e&&(this.state.fold=e),this.setState(this.state)}},{key:"changeOverViewFold",value:function(){this.state.fold&&(this.overviewMapControl=de.a.overviewMapControl,this.overviewMapControl||(this.overviewMapControl=de.a.createOverviewMapControl())),this.updateState(!this.state.fold)}},{key:"render",value:function(){var e=this.state.fold?"":"overviewPanel-show";return i.a.createElement("div",{className:"overview"},i.a.createElement("a",{className:this.state.fold?"":"fold",title:this.state.fold?DataViz.Language.openOverViewMap:DataViz.Language.closeOverViewMap,onClick:this.changeOverViewFold.bind(this)}),i.a.createElement("div",{id:"overviewMapPanel",className:"overviewPanel "+e}))}}]),t}(n.Component)),Js=(a(1743),a(1744),function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getContentUI",value:function(){return this.props.themeType===q.r.UNIQUE?i.a.createElement("div",{className:"detail-values",title:this.props.data.value},this.props.data.value):[q.r.RANGE,q.r.RANK_SYMBOL].includes(this.props.themeType)?i.a.createElement("div",{className:"detail-values"},i.a.createElement("span",{className:"detail-start"},this.props.data.value),i.a.createElement("i",{className:"detail-separator"},"-"),i.a.createElement("span",{className:"detail-end"},this.props.data.value1)):void 0}},{key:"getPointStyle",value:function(){var e,t=this.props.data,a={width:2*t.radius+"px",height:2*t.radius+"px"},n="",r=this.props.featureType,s=t.type;if([q.r.RANK_SYMBOL,q.r.UNIQUE].includes(this.props.themeType))if("IMAGE_POINT"===s&&t.imageInfo)e=i.a.createElement("img",{src:t.imageInfo.url,style:a});else if("SVG_POINT"===s&&t.symbolInfo&&t.symbolInfo.url)e=i.a.createElement("img",{src:t.symbolInfo.url,style:a});else if("SYMBOL_POINT"===s&&t.symbolInfo&&t.symbolInfo.unicode)a.color=t.color,a.fontSize=2*t.radius+"px",a.opacity=t.fillOpacity,delete a.width,delete a.height,n=t.symbolInfo.className,e=i.a.createElement("div",{className:n,style:a});else if(this.props.themeType===q.r.RANK_SYMBOL)a.color=t.color,n=q.q[r],e=i.a.createElement("div",{className:n,style:a});else{var o=t.color,l=t.strokeOpacity,c=t.fillOpacity,u=t.fontSize,d=t.strokeWidth;a.color=o,r===q.p.LINE?(a.opacity=l,a.fontSize="".concat(12+d,"px")):a.opacity=c,r===q.p.POINT?a.fontSize=u:r===q.p.POLYGON&&(a.fontSize="".concat(d-1+12,"px")),n=this.getIconClass(t,r),e=i.a.createElement("div",{className:n,style:a})}else n=q.q[this.props.featureType],a={color:this.props.data.color},e=i.a.createElement("div",{className:n,style:a});return e}},{key:"getIconClass",value:function(e,t){var a=e.lineDash;return t===q.p.POINT||"solid"===a?q.q[this.props.featureType]:t===q.p.LINE?"supermapol-icons-line-s".concat(a):"supermapol-icons-polygon-s".concat(a)}},{key:"render",value:function(){var e="detail-container ".concat(this.props.themeType===q.r.RANK_SYMBOL?" rank":" color");return i.a.createElement("div",{className:e},i.a.createElement("div",{className:"detail-key"},this.getPointStyle()),this.getContentUI())}}]),t}(n.Component)),Zs=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"getContentUI",value:function(){var e=null,t=de.a.getVectorLayerById(this.props.layerID).layerInfo.captions||{};if([q.r.UNIQUE,q.r.RANGE,q.r.RANK_SYMBOL].includes(this.props.layerType))e=i.a.createElement("div",{className:"item-content",style:{display:this.props.isFold?"none":"block"}},i.a.createElement("div",{className:"content-info"},DataViz.Language.legendThemeField,i.a.createElement("span",null,t[this.props.themeField]||this.props.themeField)),i.a.createElement("div",{className:"content-container",style:{height:this.props.detailHeight}},i.a.createElement(oe.Scrollbars,{className:"scroll-bars"},this.getFieldUI(this.props.datas,this.props.layerType,this.props.featureType))));else if(this.props.layerType===q.r.HEAT_MAP||this.props.layerType===q.r.DATAFLOWHEAT){var a={background:"linear-gradient(".concat(this.props.datas.join(","),")")};e=i.a.createElement("div",{className:"item-content",style:{display:this.props.isFold?"none":"block"}},this.props.themeField&&this.props.themeField!==DataViz.Language.notSet&&i.a.createElement("div",{className:"content-info"},DataViz.Language.legendWeightField,i.a.createElement("span",null,this.props.themeField)),i.a.createElement("div",{className:"content-container legend-heat"},i.a.createElement("div",{className:"heat-gradient",style:a}),i.a.createElement("p",{className:"first"},DataViz.Language.rarely),i.a.createElement("p",{className:"second"},DataViz.Language.balanced),i.a.createElement("p",{className:"third"},DataViz.Language.crowded)))}return e}},{key:"getFieldUI",value:function(e,t,a){var n,r=[];return e.forEach((function(e,s){n=i.a.createElement(Js,{key:s,data:e,themeType:t,featureType:a}),r.push(n)})),r}},{key:"removeLegend",value:function(){de.a.getVectorLayerById(this.props.layerID).layerInfo.legendSetting={isShow:!1,isFold:!1},this.props.removeLegend(-this.props.layerID)}},{key:"updateStatus",value:function(e,t,a){a.stopPropagation(),this.props.layerType!==q.r.VECTOR&&this.props.layerType!==q.r.SYMBOL&&this.props.updateState(e,t)}},{key:"render",value:function(){var e={display:[q.r.VECTOR,q.r.SYMBOL,q.r.DATAFLOW,q.r.MIGRATION].includes(this.props.layerType)?"inline-block":"none"},t="vector ";if(this.props.layerType===q.r.VECTOR){if(this.props.featureType===q.p.LINE||this.props.featureType===q.p.POLYGON||this.props.featureType===q.p.POINT&&!this.props.datas[0].symboleName)e.color=this.props.datas[0].color,t+=q.q[this.props.featureType];else if(this.props.featureType===q.p.POINT&&this.props.datas[0].symboleName){var a=this.props.datas[0].symboleName;a=(a=a.indexOf("resources")>-1&&a.indexOf("http")<0?T.a.getIPortalUrl()+a:a).indexOf("http")>-1?"".concat(a,"?t=").concat((new Date).getTime()):a,e.backgroundImage="url(".concat(a,")"),e.backgroundSize="100% 100%"}}else if(this.props.layerType===q.r.SYMBOL)"SYMBOL_POINT"!==this.props.datas[0].symboleType&&"SVG_POINT"!==this.props.datas[0].symboleType||this.props.featureType!==q.p.POINT||(e.color=this.props.datas[0].color,t+=this.props.datas[0].symboleName);else if(this.props.layerType===q.r.DATAFLOW)if(this.props.datas[0].symboleName)if("SYMBOL_POINT"===this.props.datas[0].symboleType)e.color=this.props.datas[0].color,t+=this.props.datas[0].symboleName;else if("SVG_POINT"===this.props.datas[0].symboleType){var n=this.props.datas[0].symboleName;n=(n=n.indexOf("resources")>-1&&n.indexOf("http")<0?T.a.getIPortalUrl()+n:n).indexOf("http")>-1?"".concat(n,"?t=").concat((new Date).getTime()):n,e.backgroundImage="url(".concat(n,")"),e.backgroundSize="100% 100%"}else{var r=this.props.datas[0].symboleName;r=(r=r.indexOf("resources")>-1&&r.indexOf("http")<0?T.a.getIPortalUrl()+r:r).indexOf("http")>-1?"".concat(r,"?t=").concat((new Date).getTime()):r,e.backgroundImage="url(".concat(r,")"),e.backgroundSize="100% 100%"}else e.color=this.props.datas[0].color,t+=q.q[this.props.featureType];else this.props.layerType===q.r.MIGRATION&&(e.color=this.props.datas[0].color,t+=q.q[q.p.LINE]);return i.a.createElement("div",{className:"legend-item"},i.a.createElement("div",{className:"item-title"},i.a.createElement("div",{className:t,style:e}),i.a.createElement("p",{onClick:this.updateStatus.bind(this,this.props.idx,this.props.detailHeight)},this.props.layerName),i.a.createElement("a",{className:this.props.isFold?"fold supermapol-icons-legend-unfold":"fold supermapol-icons-legend-fold",onClick:this.updateStatus.bind(this,this.props.idx,this.props.detailHeight),style:{display:[q.r.VECTOR,q.r.SYMBOL,q.r.DATAFLOW,q.r.MIGRATION].includes(this.props.layerType)?"none":"inline-block"}}),i.a.createElement("a",{className:"close supermapol-icons-close-legend",onClick:this.removeLegend.bind(this)})),this.getContentUI())}}]),t}(n.Component),Qs=(a(1745),{UNIQUE:30,RANGE:30,RANK_SYMBOL:40}),$s=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={legends:[]},a.contentHeight=0,a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.state.legends.findIndex((function(t){return e.legendLayerID>0?t.layerID===e.legendLayerID:e.legendLayerID<0?t.layerID===-e.legendLayerID:void 0}));e.legendLayerID&&e.legendLayerID>0&&t<0?this.state.legends.push({layerID:e.legendLayerID,isFold:e.isFold}):e.legendLayerID&&e.legendLayerID<0&&t>-1?this.state.legends.splice(t,1):0===e.legendLayerID&&(this.state.legends=[]),this.setState(this.state)}},{key:"getContentUI",value:function(){var e,t=[];this.contentHeight=41*this.state.legends.length;var a=this;return this.state.legends.forEach((function(n,r){var s,o,l=de.a.getVectorLayerById(n.layerID),c=l.layerInfo,u=c.id,d=c.name,p=c.layerType,h=c.featureType,f=l.getStyleParameters(),m=0;o=a.getAllFieldColor(l.layer,c.layerType,h,f),[q.r.UNIQUE,q.r.RANGE,q.r.RANK_SYMBOL].includes(p)?m=o.length*Qs[p]<200?o.length*Qs[p]:200:[q.r.HEAT_MAP,q.r.DATAFLOWHEAT].includes(p)&&(m=150),[q.r.VECTOR,q.r.SYMBOL,q.r.DATAFLOW,q.r.MIGRATION].includes(p)||(s=l.styleCache[c.layerType].themeSetting&&(l.styleCache[c.layerType].themeSetting.themeField||l.styleCache[c.layerType].themeSetting.weight),a.state.legends[r].isFold||(![q.r.HEAT_MAP,q.r.DATAFLOWHEAT].includes(p)||""!==s&&s?a.contentHeight+=m+26+8:a.contentHeight+=m+8)),e=i.a.createElement(Zs,{key:r,idx:r,isFold:a.state.legends[r].isFold,layerID:u,layerName:d,layerType:p,featureType:h,datas:o,themeField:s,detailHeight:m,removeLegend:a.props.updateLegendView,updateState:a.updateState.bind(a)}),t.push(e)})),i.a.createElement("div",{className:"legend-content",style:{height:this.contentHeight}},i.a.createElement(oe.Scrollbars,{ref:"contentScrollbars",className:"scroll-bars"},t))}},{key:"getAllFieldColor",value:function(e,t,a,n){var i,r=[];if(n&&n.style&&("SYMBOL_POINT"===n.style.type||"SVG_POINT"===n.style.type?i=n.style.symbolInfo&&(n.style.symbolInfo.className||n.style.symbolInfo.url):"IMAGE_POINT"===n.style.type&&(i=n.style.imageInfo&&n.style.imageInfo.url)),[q.r.UNIQUE,q.r.RANGE,q.r.RANK_SYMBOL].includes(t)){var s=e.get("styleSource"),o=s.styleGroups,l=s.parameters.style;if(t===q.r.RANK_SYMBOL)for(var c in o){var u={type:l.type,radius:o[c].radius,color:o[c].fillColor,symbolInfo:l.symbolInfo,imageInfo:l.imageInfo,value:o[c].start,value1:o[c].end};r.push(u)}else if(t===q.r.UNIQUE)for(var d in o){var p=o[d],h=window.cloneDeep(p.style),f=Object.assign(h,{color:a===q.p.LINE?p.style.strokeColor:p.style.fillColor,value:o[d].value,value1:o[d].end});r.push(f)}else for(var m in o){var y={color:o[m].color,value:void 0!==o[m].start?o[m].start:o[m].value,value1:o[m].end};r.push(y)}}else t===q.r.HEAT_MAP||t===q.r.DATAFLOWHEAT?r=e.getGradient():t===q.r.VECTOR?a===q.p.LINE?r.push({color:n.style.strokeColor}):a===q.p.POLYGON?r.push({color:n.style.fillColor}):a===q.p.POINT&&("IMAGE_POINT"===n.style.type?r.push({symboleType:n.style.type,symboleName:i,color:n.style.fillColor}):r.push({color:n.style.fillColor,symboleName:i})):t===q.r.SYMBOL?a!==q.p.POINT||"SYMBOL_POINT"!==n.style.type&&"SVG_POINT"!==n.style.type||r.push({symboleType:n.style.type,symboleName:i,color:n.style.fillColor}):t===q.r.DATAFLOW?"SYMBOL_POINT"===n.style.type||"SVG_POINT"===n.style.type?r.push({symboleType:n.style.type,symboleName:i,color:n.style.fillColor}):r.push({color:n.style.fillColor,symboleName:i}):t===q.r.MIGRATION&&r.push({color:n.lineSetting.color});return r}},{key:"updateState",value:function(e,t){if(null!=e){this.state.legends[e].isFold=!this.state.legends[e].isFold;var a=t+26+8;this.state.legends[e].isFold?this.contentHeight-=a:this.contentHeight+=a}de.a.getVectorLayerById(this.state.legends[e].layerID).layerInfo.legendSetting.isFold=this.state.legends[e].isFold,this.forceUpdate()}},{key:"colseLegendView",value:function(){this.state.legends.forEach((function(e){de.a.getVectorLayerById(e.layerID).layerInfo.legendSetting={isShow:!1,isFold:!1}})),this.props.updateLegendView(0)}},{key:"render",value:function(){return this.state.legends.length>0?i.a.createElement("div",{className:"legend",style:{bottom:this.props.attributeTableID?380:32}},i.a.createElement("div",{className:"legend-title"},i.a.createElement("i",{className:"supermapol-icons-legend-big"}),i.a.createElement("span",null,DataViz.Language.legend),i.a.createElement("a",{className:"supermapol-icons-close",onClick:this.colseLegendView.bind(this)})),this.getContentUI()):null}}]),t}(n.Component),eo=Object(o.b)((function(e){return{legendLayerID:e.layerGroupReducer.legendLayerID,updateLegendTime:e.layerGroupReducer.updateTime,isFold:e.layerGroupReducer.isFold,attributeTableID:e.layerGroupReducer.showATLayerID}}),(function(e,t){return{updateLegendView:function(t,a,n){return e(ur.p(t,a,n))}}}))($s),to=(a(1746),a(1620),a(1621),function(e){function t(){return f()(this,t),v()(this,b()(t).apply(this,arguments))}return E()(t,e),y()(t,[{key:"render",value:function(){var e=this,t=this.props.config.POI_SEARCH,a=this.props.config.LAYER_SEARCH;return i.a.createElement("div",{id:"map",className:this.props.fold?"map-fold":""},i.a.createElement(eo,null),this.props.config.OVERVIEW_MAP&&i.a.createElement(qs,null),(t||a)&&i.a.createElement(os.a,{map:de.a.map,serviceProxy:T.a.serviceProxy,needPoi:t,needLayer:a,poiLayer:de.a.poiLayer,ref:function(t){e.poi=t},addMarkerLayer:this.props.addMarkerLayer,layers:this.getLayersInfo(),addLayerSearchSetting:this.addLayerSearchSetting,deletedLayerSearchSetting:this.deletedLayerSearchSetting,hideMarkerPopup:this.props.hideMarkerPopup,isSave:!0,closeAllPop:de.a.closeAllPop.bind(de.a)}),this.props.feature&&i.a.createElement(Xs,{feature:this.props.feature,hideMarkerPopup:this.props.hideMarkerPopup,layerNotEditable:this.props.layerNotEditable}))}},{key:"componentDidMount",value:function(){var e=this,t=this;de.a.createMapContainer("map",{mapMoveEndCallback:function(e){var a=e.center,n=e.extent;(a&&!T.a.judgeArrayEqual(t.center,a)||n&&!T.a.judgeArrayEqual(t.extent,n))&&"dv-settings"===t.props.selectedId&&(t.props.changeMapSetting({center:a,extent:n}),t.center=a,t.extent=n)},mapClickCallback:function(e,a,n,i){if(_a.a.setFeatureUneditable(),a){var r=de.a.getLayerById(e).layerInfo.layerType,s=a.getProperties(),o=!window.isSuperMapOL&&ie.a.getEditFeatureInfo(e,a);if(s.useStyle){var l=de.a.getLayerById(e).layerInfo;Ua.a.calculateDistance(a,n),Ua.a.checkPopPosition(a,n,t.props.showMarkerPopup.bind(t,e,a,n,l.layerNotEditable))}else if(T.a.isThemeLayer(r)){var c=de.a.getVectorLayerById(e),u=c&&c.layerInfo;if(!u||[q.r.HEAT_MAP,q.r.DATAFLOWHEAT].includes(u.layerType))return;t.themeLayerId=e,wi.a.showThemePop(a,n,u.enableFields,u.captions,o,(function(){t.props.attributeTableID&&t.props.showAttributeTable(e),c&&c.layer.getSource().changed()}),e,t.props.showCustomSettings)}else if(r===q.i.VECTOR_TILE){var d={},p=[];for(var h in s)"geometry"!==h&&"layer"!==h&&(d[h]=s[h],p.push(h));a.set("attributes",d),wi.a.showThemePop(a,n,p,layerInfo.captions,o,(function(){t.props.attributeTableID&&t.props.showAttributeTable(e)}),e),de.a.highLightLayer.getSource().addFeature(a)}}else i&&t.showTileAttrPop(i,n)},mapPostrenderCallback:function(e,a){a&&!Ua.a.isClose&&Ua.a.refreshMarkerPopup(a,t.props.mousePosition)},changeResCallback:function(t){t&&e.props.changeCurrentScale(t)}},t.props.hideMarkerPopup)}},{key:"componentDidUpdate",value:function(e){var t=de.a.getVectorLayerById(this.themeLayerId);if((this.props.removeLayerID!==e.removeLayerID||this.themeLayerId&&t&&!t.getVisible())&&wi.a.showThemePop(null),"dv-settings"===this.props.selectedId&&this.props.selectedId!==e.selectedId){var a=de.a.getMapSettingInfo(),n=a.center,i=a.extent;(n&&!T.a.judgeArrayEqual(this.center,n)||i&&!T.a.judgeArrayEqual(this.extent,i))&&(this.props.changeMapSetting({center:n,extent:i}),this.center=n,this.extent=i)}}},{key:"getLayersInfo",value:function(){var e=this.props.layers.filter((function(e){return!e.getDataFaild})).map((function(e){var t=de.a.getLayerById(e.id),a=t.layerInfo,n={layerId:a.id,layerType:a.layerType,name:a.name,searchSetting:a.searchSetting&&Mi()(a.searchSetting),zIndex:a.zIndex,orginEpsgCode:a.projection};return"TILE"===a.layerType?(n.url=a.url,n.subLayers=a.subLayers):(n.features=t.features,n.enableFields=a.enableFields),n}));return e.reverse(),e}},{key:"deletedLayerSearchSetting",value:function(e){var t=de.a.getLayerById(e.layerId);if(t&&t.layerInfo){var a=t.layerInfo.searchSetting;a&&a.map((function(a,n){a.name===e.filterName&&a.layerName===e.layerName&&t.layerInfo.searchSetting.splice(n,1)}))}}},{key:"addLayerSearchSetting",value:function(e){var t=de.a.getLayerById(e.layerId);t&&t.layerInfo&&(t.layerInfo.searchSetting||(t.layerInfo.searchSetting=[]),t.layerInfo.searchSetting.push(e))}},{key:"showTileAttrPop",value:function(e,t){if(e.length){var a=de.a.map.getOverlayById("tile-pop");!this.TileAttrPop&&(this.TileAttrPop=document.createElement("div")),a.setElement(this.TileAttrPop),s.a.render(i.a.createElement(hs,{olPopInstance:a,tileLayers:e,coordinate:t}),this.TileAttrPop),a.setPosition(t)}}}]),t}(n.Component)),ao=Object(o.b)((function(e){return{removeLayerID:e.layerGroupReducer.removeLayerID,layers:e.layerGroupReducer.tileLayers.concat(e.layerGroupReducer.vectorLayers),selectedId:e.changeTabReducer.selectedId,fold:e.changeTabReducer.fold,layerNotEditable:e.manageMarkerLayerReducer.layerNotEditable,feature:e.manageMarkerLayerReducer.feature,mousePosition:e.manageMarkerLayerReducer.mousePosition,attributeTableID:e.layerGroupReducer.showATLayerID}}),(function(e,t){return{addMarkerLayer:function(t,a){return e(ur.d(t,a))},changeMapSetting:function(t){return e(x(t))},changeBaseMapIndex:function(t,a){return e(ur.g(t,a))},showMarkerPopup:function(t,a,n,i){return e(dr(t,a,n,i))},hideMarkerPopup:function(){e(pr())},showAttributeTable:function(t){return e(ur.m(t))},changeCurrentScale:function(t){e(V(t))},showCustomSettings:function(t){return e(hr(t))}}}))(to),no=a(1657),io=a.n(no),ro=a(1658),so=a.n(ro),oo=a(1659),lo=a.n(oo),co=a(1660),uo=a.n(co),po=(a(1820),a(1821),window.DataViz.Language),ho=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).layerID=e.layerID,a.currentPage=1,a.closeTable=a.closeTable.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"getDataInf",value:function(e){var t=de.a.getVectorLayerById(e),a=t.features,n=[],i=this.props.enableFields.slice();return i.length>0&&a.forEach((function(e,t){var a={index:t},r=e.get("attributes");for(var s in r)if(i.indexOf(s)>-1){var o=r[s];a[s]="object"===fe()(o)?JSON.stringify(o):o}n.push(a)})),{name:t.layerInfo.name+po.dataNumber1+a.length+po.dataNumber2,datas:n,attrNames:i,captions:t.layerInfo.captions||{}}}},{key:"getTable",value:function(e){var t=this,a=this;if(!e||0===e.datas.length)return null;var n=!window.isSuperMapOL&&ie.a.isLayerEditable(this.props.layerID),r=[],s={};e.attrNames.forEach((function(a,i){n&&0===a.toUpperCase().indexOf("SM")&&(s[i]=!0);var o={dataField:a,headerAlign:"center",align:"center",text:e.captions[a]||a,sort:!0,headerStyle:{width:150},title:!0,headerTitle:!0,events:{onClick:function(e,a,n,i,r){t.onRowClick(i)}},editable:function(e,t,a,n){return!s[n]},editCellClasses:function(){return"dv-attribute-edit"}};r.push(o)}));var o=so()({sizePerPage:6,hideSizePerPage:!0,onPageChange:function(e){a.currentPage=e}}),l=a.getSearchCtrl(),c=a.getClearCtrl(),u=uo()({mode:"dbclick",blurToSave:!0,beforeSaveCell:function(e,a,n,i){t.beforeSaveCell(e,a,i.dataField)}});return i.a.createElement(lo.a,{keyField:"index",data:e.datas,bordered:!0,search:!0,columns:r},(function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement(l,Y()({placeholder:po.filterCondition},e.searchProps,{className:"dv-attribute-search"})),""!==e.searchProps.searchText&&i.a.createElement(c,e.searchProps),i.a.createElement(io.a,Y()({},e.baseProps,{pagination:o,striped:!0,hover:!0,cellEdit:n?u:void 0,wrapperClasses:"dv-attribute-table"})))}))}},{key:"getSearchCtrl",value:function(){var e=this;return function(t){return i.a.createElement("div",{className:"table-filter supermapol-icons-search"},i.a.createElement("input",{className:"dv-search-input",style:{backgroundColor:"pink"},ref:function(t){return e.searchInput=t},type:"text",onChange:function(){var a=e.searchInput.value;t.onSearch(a)},defaultValue:t.searchText}))}}},{key:"getClearCtrl",value:function(){var e=this;return function(t){return i.a.createElement("span",{className:"supermapol-icons-close",onClick:function(){t.onClear(),e.searchInput.value=""}.bind(e)})}}},{key:"beforeSaveCell",value:function(e,t,a){var n=this;if(String(e)!==t){var i=this.props.layerID;if(this.clickRowFearture){var r=ie.a.getEditFeatureInfo(i,this.clickRowFearture),s=Ca()({},this.clickRowFearture.get("attributes")),o=[null,void 0].includes(s.dataviz_featureID)?s.SMID:s.dataviz_featureID;if(r){var l={urlId:r.urlId,fieldValue:t,fieldName:a,oldfieldValue:e,featureID:o};ie.a.modifyVectorLayerFeatureAttr(this.clickRowFearture,a,t),ie.a.addEditFeatureInfo(r,l);var c=de.a.getLayerById(i);if(c){var u=this;c.updateLayerFromEdit(l,(function(){u.props.showCustomSettings(!1)}));var d=c.layerInfo;if(d&&d.layerType!==q.r.MIGRATION&&d.layerType!==q.r.HEAT_MAP){var p=d.enableFields,h=d.captions;c.layer.getSource().changed(),wi.a.showThemePop(this.clickRowFearture,null,p,h,r,(function(){n.props.layerID&&n.props.showAttributeTable(i)}),i)}}}}}}},{key:"onRowClick",value:function(e){var t=this,a=this.props.layerID,n=de.a.getLayerById(a);if(n){var i=n.layerInfo,r=i.captions;if(i&&(this.clickRowFearture=n.features[e.index],this.clickRowFearture)){de.a.updateView(null,T.a.getFeatureCenter(this.clickRowFearture));var s=window.isSuperMapOL?null:ie.a.getEditFeatureInfo(a,this.clickRowFearture);de.a.closeAllPop(this.props.hideMarkerPopup);var o={layerID:a,feature:this.clickRowFearture};if(de.a.setOnlySelectedFeature(o),i.layerType!==q.r.MIGRATION&&i.layerType!==q.r.HEAT_MAP){var l=i.enableFields;wi.a.showThemePop(this.clickRowFearture,T.a.getFeatureCenter(this.clickRowFearture),l,r,s,(function(){t.props.layerID&&t.props.showAttributeTable(a)}),a)}}}}},{key:"closeTable",value:function(){this.props.showAttributeTable(0),this.currentPage=1}},{key:"componentDidUpdate",value:function(){var e=this;ie.a.updataAtrributeTableFn=function(){e.props.showAttributeTable(0)}}},{key:"render",value:function(){if(this.props.layerID){var e=this.getDataInf(this.props.layerID);return i.a.createElement("div",{className:"atrribute-table-container",style:{width:this.props.fold?"calc(100% - 52px)":"calc(100% - 344px)"}},i.a.createElement("div",{className:"table-manager"},i.a.createElement("div",{className:"table-info"},e.name),i.a.createElement("div",{className:"table-close",onClick:this.closeTable},po.closeButton)),i.a.createElement("div",{className:"table-container",ref:"tableContainer"},this.getTable(e)))}return null}}]),t}(n.Component),fo=Object(o.b)((function(e){return{layerID:e.layerGroupReducer.showATLayerID,enableFields:e.layerGroupReducer.enableFields,fold:e.changeTabReducer.fold}}),(function(e,t){return{showAttributeTable:function(t){return e(ur.m(t))},hideMarkerPopup:function(){return e(pr())},changeSelectedLayer:function(t){return e(ur.i(t))},showCustomSettings:function(t){e(hr(t))}}}))(ho),mo=(a(1822),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={measureType:"NONE",clearBtnEnable:!1},a.draw=null,a.sketch=null,a.measureTooltipElement=null,a.measureTooltip=null,a.helpTooltipElement=null,a.helpTooltip=null,a.output="",a.count=0,a.remainCount=0,a.isStart=!0,a.zIndex=1,a.measureSource=[],a.measureFeatureArr=[],a.measureFeatureItemArr=[],a.measureInfoArr=[],a.measureInfoItemArr=[],a.isDrawEnd=!0,a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.baseLayerInfo&&this.props.baseLayerInfo&&e.baseLayerInfo!==this.props.baseLayerInfo&&this.props.isMeasureBtnShow&&this.clearMeasure(!0)}},{key:"addInteraction",value:function(e){this.measureSource=de.a.measureLayer.getSource(),this.draw=new ol.interaction.Draw({source:this.measureSource,type:e,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255,255,255,0.35)"}),stroke:new ol.style.Stroke({color:"#0081E2",lineDash:[10,10],width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"#0081E2",width:2}),fill:new ol.style.Fill({color:"rgba(255,255,255,1)"})})})}),de.a.map.addInteraction(this.draw)}},{key:"pointerMoveHandler",value:function(e){this.isDrawEnd||e.dragging||(this.helpTooltipElement.innerHTML="<p>"+DataViz.Language.helpInfo+"</p>",this.helpTooltip.setPosition(e.coordinate))}},{key:"initMeasure",value:function(){if(!this.isDrawEnd){for(var e=0,t=this.measureInfoItemArr.length;e<t;e++)de.a.map.removeOverlay(this.measureInfoItemArr[e]);for(var a=0,n=this.measureFeatureItemArr.length;a<n;a++)this.measureSource.removeFeature(this.measureFeatureItemArr[a])}de.a.map.removeInteraction(this.draw),this.measureFeatureItemArr=[],this.measureInfoItemArr=[],this.isStart=!0,this.isDrawEnd=!0}},{key:"drawMeasure",value:function(e){this.initMeasure(),this.addInteraction(e),this.createMeasureTooltip(),this.createHelpTooltip(),window.DataViz.isMeasure=!0;var t,a=this,n=null,i="";this.draw.on("drawstart",(function(e){a.isDrawEnd=!1,de.a.map.getInteractions().item(1).setActive(!1),a.sketch=e.feature;var r=e.coordinate,s=de.a.getBaseLayerProj();t=a.sketch.getGeometry().on("change",(function(e){var t=e.target;t instanceof ol.geom.Polygon?(a.output=a.formatArea(t,s),i=DataViz.Language.totalArea):t instanceof ol.geom.LineString&&(a.output=a.formatLength(t,s),r=t.getLastCoordinate(),i=DataViz.Language.totalDistance),a.helpTooltipElement.innerHTML="<span>"+i+' :</span><span class="tooltip-help">'+a.output+"</span><p>"+DataViz.Language.helpInfo+"</p>",n=r}))}),this),this.draw.on("drawend",(function(r){var s,o,l=r.feature,c=l.getGeometry().getCoordinates(),u=c[0][c[0].length-2],d=a.count;"LineString"===e?(s=new ol.geom.Point(n),o=new ol.Feature(s),a.measureSource.addFeature(o),a.measureTooltip.setPosition(n),i=DataViz.Language.totalDistance):"Polygon"===e&&(s=new ol.geom.Point(u),o=new ol.Feature(s),a.measureSource.addFeature(o),a.measureTooltip.setPositioning("bottom-center"),a.measureTooltip.setPosition(l.getGeometry().getInteriorPoint().getCoordinates()),i=DataViz.Language.totalArea),a.measureFeatureItemArr.push(l),a.measureFeatureItemArr.push(o),a.measureFeatureArr.push(a.measureFeatureItemArr),a.measureTooltipElement.innerHTML='<span class="tooltip-measure">'+i+' : <strong class="strong">'+a.output+'</strong></span><a id="clear_'+d+'" class="tooltip-clear supermapol-icons-close" title="'+DataViz.Language.clearCurrentMeasure+'"></a>',a.measureTooltipElement.style.zIndex=a.count+1,a.measureInfoItemArr.push(a.measureTooltip),a.measureInfoArr.push(a.measureInfoItemArr),document.getElementById("clear_"+d).addEventListener("click",(function(){a.remainCount>0&&a.remainCount--;for(var e=a.measureFeatureArr[d],t=0,n=e.length;t<n;t++)a.measureSource.removeFeature(e[t]);for(var i=a.measureInfoArr[d],r=0,s=i.length;r<s;r++)de.a.map.removeOverlay(i[r]);a.measureFeatureArr[d]=[],a.measureInfoArr[d]=[],0===a.remainCount&&a.updateState("NONE",!1)})),a.isDrawEnd=!0,a.sketch=null,a.output=null,a.measureFeatureItemArr=[],a.measureTooltipElement=null,a.helpTooltipElement=null,ol.Observable.unByKey(t),de.a.map.removeInteraction(a.draw),de.a.map.removeEventListener("singleclick"),de.a.map.removeEventListener("pointermove"),de.a.map.removeOverlay(a.helpTooltip),a.count++,a.remainCount++,a.updateState("NONE",!0),setTimeout((function(){de.a.map.getInteractions().item(1).setActive(!0),window.DataViz.isMeasure=!1}),100)}),this)}},{key:"clearMeasure",value:function(e){if(this.state.clearBtnEnable||!e){if(e){if(this.measureFeatureArr)for(var t=0;t<this.measureFeatureArr.length;t++)for(var a=0;a<this.measureFeatureArr[t].length;a++)this.measureSource.removeFeature(this.measureFeatureArr[t][a]);if(this.measureInfoArr)for(var n=0;n<this.measureInfoArr.length;n++)for(var i=0;i<this.measureInfoArr[n].length;i++)de.a.map.removeOverlay(this.measureInfoArr[n][i]);this.count=0,this.remainCount=0,this.measureFeatureArr=[],this.measureInfoArr=[],this.updateState("NONE",!1)}this.helpTooltip&&de.a.map.removeOverlay(this.helpTooltip),this.sketch=null,this.measureTooltipElement=null,this.measureTooltip=null,this.helpTooltipElement=null,this.helpTooltip=null,this.output=null,this.initMeasure(),window.DataViz.isMeasure=!1}}},{key:"createHelpTooltip",value:function(){this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement("div"),this.helpTooltipElement.className="tooltip",this.helpTooltipElement.style.zIndex=this.count+2,this.helpTooltip=new ol.Overlay({element:this.helpTooltipElement,offset:[15,0],positioning:"center-left"}),de.a.map.addOverlay(this.helpTooltip)}},{key:"createMeasureTooltip",value:function(){this.measureTooltipElement=document.createElement("div"),this.measureTooltipElement.className="tooltip",this.measureTooltipElement.style.zIndex=this.count,this.measureTooltip=new ol.Overlay({element:this.measureTooltipElement,offset:[5,-5],positioning:"bottom-left"}),de.a.map.addOverlay(this.measureTooltip)}},{key:"formatLength",value:function(e,t){var a=ol.sphere.getLength(e,{projection:t});return a>100?Math.round(a/1e3*100)/100+" km":Math.round(100*a)/100+" m"}},{key:"formatArea",value:function(e,t){var a=ol.sphere.getArea(e,{projection:t});return a>1e4?Math.round(a/1e6*100)/100+" km<sup>2</sup>":Math.round(100*a)/100+" m<sup>2</sup>"}},{key:"updateState",value:function(e,t){e&&(this.state.measureType=e),null!=t&&(this.state.clearBtnEnable=t),this.setState(this.state)}},{key:"changeMeasureFold",value:function(e){e&&this.updateState("NONE"),this.props.updateState(e?"measure":"")}},{key:"changeMeasureType",value:function(e){this.drawMeasure(e),this.updateState(e),this.registerMapEvent()}},{key:"registerMapEvent",value:function(){var e=this;e.isRegisteredMapEvent||(de.a.map.addEventListener("pointermove",this.pointerMoveHandler.bind(this)),de.a.map.addEventListener("singleclick",(function(t){if(!e.isDrawEnd){var a=t.coordinate,n=new ol.geom.Point(a),i=new ol.Feature(n);e.measureSource.addFeature(i),e.measureFeatureItemArr.push(i),e.measureTooltipElement.innerHTML='<span class="tooltip-measure">'+e.output+"</span>","LineString"===e.state.measureType&&(e.isStart&&(e.measureTooltipElement.innerHTML='<span class="tooltip-measure">'+DataViz.Language.startPoint+"</span>",e.measureInfoItemArr.push(e.measureTooltip)),e.measureTooltip.setPosition(a),e.createMeasureTooltip()),e.isStart=!1,e.measureInfoItemArr.push(e.measureTooltip)}})),e.isRegisteredMapEvent=!0)}},{key:"render",value:function(){var e=this.props.isMeasureBtnShow?"measurePanel-show":"",t=this.state.clearBtnEnable?"clearBtn-enable":"clearBtn-disable",a="LineString"===this.state.measureType?"measureBtn-active":"",n="Polygon"===this.state.measureType?"measureBtn-active":"";return i.a.createElement("div",{className:"toolBtn measureTool"},i.a.createElement(C.a,{placement:"left",labelType:"span",tooltip:DataViz.Language.mapMeasure,iconClassName:"supermapol-icons-measure",onClick:this.changeMeasureFold.bind(this,!0)}),i.a.createElement("div",{className:"measurePanel "+e},this.props.isMeasureBtnShow&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"measurePanel-title"},i.a.createElement("i",{className:"supermapol-icons-measure"}),i.a.createElement("span",null,DataViz.Language.mapMeasure),i.a.createElement("a",{className:"supermapol-icons-close",onClick:this.changeMeasureFold.bind(this,!1)})),i.a.createElement("div",{className:"measurePanel-content"},i.a.createElement("a",{className:a,onClick:this.changeMeasureType.bind(this,"LineString")},DataViz.Language.distanceMeasure),i.a.createElement("a",{className:n,onClick:this.changeMeasureType.bind(this,"Polygon")},DataViz.Language.areaMeasure),i.a.createElement("a",{className:t,onClick:this.clearMeasure.bind(this,!0)},DataViz.Language.clearMeasure)))))}}]),t}(n.Component)),yo=function(e){function t(e){return f()(this,t),v()(this,b()(t).call(this,e))}return E()(t,e),y()(t,[{key:"zoomToExtent",value:function(){for(var e=de.a.vectorLayers.concat(de.a.tileLayers),t=ol.extent.createEmpty(),a=[],n=null,i=0,r=e.length;i<r;i++){var s=e[i],o=s.layer,l=s.layerInfo;s.isBaseLayer()?n=s:(o.getVisible&&o.getVisible()||l.visible)&&a.push(s)}if(a.length||n){for(var c=0;c<a.length;c++){var u=a[c];ol.extent.extend(t,u.getBounds())}!a.length&&ol.extent.extend(t,n.getBounds()),de.a.zoomToExtent(t)}}},{key:"render",value:function(){return i.a.createElement("div",{className:"toolBtn"},i.a.createElement(C.a,{placement:"left",labelType:"span",tooltip:DataViz.Language.zoomToExtent,iconClassName:"supermapol-icons-full-figure",onClick:this.zoomToExtent.bind(this)}))}}]),t}(n.Component);a(1823);function go(e){var t=e.toggleMap,a=e.openTrafficMap;return i.a.createElement("div",{className:a?"dataviz-traffic-switch open":"dataviz-traffic-switch",onClick:t},i.a.createElement("div",{className:"switch"}))}function vo(e){var t=e.baseLayerInfo,a=e.closeContent,n=e.showTrafficContent,r=e.openTrafficMap,s=e.toggleMap,o=e.refreshTraffic,l=!!t&&So.indexOf(t.layerType)>-1;return i.a.createElement("div",{className:n?"dataviz-traffic-content show":"dataviz-traffic-content"},i.a.createElement("div",{className:"dataviz-traffic-content-title"},i.a.createElement("span",{className:"supermapol-icons-traffic"}),i.a.createElement("span",{className:"traffic-title"},DataViz.Language.traffic),i.a.createElement("span",{onClick:a,className:"supermapol-icons-close"})),l?i.a.createElement("div",null,i.a.createElement("div",{className:"dataviz-traffic-content-cond"},i.a.createElement("div",{className:"jam"},DataViz.Language.trafficJam),i.a.createElement("div",{className:"crowd"},DataViz.Language.trafficCrowding),i.a.createElement("div",{className:"slow"},DataViz.Language.trafficSlow),i.a.createElement("div",{className:"clear"},DataViz.Language.trafficClear)),i.a.createElement("div",{className:"dataviz-traffic-content-footer"},i.a.createElement(go,{toggleMap:s,openTrafficMap:r}),i.a.createElement("span",{className:"time"},T.a.getFormatTime()),i.a.createElement("span",{onClick:o,className:"supermapol-icons-refresh"}))):i.a.createElement("div",{className:"dataviz-traffic-disabled"},DataViz.Language.onlyAMapAndBMap))}var So=["BAIDU","CLOUD"],bo=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={baseLayerInfo:null,showTrafficContent:!1,openTrafficMap:!1},a.traffic=null,a.closeContent=a.closeContent.bind(O()(a)),a.toggleMap=a.toggleMap.bind(O()(a)),a.showContent=a.showContent.bind(O()(a)),a.refreshTraffic=a.refreshTraffic.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e,t){"baseLayerInfo"in e&&e.baseLayerInfo!==this.state.baseLayerInfo&&this.changeBaseLayer(e.baseLayerInfo)}},{key:"hasLayer",value:function(e,t){return e.getLayers().getArray().indexOf(t)>-1}},{key:"changeBaseLayer",value:function(e){var t=de.a.map;this.setState({baseLayerInfo:e,openTrafficMap:!1}),this.traffic&&this.hasLayer(t,this.traffic)&&(de.a.map.removeLayer(this.traffic),this.traffic=null)}},{key:"createTrafficMap",value:function(){var e,t,a={wrapX:!1,transparent:!0,cacheEnabled:!1,redirect:!1};return"BAIDU"===this.state.baseLayerInfo.layerType?(a.url="https://www.supermapol.com/iserver/services/traffic/rest/maps/baidu",t=2048,e=.5):(a.url="https://www.supermapol.com/iserver/services/traffic/rest/maps/tencent",t=611.4962262814099,e=.5971642834779394),new ol.layer.Tile({source:new ol.source.TileSuperMapRest(a),maxResolution:t,minResolution:e})}},{key:"refreshTraffic",value:function(){this.traffic&&this.traffic.getSource().refresh(),this.forceUpdate()}},{key:"toggleMap",value:function(){var e=this;this.setState({openTrafficMap:!this.state.openTrafficMap},(function(){e.state.openTrafficMap?(e.traffic=e.createTrafficMap(),de.a.map.addLayer(e.traffic)):e.traffic&&e.hasLayer(de.a.map,e.traffic)&&(de.a.map.removeLayer(e.traffic),e.traffic=null)}))}},{key:"showContent",value:function(){this.props.updateState&&this.props.updateState("traffic")}},{key:"closeContent",value:function(){this.props.updateState&&this.props.updateState("")}},{key:"render",value:function(){var e;return i.a.createElement("div",{className:"toolBtn dataviz-traffic"},i.a.createElement(C.a,(e={placement:"left",labelType:"span",tooltip:DataViz.Language.traffic,iconClassName:"supermapol-icons-traffic"},j()(e,"labelType","span"),j()(e,"onClick",this.showContent),e)),i.a.createElement(vo,{baseLayerInfo:this.state.baseLayerInfo,openTrafficMap:this.state.openTrafficMap,toggleMap:this.toggleMap,closeContent:this.closeContent,showTrafficContent:this.props.isTrafficBtnShow,refreshTraffic:this.refreshTraffic}))}}]),t}(n.Component),Io=(a(1824),a(52)),Eo="#1464A1",To="#F6C158",Co="#1ABD9C",Lo=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).colors=[Eo,To],a.state={visible:!1,styleIndex:0,color:Co,projSupport:a.projIsSupport(),baseLayerInfo:e.baseLayerInfo,latitudeInterval:5},a}return E()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){var t=!1,a=!1,n=this.state,i=n.color,r=n.styleIndex,s=n.latitudeInterval,o=n.visible;if(e.baseLayerInfo!==this.state.baseLayerInfo&&(t=!0),this.props.visible!==e.visible){o=e.visible,a=!0;var l=Io.a.getColor();this.colors.includes(l)?r=l===Eo?0:1:(r=-1,i=l),s=Io.a.getIntervals()}if(t||a){var c=this.projIsSupport();this.setState({color:i,styleIndex:r,latitudeInterval:s,projSupport:c,visible:o&&c,baseLayerInfo:e.baseLayerInfo})}}},{key:"projIsSupport",value:function(){var e=Io.a.projIsSupport,t=Io.a.setProjectionExtent;return e()&&t()}},{key:"changePaneState",value:function(e){this.props.updateState(e?"graticule":"")}},{key:"changeVisible",value:function(){var e=this.state.visible;this.changeGraticuleVisible(!e)}},{key:"changeGraticuleVisible",value:function(e){e?this.addGraticule():Io.a.removeGraticuleLayer(),this.setState({visible:e})}},{key:"getColor",value:function(){var e=this.state,t=e.styleIndex,a=e.color;return t>-1?this.colors[t]:a}},{key:"addGraticule",value:function(){var e=this.getColor();Io.a.addGraticuleLayer(e,this.state.latitudeInterval)}},{key:"updateLayerStyle",value:function(e){Io.a.graticuleLayer&&this.setState({styleIndex:e},this.addGraticule)}},{key:"onColorPickerChange",value:function(e){this.setState({color:e.hex},this.updateLayerStyle(-1))}},{key:"changeTargetSizeValue",value:function(e){var t=e.target.value;this.setState({latitudeInterval:t})}},{key:"changeTargetSize",value:function(e){var t=e.target.value,a=parseFloat(t);a!==this.state.latitudeInterval&&(T.a.isNumber(a)?(a>90?(a=90,K.a.showMessage(DataViz.Language.inputMaxNumber)):a<.01&&(a=.01,K.a.showMessage(DataViz.Language.inputMinNumber)),this.setState({latitudeInterval:a},this.addGraticule)):K.a.showMessage(DataViz.Language.inputJustNumber))}},{key:"onKeyUp",value:function(e){13===e.keyCode&&e.target.blur()}},{key:"render",value:function(){var e=this.state,t=e.visible,a=e.styleIndex,n=e.color,r=e.projSupport,s=e.latitudeInterval,o=this.props.isGraticuleBtnShow;return i.a.createElement("div",{className:"toolBtn visible-".concat(t)},i.a.createElement(C.a,{placement:"left",labelType:"span",tooltip:DataViz.Language.graticuleOnOff,iconClassName:"supermapol-icons-grid",onClick:this.changePaneState.bind(this,!0)}),i.a.createElement("div",{className:"graticule-panel graticule-panel-".concat(o," ").concat(t?"height1":"height2")},o&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"dv-graticule-title"},i.a.createElement("i",{className:"supermapol-icons-grid"}),i.a.createElement("span",null,DataViz.Language.graticuleOnOff),i.a.createElement("a",{className:"supermapol-icons-close",onClick:this.changePaneState.bind(this,!1)})),!r&&i.a.createElement("div",{className:"dv-graticule-unsupport"},DataViz.Language.notSupportGraticule),r&&i.a.createElement("div",{className:"dv-graticule-switch"},i.a.createElement("div",{className:"text"},DataViz.Language.showGraticule),i.a.createElement("div",{className:"dataviz-switch dataviz-switch-".concat(t),onClick:this.changeVisible.bind(this)},i.a.createElement("div",{className:"switch"}))),r&&t&&i.a.createElement("div",{className:"dv-graticule-style-select"},i.a.createElement("div",{className:"text"},DataViz.Language.style),i.a.createElement("div",{className:"dv-style-select dark ".concat(0===a?"select":""),onClick:this.updateLayerStyle.bind(this,0)},DataViz.Language.themeDark),i.a.createElement("div",{className:"dv-style-select light ".concat(1===a?"select":""),onClick:this.updateLayerStyle.bind(this,1)},DataViz.Language.themeLight),i.a.createElement("div",{className:"dv-graticule-color"},i.a.createElement(nt.a,{innerWidth:"100%",onColorPickerChange:this.onColorPickerChange.bind(this),color:n}))),r&&t&&i.a.createElement("div",{className:"dv-graticule-target-size"},i.a.createElement("div",{className:"text"},DataViz.Language.gridIntervals),i.a.createElement("input",{type:"text",onChange:this.changeTargetSizeValue.bind(this),onKeyUp:this.onKeyUp.bind(this),onBlur:this.changeTargetSize.bind(this),value:s}),i.a.createElement("span",null,DataViz.Language.DEGREES)))))}}]),t}(n.Component),No=Object(o.b)((function(e){return{visible:e.MapInfoReducer.graticuleVisible}}),null)(Lo),ko=(a(1629),function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={tool:""},a.updateState=a.updateState.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"updateState",value:function(e){"measure"!==e&&this.refs.measureTool.clearMeasure(!1),this.setState({tool:e})}},{key:"render",value:function(){var e=this.state.tool;return i.a.createElement("div",{className:"toolbar"},i.a.createElement(yo,null),i.a.createElement(mo,{ref:"measureTool",updateState:this.updateState,isMeasureBtnShow:"measure"===e,baseLayerInfo:this.props.baseLayerInfo}),i.a.createElement(No,{baseLayerInfo:this.props.baseLayerInfo,updateState:this.updateState,isGraticuleBtnShow:"graticule"===e}),this.props.config.ROAD_CONDITION&&i.a.createElement(bo,{updateState:this.updateState,isTrafficBtnShow:"traffic"===e,baseLayerInfo:this.props.baseLayerInfo}))}}]),t}(n.Component)),Oo=(a(1825),["addFromFile","addFromWeb","addMarker"]),Do="".concat(T.a.getRootUrl(),"apps/dataviz/static/imgs/guide/").concat(window.DataViz.theme||"light","/"),wo={zh:"332px",en:"309px"},Ao=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).config={modalWidth:"816px",modalHeight:"462px",hideFooter:!0,hideHeader:!0},a.state={largeImg:Oo[0],checked:!1},a.onCheckedChange=a.onCheckedChange.bind(O()(a)),a.btnClick=a.btnClick.bind(O()(a)),a.getContent=a.getContent.bind(O()(a)),a.onMouseOver=a.onMouseOver.bind(O()(a)),a}return E()(t,e),y()(t,[{key:"componentDidMount",value:function(){this.GuideModal.showModal()}},{key:"onCheckedChange",value:function(e){this.setState({checked:e.target.checked}),T.a.setLocalStorage("isShowGuide",!e.target.checked)}},{key:"btnClick",value:function(e){this.closeModalBox(),0===e?this.addFromFileModal.modalBox.showModal():1===e?this.addFromWebModal.modalBox.showModal():2===e&&this.props.addMarkerLayer({layerType:q.r.MARKER,id:(new Date).getTime(),name:window.DataViz.Language.defaultMarkerLayer+"1",visible:!0,triggerDrawPoint:!0})}},{key:"onMouseOver",value:function(e){this.state.largeImg!==e&&this.setState({largeImg:e})}},{key:"getContent",value:function(){var e=this,t=[],a=this.state.largeImg;return Oo.forEach((function(n,r){var s=n===Oo[0]?DataViz.Language.uploadFile:DataViz.Language["".concat(n,"Button")];t.push(i.a.createElement("div",{className:"".concat(n," ").concat(a===n?"largeInfoGroup":"smallInfoGroup"),key:r,onMouseOver:e.onMouseOver.bind(e,n)},a===n?i.a.createElement("div",{className:"largeInfo"},i.a.createElement("div",{className:"name"},DataViz.Language["".concat(n,"Name")]),i.a.createElement("div",{className:"description",style:{width:wo[window.lang]}},DataViz.Language["".concat(n,"Description")]),i.a.createElement("div",{className:"button",onClick:function(){e.btnClick(Oo.indexOf(n))}},s)):i.a.createElement("div",{className:"smallInfo"},i.a.createElement("div",{className:"name"},DataViz.Language["".concat(n,"Name")])),i.a.createElement("img",{src:"".concat(Do).concat(n,".png"),alt:""})))}),this),i.a.createElement("div",{className:"guide-modal-content"},t)}},{key:"closeModalBox",value:function(){this.GuideModal.hideModal()}},{key:"render",value:function(){var e=this,t=Ka.a.dataVizConfig.layerLists,a={addRestMapOverLayer:this.props.addRestMapOverLayer,addFromRestData:this.props.addFromRestData,addFromDataflow:this.props.addFromDataflow,addVectorTileLayer:this.props.addVectorTileLayer},n={addRestMapOverLayer:this.props.addRestMapOverLayer,addFeatureFromFile:this.props.addFeatureFromFile,addVectorTileLayer:this.props.addVectorTileLayer,setLayerServerId:this.props.setLayerServerId};return i.a.createElement(i.a.Fragment,null,i.a.createElement(re.a,Y()({},this.config,{ref:function(t){e.GuideModal=t}}),i.a.createElement("div",{className:"guide-modal-header"},i.a.createElement("div",{className:"guideModalTitle"},DataViz.Language.guideModalTitle),i.a.createElement("div",{className:"guideModalDescription"},DataViz.Language.guideModalDescription),i.a.createElement("span",{className:"supermapol-icons-close",onClick:this.closeModalBox.bind(this)})),this.getContent(),i.a.createElement("div",{className:"guide-modal-footer"},i.a.createElement(se.a,{onChange:this.onCheckedChange,checked:this.state.checked},DataViz.Language.donotShow))),i.a.createElement(Bn,{addFromFile:n,ref:function(t){e.addFromFileModal=t}}),i.a.createElement(ei,{addFromWeb:a,childrens:t[2].children,ref:function(t){e.addFromWebModal=t}}))}}]),t}(n.Component),Fo=Object(o.b)((function(e){return{}}),(function(e,t){return{addMarkerLayer:function(t){return e(ur.d(t))},addFeatureFromFile:function(t){return e(ur.b(t))},addRestMapOverLayer:function(t,a){return e(ur.e(t,a))},addVectorTileLayer:function(t){return e(ur.f(t))},addFromRestData:function(t){return e(ur.c(t))},addFromDataflow:function(t,a){return e(ur.a(t,a))},setLayerServerId:function(t){return e(ur.l(t))}}}))(Ao),Mo=a(137),Ro=function(){function e(t){f()(this,e),this._bindChangeTab(t.changeTabCallback),this._bindChangeTheme(t.changeThemeCallback)}return y()(e,[{key:"_bindChangeTab",value:function(e){e&&(X.changeTabCallback=e)}},{key:"_bindChangeTheme",value:function(e){e&&(X.changeThemeCallback=e)}},{key:"_getInfoFromRestData",value:function(e,t,a){return Gn.a.getRestDataInfo(e).then((function(n){var i=e.split("rest/data/datasources/")[1].split("/"),r=i[0],s=i[2],o="".concat(r,":").concat(s),l=e.substr(0,e.search("/datasources"));T.a.getFeatureBySQL(l,[o],(function(e){var a=e.result.features.features;t({features:a,projection:"EPSG:".concat(n.datasetInfo.prjCoordSys.epsgCode),requestUrl:l,dataSourceName:o})}),(function(e){a(e)}))}))}},{key:"addTileLayer",value:function(e,t,a,n){Gn.a.checkUrl(t)||n&&n({error:"url is illegal"}),Gn.a.getRestLayerInfo(t,a).then((function(i){var r=i.bounds;Object.assign(e,{layerType:q.i.TILE,overLayer:!0,epsgCode:de.a.getBaseLayerProj(),orginEpsgCode:"EPSG:".concat(i.prjCoordSys.epsgCode),projection:"EPSG:".concat(i.prjCoordSys.epsgCode),units:i.coordUnit&&i.coordUnit.toLowerCase(),extent:[r.left,r.bottom,r.right,r.top],visibleScales:i.visibleScales,coordUnit:i.coordUnit,url:t,sourceType:q.i.TILE,visible:!0}),a&&Object.assign(e,{credential:a}),l.a.dispatch(Object(ur.e)(e,e.id)),n&&n()})).catch((function(e){n&&n({error:e})}))}},{key:"addVectorLayerFromUrl",value:function(e,t,a){this._getInfoFromRestData(t,(function(t){var n,i=t.features,r=t.projection,s={};0!==i.length&&(s=Gn.a.getDataTypes(i[0].properties),n=q.e[i[0].geometry.type.toUpperCase()]),Object.assign(e,{dataTypes:s,featureType:n,projection:r,originData:i,layerType:q.i.VECTOR,visible:!0,dataSource:{type:"REST_DATA",url:t.requestUrl,dataSourceName:t.dataSourceName}}),de.a.addProjection(r).then((function(){l.a.dispatch(Object(ur.c)({features:ie.a.parseData2Feature({allDatas:{features:i},fileCode:r},"JSON"),layerInfo:e,selectedLayerId:e.id})),a&&a()})).catch((function(e){a&&a({error:e})}))}))}},{key:"addVectorLayerFromJSON",value:function(e,t,a,n){tn.a.getGeoJsonFeatureType(t)===q.p.UNKNOWN&&n&&n({error:"unknonw feature type"});var i,r,s=e.id,o=e.name,c=t.features;0!==c.length&&(i=Gn.a.getDataTypes(c[0].properties),r=q.e[c[0].geometry.type.toUpperCase()]);var u={id:s,name:o,dataTypes:i,featureType:r,projection:a,originData:c,layerType:q.i.VECTOR,visible:!0,dataSource:{type:"REST_DATA"}};de.a.addProjection(a).then((function(){l.a.dispatch(Object(ur.c)({features:ie.a.parseData2Feature({allDatas:{features:c},fileCode:a},"JSON"),layerInfo:u,selectedLayerId:s})),n&&n()})).catch((function(e){n&&n({error:e})}))}},{key:"addMarkerLayerFromUrl",value:function(e,t,a){this._getInfoFromRestData(t,(function(t){var n=ie.a.parseData2Feature({allDatas:{features:t.features},fileCode:t.projection},"JSON"),i={id:e.id,layerType:q.r.MARKER,name:e.name,visible:!0};l.a.dispatch(Object(ur.d)(i,n)),a&&a()}))}},{key:"addMarkerLayerFromJSON",value:function(e,t,a,n){de.a.addProjection(a).then((function(){var i=ie.a.parseData2Feature({allDatas:{features:t.features},fileCode:a},"JSON"),r={id:e.id,layerType:q.r.MARKER,name:e.name,visible:!0};l.a.dispatch(Object(ur.d)(r,i)),n&&n()})).catch((function(e){n&&n({err:e})}))}},{key:"getWMTSCapabilities",value:function(e,t){return Gn.a.getCapabilities(e,q.s.WMTS,t)}},{key:"getWMSCapabilities",value:function(e){return Gn.a.getCapabilities(e,q.s.WMS)}},{key:"addWMTSLayer",value:function(e,t,a){de.a.getBaseLayerProj()&&t!==de.a.getBaseLayerProj()?a&&a({error:"projection need equal with baseLayer"}):this.getWMTSCapabilities(e.url,e.isKvp).then((function(t){e=Mo.a.getParamsFromWMTSCapabilities(t,e),e=Object.assign({sourceType:q.s.WMTS,layerType:q.s.WMTS,overLayer:!0},e),l.a.dispatch(Object(ur.e)(e)),a&&a()})).catch((function(e){a&&a({error:e})}))}},{key:"addWMSLayer",value:function(e,t){this.getWMSCapabilities(e.url).then((function(a){e=Gn.a.getParamsFromWMSCapabilities(a,e),e=Object.assign({sourceType:q.s.WMS,layerType:q.s.WMS,overLayer:!0},e),l.a.dispatch(Object(ur.e)(e)),t&&t()}))}},{key:"getLayerById",value:function(e){return de.a.getLayerById(e)}},{key:"removeLayerById",value:function(e){l.a.dispatch(Object(ur.j)(e))}},{key:"getOLMap",value:function(){return de.a.map}}]),e}();window.DataViz.Plugins.DatavizPlugins=Ro;a(1630);Number.isNaN=Number.isNaN||function(e){return"number"==typeof e&&isNaN(e)},window.DataViz.codeId="96f804c3";var xo=function(e){function t(e){var a;return f()(this,t),(a=v()(this,b()(t).call(this,e))).state={isShowGuide:!1},a}var a;return E()(t,e),y()(t,[{key:"render",value:function(){var e=T.a.getChildToolsConfig();return i.a.createElement("div",{className:"app-root default"},i.a.createElement(ss,null),i.a.createElement(ao,{config:e}),i.a.createElement(fo,null),i.a.createElement(ko,{config:e,baseLayerInfo:this.props.baseLayerInfo,changeGraticuleVisible:this.props.changeGraticuleVisible}),this.state.isShowGuide&&i.a.createElement(Fo,null))}},{key:"componentDidMount",value:function(){T.a.getTheme().then((function(e){T.a.changeTheme(e)}));var e=document.getElementById("loading"),t=document.getElementsByTagName("body")[0];e&&t&&t.removeChild(e),this.isOpenApp()}},{key:"isOpenApp",value:(a=p()(u.a.mark((function e(){var t,a,n,i,r,s,o,l,c,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=window.location.href,Ka.a.updateAppLogo=this.props.updateAppLogo,Ka.a.changeBaseMapIndex=this.props.changeBaseMapIndex,Zi.a.changeBaseMapIndex=this.props.changeBaseMapIndex,Zi.a.changeMinMaxScale=this.props.changeMinMaxScale,Zi.a.addFromRestData=this.props.addFromRestData,Zi.a.addRestMapOverLayer=this.props.addRestMapOverLayer,Zi.a.addVectorTileLayer=this.props.addVectorTileLayer,Zi.a.changeMapTags=this.props.changeMapTags,Zi.a.changeMapTitle=this.props.changeMapTitle,Zi.a.changeMapDescription=this.props.changeMapDescription,Zi.a.updateLegendView=this.props.updateLegendView,Zi.a.changeTabFold=this.props.changeTabFold,Zi.a.reviewPortalMap=this.props.reviewPortalMap,Zi.a.changeMapSetting=this.props.changeMapSetting,Zi.a.changeAuthorizeSetting=this.props.changeAuthorizeSetting,Zi.a.changeGraticuleVisible=this.props.changeGraticuleVisible,T.a.actions.changeMapShare=this.props.changeMapShare,a=!0,n=t.includes("dataviz"),i=T.a.getUrlQueryParams(t),r=i.serviceId,s=i.name,o=i.id,(r||o)&&n&&(Ka.a.isOpenApp=!0),l=T.a.getLocalStorage("DATAVIZ_WEBMAP"),Ka.a.isIportalView=!!l,T.a.deleteLocalStorage("DATAVIZ_WEBMAP"),e.next=28,Ka.a.getServiceConfig();case 28:return e.next=30,Ka.a.getServiceProxy();case 30:Ka.a.isOpenApp?(s&&(a=!1,o=r||o,t="".concat(T.a.getIPortalUrl(),"web/services/").concat(o,"/").concat(s)),T.a.checkReLogin().then((function(){K.a.checkMapPermission({isMap:a,url:t,id:o,name:s},(function(){Zi.a.open(a,t,o)}))})).catch((function(){K.a.showPermissionModal({isMap:a,url:t,id:o,name:s})}))):l?Zi.a.openDatavizWebMap(l):(c=T.a.getLocalStorage("isShowGuide"),d=!0,!1===c&&(d=c),this.setState({isShowGuide:d}));case 31:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})}]),t}(n.Component),Po=Object(o.b)((function(e){return{baseLayerInfo:e.layerGroupReducer.tileLayers[0]}}),(function(e){return{reviewPortalMap:function(t){return e(Object(ur.k)(t))},changeBaseMapIndex:function(t,a){return e(Object(ur.g)(t,a))},addFromRestData:function(t){return e(Object(ur.c)(t))},addRestMapOverLayer:function(t){return e(Object(ur.e)(t))},addVectorTileLayer:function(t){return e(Object(ur.f)(t))},changeMapTags:function(t){return e(M(t))},changeMapTitle:function(t){return e(F(t))},changeMapDescription:function(t){return e(R(t))},changeMapShare:function(t){return e({payload:t,type:A.o})},updateLegendView:function(t,a,n){return e(Object(ur.p)(t,a,n))},changeTabFold:function(t){return e(be(t))},updateAppLogo:function(t){return e({payload:t,type:A.E})},changeMapSetting:function(t){return e(x(t))},changeAuthorizeSetting:function(t){return e(B(t))},changeGraticuleVisible:function(t){return e(function(e){return{visible:e,type:A.j}}(t))},changeMinMaxScale:function(t){return e(P(t))}}}))(xo);a(1826);window.cloneDeep=Ki.a,window.APP_CODE_ID="96f804c3",window.PointerEvent||a.e(6).then(a.t.bind(null,2034,7)),Object(r.render)(i.a.createElement(o.a,{store:l.a},i.a.createElement(Po,null)),document.querySelector(".root"))},188:function(e,t,a){"use strict";var n=a(5),i=a(1),r=a(158),s=a.n(r),o=(a(18),a(27),a(668)),l=a.n(o),c=a(12),u=window.DataViz.Language,d=ol.interaction.Draw.prototype.handlePointerMove_,p=ol.interaction.Draw.prototype.handleUpEvent,h=ol.interaction.Draw.prototype.finishDrawing,f=ol.interaction.Modify.prototype.handleDragEvent,m=ol.interaction.Translate.prototype.handleDragEvent;ol.interaction.Draw.prototype.handlePointerMove_=function(e){var t=e.map.getView().getProjection().getExtent(),a=e.coordinate;ol.extent.containsCoordinate(t,a)&&d.call(this,e)},ol.interaction.Draw.prototype.handleUpEvent=function(e){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0);var t=e.coordinate,a=e.map.getView().getProjection().getExtent();if(ol.extent.containsCoordinate(a,t)){if(this.sketchFeature_){var n=this.sketchFeature_.getGeometry().getExtent();if(!ol.extent.containsExtent(a,n))return void c.a.showMessage(u.outOfMaxExtent,i.j.WARNING,1e3)}p.call(this,e)}},ol.interaction.Draw.prototype.finishDrawing=function(){if(this.sketchFeature_){var e=this.getMap().getView().getProjection().getExtent(),t=this.sketchFeature_.getGeometry().getExtent();if(!ol.extent.containsExtent(e,t))return void c.a.showMessage(u.outOfMaxExtent,i.j.WARNING,1e3)}h.call(this)},ol.interaction.Modify.prototype.handleDragEvent=function(e){var t=e.coordinate,a=this.getMap().getView().getProjection().getExtent();ol.extent.containsCoordinate(a,t)&&f.call(this,e)},ol.interaction.Translate.prototype.handleDragEvent=function(e){if(this.lastCoordinate_){var t=e.coordinate,a=t[0]-this.lastCoordinate_[0],n=t[1]-this.lastCoordinate_[1],i=this.features_||new ol.Collection([this.lastFeature_]),r=ol.extent.createEmpty();i.forEach((function(e){var t=e.getGeometry().clone();t.translate(a,n),ol.extent.extend(r,t.getExtent())}));var s=this.getMap().getView().getProjection().getExtent();if(!ol.extent.containsExtent(s,r))return;m.call(this,e)}};var y=new ol.interaction.Draw({type:"Point",snapTolerance:20,stopClick:!0}),g=new ol.interaction.Draw({type:"LineString",snapTolerance:20,stopClick:!0}),v=new ol.interaction.Draw({type:"Polygon",snapTolerance:20,stopClick:!0}),S=new ol.interaction.Draw({type:"Circle",snapTolerance:20,stopClick:!0,geometryFunction:function(e,t){var a=s()(e,2),n=a[0],i=a[1],r=Math.sqrt(Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2));if(t){if(r>0){var o=ol.geom.Polygon.fromCircle(new ol.geom.Circle(n,r,"XY"),100,0);t.setCoordinates(o.getCoordinates())}}else t=ol.geom.Polygon.fromCircle(new ol.geom.Circle([NaN,NaN]),100,0);return t}}),b=new ol.interaction.Draw({type:"Circle",snapTolerance:20,stopClick:!0,geometryFunction:function(e,t,a){var n=s()(e,2),i=n[0],r=n[1],o=[(i[0]+r[0])/2,(i[1]+r[1])/2],l=Math.sqrt(Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2));if(t){if(l>0){var c=ol.geom.Polygon.fromCircle(new ol.geom.Circle(o,l,"XY"),100,0),u=c.getExtent(),d=(i[0]-r[0])/(u[0]-u[2]),p=(i[1]-r[1])/(u[1]-u[3]),h=[i[0]-u[0]*d,i[1]-u[1]*p];c.applyTransform((function(e,t,a){for(var n=0;n<e.length;n+=a)t[n]=e[n]*d+h[0],t[n+1]=e[n+1]*p+h[1];return t})),t.setCoordinates(c.getCoordinates())}}else t=ol.geom.Polygon.fromCircle(new ol.geom.Circle(o,l,"XY"),100,0);return t}}),I=new ol.interaction.Draw({type:"Circle",snapTolerance:20,stopClick:!0,geometryFunction:ol.interaction.Draw.createBox()}),E=new ol.interaction.Draw({type:"Circle",snapTolerance:20,stopClick:!0,geometryFunction:ol.interaction.Draw.createRegularPolygon(6)}),T=new ol.interaction.Draw({type:"LineString",snapTolerance:20,stopClick:!0,geometryFunction:function(e,t){if(t){var a=l()({type:"Feature",geometry:{type:"LineString",coordinates:e}});t.setCoordinates(a.geometry.coordinates)}else t=new ol.geom.LineString(e);return t}}),C=a(52),L={POINT:y,LINE:g,POLYGON:v,CIRCLE:S,ELLIPSE:b,RECTANGLE:I,HEXAGON:E,BEZIER:T},N={selectFeatures:new ol.Collection,markerLayerManager:null,drawEndCallBack:null,hideMarkerPopup:null,addControlToMap:function(e,t){var a=this;a.hideMarkerPopup=t;var i=this.selectFeatures,r=this.dragCtrl=new ol.interaction.Translate({features:i}),s=this.modifyCtrl=new ol.interaction.Modify({features:i});for(var o in r.setActive(!1),s.setActive(!1),L){var l=L[o];l.setActive(!1),e.addInteraction(l),a.registerDrawCtrlEvent(l)}e.addInteraction(r),e.addInteraction(s),this.isTextFeature=!1,r.on("translatestart",(function(){n.a.closeAllPop(a.hideMarkerPopup)}))},registerDrawCtrlEvent:function(e){var t=this;e.on("drawend",(function(e){var a=e.feature,n=a.getGeometry().getType();"Point"===n&&t.isTextFeature&&(n="Text"),t.markerLayerManager.addFeature(a,n),C.a.updateGraticuleLayer(),t.deatectiveDrawControl(),t.drawEndCallBack()}))},setMarkerLayerToDrawCtrl:function(e){this.markerLayerManager=e},activeDrawControl:function(e,t,a){this.drawEndCallBack=a,this.markerLayerManager=t,this.deatectiveDrawControl();var n=e===i.e.TEXT?y:L[e];n.setActive(!0),this.activeDrawCtrl=n,this.isTextFeature=e===i.e.TEXT},deatectiveDrawControl:function(){this.activeDrawCtrl&&this.activeDrawCtrl.setActive(!1),this.activeDrawCtrl=null},setFeatureEditable:function(e){this.selectFeatures.clear(),this.selectFeatures.push(e),this.dragCtrl.setActive(!0),e.getGeometry().getType().toUpperCase()!==i.e.POINT&&this.modifyCtrl.setActive(!0)},isDrawing:function(){return!!this.activeDrawCtrl},setFeatureUneditable:function(){this.selectFeatures.clear(),this.dragCtrl.setActive(!1),this.modifyCtrl.setActive(!1)}};t.a=N},19:function(e,t,a){"use strict";a.d(t,"r",(function(){return n})),a.d(t,"u",(function(){return i})),a.d(t,"q",(function(){return r})),a.d(t,"n",(function(){return s})),a.d(t,"s",(function(){return o})),a.d(t,"g",(function(){return l})),a.d(t,"o",(function(){return c})),a.d(t,"b",(function(){return u})),a.d(t,"y",(function(){return d})),a.d(t,"t",(function(){return p})),a.d(t,"k",(function(){return h})),a.d(t,"e",(function(){return f})),a.d(t,"f",(function(){return m})),a.d(t,"c",(function(){return y})),a.d(t,"a",(function(){return g})),a.d(t,"d",(function(){return v})),a.d(t,"z",(function(){return S})),a.d(t,"B",(function(){return b})),a.d(t,"v",(function(){return I})),a.d(t,"w",(function(){return E})),a.d(t,"p",(function(){return T})),a.d(t,"G",(function(){return C})),a.d(t,"x",(function(){return L})),a.d(t,"D",(function(){return N})),a.d(t,"m",(function(){return k})),a.d(t,"E",(function(){return O})),a.d(t,"C",(function(){return D})),a.d(t,"l",(function(){return w})),a.d(t,"F",(function(){return A})),a.d(t,"i",(function(){return F})),a.d(t,"h",(function(){return M})),a.d(t,"A",(function(){return R})),a.d(t,"j",(function(){return x}));var n="CHANGE_MENU_TAB",i="CHANGE_TAB_FLOD",r="CHANGE_MAP_TITLE",s="CHANGE_MAP_SETTING",o="CHANGE_MIN_MAX_SCALE",l="CHANEG_BASEMAP_INDEX",c="CHANGE_MAP_SHARE",u="ADD_FROM_FILE",d="SET_LAYER_SERVERID",p="CHANGE_SELECTED_LAYER",h="CHANGE_LAYER_ZINDEX",f="ADD_RESTMAP_OVERLAYER",m="ADD_VECTOR_TILE",y="ADD_FROM_RESTDATA",g="ADD_FROM_DATAFLOW",v="ADD_MARKER_LAYER",S="SHOW_ATTRIBUTE_TABLE",b="SHOW_MARKER_POPUP",I="HIDE_MARKER_POPUP",E="REMOVE_CURRENT_LAYER",T="CHANGE_MAP_TAGS",C="UPDATE_LEGEND_VIEW",L="REVIEW_PORTAL_MAP",N="UPDATA_MARKER",k="CHANGE_MAP_DESCRIPTION",O="UPDATE_APP_LOGO",D="TWINKLE_LAYER",w="CHANGE_LOGIN_STATUS",A="UPDATE_LAYER_INFO",F="CHANGE_CURRENT_SCALE",M="CHANGE_AUTHORIZE_SETTIONG",R="SHOW_CUSTOM_SETTINGS",x="CHANGE_GRATICULE_VISIBLE"},192:function(e,t,a){"use strict";a(92),a(28),a(30),a(20),a(27);var n=a(0),i=a.n(n),r=a(13),s=a.n(r),o=a(5),l=a(2),c=a(239),u=a(107),d=a(24),p={themePop:document.createElement("div"),showThemePop:function(e,t,a,n,r,d,h,f){if(e){var m=o.a.map.getOverlayById("theme-pop"),y=o.a.getLayerById(h),g={};if(y){var v=y.layerInfo;v&&(g=v.popupInfo||u.a.getDefaultPopupInfo(a,v.name))}if(m.setElement(this.themePop),e.getGeometry()&&"Point"===e.getGeometry().getType()){var S=y.styleCache,b=y.layerInfo,I=y.layer,E=b.layerType,T=S[E],C=T.style,L=T.themeSetting;if(["VECTOR","SYMBOL","UNIQUE","RANK_SYMBOL"].includes(E)){var N=C.type,k=C.radius,O=C.symbolInfo,D=C.imageInfo,w=C.svgOffset,A=C.imageOffset,F=C.symbolOffset;if("RANK_SYMBOL"===E){var M=+e.get("attributes")[L.themeField],R=I.get("styleSource").styleGroups.find((function(e){return e.start<=M&&M<e.end}));k=R?R.radius:L.maxRadius+L.minRadius/2}var x=F.offsetX*k,P=F.offsetY*k,V=2*k;"IMAGE_POINT"===N&&D&&D.url?(x=(A.offsetX-.5)*V,P=(A.offsetY-.5)*V):"SVG_POINT"===N&&O&&O.url&&(x=(w.offsetX-.5)*V,P=(w.offsetY-.5)*V),m.setOffset([x,P-20])}else{var B=C.radius,U=C.offsetX*B,G=C.offsetY*B;m.setOffset([U,G-20])}m.setPosition(l.a.getFeatureCenter(e))}else m.setOffset([0,0]),m.setPosition(t);var _=e.get("attributes");s.a.render(i.a.createElement(c.a,{enableInfo:r,attributes:_,captions:n,popupInfo:g,onPopClose:p.onPopClose,changeFieldValue:function(t,a){p.changeFieldValue(t,a,e,r,h,d,f)}}),this.themePop),o.a.onPopClose=p.closePopup}},onPopClose:function(){o.a.highLightLayer&&o.a.highLightLayer.getSource().clear(),o.a.closeThemePop()},closePopup:function(){p.themePop&&s.a.unmountComponentAtNode(p.themePop)},changeFieldValue:function(e,t,a,n,i,r,s){var l=a.get("attributes"),c=[null,void 0].includes(l.dataviz_featureID)?l.SMID:l.dataviz_featureID;if(n&&void 0!==l[e]){l[e]=t;var u={urlId:n.urlId,fieldValue:t,fieldName:e,oldfieldValue:l[e],featureID:c};r&&r(),d.a.addEditFeatureInfo(n,u);var p=o.a.getLayerById(i);p&&p.updateLayerFromEdit(u,(function(){s&&s(!1)}))}}};t.a=p},193:function(e,t,a){"use strict";a(14),a(18);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(10),p=a.n(d),h=a(0),f=a.n(h),m=a(96),y=a(55),g=a(214),v=(a(27),a(32),a(44),a(40),a(36),a(20),a(1587),function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).pageY=0,a.state={name:e.name,values:["round","butt","square"],value:e.strokeDashstyle,isShow:!1},a}return p()(t,e),s()(t,[{key:"componentWillMount",value:function(){this.setState({className:this.props.strokeDashstyle})}},{key:"componentWillReceiveProps",value:function(e){this.setState({className:e.strokeDashstyle})}},{key:"componentDidUpdate",value:function(){var e=document.body.clientHeight;if(this.pageY){var t=this.refs.selectContent;if(t){for(var a,n,i=t.clientHeight,r=document.getElementsByClassName("selected"),s=99999999,o=0;o<r.length;o++)a=r[o].getBoundingClientRect().top,(n=this.pageY-a)>0&&n<s&&(s=a);this.pageY+i+10>e?t.style.top=s+16-i-28+"px":t.style.top=s+16+14+"px"}}this.pageY=0}},{key:"update",value:function(e,t,a,n){var i=window.cloneDeep(this.state);a&&(i.name=a),e&&(i.value=e),n&&(i.values=n),void 0!==t&&(i.isShow=t),this.setState(i)}},{key:"onClick",value:function(e){var t="",a=(t=e.target.firstChild?e.target.firstChild.className:e.target.className).indexOf(" "),n=t.slice(0,a);this.update(n,!0),this.props.editor(this.props.type,n,this.props.parentKey)}},{key:"getAllLineUI",value:function(){var e=this;return this.state.isShow?f.a.createElement("div",{ref:"selectContent",className:"selects_container active"},this.state.values.map((function(t,a){return f.a.createElement("div",{key:a,className:"selects-content",onMouseDown:e.onClick.bind(e)},f.a.createElement("div",{className:t+" line_type_img"}))}))):null}},{key:"changeDisplay",value:function(e){this.pageY=e.pageY,this.setState({isShow:!this.state.isShow})}},{key:"closeOptions",value:function(){this.setState({isShow:!1})}},{key:"render",value:function(){return f.a.createElement("div",{className:"editor-tool line-cap"},f.a.createElement("div",{className:"text"},this.props.name),f.a.createElement("div",{className:"selects_tool_img",tabIndex:"1",onBlur:this.closeOptions.bind(this),onClick:this.changeDisplay.bind(this)},f.a.createElement("div",{className:"selected"},f.a.createElement("div",{className:"selected_img"},f.a.createElement("div",{className:"line_type_img "+this.state.value})),f.a.createElement("div",{className:"type_icon"},f.a.createElement("div",{className:this.state.isShow?"triangle-up-btn":"triangle-down-btn"}))),this.getAllLineUI()))}}]),t}(h.Component)),S=a(45),b=function(e){function t(e){return i()(this,t),l()(this,u()(t).call(this,e))}return p()(t,e),s()(t,[{key:"onChange",value:function(e,t){var a=this.props.type.toUpperCase();"strokeOpacity"===e&&"fillOpacity"===e&&(t/=100),this.defaultStyle[e]=t,S.a.setStyle(this.defaultStyle,a,this.props.feature)}},{key:"getContainer",value:function(){var e=[];return this.defaultStyle=this.props.style,this.props.config.forEach((function(t,a){"selectColor"===t.componentName?e.push(f.a.createElement(m.a,{key:a,name:t.title,type:t.type,color:t.value.defaultValue,editor:this.onChange.bind(this)})):"slider"===t.componentName?e.push(f.a.createElement(y.a,{key:a,name:t.title,type:t.type,value:t.value.defaultValue,min:t.value.min,max:t.value.max,unit:t.value.unit,editor:this.onChange.bind(this)})):"selectLineDash"===t.componentName?e.push(f.a.createElement(g.a,{key:a,name:t.title,type:"lineDash",strokeDashstyle:t.value.defaultValue,editor:this.onChange.bind(this)})):"selectLineCapStyle"===t.componentName&&e.push(f.a.createElement(v,{key:a,name:t.title,type:"lineCap",strokeDashstyle:t.value.defaultValue,editor:this.onChange.bind(this)}))}),this),e}},{key:"render",value:function(){return f.a.createElement("div",{className:"feature-style-template"},this.getContainer())}}]),t}(h.Component);t.a=b},2:function(e,t,a){"use strict";var n,i=a(17),r=a.n(i),s=(a(87),a(25)),o=a.n(s),l=(a(333),a(466),a(252),a(20),a(455),a(459),a(334),a(467),a(71),a(443),a(73),a(112),a(72),a(54),a(259),a(32),a(141),a(18),a(99),a(100),a(93),a(14),a(44),a(40),a(36),a(69),a(136)),c=a.n(l),u=(a(28),a(30),a(81)),d=a.n(u),p=(a(78),a(1)),h=a(633),f=a.n(h),m=a(22),y=a(21),g=(a(27),{getFeatureBySQLWithConcurrent:function(e,t,a,n,i,r){var s,o=this,l=i||new SuperMap.FilterParameter({name:t.join().replace(":","@")}),c=[];this._getReasult(e,l,t,0,1,1,r).then((function(i){s=i;var u=i.result.totalCount;if(u>1){for(var d=1;d<u;)c.push(o._getReasult(e,l,t,d,d+100,100,r)),d+=100;Promise.all(c).then((function(e){e.map((function(e){"processCompleted"===e.type&&e.result.features&&e.result.features.features?e.result.features.features.map((function(e){s.result.features.features.push(e)})):s.someRequestFailed=!0})),a(s)})).catch((function(e){n(e)}))}else a(i)})).catch((function(e){n(e)}))},_getReasult:function(e,t,a,n,i,r,s){var o=this;return new Promise((function(l,c){new ol.supermap.FeatureService(e,o._getfeatureServiceOption(e)).getFeaturesBySQL(o._getFeaturesBySQLParameters(t,a,n,i,r,s),(function(e){var t=e.result;"processCompleted"===e.type&&t&&t.features?l(e):c(e)}))}))},_getFeaturesBySQLParameters:function(e,t,a,n,i,r){return new SuperMap.GetFeaturesBySQLParameters({queryParameter:e,datasetNames:t,fromIndex:a,toIndex:n,maxFeatures:i,returnContent:!0,targetEpsgCode:r})},_getfeatureServiceOption:function(e){return{withCredentials:C.isIportalProxyServiceUrl(e)}}}),v=a(665),S=a.n(v),b={},I={},E={"EPSG:3857":["EPSG:900913"],"EPSG:900913":["EPSG:3857"],"EPSG:4326":["EPSG:4490"],"EPSG:4490":["EPSG:4326"]},T={actions:{},translateTools:new ol.format.GeoJSON,isNumber:function(e){if(""===e)return!1;var t=Number(e);return 0===t||!isNaN(t)},getEpsgCode:function(e){var t=null;switch(e){case DataViz.Language.LonLatProj:t="EPSG:4326";break;case DataViz.Language.webMercatorProj:t="EPSG:3857";break;case"EPSG:4326":t=DataViz.Language.LonLatProj;break;case"EPSG:3857":t=DataViz.Language.webMercatorProj}return t},isSupportedEpsg:function(e,t){var a=T.isArray(e)?d()(e):[e];return!!T.getMatchedEpsg(a,t)},getMatchedEpsg:function(e,t){return e.includes(t)?t:E[t]?S()(e,E[t])[0]:void 0},shallowEqual:function(e,t){if(e===t)return!0;if("object"!==c()(e)||null===e||"object"!==c()(t)||null===t)return!1;var a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(var i=Object.prototype.hasOwnProperty.bind(t),r=0;r<a.length;r++)if(!i(a[r])||e[a[r]]!==t[a[r]])return!1;return!0},getUploadId:function(e,t,a,n,i){var r={};return n&&((r={fileEncoding:a||"UTF-8"}).xIndex=n.xIndex,r.yIndex=n.yIndex,r.separator=i,r.firstRowIsHead=!0,r.fieldTypes=n.fieldTypes),T.doFetch("".concat(T.getIPortalUrl(),"web/mycontent/datas.json"),{method:"POST",withCredentials:!0,data:{fileName:e,type:t,dataMetaInfo:r}}).catch((function(e){throw{getUploadIdFailed:!0,info:e}}))},getFeatureCenter:function(e){var t=null,a=null;if(t=e instanceof ol.geom.Geometry?e:e.getGeometry())switch(t.getType()){case"Circle":case"Point":case"LinearRing":a=t.getFirstCoordinate();break;case"LineString":a=t.getCoordinateAt(.5);break;case"MultiLineString":case"MultiPoint":var n=t.getExtent();a=[(n[0]+n[2])/2,(n[1]+n[3])/2];break;case"Polygon":var i=t.getInteriorPoint().getCoordinates();a=[i[0],i[1]];break;case"MultiPolygon":var r=t.getInteriorPoints();a=T.getFeatureCenter(r);break;default:a=t.getFirstCoordinate()}return a},checkReLogin:function(){return T.doFetch("".concat(T.getIPortalUrl(),"web/mycontent/account.json"),{method:"GET",withCredentials:!0}).then((function(e){return T.actions.changeLoginStatus(!0),e})).catch((function(e){throw T.actions.changeLoginStatus(!1),{checkReLogin:!0}}))},getPrivateKey:function(){var e=this;if(this.privateKey)return new Promise((function(t,a){t(e.privateKey)}));var t=T.getIPortalUrl()+"web/mycontent/keys/default.json";return T.doFetch(t,{method:"GET",withCredentials:!0}).then((function(t){return e.privateKey=t.customResult,e.privateKey}))},uploadImageFile:function(e,t){var a="".concat(this.getIPortalUrl(),"web/uploadfile.json");return a+="?toFile=./resources/portal/dataviz/markericon/"+"".concat(e,"-").concat(t),this.doFetch(a,{method:"POST",withCredentials:!0,file:!0,inputElementId:e}).catch((function(e){throw{upLoadFileFailed:!0}}))},newGuid:function(e){for(var t=e||32,a="",n=1;n<t;n++){a+=Math.floor(16*Math.random()).toString(16)}return a},moveFileToDir:function(e){if(window.dataVizConfig&&window.dataVizConfig.directoryName)return T.doFetch("".concat(T.getIPortalUrl(),"web/directories/resources.json"),{method:"POST",withCredentials:!0,data:{basicDirInfo:{id:null,dirName:window.dataVizConfig.directoryName,dirType:"DATA",dirLevel:1,parentDirId:null,isPersonal:!0},dirResource:{resourceId:e}}}).catch((function(t){throw{fileId:e,moveFileToDirFailed:!0}}));throw{fileId:e,moveFileToDirFailed:!0}},getTileLayerInfo:function(e,t,a){return T.doFetch("".concat(T.getUrl("".concat(e,"/maps.json"))),{method:"GET",withCredentials:!0}).then((function(e){a&&a();var n=[];return e&&e.forEach((function(e){var a="prjCoordSys=".concat(JSON.stringify({epsgCode:t})),i=T.doFetch(T.getUrl("".concat(e.path,".json?").concat(encodeURI(a))),{method:"GET",withCredentials:!0}).then((function(t){if(!1===t.succeed)throw{getDataServiceFaild:!0};return t.url=e.path,t})).catch((function(e){throw{getDataServiceFaild:!0}}));n.push(i)})),Promise.all(n).then((function(e){return e}))}))},uploadFile:function(e,t,a,n){var i={file:e,fileName:t,dataMetaInfo:a,callbackFunc:n,directoryName:window.dataVizConfig.directoryName};return y.o.publicFile(i,m.a.maxRestDataCount).then((function(e){return y.o.getDataInfo(e.fileId).then((function(t){return t.fileId=e.fileId,t.datasetName=e.datasetName,t.dataCount=e.dataCount,t.featureType=e.featureType,t}))}))},uploadFileWithoutService:function(e,t,a,n){var i={file:e,fileName:t,dataMetaInfo:a,callbackFunc:n,directoryName:window.dataVizConfig.directoryName};return y.o.uploadFile(i)},checkPublicServer:function(){return T.doFetch("".concat(T.getIPortalUrl(),"web/config/portal.json?").concat(encodeURI("scope=[dataCapabilities]")),{method:"GET",withCredentials:!0}).then((function(e){return e&&e.dataCapabilities}))},uploadJson:function(e,t,a){return T.checkReLogin().then((function(){return a&&a(),T.uploadJsonUnCheckLogin(e,t)}))},uploadJsonUnCheckLogin:function(e,t,a){return T.getUploadId(e,"GEOJSON").then((function(e){return a&&a(),T.doFetch("".concat(T.getIPortalUrl(),"web/mycontent/datas/").concat(e.childID,"/upload.json"),{method:"POST",withCredentials:!0,data:t})}))},getIPortalUrl:function(){return T.getRootUrl()},getRootUrl:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.href,t="https://www.supermapol.com/",a="https://itest.supermapol.com/";if(b[e])return b[e];var n="";if(0===e.indexOf(t))n=t;else if(0===e.indexOf(a))n=a;else{var i=/\/apps|\/web|\/manager|\/developer|\/services/i,r=e.search(i),s=this.getAnchor(e);n+=s.protocol+"//"+this.getHost(e)+"/",r>0&&(n+=e.substring(n.length,r+1))}return b[e]=n,n},getAnchor:function(e){if(I[e])return I[e];var t=document.createElement("a");return t.href=e,I[e]=t,t},getHost:function(e){var t=this.getAnchor(e);if(!t)return null;var a=t.port,n=t.host;return"80"===a||"443"===a?n.split(":")[0]:n},doFetch:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,n={},i=t.data||{};if(n.headers=t.headers||{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},n.mode=t.mode||"cors",n.method=t.method?t.method.toUpperCase():"GET",t.withCredentials&&(n.credentials="include"),"GET"===n.method||"HEAD"===n.method){var r="";Object.keys(i).forEach((function(e,t){r+="".concat(e,"=").concat(i[e],"&")})),e+=r}else if(t.file)if(t.uploadFile){n.headers={};var s=new FormData;s.append("file",t.uploadFile),n.body=s}else{n.headers={};var o=new FormData;o.append("file",document.getElementById(t.inputElementId).files[0]),n.body=o}else n.body=a?i:JSON.stringify(i);return fetch(e,n).then((function(e){if(401!==e.status&&500!==e.status){if("text"===t.dataType)return e.text();if("binary"===t.dataType){if(200!==e.status)throw e.status;return e.blob()}if("response"===t.dataType){if(200!==e.status)throw e.status;return e}return e.json()}throw 500===e.status?"500":"401"}))},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},getDataType:function(e){if(null!=e&&""!==e){if(T.isDate(e))return p.c.DATE;if(T.isNumber(e))return p.c.NUMBER}return p.c.STRING},isDate:function(e){return/((^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(10|12|0?[13578])([-\/\._])(3[01]|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(11|0?[469])([-\/\._])(30|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))([-\/\._])(0?2)([-\/\._])(2[0-8]|1[0-9]|0?[1-9])$)|(^([2468][048]00)([-\/\._])(0?2)([-\/\._])(29)$)|(^([3579][26]00)([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][0][48])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][0][48])([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][2468][048])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][2468][048])([-\/\._])(0?2)([-\/\._])(29)$)|(^([1][89][13579][26])([-\/\._])(0?2)([-\/\._])(29)$)|(^([2-9][0-9][13579][26])([-\/\._])(0?2)([-\/\._])(29)$))/gi.test(e)},isString:function(e){return"string"==typeof e&&e.constructor===String},isXField:function(e){if(!e||!T.isString(e))return!1;var t=e.toLowerCase().trim();return"x"===t||"smx"===t||"jd"===t||""===t||""===t||"longitude"===t||"lot"===t||"lon"===t||"lng"===t},isInTheSameDomain:function(e){if(!e)return!0;var t=e.indexOf("//"),a=document.location.toString(),n=a.indexOf("//");if(-1===t)return!0;var i,r=i=e.substring(0,t),s=a.substring(n+2);n=s.indexOf("/");var o=s.indexOf(":"),l=s.substring(0,n),c=document.location.protocol;if(-1!==o||(l+=":"+("http:"===c.toLowerCase()?80:443)),c.toLowerCase()!==r.toLowerCase())return!1;var u=(r=e.substring(t+2)).indexOf(":");t=r.indexOf("/");var d,p=r.substring(0,t);return-1!==u?d=r.substring(0,u):(d=r.substring(0,t),p+=":"+("http:"===i.toLowerCase()?80:443)),d===document.domain&&p===l},isSameDomain:function(e){var t=e.split("://")[1],a=t.indexOf("/"),n=t.substring(0,a),i=document.location.toString().split("://")[1],r=i.indexOf("/"),s=i.substring(0,r);if(n.indexOf(":")>-1||""!==window.location.port)return n===s;var o=n.split("."),l=s.split(".");return o[1]===l[1]&&o[2]===l[2]},isYField:function(e){if(!e||!T.isString(e))return!1;var t=e.toLowerCase().trim();return"y"===t||"smy"===t||"wd"===t||""===t||""===t||"latitude"===t||"lat"===t},isCityField:function(e){if(!e||!T.isString(e))return!1;var t=e.toLowerCase().trim();return""===t||/\bcity\b/.test(t)||e.indexOf("")>-1||e.indexOf("")>-1},isAddressField:function(e){if(!e||!T.isString(e))return!1;var t=e.toLowerCase().trim();return""===t||/\baddress\b/.test(t)},isMatchUrl:function(e){return f.a.isWebUri(e)},handleInputUrl:function(e){return!T.isMatchUrl(e)&&T.isMatchUrl(encodeURI(e))?encodeURI(e):e},delayCall:function(e,t,a){var i=this;n&&clearTimeout(n),n=setTimeout((function(){n=null,"function"==typeof e&&e.apply(a||i)}),t||300)},isSupportCssTransition:function(){if(void 0===this.browserIsSupportCss3){var e=document.createElement("div").style;this.browserIsSupportCss3="transition"in e||"mozTransition"in e||"webkitTransition"in e}return this.browserIsSupportCss3},isIE:function(){return!!(window.ActiveXObject||"ActiveXObject"in window)},isFirefox:function(){return navigator.userAgent.indexOf("Firefox")>-1},isChrome:function(){return navigator.userAgent.indexOf("Chrome")>-1},getFirefoxVersion:function(){return+navigator.userAgent.toLowerCase().match(/firefox\/([\d.]+)/)[1]},getChromeVersion:function(){for(var e=navigator.userAgent.split(" "),t="",a=0;a<e.length;a++)/chrome/i.test(e[a])&&(t=e[a]);return!!t&&Number(t.split("/")[1].split(".")[0])},trim:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return T.isNumber(e)?e:e.replace(/(^\s*)|(\s*$)/g,"")},getFeatureBySQL:function(e,t,a,n,i,r,s){if(r){i=i||new SuperMap.FilterParameter({name:t.join().replace(":","@")}),r=r||new SuperMap.GetFeaturesBySQLParameters({queryParameter:i,datasetNames:t,fromIndex:0,toIndex:1e5,maxFeatures:1e5,returnContent:!0,targetEpsgCode:s});var o={withCredentials:T.isIportalProxyServiceUrl(e),hasGeometry:!1};this.isInTheSameDomain(e)||(o.proxy=this.getIPortalUrl()+"apps/viewer/getUrlResource.json?url="),new ol.supermap.FeatureService(e,o).getFeaturesBySQL(r,(function(e){"processCompleted"===e.type?a(e):n(e)}))}else g.getFeatureBySQLWithConcurrent(e,t,a,n,i,s)},queryFeatureBySQL:function(e,t,a,n,i,r,s,o,l,c){var u,d,p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:T.serviceProxy;u=new SuperMap.FilterParameter({name:t,attributeFilter:a}),n&&(u.fields=n);var h={queryParams:[u]};c&&(h.queryOption=SuperMap.QueryOption.ATTRIBUTE),o&&(h.startRecord=o),l&&(h.expectCount=l),i&&(h.prjCoordSys={epsgCode:i}),d=new SuperMap.QueryBySQLParameters(h);var f={withCredentials:T.isIportalProxyServiceUrl(e,p)};this.isInTheSameDomain(e)||(f.proxy=this.getIPortalUrl()+"apps/viewer/getUrlResource.json?url="),new ol.supermap.QueryService(e,f).queryBySQL(d,(function(e){"processCompleted"===e.type?r(e):s(e)}))},judgeArrayEqual:function(e,t){return!(!e||!t||e.length!==t.length)&&e.every((function(e,a){return e===t[a]}))},changeTimeToData:function(e){var t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),r=t.getHours(),s=t.getMinutes(),o=t.getSeconds();return a+"-"+this.toDouble(n)+"-"+this.toDouble(i)+" "+this.toDouble(r)+":"+this.toDouble(s)+":"+this.toDouble(o)},toDouble:function(e){return e<10?"0"+e:e},getDataTypesFromFeature:function(e){if(!e)return[];var t=[],a=[],n=e.get("attributes");for(var i in n)t.push(i),a.push(n[i]);return this.getFieldType(t,a)},getFieldsByObj:function(e){return e&&Object.keys(e).filter((function(e){return e&&!e.startsWith("dataviz_")}))},getFieldType:function(e,t){var a={};return e.forEach((function(e,n){var i=e;T.isString(e)&&(i=e.trim()),Object.keys(a).includes(i)&&(i+="_1"),T.isNumber(t[n])?a[i]=p.c.NUMBER:T.isString(t[n])?a[i]=p.c.STRING:a[i]=p.c.UNKNOWN})),a},getFormatTime:function(){var e=new Date,t=e.getHours(),a=e.getMinutes();return a=a>=10?a:"0"+a,"".concat(t=t>=10?t:"0"+t,":").concat(a)},getChildToolsConfig:function(){var e=window.dataVizConfig.controls,t={};return e.forEach((function(e){t[e.id]=e.isCheck})),t},deleteServerData:function(e,t){T.checkReLogin().then((function(){var a=T.getGetOrDeleteParams("".concat(T.getIPortalUrl(),"web/mycontent/datas/").concat(e,".json"));return T.doFetch(a.requestUrl,{method:a.method,withCredentials:!0}).then((function(){t&&t(DataViz.Language.delteServerDataSuccess,p.j.SUCCESS)})).catch((function(e){e&&e.error&&404===e.error.code?t&&t(DataViz.Language.dataUnexit):t&&t(DataViz.Language.delteServerDataFaild)}))}))},isVectorLayer:function(e){return this.isThemeLayer(e)||e===p.r.MARKER||this.isDataflowLayer(e)},isThemeLayer:function(e){return[p.r.VECTOR,p.r.UNIQUE,p.r.RANGE,p.r.HEAT_MAP,p.r.GRAPHIC,p.r.SYMBOL,p.r.RANK_SYMBOL,p.r.MIGRATION].includes(e)},isDataflowLayer:function(e){return e===p.r.DATAFLOW||e===p.r.DATAFLOWHEAT},isTileLayer:function(e){return[p.o.TILE,p.o.WMS,p.o.WMTS].includes(e)},isInternetMap:function(e){return["BAIDU","CLOUD","CLOUD_BLACK","TIANDITU_VEC_3857","TIANDITU_VEC_4326","TIANDITU_IMG_3857","TIANDITU_IMG_4326","TIANDITU_TER_3857","TIANDITU_TER_4326","OSM","GOOGLE","JAPAN_STD","JAPAN_PALE","JAPAN_RELIEF","JAPAN_ORT","GOOGLE_CN","BING","CHINA_DARK"].includes(e)},isVectorTileLayer:function(e){return e===p.i.VECTOR_TILE||"MAPBOXSTYLE"===e},isDateObject:function(e){return"[object Date]"===Object.prototype.toString.call(e)},getDatasources:function(e){return T.doFetch("".concat(T.getUrl("".concat(e,"/data/datasources.json"))),{method:"GET",withCredentials:!0}).then((function(e){return e.datasourceNames[0]}))},getDataServiceInfo:function(e){return T.doFetch("".concat(e,".json"),{method:"GET",withCredentials:!0}).then((function(e){return e}))},transformObjToArray:function(e){var t=[];for(var a in e)t.push(e[a]);return t},getAdministrativeDataByType:function(e){switch(e){case"":case"Province":return window.ProvinceData;case"":case"City":return window.MunicipalData}},isMatchAdministrativeName:function(e,t){if(T.isString(t)){var a=e.substr(0,2);return!!t.match(new RegExp(a))}return!1},getAdministrativeFeature:function(e,t){var a=this.getAdministrativeDataByType(e).features.filter((function(e){return T.isMatchAdministrativeName(e.properties.Name,t)}));return T.getHighestMatchAdministration(a,t)},getHighestMatchAdministration:function(e,t){var a=0,n=null;return e.forEach((function(e){var i=0;Array.from(new Set(e.properties.Name.split(""))).forEach((function(e){t.includes(e)&&i++})),i>a&&(a=i,n=e)})),window.cloneDeep(n)},formatDataTypes:function(e){var t={};return e.forEach((function(e){var a=e.name.trim();"TEXT"===e.type?t[a]=p.c.STRING:["DOUBLE","INT","FLOAT","LONG","SHORT"].includes(e.type)?t[a]=p.c.NUMBER:t[a]=p.c.UNKNOWN})),t},completeRelativePath:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=e;return/^(http:|https:)/.test(a)||/point_imgs/.test(a)||!/resources/.test(a)||/apps\/dataviz/.test(a)||(a="".concat(T.getIPortalUrl(),"apps/dataviz/").concat(a)),t&&/^(http:|https:)/.test(a)&&!/(\?t=|&t=)/.test(a)&&(a+="?t=".concat((new Date).getTime())),a},throttle:function(e,t,a){var n,i,r,s=null,o=0;a||(a={});var l=function(){o=!1===a.leading?0:(new Date).getTime(),s=null,r=e.apply(n,i),s||(n=i=null)};return function(){var c=(new Date).getTime();o||!1!==a.leading||(o=c);var u=t-(c-o);return n=this,i=arguments,u<=0||u>t?(s&&(clearTimeout(s),s=null),o=c,r=e.apply(n,i),s||(n=i=null)):s||!1===a.trailing||(s=setTimeout(l,u)),r}},debounce:function(e,t,a){var n,i,r,s,o,l=function l(){var c=(new Date).getTime()-s;c<t&&c>=0?n=setTimeout(l,t-c):(n=null,a||(o=e.apply(r,i),n||(r=i=null)))};return function(){r=this,i=arguments,s=(new Date).getTime();var c=a&&!n;return n||(n=setTimeout(l,t)),c&&(o=e.apply(r,i),r=i=null),o}},getEpsgCodeFromWKT:function(e,t){var a=e.lastIndexOf("AUTHORITY")+10,n=e.indexOf("]",a)-1,i=e.substring(a,n).split(",")[1].substr(1);return t?i:"EPSG:".concat(i)},initThemeField:function(e,t){for(var a,n=[],i=Object.keys(e),r=0,s=i.length;r<s;r++){var o=i[r];if("dataviz_featureID"!==o)if(T.isXField(o)||T.isYField(o))n.push(o);else if(!t||e[o]===t){a=o;break}}return a=void 0===a?n[0]:a},getFeatureProperties:function(e){var t=[];return T.isArray(e)&&e.length&&e.forEach((function(e){var a=e.get("Properties")||e.get("attributes");a&&t.push(window.cloneDeep(a))})),t},getUrl:function(e,t){return e=e.trim(),T.isInTheSameDomain(e)?e:T.getProxy(t)+encodeURIComponent(e)},getProxy:function(e){var t=e||"json";return"".concat(T.getRootUrl(),"apps/viewer/getUrlResource.").concat(t,"?url=")},scaleToResolution:function(e,t,a){var n=e*t*(1/.0254)*this.getMeterPerMapUnit(a);return n=1/n},resolutionToScale:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.a.dpi.default,a=arguments.length>2?arguments[2]:void 0,n=1/.0254,i=getMeterPerMapUnit(a),r=e*t*n*i;return r=1/r},getMeterPerMapUnit:function(e){var t;return"METER"===e?t=1:"DEGREE"===e?t=2*Math.PI*6378137/360:"KILOMETER"===e?t=.001:"INCH"===e?t=1/.025399999918:"FOOT"===e&&(t=.3048),t},getAllFields:function(e){return T.doFetch("".concat(T.getUrl("".concat(e,"/fields.json"))),{method:"GET",withCredentials:!0}).then((function(e){return e.fieldNames}))},setLocalStorage:function(e,t){var a=window.localStorage;if(a){t=T.isString(t)?t:JSON.stringify(t);try{a.setItem(e,t)}catch(e){}}},getLocalStorage:function(e){var t=null,a=window.localStorage;if(!a)return t;try{t=a.getItem(e),t=JSON.parse(t)}catch(e){}return t},deleteLocalStorage:function(e){var t=window.localStorage;if(t)try{t.removeItem(e)}catch(e){}},getStyleResolutions:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:22,n=[],i=Math.abs(e.left-e.right)/512,r=t;r<=a;r++)0!==r?(i/=2,n[r]=i):n[r]=i;return n},setCookie:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i="";a&&T.isNumber(a)&&(i=";expire="+(i=new Date((new Date).getTime()+24*a*60*60*1e3).toGMTString())),n&&T.isString(n)&&(n=";path="+n),document.cookie="".concat(e,"=").concat(escape(t)).concat(i).concat(n)},getResFromScale:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DEGREE",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.a.dpi.default,n=m.a.metersPerUnit[t.toUpperCase()];return.0254*e/a/n},getScaleFromRes:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DEGREE",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.a.dpi.default;if(e){var n=m.a.metersPerUnit[t.toUpperCase()];return"1:"+e*a*n/.0254}},formatScale:function(e){return e.replace(/,/g,"")},toLocalScale:function(e){var t=Number(e.split(":")[1]);return t=t.toLocaleString(),"1:".concat(t)},formateWithToken:function(e,t){if(!e)return null;var a=e;return e.indexOf("?token=")>-1&&(t=e.split("?token=")[1],a=e=e.split("?token=")[0]),a+=".json",t&&(a+="?token=".concat(t)),{url:e,requestUrl:a,credential:t}},getValuesFromField:function(e,t){var a=[];return e.forEach((function(e){var n=e.get("attributes")[t];void 0!==n&&-1===a.indexOf(n)&&a.push(n)})),a},toRadians:function(e){return Math.PI*e/180},toAngle:function(e){return Math.ceil(180*e/Math.PI)},isIportalProxyServiceUrl:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.serviceProxy;if(t&&t.enable){var a="";return t.proxyServerRootUrl?a="".concat(t.proxyServerRootUrl,"/"):t.rootUrlPostfix?a="".concat(t.port,"/").concat(t.rootUrlPostfix,"/"):t.rootUrlPostfix||(a="".concat(t.port,"/")),80!==t.port?e.indexOf(a)>=0:e.indexOf(a)>=0||e.indexOf(a.replace(":80",""))>=0}return!1},hasDatavizPermission:function(){return T.doFetch("".concat(T.getIPortalUrl(),"web/config/userprofile.json?").concat(encodeURI("scope=[editableWebApps]")),{method:"GET"}).then((function(e){var t=e.editableWebApps;return(void 0===t?[]:t).includes("DATAVIZ")}))},isOverThemeMaxCount:function(e,t){var a=!1;switch(t){case p.p.POINT:a=e>m.a.pointThemeLayerMaxCount;break;case p.p.LINE:case p.p.POLYGON:case p.p.REGION:a=e>m.a.themeLayerMaxCount}return a},isSupportWebp:function(e,t){return!(T.isIE()||T.isFirefox()&&T.getFirefoxVersion()<65||T.isChrome()&&T.getChromeVersion()<32)&&(e=t?"".concat(e,"/tileImage.webp?token=").concat(t):"".concat(e,"/tileImage.webp"),e=T.getUrl(e),T.doFetch(e,{method:"HEAD",dataType:"response"}).then((function(){return!0})).catch((function(){return!1})))},filterDatavizFields:function(e){return e.filter((function(e){return!m.a.datavizFields.includes(e)}))},checkUserPermission:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MAP",a="".concat(T.getIPortalUrl(),"web/permissions/highestpermission.json?"),n="resourceType=".concat(t,"&resourceIds=").concat(JSON.stringify(e));return T.doFetch(a+encodeURI(n),{method:"GET",withCredentials:!0}).then((function(e){return e})).catch((function(){return null}))},handleSearchSetting:function(e){var t=[];return e.forEach((function(e){var a={name:e.filterName||e.name,attributes:e.attributes,createTime:e.createTime,layerName:e.layerName};t.push(a)})),t},isSupportSearchSettingType:function(e){return[p.o.TILE,p.r.VECTOR,p.r.UNIQUE,p.r.RANGE,p.r.GRAPHIC,p.r.SYMBOL,p.r.RANK_SYMBOL].includes(e)},isSupportPopupConfig:function(e){return[p.r.RANK_SYMBOL,p.r.RANGE,p.r.UNIQUE,p.r.SYMBOL,p.r.VECTOR,p.r.DATAFLOW].includes(e)},getSublayers:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.serviceProxy,a=arguments.length>2?arguments[2]:void 0,n="".concat(e,"/layers.json"),i=T.isIportalProxyServiceUrl(n);if(a){var r=Object.entries(a)[0].join("=");Object.values(a)[0]&&(n+=n.includes("?")?"&".concat(r):"?".concat(r))}return t&&t.enable&&(n="".concat(T.getProxy()).concat(n)),T.doFetch(n,{method:"GET",withCredentials:i}).then((function(e){if(e[0]&&e[0].subLayers&&e[0].subLayers.layers)return e[0].subLayers.layers;throw""})).catch((function(e){return null}))},getPostOrPutParams:function(e){var t=window.DataViz.Plugins.isPut2Post;return{requestUrl:t?"".concat(e,"?_method=PUT"):e,method:t?"POST":"PUT"}},getGetOrDeleteParams:function(e){var t=window.DataViz.Plugins.isDelete2Get;return{requestUrl:t?"".concat(e,"?_method=DELETE"):e,method:t?"GET":"DELETE"}},getUrlQueryParams:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.href,t=e.split("?"),a={};return 1===t.length?a:((t=t[1].split("&")).forEach((function(e){var t=e.split("=");a[t[0]]=t[1]})),a)},getRestMapWKT:function(e){return T.doFetch(T.getUrl("".concat(e.trim(),"/prjCoordSys.wkt")),{method:"GET",dataType:"text"}).then((function(e){return e}))},setMask:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"EPSG:4326";T.doFetch("".concat(T.getIPortalUrl(),"web/services/").concat(e,"/regionpermissions/mine.json"),{method:"GET",withCredentials:!0}).then((function(e){var n=T.translateTools.readFeature(e,{dataProjection:"EPSG:4326",featureProjection:a});ol.supermap.Util.setMask(t,n)}))},wktIsEqual:function(e){var t=!1;if(proj4&&e&&2===e.length)try{var a=proj4(e[0]).oProj,n=proj4(e[1]).oProj;if(t=!0,a.type!==n.type)return!1;["a","b","e","ep2"].forEach((function(e){a[e].toFixed(9)!==n[e].toFixed(9)&&(t=!1)})),"PROJCS"===a.type&&["long0","lat0"].forEach((function(e){a[e].toFixed(9)!==n[e].toFixed(9)&&(t=!1)}))}catch(e){t=!1}return t},isCustomProjection:function(e){return this.isNumber(e)?[-1e3,-1].includes(+e):["EPSG:-1000","EPSG:-1"].includes(e)},isDynamicRestData:function(e){return!["EPSG:0"].includes(e)},isSupportRestDataType:function(e){return["POINT","LINE","REGION"].includes(e)},getUserprofile:function(){return T.doFetch("".concat(T.getIPortalUrl(),"web/config/userprofile.json"),{withCredentials:!0}).catch((function(){return{userName:"GUEST"}}))},getThemes:function(){return T.doFetch("".concat(T.getIPortalUrl(),"web/uiconfig/themes.json")).catch((function(){return{default:window.DataViz.theme}}))},getTheme:function(){return new Promise(function(){var e=o()(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("localStorage"in window&&localStorage.getItem(p.a))){e.next=4;break}t(localStorage.getItem(p.a)),e.next=15;break;case 4:return e.next=6,T.getUserprofile();case 6:if(!(a=e.sent).theme){e.next=11;break}t(T.getAppTheme(a.theme)),e.next=15;break;case 11:return e.next=13,T.getThemes();case 13:n=e.sent,t(T.getAppTheme(n.default));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},getAppTheme:function(e){return["ThemeSetting_blue","ThemeSetting_orange"].includes(e)?"light":"dark"},changeTheme:function(e){e!==window.DataViz.theme&&(window.DataViz.theme=e,document.querySelector("html").setAttribute("theme",e),[].forEach.call(document.querySelectorAll("link[name=theme]"),(function(t){t.getAttribute("title")===e?t.disabled=!1:t.disabled=!0})))},getQueryValue:function(e,t){var a=new RegExp("(^|&|\\?)"+t+"=([^&]*)(&|$)").exec(e);return a&&a.length>=3?a[2]:null}},C=t.a=T},211:function(e,t,a){"use strict";a(28),a(30),a(20),a(43);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(1),l=a(76),c=function(){function e(t){i()(this,e),this.layerInfo=Object.assign({},t)}return s()(e,[{key:"createLayer",value:function(){return!1}},{key:"isTileVectorLayer",value:function(){return!1}},{key:"isTileLayer",value:function(){return!1}},{key:"isBaseLayer",value:function(){return!1}},{key:"isVectorLayer",value:function(){return!1}},{key:"down",value:function(){this.layerInfo.zIndex&&this.layerInfo.zIndex--,this.layer.setZIndex(this.layerInfo.zIndex)}},{key:"up",value:function(){this.layerInfo.zIndex&&this.layerInfo.zIndex++,this.layer.setZIndex(this.layerInfo.zIndex)}},{key:"updateZIndex",value:function(e){e&&(this.layerInfo.zIndex=e,this.layer.setZIndex(this.layerInfo.zIndex))}},{key:"setVisible",value:function(e){this.layerInfo.visible=e,this.layer.setVisible(this.layerInfo.visible)}},{key:"getVisible",value:function(){return this.layerInfo.layerType===o.r.MIGRATION?this.layerInfo.visible:this.layer.getVisible()}},{key:"setLayerName",value:function(e){this.layerInfo.name=e}},{key:"getZIndex",value:function(){return this.layerInfo.zIndex}},{key:"getBounds",value:function(){return null}},{key:"getProjection",value:function(){return"EPSG:0"}},{key:"setVisibleScale",value:function(){var e=this.layerInfo.visibleScale;e&&(l.a.setVisibleScales(this.layer,e),this.labelLayer&&l.a.setVisibleScales(this.labelLayer,e),this.pathLayer&&l.a.setVisibleScales(this.pathLayer,e))}},{key:"getExtent",value:function(e){var t=this.layerInfo,a=t.extent,n=t.projection;return e&&n!==e&&(a=ol.proj.transformExtent(a,n,e)),a&&a.includes(NaN)?null:a}}]),e}();t.a=c},214:function(e,t,a){"use strict";a(14),a(27),a(32),a(44),a(40),a(36),a(20);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(10),p=a.n(d),h=a(0),f=a.n(h),m=(a(1586),function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).pageY=0,a.cover={position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"},a.state={name:e.name,values:e.dashStyle||["solid","dot","dash","dashdot","longdash","longdashdot"],value:e.strokeDashstyle,isShow:!1},a}return p()(t,e),s()(t,[{key:"componentWillMount",value:function(){this.setState({className:this.props.strokeDashstyle})}},{key:"componentWillReceiveProps",value:function(e){this.setState({value:e.strokeDashstyle,className:e.strokeDashstyle})}},{key:"componentDidUpdate",value:function(){var e=document.body.clientHeight;if(this.pageY){var t=this.refs.selectContent;if(t){for(var a,n,i=t.clientHeight,r=document.getElementsByClassName("selected"),s=99999999,o=0;o<r.length;o++)a=r[o].getBoundingClientRect().top,(n=this.pageY-a)>0&&n<s&&(s=a);this.pageY+i+10>e?t.style.top=s+16-i-28+"px":t.style.top=s+16+14+"px"}}this.pageY=0}},{key:"update",value:function(e,t,a,n){var i=window.cloneDeep(this.state);a&&(i.name=a),e&&(i.value=e),n&&(i.values=n),void 0!==t&&(i.isShow=t),this.setState(i)}},{key:"onClick",value:function(e){var t="",a=(t=e.target.firstChild?e.target.firstChild.className:e.target.className).indexOf(" "),n=t.slice(0,a);this.update(n,!0),this.props.editor(this.props.type,n,this.props.parentKey)}},{key:"getAllLineUI",value:function(){var e=this;return this.state.isShow?f.a.createElement("div",null,f.a.createElement("div",{style:this.cover}),f.a.createElement("div",{ref:"selectContent",className:"selects_container active",style:{height:"".concat(28*this.state.values.length+12,"px")}},this.state.values.map((function(t,a){return f.a.createElement("div",{key:a,className:"selects-content",onMouseDown:e.onClick.bind(e)},f.a.createElement("div",{className:t+" line_type_img"}))})))):null}},{key:"changeDisplay",value:function(e){this.pageY=e.pageY,this.setState({isShow:!this.state.isShow}),this.state.isShow?this.refs.selectsToolImg.removeAttribute("style"):this.refs.selectsToolImg.style.borderColor="#0083CB"}},{key:"closeOptions",value:function(){this.setState({isShow:!1}),this.refs.selectsToolImg.removeAttribute("style")}},{key:"render",value:function(){return f.a.createElement("div",{className:"editor-tool line-dash"},f.a.createElement("div",{className:"text"},this.props.name),f.a.createElement("div",{className:"selects_tool_img",tabIndex:"1",ref:"selectsToolImg",onBlur:this.closeOptions.bind(this),onClick:this.changeDisplay.bind(this)},f.a.createElement("div",{className:"selected"},f.a.createElement("div",{className:"selected_img"},f.a.createElement("div",{className:"line_type_img line_type_img_selected "+this.state.value}))),this.getAllLineUI()))}}]),t}(h.Component));t.a=m},22:function(e,t,a){"use strict";var n={version:"2.3.0",pointThemeLayerMaxCount:3e4,themeLayerMaxCount:15e3,maxRestDataCount:{POINT:1e5,LINE:2e4,POLYGON:1e4},mousePositionNumber:5,animateDuration:1e3,migrationCount:1e3,isVisiblePopOpen:!1,metersPerUnit:{DEGREES:2*Math.PI*6370997/360,DEGREE:2*Math.PI*6370997/360,FEET:.3048,METERS:1,METER:1,M:1,USFEET:1200/3937},dpi:{default:96,iServerWMTS:90.7142857142857},datavizFields:["dataviz_featureID","dataviz_lon","dataviz_lat"],baseMaps:[{internetMapName:"CHINA_DARK",isInternetMap:!0}]};t.a=n},239:function(e,t,a){"use strict";a(467),a(71),a(44),a(40),a(36),a(69),a(14);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(11),p=a.n(d),h=a(10),f=a.n(h),m=a(0),y=a.n(m),g=(a(444),a(21)),v=a(182),S=a.n(v),b=(a(1631),a(1604),DataViz.Language),I=function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).state={isEdit:!1,attributes:{}},a.changeFieldValue=a.changeFieldValue.bind(p()(a)),a}return f()(t,e),s()(t,[{key:"getEditableFields",value:function(e,t){var a=[];e&&(e.editable&&(a=Object.keys(t).filter((function(e){return!String(e).toLowerCase().startsWith("sm")}))));return a}},{key:"changeFieldValue",value:function(e,t){this.props.changeFieldValue&&this.props.changeFieldValue(e,t)}},{key:"render",value:function(){var e=this.props,t=e.enableInfo,a=e.attributes,n=e.popupInfo,i=e.captions,r=e.className,s=void 0===r?"":r;return n=S()(n),y.a.createElement("div",{className:"dv-attributes-pop "+s},y.a.createElement(g.a,{editableFields:this.getEditableFields(t,a),elements:n.elements,title:n.title,fieldCaptions:i,locales:{noDataTip:b.noField,loadFailedTip:b.loadFaild},attributes:this.props.attributes,contentHeightMax:440,onClose:this.props.onPopClose,onEndedEdit:this.changeFieldValue}),y.a.createElement("div",{className:"dv-pop-arrow-content"},y.a.createElement("div",{className:"dv-pop-arrow"})))}}]),t}(m.Component);t.a=I},24:function(e,t,a){"use strict";a(207),a(112),a(30),a(73),a(69),a(72),a(28),a(408),a(99),a(100),a(54);var n,i,r=a(51),s=a.n(r),o=(a(43),a(92),a(20),a(71),a(93),a(44),a(40),a(36),a(17)),l=a.n(o),c=(a(18),a(78),a(27),a(32),a(87),a(25)),u=a.n(c),d=a(12),p=a(5),h=a(1),f=a(2),m=a(163),y=a(21),g=new ol.format.GeoJSON,v={updateFeatures:{},dataLayerInfo:{},updataAtrributeTableFn:null,confirmDataChange:(i=u()(l.a.mark((function e(){var t,a,n,i,r,s,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n in t=this,a=[],this.dataLayerInfo)this.dataLayerInfo[n].checked&&a.push(n);i={Binary:[],Relationship:[]},e.t0=l.a.keys(this.updateFeatures);case 5:if((e.t1=e.t0()).done){e.next=31;break}if(r=e.t1.value,s=this.updateFeatures[r],!(a.indexOf(String(s.urlId))>-1)){e.next=28;break}if("Binary"!==s.storageType){e.next=24;break}return o=s.editedFeature[0].layerId,e.t2=i.Binary,e.t3=r,e.t4=s.dataName,e.t5=s.fileType,e.t6=s.dataMetaInfo,e.next=19,t.createBlobForUpdateData(o,s.dataName,s.fileType);case 19:e.t7=e.sent,e.t8={dataId:e.t3,dataName:e.t4,fileType:e.t5,dataMetaInfo:e.t6,file:e.t7},e.t2.push.call(e.t2,e.t8),e.next=26;break;case 24:c=s.editedFeature.map((function(e){return{ID:Number(e.featureID),fieldNames:e.fieldNames,fieldValues:e.fieldValues}})),i.Relationship.push({urlId:s.urlId,params:c});case 26:e.next=29;break;case 28:s.editedFeature.forEach((function(e){e.fieldNames.forEach((function(a,n){t.modifyVectorLayerFeatureAttr(e.feature,a,e.oldfieldValues[n])}))}));case 29:e.next=5;break;case 31:return e.abrupt("return",i);case 32:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)}),createBlobForUpdateData:(n=u()(l.a.mark((function e(t,a,n){var i,r,s,o,c,u,f,y,g,S,b,I;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=p.a.getLayerById(t)){e.next=3;break}return e.abrupt("return",null);case 3:if(r=i.layerInfo,s=i.features,o=r.originData.content&&r.originData.content.colTitles||r.originData.data&&r.originData.data.titles,c=new FormData,"CSV"!==n){e.next=15;break}return u=v.createCSVTitle(o,!0),u+=v.geCSVValue(o,s,!0),f=new Blob([u],{type:"text/csv;charset=UTF-8"}),c.append("newfile",new File([f],a)),e.abrupt("return",c);case 15:if("EXCEL"!==n){e.next=21;break}return y=v.features2sheet(o,s),g={sheet:y,fileName:a},e.abrupt("return",new Promise((function(e,t){try{m.a.readCsvExcelData(g,{},"sheet_to_blob",(function(t){c.append("newfile",new File([t],a)),e(c)}))}catch(e){d.a.showMessage(Language.attributeModificationFailed,h.j.ERROR),d.a.closeLoadingBox(),t(e)}})));case 21:if("GEOJSON"!==n&&"JSON"!==n){e.next=27;break}return S=v.changeGeojsonOriginData(s),b={type:"FeatureCollection",features:S},I=new Blob([JSON.stringify(b)],{type:"application/json"}),c.append("newfile",new File([I],a)),e.abrupt("return",c);case 27:return e.abrupt("return",null);case 28:case"end":return e.stop()}}),e)}))),function(e,t,a){return n.apply(this,arguments)}),changeGeojsonOriginData:function(e){return g.writeFeaturesObject(e,{featureProjection:p.a.getBaseLayerProj()||"EPSG:4326"}).features.map((function(e){var t=e.properties.attributes;return t&&delete t.dataviz_featureID,e.properties=t,e}))},updateDataLayerInfo:function(){var e={};for(var t in this.updateFeatures){var a=this.updateFeatures[t];e[a.urlId]={checked:!0,layerNames:[],dataName:a.dataName,dataSourceName:a.dataSourceName}}var n=function(t){var a=p.a.vectorLayers.filter((function(a){return a.layerInfo.dataSource&&(String(a.layerInfo.dataSource.serverId)===t||a.layerInfo.dataSource.dataSourceName&&String(a.layerInfo.dataSource.dataSourceName)===e[t].dataSourceName)})).map((function(e){return e.layerInfo.name}));e[t].layerNames=a};for(var i in e)n(i);return this.dataLayerInfo=e,this.dataLayerInfo},deleteUpdateFeaLayer:function(e){for(var t in this.updateFeatures){var a=this.updateFeatures[t].editedFeature;if(!a)return;var n=a.filter((function(t){return t.layerId!==e}));this.updateFeatures[t].editedFeature=n,0===n.length&&delete this.updateFeatures[t]}},addEditFeatureInfo:function(e,t){var a={fieldValues:[t.fieldValue],fieldNames:[t.fieldName],oldfieldValues:[t.oldfieldValue]},n=this.updateFeatures[e.urlId];if(n){var i=n.editedFeature.find((function(e){return t.featureID===e.featureID}));if(i){var r=i.fieldNames.indexOf(t.fieldName);r>-1?i.fieldValues[r]=t.fieldValue:(i.fieldNames.push(t.fieldName),i.fieldValues.push(t.fieldValue),i.oldfieldValues.push(t.oldfieldValue))}else n.editedFeature.push(Object.assign(e.editedFeature,a))}else{var o=s()({},e);o.editedFeature=[Object.assign(e.editedFeature,a)],this.updateFeatures[e.urlId]=o}},modifyVectorLayerFeatureAttr:function(e,t,a){e.get("attributes")[t]=a},getEditFeatureInfo:function(e,t){var a=p.a.getLayerById(e);if(!a)return null;var n=a.layerInfo;if(!n)return null;var i=t.get("attributes");if(!i)return null;var r=n.dataSource;if(!r)return null;var s={};if(r.url&&r.dataSourceName){var o=r.dataSourceName.toString().split(":"),l="".concat(r.url,"/datasources/").concat(o[0],"/datasets/").concat(o[1],"/features.json?_method=PUT");s={storageType:"Relationship",urlId:f.a.getUrl(l,"json"),editable:v.isLayerEditable(e),layerName:n.name,dataName:r.dataSourceName.split(":")[1],dataSourceName:r.dataSourceName,editedFeature:{feature:t,featureID:i.SMID,layerId:e}}}else{var c=n.originData&&(n.originData.originName||n.originData.fileName)||n.dataName;s={storageType:"Binary",urlId:r.serverId,editable:v.isLayerEditable(e),dataName:c,fileType:n.originData&&n.originData.type||n.type,layerName:n.name,dataMetaInfo:n.dataMetaInfo,editedFeature:{featureID:i.dataviz_featureID,feature:t,layerId:e}}}return s},isLayerEditable:function(e){var t=p.a.getLayerById(e),a=!0,n=t.layerInfo;if(t&&n){var i=n.dataSource;if(n.layerNotEditable)return!1;var r=n.type?n.type:n.originData&&n.originData.type;if(!i)return a;i.dataSourceName&&i.type===h.b.REST_DATA||i.type===h.b.SAMPLE_DATA||i.type===h.b.USER_DATA?a=!1:r&&r.toUpperCase()===h.h.SHP&&(a=!1)}return a},getIptDataPermission:function(e){var t=e.reduce((function(e,t){var a=t.serverId||t.dataSource&&t.dataSource.serverId;return a&&e.push(a),e}),[]);if(0!==t.length)return f.a.checkUserPermission(t,"DATA").then((function(t){return v.setAppLayersEditable(e,t),dataPermission})).catch((function(e){return e}))},setAppLayersEditable:function(e,t){e.map((function(e){if(!e.getDataFaild){var a=e.serverId||e.dataSource&&e.dataSource.serverId;["VECTOR","HEAT","UNIQUE","RANGE","SYMBOL","RANK_SYMBOL","MIGRATION","MARKER"].includes(e.layerType)&&(e.layerNotEditable="DELETE"!==t[a])}}))},assembleTableJSONData:function(e){var t,a=e.features[0],n=e.features,i=[],r=[],s=n.length>6?6:n.length;for(var o in a.properties)i.push(o);for(var l=0;l<s;l++){t=[];for(var c=0;c<i.length;c++)t.push(e.features[l].properties[i[c]]);r.push(t)}return{titles:i,rows:r}},assembleTableExcelData:function(e){for(var t=e[0],a=[],n=e.length,i=1;i<n;i++)a.push(e[i]);return{titles:t,rows:a}},_parseExcelData2Feature:function(e){var t=e.originData.data.rows,a=0,n=e.originData.data.titles||e.originData.content.colTitles,i=e.projection,r=n.indexOf(e.xyField.xField),s=n.indexOf(e.xyField.yField),o=p.a.getBaseLayerProj(),l=[];e.cityField&&e.addressField&&n.splice(r,2);for(var c=0,u=t.length;c<u;c++){var f=t[c],m={},y=t[c][r],g=t[c][s];if(void 0!==y&&void 0!==g&&null!==y&&null!==g){var v=new ol.geom.Point([+y,+g]);e.cityField&&e.addressField&&t[c].splice(r,2),i!==o&&v.transform(i,o);for(var S=0,b=f.length;S<b;S++)if(void 0!==n[S]&&null!==n[S]){var I=n[S].trim(),E=Object.keys(m);m[this.renameDataCaption(E,I)]=void 0===f[S]?"":f[S]}m.dataviz_featureID=c;var T=new ol.Feature({geometry:v,attributes:m});l.push(T)}else a++}return a>0&&(d.a.closeMessage(),setTimeout((function(){d.a.showMessage(DataViz.Language.filterDatas.replace("{num}",a),h.j.WARNING,2e3)}))),l},renameDataCaption:function(e,t){if(!e.includes(t))return t;var a=t.match(/(.+)_(\w)$/);return a?t="".concat(a[1],"_").concat(+a[2]+1):t+="_1",this.renameDataCaption(e,t)},_parseGeoJsonData2Feature:function(e){var t=e.originData&&e.originData.data.rows&&e.originData.data.rows.features||[],a=[];0===t.length&&(t=e.allDatas&&e.allDatas.features||[]);for(var n=0,i=t.length;n<i;n++){var r=Object.assign({},t[n].properties);delete t[n].properties,r.dataviz_featureID=n;var s=g.readFeature(t[n],{dataProjection:e.projection||e.fileCode||"EPSG:4326",featureProjection:e.featureProjection||p.a.getBaseLayerProj()||"EPSG:4326"});s.setProperties({attributes:r}),a.push(s)}return a},parseData2Feature:function(e,t){var a;switch(e.type||t){case h.h.CSV:case h.h.XLSX:a=this._parseExcelData2Feature(e);break;case h.h.JSON:case h.h.SHP:case h.h.GEOJSON:a=this._parseGeoJsonData2Feature(e)}return a},getFeature:function(e,t,a,n){var i=t.titles,r=t.rows;if(n)for(var s=a.datas1.noSingleQuoteValue,o=a.datas2.noSingleQuoteValue,l=a.selectedField1,c=a.selectedField2,u=e.features.length,d=a.datas1.noSingleQuoteValue.length,p=null,h=0;h<u;h++){p=e.features[h].properties;for(var f=0;f<d;f++){if(!r[f].join(""))return;if(String(s[f])===String(p[l])&&String(o[f])===String(p[c])){for(var m in i){var y=i[m].toLowerCase();y===l.toLowerCase()&&delete p[l],y===c.toLowerCase()&&delete p[c],p[i[m]]=r[f][m]}break}}}else!function(){for(var t=a.datas.noSingleQuoteValue,n=a.selectedField,s=function(s){var o=e.features[s].properties;t.map((function(e,t){if(String(e)===String(o[a.selectedField])){if(!r[t].join(""))return;i.forEach((function(e,a){e.toLowerCase()===n.toLowerCase()&&delete o[n],o[i[a]]=r[t][a]}))}}))},o=0;o<e.features.length;o++)s(o)}();return e},getDataMetaInfoParams:function(e,t){if(!t)return{};var a={fieldTypes:t.fieldTypes,xIndex:t.xIndex,yIndex:t.yIndex,xField:t.xField,yField:t.yField,firstRowIsHead:t.firstRowIsHead};return"CSV"===e&&(a.fileEncoding=t.fileEncoding,a.separator=t.separator),a},changeExcel2Geojson:function(e,t,a){var n={type:"FeatureCollection",features:[]};if(e.length<2)return n;var i=e.colTitles,r=e.rows,s=i.findIndex((function(e){return e===a}));return r.forEach((function(e){var a=f.a.getAdministrativeFeature(t,e[s]);a&&(a.properties={},e.forEach((function(e,t){a.properties[i[t]]=e})),n.features.push(a))})),n},excelData2FeatureByDivision:function(e,t,n){var i=this;return t===h.d.PROVINCE?a.e(2).then(a.t.bind(null,1661,7)).then((function(){return i.changeExcel2Geojson(e,t,n)})):t===h.d.CITY?a.e(1).then(a.t.bind(null,1662,7)).then((function(){return i.changeExcel2Geojson(e,t,n)})):void 0},createCSVTitle:function(e,t){return t?e.toString()+"\r\n":e.toString()+",lon,lat\r\n"},geCSVValue:function(e,t,a){var n,i,r="",s=p.a.getBaseLayerProj();n="EPSG:4326"!==s;for(var o=0;o<t.length;o++)for(var l=0;l<e.length;l++)if(i=t[o].get("attributes"),i=n?this.transformLonlat(s,i):i,a)l===e.length-1?r+=i[e[l]]+"\r\n":r+=i[e[l]]+",";else if(void 0===i[e[l]]||null===i[e[l]]?r+=",":r+=i[e[l]]+",",l===e.length-1){var c=t[o].getGeometry().getCoordinates(),u=c;n&&(u=ol.proj.transform(c,s,"EPSG:4326")),r+=u[0]+","+u[1]+"\r\n"}return r},transformLonlat:function(e,t){var a,n=window.cloneDeep(t);return n.lon&&n.lat&&(a=ol.proj.transform([n.lon,n.lat],e,"EPSG:4326"),n.lon=a[0],n.lat=a[1]),n},trimBinaryTitles:function(e){return e.map((function(e){return e.trim()}))},features2sheet:function(e,t){var a,n,i=p.a.getBaseLayerProj();a="EPSG:4326"!==i;var r={};r["!ref"]="A1:"+this.numberToSystem26(e.length)+(t.length+1);for(var s=0;s<e.length;s++)r[this.numberToSystem26(s+1)+1]={v:e[s]};for(var o=0;o<t.length;o++)for(var l=0;l<e.length;l++)n=t[o].get("attributes"),n=a?this.transformLonlat(i,n):n,r[this.numberToSystem26(l+1)+(o+2)]={v:n[e[l]]};return r},numberToSystem26:function(e){for(var t="";e>0;){var a=e%26;0===a&&(a=26),t=String.fromCharCode(a+64)+t,e=(e-a)/26}return t},getBinaryContent:function(e){var t="".concat(f.a.getIPortalUrl(),"web/datas/").concat(e,"/content.json?&currentPage=1&pageSize=99999999");return f.a.doFetch(t,{method:"GET",withCredentials:!0}).then((function(e){return e})).catch((function(e){throw d.a.showMessage(DataViz.Language.getRestDataFaild,h.j.WARNING),{getDatasInfFailed:!0}}))},updateMarkeData:function(e,t,a){return new Promise((function(n,i){var r={file:p.a.getGeojsonFromFeature(e,!0),fileName:t,dataID:a,dataMetaInfo:null};y.o.updateData(r).then((function(e){n()})).catch((function(e){d.a.showMessage(DataViz.Language.attributeModificationFailed,h.j.ERROR),d.a.closeLoadingBox(),i(e)}))}))}};t.a=v},240:function(e,t,a){"use strict";a(20),a(54),a(32);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(2),l=0,c=1,u=2,d=3,p=function(){function e(t){for(var a in i()(this,e),this.namespaces={},this.namespaceAlias={},this.defaultPrefix=null,this.xmldom=null,this.readers=null,this.namespaces)this.namespaceAlias[this.namespaces[a]]=a}return s()(e,[{key:"setNamespace",value:function(e,t){this.namespaces[e]=t,this.namespaceAlias[t]=e}},{key:"read",value:function(e){var t=e.indexOf("<");return t>0&&(e=e.substring(t)),o.a.isIE()?(this.xmldom||(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),this.xmldom.loadXML(e),this.xmldom):(this.xmldom||(this.xmldom=new DOMParser),this.xmldom.parseFromString(e,"text/xml"))}},{key:"getElementsByTagNameNS",value:function(e,t,a){var n=[];if(e.getElementsByTagNameNS)n=e.getElementsByTagNameNS(t,a);else for(var i,r,s=e.getElementsByTagName("*"),o=0,l=s.length;o<l;++o)r=(i=s[o]).prefix?i.prefix+":"+a:a,"*"!=a&&r!=i.nodeName||"*"!=t&&t!=i.namespaceURI||n.push(i);return n}},{key:"getAttributeNodeNS",value:function(e,t,a){var n=null;if(e.getAttributeNodeNS)n=e.getAttributeNodeNS(t,a);else for(var i,r=e.attributes,s=0,o=r.length;s<o;++s)if((i=r[s]).namespaceURI==t&&(i.prefix?i.prefix+":"+a:a)==i.nodeName){n=i;break}return n}},{key:"getAttributeNS",value:function(e,t,a){var n="";if(e.getAttributeNS)n=e.getAttributeNS(t,a)||"";else{var i=this.getAttributeNodeNS(e,t,a);i&&(n=i.nodeValue)}return n}},{key:"getChildValue",value:function(e,t){var a=t||"";if(e)for(var n=e.firstChild;n;n=n.nextSibling)switch(n.nodeType){case 3:case 4:a+=n.nodeValue}return a}},{key:"isSimpleContent",value:function(e){for(var t=!0,a=e.firstChild;a;a=a.nextSibling)if(1===a.nodeType){t=!1;break}return t}},{key:"contentType",value:function(e){for(var t=!1,a=!1,n=l,i=e.firstChild;i;i=i.nextSibling){switch(i.nodeType){case 1:a=!0;break;case 8:break;default:t=!0}if(a&&t)break}if(a&&t)n=d;else{if(a)return u;if(t)return c}return n}},{key:"hasAttributeNS",value:function(e,t,a){return e.hasAttributeNS?e.hasAttributeNS(t,a):!!this.getAttributeNodeNS(e,t,a)}},{key:"getFirstElementChild",value:function(e){if(e.firstElementChild)return e.firstElementChild;for(var t=e.firstChild;1!=t.nodeType&&(t=t.nextSibling););return t}},{key:"readNode",value:function(e,t){t||(t={});var a=this.readers[this.defaultPrefix];if(a){var n=a[e.localName||e.nodeName.split(":").pop()]||a["*"];n&&n.apply(this,[e,t])}return t}},{key:"readChildNodes",value:function(e,t){t||(t={});for(var a,n=e.childNodes,i=0,r=n.length;i<r;++i)1==(a=n[i]).nodeType&&this.readNode(a,t);return t}},{key:"getChildEl",value:function(e,t,a){return e&&this.getThisOrNextEl(e.firstChild,t,a)}},{key:"getNextEl",value:function(e,t,a){return e&&this.getThisOrNextEl(e.nextSibling,t,a)}},{key:"getThisOrNextEl",value:function(e,t,a){e:for(var n=e;n;n=n.nextSibling)switch(n.nodeType){case 1:if(!(t&&t!==(n.localName||n.nodeName.split(":").pop())||a&&a!==n.namespaceURI))break e;n=null;break e;case 3:if(/^\s*$/.test(n.nodeValue))break;case 4:case 6:case 12:case 10:case 11:n=null;break e}return n||null}},{key:"lookupNamespaceURI",value:function(e,t){var a=null;if(e)if(e.lookupNamespaceURI)a=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){a=e.namespaceURI;break e}var n=e.attributes.length;if(n)for(var i,r=0;r<n;++r){if("xmlns"===(i=e.attributes[r]).prefix&&i.name==="xmlns:"+t){a=i.value||null;break e}if("xmlns"===i.name&&null===t){a=i.value||null;break e}}a=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:a=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:a=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:a=this.lookupNamespaceURI(e.parentNode,t)}return a}}]),e}(),h=(a(44),a(40),a(36),a(78),a(43),a(9)),f=a.n(h),m=a(8),y=a.n(m),g=a(128),v=a.n(g),S=a(10),b=a.n(S),I=(a(99),a(100),function(e){function t(e){var a;return i()(this,t),(a=f()(this,y()(t).call(this,e))).defaultPrefix="wms",a.readers=a.getReaders(),a.namespaces=Object.assign({},a.namespaces,{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"}),a}return b()(t,e),s()(t,[{key:"read",value:function(e){"string"==typeof e&&(e=v()(y()(t.prototype),"read",this).call(this,e)),e&&9===e.nodeType&&(e=e.documentElement);var a={};return this.readNode(e,a),void 0===a.service&&(a.error=!0),a}},{key:"extend",value:function(e,t){if(e=e||{},t){for(var a in t){var n=t[a];void 0!==n&&(e[a]=n)}!("function"==typeof window.Event&&t instanceof window.Event)&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e}},{key:"getReaders",value:function(){return{wms:{Service:function(e,t){t.service={},this.readChildNodes(e,t.service)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t.abstract=this.getChildValue(e)},BoundingBox:function(e,t){var a={};a.bbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))];var n={x:parseFloat(e.getAttribute("resx")),y:parseFloat(e.getAttribute("resy"))};return isNaN(n.x)&&isNaN(n.y)||(a.res=n),a},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},ContactInformation:function(e,t){t.contactInformation={},this.readChildNodes(e,t.contactInformation)},ContactPersonPrimary:function(e,t){t.personPrimary={},this.readChildNodes(e,t.personPrimary)},ContactPerson:function(e,t){t.person=this.getChildValue(e)},ContactOrganization:function(e,t){t.organization=this.getChildValue(e)},ContactPosition:function(e,t){t.position=this.getChildValue(e)},ContactAddress:function(e,t){t.contactAddress={},this.readChildNodes(e,t.contactAddress)},AddressType:function(e,t){t.type=this.getChildValue(e)},Address:function(e,t){t.address=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},StateOrProvince:function(e,t){t.stateOrProvince=this.getChildValue(e)},PostCode:function(e,t){t.postcode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ContactVoiceTelephone:function(e,t){t.phone=this.getChildValue(e)},ContactFacsimileTelephone:function(e,t){t.fax=this.getChildValue(e)},ContactElectronicMailAddress:function(e,t){t.email=this.getChildValue(e)},Fees:function(e,t){var a=this.getChildValue(e);a&&"none"!==a.toLowerCase()&&(t.fees=a)},AccessConstraints:function(e,t){var a=this.getChildValue(e);a&&"none"!==a.toLowerCase()&&(t.accessConstraints=a)},Capability:function(e,t){t.capability={nestedLayers:[],layers:[]},this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={},this.readChildNodes(e,t.request)},GetCapabilities:function(e,t){t.getcapabilities={formats:[]},this.readChildNodes(e,t.getcapabilities)},Format:function(e,t){o.a.isArray(t.formats)?t.formats.push(this.getChildValue(e)):t.format=this.getChildValue(e)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t)},Get:function(e,t){t.get={},this.readChildNodes(e,t.get),t.href||(t.href=t.get.href)},Post:function(e,t){t.post={},this.readChildNodes(e,t.post),t.href||(t.href=t.get.href)},GetMap:function(e,t){t.getmap={formats:[]},this.readChildNodes(e,t.getmap)},GetFeatureInfo:function(e,t){t.getfeatureinfo={formats:[]},this.readChildNodes(e,t.getfeatureinfo)},Exception:function(e,t){t.exception={formats:[]},this.readChildNodes(e,t.exception)},Layer:function(e,t){var a,n;t.capability?(n=t.capability,a=t):n=t;var i=e.getAttributeNode("queryable"),r=i&&i.specified?e.getAttribute("queryable"):null,s=(i=e.getAttributeNode("cascaded"))&&i.specified?e.getAttribute("cascaded"):null,o=(i=e.getAttributeNode("opaque"))&&i.specified?e.getAttribute("opaque"):null,l=e.getAttribute("noSubsets"),c=e.getAttribute("fixedWidth"),u=e.getAttribute("fixedHeight"),d=a||{},p=this.extend,h={nestedLayers:[],styles:a?[].concat(a.styles):[],srs:a?p({},d.srs):{},metadataURLs:[],bbox:a?p({},d.bbox):{},llbbox:d.llbbox,dimensions:a?p({},d.dimensions):{},authorityURLs:a?p({},d.authorityURLs):{},identifiers:{},keywords:[],queryable:r&&""!==r?"1"===r||"true"===r:d.queryable||!1,cascaded:null!==s?parseInt(s):d.cascaded||0,opaque:o?"1"===o||"true"===o:d.opaque||!1,noSubsets:null!==l?"1"===l||"true"===l:d.noSubsets||!1,fixedWidth:null!==c?parseInt(c):d.fixedWidth||0,fixedHeight:null!==u?parseInt(u):d.fixedHeight||0,minScale:d.minScale,maxScale:d.maxScale,attribution:d.attribution};if(t.nestedLayers.push(h),h.capability=n,this.readChildNodes(e,h),delete h.capability,h.name){var f=h.name.split(":"),m=n.request,y=m.getfeatureinfo;f.length>0&&(h.prefix=f[0]),n.layers.push(h),void 0===h.formats&&(h.formats=m.getmap.formats),void 0===h.infoFormats&&y&&(h.infoFormats=y.formats)}},Attribution:function(e,t){t.attribution={},this.readChildNodes(e,t.attribution)},LogoURL:function(e,t){t.logo={width:e.getAttribute("width"),height:e.getAttribute("height")},this.readChildNodes(e,t.logo)},Style:function(e,t){var a={};t.styles.push(a),this.readChildNodes(e,a)},LegendURL:function(e,t){var a={width:e.getAttribute("width"),height:e.getAttribute("height")};t.legend=a,this.readChildNodes(e,a)},MetadataURL:function(e,t){var a={type:e.getAttribute("type")};t.metadataURLs.push(a),this.readChildNodes(e,a)},DataURL:function(e,t){t.dataURL={},this.readChildNodes(e,t.dataURL)},FeatureListURL:function(e,t){t.featureListURL={},this.readChildNodes(e,t.featureListURL)},AuthorityURL:function(e,t){var a=e.getAttribute("name"),n={};this.readChildNodes(e,n),t.authorityURLs[a]=n.href},Identifier:function(e,t){var a=e.getAttribute("authority");t.identifiers[a]=this.getChildValue(e)},KeywordList:function(e,t){this.readChildNodes(e,t)},SRS:function(e,t){t.srs[this.getChildValue(e)]=!0},UserDefinedSymbolization:function(e,t){var a={supportSLD:1===parseInt(e.getAttribute("SupportSLD")),userLayer:1===parseInt(e.getAttribute("UserLayer")),userStyle:1===parseInt(e.getAttribute("UserStyle")),remoteWFS:1===parseInt(e.getAttribute("RemoteWFS"))};t.userSymbols=a},DescribeLayer:function(e,t){t.describelayer={formats:[]},this.readChildNodes(e,t.describelayer)},GetLegendGraphic:function(e,t){t.getlegendgraphic={formats:[]},this.readChildNodes(e,t.getlegendgraphic)}}}}}]),t}(p)),E=39.37,T=function(e){function t(e){return i()(this,t),f()(this,y()(t).call(this,e))}return b()(t,e),s()(t,[{key:"getReaders",value:function(){var e=v()(y()(t.prototype),"getReaders",this).call(this).wms;return{wms:Object.assign({},e,{WMT_MS_Capabilities:function(e,t){this.readChildNodes(e,t)},Keyword:function(e,t){t.keywords&&t.keywords.push(this.getChildValue(e))},GetStyles:function(e,t){t.getstyles={formats:[]},this.readChildNodes(e,t.getstyles)},PutStyles:function(e,t){t.putstyles={formats:[]},this.readChildNodes(e,t.putstyles)},LatLonBoundingBox:function(e,t){t.llbbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))]},BoundingBox:function(t,a){var n=e.BoundingBox.apply(this,[t,a]);n.srs=t.getAttribute("SRS"),a.bbox[n.srs]=n},ScaleHint:function(e,t){var a=e.getAttribute("min"),n=e.getAttribute("max"),i=Math.pow(2,.5),r=E;0!==a&&(t.maxScale=parseFloat((a/i*r*72).toPrecision(13))),n!==Number.POSITIVE_INFINITY&&(t.minScale=parseFloat((n/i*r*72).toPrecision(13)))},Dimension:function(e,t){var a={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};t.dimensions[a.name]=a},Extent:function(e,t){var a=e.getAttribute("name").toLowerCase();if(a in t.dimensions){var n=t.dimensions[a];n.nearestVal="1"===e.getAttribute("nearestValue"),n.multipleVal="1"===e.getAttribute("multipleValues"),n.current="1"===e.getAttribute("current"),n.default=e.getAttribute("default")||"";var i=this.getChildValue(e);n.values=i.split(",")}},SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}})}}}]),t}(I),C=function(e){function t(e){return i()(this,t),f()(this,y()(t).call(this,e))}return b()(t,e),s()(t,[{key:"getReaders",value:function(){var e=v()(y()(t.prototype),"getReaders",this).call(this).wms;return{wms:Object.assign({},e,{WMS_Capabilities:function(e,t){this.readChildNodes(e,t)},LayerLimit:function(e,t){t.layerLimit=parseInt(this.getChildValue(e))},MaxWidth:function(e,t){t.maxWidth=parseInt(this.getChildValue(e))},MaxHeight:function(e,t){t.maxHeight=parseInt(this.getChildValue(e))},BoundingBox:function(t,a){var n=e.BoundingBox.apply(this,[t,a]);n.srs=t.getAttribute("CRS"),a.bbox[n.srs]=n},CRS:function(e,t){this.readers.wms.SRS.apply(this,[e,t])},EX_GeographicBoundingBox:function(e,t){t.llbbox=[],this.readChildNodes(e,t.llbbox)},westBoundLongitude:function(e,t){t[0]=this.getChildValue(e)},eastBoundLongitude:function(e,t){t[2]=this.getChildValue(e)},southBoundLatitude:function(e,t){t[1]=this.getChildValue(e)},northBoundLatitude:function(e,t){t[3]=this.getChildValue(e)},MinScaleDenominator:function(e,t){var a=parseFloat(this.getChildValue(e)).toPrecision(16);0!==a&&(t.maxScale=a)},MaxScaleDenominator:function(e,t){var a=parseFloat(this.getChildValue(e)).toPrecision(16);a!==Number.POSITIVE_INFINITY&&(t.minScale=a)},Dimension:function(e,t){var a={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:"1"===e.getAttribute("nearestValue"),multipleVal:"1"===e.getAttribute("multipleValues"),default:e.getAttribute("default")||"",current:"1"===e.getAttribute("current"),values:this.getChildValue(e).split(",")};t.dimensions[a.name]=a},Keyword:function(e,t){var a={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};t.keywords&&t.keywords.push(a)}}),sld:{UserDefinedSymbolization:function(t,a){e.UserDefinedSymbolization.apply(this,[t,a]),a.userSymbols.inlineFeature=1===parseInt(t.getAttribute("InlineFeature")),a.userSymbols.remoteWCS=1===parseInt(t.getAttribute("RemoteWCS"))},DescribeLayer:function(t,a){e.DescribeLayer.apply(this,[t,a])},GetLegendGraphic:function(t,a){e.GetLegendGraphic.apply(this,[t,a])}}}}}]),t}(I);a.d(t,"a",(function(){return N}));var L=new p,N={parser:{},defaultVersion:"1.1.1",getVersion:function(e){return e.getAttribute("version")||this.defaultVersion},getParser:function(e){var t=e||this.defaultVersion,a=null;return this.parser[t]?a=this.parser[t]:this.parser[t]=a="1.1.1"===t?new T:new C,a},read:function(e){var t=L.read(e),a=t.documentElement,n=this.getVersion(a),i=this.getParser(n).read(t);return i.version=n,i}}},241:function(e,t,a){"use strict";a(71);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(10),p=a.n(d),h=a(211),f=a(1),m=a(16),y={defaultStyle:{style:{radius:8,fillColor:"#EE4D5A",fillOpacity:.9,strokeColor:"#ffffff",strokeWidth:1,strokeOpacity:1,lineDash:"solid",type:"BASIC_POINT"}},getDefaultStyle:function(e){var t=window.cloneDeep(this.defaultStyle);return e===f.p.LINE?(t.style.strokeColor="#4CC8A3",t.style.strokeWidth=2):e===f.p.POLYGON&&(t.style.fillColor="#826DBA"),t},createLayer:function(e){if(e.getDataFaild)return new ol.layer.VectorTile({layerID:e.id,source:new ol.source.VectorTile({}),visible:e.visible});var t=new ol.format.MVT({featureClass:ol.Feature});ol.format.MVT.prototype.readProjection=function(e){return new ol.proj.Projection({code:"",units:ol.proj.Units.TILE_PIXELS})};var a=e.featureType,n=m.a.toOpenLayersStyle(this.getDefaultStyle(a).style,a);return new ol.layer.VectorTile({layerID:e.id,source:new ol.source.VectorTileSuperMapRest({url:e.url,projection:e.projection,tileType:"ScaleXY",format:t}),style:n,visible:e.visible})},getStyleResolutions:function(e){for(var t=[],a=Math.abs(e.left-e.right)/512,n=0;n<22;n++)0!==n?(a/=2,t[n]=a):t[n]=a;return t}},g=a(63),v=function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).layerInfo.styles?a.currentTool=g.b:a.currentTool=y,a}return p()(t,e),s()(t,[{key:"createLayer",value:function(e){var t=this;if(this.layerInfo.styles){if(!e&&this.layerInfo.styles.layers&&"VECTOR_TILE"===this.layerInfo.layerType){var a=this.layerInfo.styles.layers.filter((function(e){return"background"!==e.type}));this.layerInfo.styles.layers=a}return this.currentTool.createLayer(this.layerInfo).then((function(e){t.layer=e,t.setVisibleScale()}))}return t.layer=this.currentTool.createLayer(this.layerInfo),t.setVisibleScale(),t.layer}},{key:"isBaseLayer",value:function(){return 0===this.layerInfo.zIndex}},{key:"getProjection",value:function(){return this.layerInfo.epsgCode}},{key:"isVectorLayer",value:function(){return!1}},{key:"getBounds",value:function(){return this.layerInfo&&this.layerInfo.extent}}]),t}(h.a);t.a=v},242:function(e,t,a){"use strict";var n='2020 <a target="_blank" href="https://www.tianditu.gov.cn/">Tianditu</a>',i='2020 <a target="_blank" href="https://www.google.com/maps">Google Maps</a>',r={BAIDU:'2020 <a target="_blank" href="https://map.baidu.com/">Baidu Maps</a>',CLOUD:'2020 <a target="_blank" href="https://amap.com/">AMap</a>',CLOUD_BLACK:"",TENCENT:'2020 <a target="_blank" href="https://map.qq.com/">Tencent Maps</a>',OSM:' <a target="_blank" href="https://www.openstreetmap.org/">OpenStreetMap</a>',GOOGLE:i,GOOGLE_CN:i,BING:'2020 <a target="_blank" href="https://cn.bing.com/maps">Bing Maps</a>',JAPAN_STD:"",JAPAN_PALE:"",JAPAN_RELIEF:"",JAPAN_ORT:"",TIANDITU_VEC_3857:n,TIANDITU_VEC_4326:n,TIANDITU_IMG_3857:n,TIANDITU_IMG_4326:n,TIANDITU_TER_3857:n,TIANDITU_TER_4326:n,CHINA_DARK:""};t.a=r},246:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return i}));var n=a(2),i="".concat(n.a.getIPortalUrl(),"apps/dataviz/libs/sample-datas/"),r=window.DataViz.Language,s=[{id:"SalesJan2009",fileName:"SalesJan2009",xField:"Longitude",yField:"Latitude",path:i+"SalesJan2009.json",type:r.pointType,lineNumber:997},{id:"Sacramentorealestatetransactions",fileName:"Ealestate transactions",xField:"longitude",yField:"latitude",path:i+"Sacramentorealestatetransactions.json",type:r.pointType,lineNumber:984}];"zh"===window.lang&&s.unshift({id:"BeijingResidentialDistrict",fileName:"",xField:"SmX",yField:"SmY",path:i+"BeijingResidentialDistrict.json",type:r.pointType,lineNumber:727},{id:"GlobalRecordOfOver7Earthquakes",fileName:"7",xField:"",yField:"",path:i+"GlobalRecordOfOver7Earthquakes.json",type:r.pointType,lineNumber:2178},{id:"ChinaRecordOfOver6Earthquakes",fileName:"6",xField:"",yField:"",path:i+"ChinaRecordOfOver6Earthquakes.json",type:r.pointType,lineNumber:837},{id:"ChinaMeteorologicalObservationStation",fileName:"",xField:"",yField:"",path:i+"ChinaMeteorologicalObservationStation.json",type:r.pointType,lineNumber:2169},{id:"BeijingSubwayLine",fileName:"",path:i+"BeijingSubwayLine.json",type:r.lineType,lineNumber:17},{id:"ChinaEarthquakeIntensityZone",fileName:"",path:i+"ChinaEarthquakeIntensityZone.json",type:r.polygonType,lineNumber:339})},247:function(e,t,a){"use strict";var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(10),p=a.n(d),h=a(211),f=(a(18),a(54),a(73),a(99),a(100),a(36),a(81)),m=a.n(f),y=(a(32),a(2)),g=a(5),v=a(41),S=a(12),b=a(22),I=window.DataViz.Language,E={tileProxy:"".concat(y.a.getIPortalUrl(),"apps/viewer/getUrlResource.png?url="),createTileLayer:function(e,t){var a=null;switch(e.layerType.indexOf("TIANDITU")>-1?"TIANDITU":e.layerType){case"TIANDITU":a=this.createTiandituSource(e);break;case"TILE":case"CHINA_DARK":a=this.createDynamicTiledSource(e,t);break;case"BAIDU":a=this.createBaiduSource(e);break;case"BING":a=this.createBingSource(e);break;case"WMS":a=this.createWMSSource(e);break;case"WMTS":a=this.createWMTSSource(e);break;case"CLOUD":case"CLOUD_BLACK":case"OSM":case"JAPAN_ORT":case"JAPAN_RELIEF":case"JAPAN_PALE":case"JAPAN_STD":case"GOOGLE_CN":case"GOOGLE":a=this.createXYZSource(e)}return new ol.layer.Tile({source:a,zIndex:e.zIndex||0,visible:e.visible,extent:e.extent})},createWMSSource:function(e){var t=this,a=e.url,n=e.subLayers,i=e.version;return new ol.source.TileWMS({url:a,wrapX:!1,params:{LAYERS:n||"0",FORMAT:"image/png",VERSION:i||"1.3.0"},tileLoadFunction:function(e,a){-1===a.indexOf(y.a.getIPortalUrl())?e.getImage().src=t.tileProxy+encodeURIComponent(a):e.getImage().src=a}})},createWMTSSource:function(e){var t=e.extent||ol.proj.get(e.projection).getExtent(),a=this,n=ol.proj.get(e.projection).getUnits(),i=e.dpi||b.a.dpi.iServerWMTS;return new ol.source.WMTS({url:e.tileUrl||e.url,layer:e.layer,format:e.format||"image/png",style:e.style,matrixSet:e.identifier,requestEncoding:e.requestEncoding||"KVP",tileGrid:this._getWMTSTileGrid(t,e.matrixSet||e.scales,n,i,e.origin,e.matrixIds),tileLoadFunction:function(t,n){n.indexOf("tianditu.gov.cn")>=0?t.getImage().src="".concat(n,"&tk=").concat(y.a.getQueryValue(e.url,"tk")):-1===n.indexOf(y.a.getIPortalUrl())?t.getImage().src=a.tileProxy+encodeURIComponent(n):t.getImage().src=n}})},createXYZSource:function(e){var t={url:e.url,wrapX:!1,crossOrigin:"anonymous"};return e.indexExtent&&(t.tileGrid=ol.tilegrid.createXYZ({extent:e.indexExtent})),new ol.source.XYZ(t)},createBaiduSource:function(e){return new ol.source.BaiduMap},createBingSource:function(e){return new ol.source.XYZ({wrapX:!1,crossOrigin:"anonymous",projection:e.epsgCode,tileUrlFunction:function(t){var a=m()(t),n=a[0],i=a[1],r=a[2];r=r>0?r-1:-r-1;for(var s="",o=n;o>0;o--){var l=0,c=1<<o-1;0!=(i&c)&&l++,0!=(r&c)&&(l+=2),s+=l.toString()}return e.url.replace("{quadKey}",s)}})},createDynamicTiledSource:function(e,t){var a=SuperMap.ServerType.IPORTAL,n=e.credential,i="Token",r=e.url;if(window.isSuperMapOL&&(i="Key",r=[r],a=SuperMap.ServerType.ONLINE),n&&SuperMap.SecurityManager["register".concat(i)](r,n),e.fromPreview&&e.mapJSON){var s=e.mapJSON;return delete e.mapJSON,this.previewDynamicTiledSource(e.url,e.epsgCode,s)}if(e.visibleScales&&e.coordUnit&&e.visibleScales.length>0&&!e.visibleResolutions){var o=[];for(var l in e.visibleScales){var c=y.a.scaleToResolution(e.visibleScales[l],b.a.dpi.default,e.coordUnit);o.push(c)}e.visibleResolutions=o}var u={transparent:!0,url:e.url,wrapX:!1,serverType:a,format:e.format||"png"};if(t||y.a.isCustomProjection(g.a.getBaseLayerProj())||(u.prjCoordSys={epsgCode:g.a.getBaseLayerProj().split(":")[1]}),e.visibleResolutions){var d=new ol.tilegrid.TileGrid({extent:e.extent,resolutions:e.visibleResolutions});u.tileGrid=d}else{var p=ol.extent.createEmpty(),h=g.a.getBaseLayer().layerInfo.extent,f=e.extent;t||(ol.extent.extend(p,h),ol.extent.extend(p,e.extent),f=u.extent=p);var m=new ol.tilegrid.TileGrid({extent:f,resolutions:this.getResolutionsFromBounds(f)});u.tileGrid=m}e.projection2=t?e.projection:g.a.getBaseLayerProj(),e.url&&!y.a.isSameDomain(e.url)&&"webp"!==e.format&&(u.tileProxy=this.tileProxy);var v=new ol.source.TileSuperMapRest(u);return SuperMap.SecurityManager["register".concat(i)](e.url),v},getResolutionsFromBounds:function(e){for(var t=[],a=Math.abs(e[0]-e[2])/512,n=0;n<22;n++)0!==n?(a/=2,t[n]=a):t[n]=a;return t},previewDynamicTiledSource:function(e,t,a){a.viewer||(a.viewer=this._getDefaultIserverViewerSource());var n=ol.source.TileSuperMapRest.optionsFromMapJSON(e,a);return n.projection=t,new ol.source.TileSuperMapRest(n)},createTiandituSource:function(e,t){var a={layerType:e.layerType.split("_")[1].toLowerCase(),isLabel:t||!1,projection:e.epsgCode},n=v.a.dataVizConfig.tiandituKey;return n||S.a.showMessage(I.notConfiguredTiandituKey),a.url="https://t{0-7}.tianditu.gov.cn/{layer}_{proj}/wmts?tk=".concat(n),new ol.source.Tianditu(a)},createTiandituLabelLayer:function(e){return new ol.layer.Tile({source:this.createTiandituSource(e,!0),zIndex:e.zIndex||0,visible:e.labelLayerVisible})},_getDefaultReslutions:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14,a=[],n=[],i=ol.extent.getWidth(e)/256,r=0;r<t;r++)a[r]=i/Math.pow(2,r),n[r]=r;return{res:a,matrixIds:n}},getResolutionFromScale:function(e,t,a,n){return e=1/(e=+e),"degrees"===a||"dd"===a||"degree"===a?254/t/e/(2*Math.PI*n/360)/1e4:254/t/e/1e4},_getReslutionsFromScales:function(e,t,a,n){a=a&&a.toLowerCase()||"degrees",t=t||b.a.dpi.iServerWMTS,n=n||6378137;var i=[],r=[];if(y.a.isArray(e))e&&e.forEach((function(e,s){e>1&&(r.push(s),i.push(this.getResolutionFromScale(e,t,a,n)))}),this);else{var s=e.TileMatrix;s&&s.forEach((function(e){e.ScaleDenominator>1&&(r.push(e.Identifier),i.push(this.getResolutionFromScale(e.ScaleDenominator,t,a,n)))}),this)}return{res:i,matrixIds:r}},_getWMTSTileGrid:function(e,t,a,n,i,r){var s=this._getReslutionsFromScales(t,n,a);return new ol.tilegrid.WMTS({origin:i,extent:e,resolutions:s.res,matrixIds:r||s.matrixIds})},_getDefaultIserverViewerSource:function(){return{leftTop:{x:0,y:0},top:0,left:0,bottom:256,rightBottom:{x:256,y:256},width:256,right:256,height:256}}},T=function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).layer=null,a.currentTool=E,a}return p()(t,e),s()(t,[{key:"isTileLayer",value:function(){return!0}},{key:"isBaseLayer",value:function(){return 0===this.layerInfo.zIndex}},{key:"createLayer",value:function(){this.layer=this.currentTool.createTileLayer(this.layerInfo,this.isBaseLayer());var e=this.layerInfo.opacity;return y.a.isNumber(e)&&this.layer.setOpacity(e),this.setVisibleScale(),this.layer}},{key:"createTiandituLabelLayer",value:function(){return this.labelLayer=this.currentTool.createTiandituLabelLayer(this.layerInfo),this.layerInfo.labelLayerVisible=!0,this.labelLayer}},{key:"getBounds",value:function(){var e=this.layerInfo.extent,t=g.a.getBaseLayerProj();if(this.layerInfo.orginEpsgCode||(this.layerInfo.orginEpsgCode=this.layerInfo.projection),this.layerInfo.orginEpsgCode&&this.layerInfo.orginEpsgCode!==t){e=ol.proj.transformExtent(e,this.layerInfo.orginEpsgCode,t);var a=g.a.tileLayers[0].getBounds();(e[0]<a[0]||e[1]<a[1]||e[2]>a[2]||e[3]>a[3])&&(e=a)}for(var n in e)y.a.isNumber(e[n])||(e=g.a.tileLayers[0].getBounds());return e}},{key:"getProjection",value:function(){return this.layerInfo.epsgCode}}]),t}(h.a);t.a=T},31:function(e,t,a){"use strict";a(14);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(11),p=a.n(d),h=a(10),f=a.n(h),m=a(0),y=a.n(m),g=(a(13),a(184)),v=(a(1430),function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).onClick=a.onClick.bind(p()(a)),a}return f()(t,e),s()(t,[{key:"onClick",value:function(e){this.props.needPropagation||this.stopPropagation(e),this.props.disabled||this.props.onClick&&this.props.onClick(e)}},{key:"stopPropagation",value:function(e){e.stopPropagation()}},{key:"render",value:function(){var e=this.props,t=e.tooltip,a=e.disabled,n=e.placement,i=e.trigger,r=e.labelType,s=e.iconClassName,o=e.children,l=e.overlayClassName,c=void 0===l?"":l;return t&&!a?y.a.createElement(g.a,{placement:n||"top",trigger:i||"hover",overlay:y.a.isValidElement(t)?t:y.a.createElement("span",null,t),overlayClassName:c},"div"===r?y.a.createElement("div",{className:a?s+" disabled":s,onClick:this.onClick},o):y.a.createElement("span",{className:a?s+" disabled":s,onClick:this.onClick},this.props.children)):y.a.createElement("span",{className:a?s+" disabled":s,onClick:this.onClick},o)}}]),t}(m.Component));t.a=v},35:function(e,t,a){"use strict";a(99),a(100),a(73),a(72),a(93);var n=a(51),i=a.n(n),r=a(325),s=a.n(r),o=(a(78),a(259),a(28),a(30),a(14),a(32),a(44),a(40),a(36),a(69),a(18),a(1)),l=(a(1593),document.createElement("div"));l.className+="dataViz-msg-wrapper";var c={getInstance:function(){l.style.display="none",this.createContainer(),document.body.appendChild(l)},createContainer:function(){var e=document.createElement("div");e.className+="dataViz-msg";var t=document.createElement("div");t.className+="msg-icon-div";var a=document.createElement("div");a.className+="msg-content-div";var n=document.createElement("div");n.className+="supermapol-icons-close msg-icon-close",n.onclick=function(){l.style.display="none"},e.appendChild(t),e.appendChild(a),e.appendChild(n),l.appendChild(e)},getContentImage:function(e){var t,a=e||o.j.SUCCESS,n="".concat(b.getRootUrl(),"apps/dataviz/static/imgs/message/");switch(a){case o.j.ERROR:t="".concat(n,"error_icon.png");break;case o.j.WARNING:t="".concat(n,"warning_icon.png");break;case o.j.SUCCESS:default:t="".concat(n,"success_icon.png")}return{iconUrl:t}},show:function(e,t,a){var n=this.getContentImage(t).iconUrl;l.style.display="block";var i=document.getElementsByClassName("msg-icon-div");i[0].style.backgroundImage="url(".concat(n,")"),i[0].style.backgroundRepeat="no-repeat",document.getElementsByClassName("msg-content-div")[0].innerText=e,setTimeout((function(){l.style.display="none"}),a)}},u=(a(1594),document.createElement("div"));u.className+="dataViz-mobile-msg";var d={getInstance:function(){u.style.display="none",this.createContainer(),document.body.appendChild(u)},createContainer:function(){var e=document.createElement("div");e.className="dataViz-mobile-msg-container";var t=document.createElement("div");t.innerText="";var a=document.createElement("div");a.className="dataViz-mobile-msg-content",e.appendChild(t),e.appendChild(a);var n=document.createElement("div");n.onclick=function(){u.style.display="none"},n.className="dataViz-mobile-msg-footer",n.innerText="",u.appendChild(e),u.appendChild(n)},show:function(e,t,a){u.style.display="block",document.getElementsByClassName("dataViz-mobile-msg-content")[0].innerText=e}},h=(a(623),document.createElement("div"));h.className+="dataViz-loading-box";var f={getInstance:function(){document.body.appendChild(h),h.style.display="none",this.createContainer(h)},createContainer:function(){var e=document.createElement("div"),t=document.createElement("div");t.setAttribute("class","loading-background");var a=document.createElement("div"),n=document.createElement("div");n.className="loading-img-gif gif-max";var i=document.createElement("div");i.className="loading-tip",i.innerHTML=DataViz.Language.loadingData,t.appendChild(n),t.appendChild(i),t.appendChild(a),e.appendChild(t),h.appendChild(e)},show:function(){h.style.display="block"},close:function(){document.body.contains(h)&&document.body.removeChild(h)}},m=(a(444),a(674),a(675),a(676),a(328)),y=a(2);c.getInstance(),d.getInstance(),f.getInstance();var g={},v={},S={transformTools:new ol.format.GeoJSON,doFetch:function(e,t,a){var n={},i=t.data||{};if(n.headers=t.headers||{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},n.mode=t.mode||"cors",n.method=t.method.toUpperCase()||"GET",n.credentials=t.withCredentials?"include":"same-origin","GET"===n.method||"HEAD"===n.method){var r="";Object.keys(i).forEach((function(e,t){r+="".concat(e,"=").concat(i[e],"&")})),e+=r}else if(t.file&&t.inputElement){n.headers={Accept:"application/json"};var s=document.createElement("form");for(var o in i){var l=document.createElement("input");l.setAttribute("name",o),l.setAttribute("value",data[o]),s.appendChild(l)}s.appendChild(t.inputElement),n.body=new FormData(s)}else n.body=a?i:JSON.stringify(i);return fetch(e,n).then((function(e){if(401!==e.status)return"text"===t.dataType?e.text():e.json();throw"401"}))},changeTimeToData:function(e){if(e&&""!==e){var t=new Date(e),a=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),r=t.getHours(),s=t.getMinutes(),o=t.getSeconds();return a+"-"+this.toDouble(n)+"-"+this.toDouble(i)+" "+this.toDouble(r)+":"+this.toDouble(s)+":"+this.toDouble(o)}},toDouble:function(e){return e<10?"0"+e:e},getIPortalUrl:function(){return S.getRootUrl()},getAnchor:function(e){if(v[e])return v[e];var t=document.createElement("a");return t.href=e,v[e]=t,t},getHost:function(e){var t=this.getAnchor(e);return t&&t.host},getBaseLayerProj:function(e){return e?e.getView().getProjection().getCode():null},showMessage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.j.ERROR,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e3;return"share-pc"===document.body.className?c.show(e,t,a):d.show(e,t,a)},showLoadingBox:function(){f.show()},closeLoadingBox:function(){f.close()},getMarkerPop:function(e,t){this.markerPop||this.createMarkerPop(e);var a=document.getElementById("marker-video-url");document.getElementById("marker-img-url").src="";var n=t.get("attributes");""===n.dataViz_title?document.getElementsByClassName("head-title")[0].innerText=DataViz.Language.lackOfTitle:document.getElementsByClassName("head-title")[0].innerText=n.dataViz_title,n.dataViz_imgUrl&&this.setImage(n.dataViz_imgUrl),n.dataViz_videoUrl?(a.src=n.dataViz_videoUrl,a.parentElement.classList.remove("hide")):a.parentElement.classList.add("hide"),""===n.dataViz_description?document.getElementsByClassName("marker-description")[0].innerHTML=DataViz.Language.noneDescription:document.getElementsByClassName("marker-description")[0].innerHTML=n.dataViz_description,""===n.dataViz_url?document.getElementsByClassName("marker-url")[0].style.display="none":(document.getElementsByClassName("marker-url")[0].style.display="block",document.getElementsByClassName("marker-url")[0].innerText=n.dataViz_url),document.getElementsByClassName("marker-url")[0].setAttribute("href",n.dataViz_url);var i=document.getElementsByClassName("marker-attribute")[0];i.innerHTML="";var r=Object.keys(n),s=["dataViz_title","dataViz_description","dataViz_imgUrl","dataViz_url","dataViz_videoUrl"],o=this;if(r.length>0){var l=document.createElement("table");l.setAttribute("class","attributes-table"),r.forEach((function(e){s.indexOf(e)>-1||o.createThemeTd(e,n,{},l)})),i.appendChild(l)}},createMarkerPop:function(e){var t=this;this.markerPop=document.createElement("div"),this.markerPop.setAttribute("class","marker-pop");var a=document.createElement("div");a.setAttribute("class","marker-head");var n=document.createElement("span");n.setAttribute("class","head-title"),a.appendChild(n);var i=document.createElement("div");i.setAttribute("class","marker-content"),S.markerScrollbar=new PerfectScrollbar(i,{wheelSpeed:.3});var r=document.createElement("img");r.setAttribute("class","play-btn div-center"),r.src="".concat(S.getIPortalUrl(),"apps/dataviz/static/imgs/play_btn.png"),r.classList.add("hide");var s=document.createElement("div");s.setAttribute("id","video-box"),s.muted=!1;var o=document.createElement("div");o.setAttribute("class","loading-img-gif div-center");var l=document.createElement("video");l.setAttribute("id","marker-video-url"),l.controls=!1,l.setAttribute("poster",""),t.videoEvent(l,r,o,(function(){t.showFullscreen("video",l.src),l.pause()})),s.appendChild(r),s.appendChild(o),s.appendChild(l);var c=document.createElement("img");c.setAttribute("id","marker-img-url"),c.onclick=function(){t.showFullscreen("image",c.src)};var u=document.createElement("div");u.setAttribute("class","marker-description");var d=document.createElement("a");d.setAttribute("class","marker-url"),i.appendChild(s),i.appendChild(c),i.appendChild(u),i.appendChild(d);var p=document.createElement("div");p.setAttribute("class","marker-attribute"),i.appendChild(p);var h=document.createElement("span");h.setAttribute("class","supermapol-icons-close"),h.onclick=function(){e.setPosition(void 0),l.pause()},a.appendChild(h);var f=document.createElement("div");f.setAttribute("class","marker-pop-arrow");var m=document.createElement("div");m.setAttribute("class","arrow"),f.appendChild(m),this.markerPop.appendChild(a),this.markerPop.appendChild(i),this.markerPop.appendChild(f),e.setElement(this.markerPop)},videoEvent:function(e,t,a,n){e.addEventListener("ended",(function(){t.classList.remove("hide")})),e.addEventListener("error",(function(){e.setAttribute("poster","".concat(S.getIPortalUrl(),"apps/dataviz/static/imgs/no_image.png")),a.classList.add("hide"),t.classList.add("hide"),e.onmouseover=null,e.onclick=null})),e.addEventListener("loadstart",(function(){e.setAttribute("poster",""),a.classList.remove("hide"),t.classList.add("hide")})),e.addEventListener("loadeddata",(function(){e.setAttribute("poster",""),a.classList.add("hide"),t.classList.remove("hide"),e.onmouseover=function(){e.play(),t.classList.add("hide")},e.onclick=n}))},showFullscreen:function(e,t){if(t){var a=this.showFullscreenVideo.bind(this),n="#full-screen-video";"image"===e&&(a=this.showFullscreenImage.bind(this),n="#full-screen-img");var i=document.querySelector(".dataViz-model .dataViz-model-content");if(i){var r=document.querySelector(n);r?a(t,null,r):a(t,i,null),i.parentElement.classList.remove("hide")}else a(t,null)}},creatFullscreenModel:function(){var e=document.createElement("div");e.className="dataViz-model";var t=document.createElement("div");t.className="dataViz-model-content";var a=document.createElement("div");return a.className="close-btn supermapol-icons-close",a.onclick=function(){var a=t.firstElementChild.nextElementSibling;a.classList.add("hide"),"full-screen-video"===a.id&&a.pause(),3===t.childElementCount&&t.lastElementChild.classList.add("hide"),e.classList.add("hide")},t.appendChild(a),e.appendChild(t),document.querySelector("body").appendChild(e),t},showFullscreenImage:function(e,t,a){null===t&&a?(a.src=e,a.classList.remove("hide")):(a||(a=document.createElement("img")).setAttribute("id","full-screen-img"),a.src=e,t?t.appendChild(a):(t=this.creatFullscreenModel()).appendChild(a))},showFullscreenVideo:function(e,t,a){null===t&&a?(a.src=e,a.classList.remove("hide")):(a?a=a.firstElementChild:((a=document.createElement("video")).setAttribute("id","full-screen-video"),t||(t=this.creatFullscreenModel()),t.appendChild(a)),a.src=e,a.autoplay=!0,a.controls=!0)},setImage:function(e){var t=new Image;t.src=e,t.onload=function(){document.getElementById("marker-img-url").setAttribute("src",e)},t.onerror=function(){document.getElementById("marker-img-url").setAttribute("src","".concat(S.getIPortalUrl(),"apps/dataviz/static/imgs/no_image.png"))}},setPopPosition:function(e,t,a){e.getGeometry()&&e.getGeometry().getType().toUpperCase()===o.e.POINT?a.setPosition(e.getGeometry().getFirstCoordinate()):a.setPosition(t)},getFeatureOffset:function(e){var t=e.getProperties().useStyle,a=0;return t.src?a=-63:(t.pointRadius&&(a-=t.pointRadius),a-=t.strokeWidth+20),[0,a]},getThemePop:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;this.themePop||this.createThemePop(e,i);var r=n,s=Object.keys(r),o=this,l=this.themePop.getElementsByClassName("attributes-table")[0];l&&(l.innerHTML=""),s.forEach((function(e){(!t||t.indexOf(e)>-1)&&o.createThemeTd(e,r,a,l)}))},createThemeTd:function(e,t,a,n){var i=document.createElement("td");i.innerText=a[e]||e;var r=document.createElement("td");r.title=r.innerHTML=t[e]||DataViz.Language.nullAttribute;var s=document.createElement("tr");s.setAttribute("class","attributes-tr"),s.appendChild(i),s.appendChild(r),n&&n.appendChild(s)},createThemePop:function(e,t){this.themePop=document.createElement("div"),this.themePop.setAttribute("class","attributes-pop");var a=document.createElement("span");a.setAttribute("class","supermapol-icons-close"),a.onclick=function(){e.setPosition(void 0),t.removeHighLightFeatures()};var n=document.createElement("div");n.setAttribute("class","pop-attributes-content");var i=document.createElement("table");i.setAttribute("class","attributes-table"),S.themeScrollbar=new PerfectScrollbar(n,{wheelSpeed:.3}),n.appendChild(i);var r=document.createElement("div");r.setAttribute("class","pop-arrow-content");var s=document.createElement("div");s.setAttribute("class","pop-arrow"),r.appendChild(s),this.themePop.appendChild(a),this.themePop.appendChild(n),this.themePop.appendChild(r),e.setElement(this.themePop)},getLayersMaxExtent:function(e,t,a){var n=ol.extent.createEmpty(),i=!1;if(e&&0!==e.length){for(var r=[],s=0,o=0,l=e.length;o<l;o++)e[o].visible&&(r.push(e[o]),s++);for(var c=0;c<s;c++){var u=r[c].layerType,d=this.getBounds(r[c],u,a);if(!d)break;ol.extent.extend(n,d),i=!0}}else ol.extent.extend(n,t);return i||ol.extent.extend(n,t),n},getBounds:function(e,t,a){var n;if(["TILE","WMS","VECTOR_TILE","WMTS"].includes(t)){n=e.extent;var i=this.getBaseLayerProj(a),r=e.projection;r&&r!==i&&(n=ol.proj.transformExtent(n,r,i))}else{var s=e.layer,l=e.layerType;if(!s||l===o.r.MIGRATION)return;var c=s.getSource().graphics?s.getSource().graphics:s.getSource().getFeatures();n=ol.extent.createEmpty(),c&&c.forEach((function(e){ol.extent.extend(n,e.getGeometry().getExtent())}),this)}return n},getChildToolsConfig:function(){var e=window.dataVizConfig.controls,t={};return e.forEach((function(e){t[e.id]=e.isCheck})),t},getRootUrl:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.href,t="https://www.supermapol.com/",a="https://itest.supermapol.com/";if(g[e])return g[e];var n="";if(0===e.indexOf(t))n=t;else if(0===e.indexOf(a))n=a;else{var i=/\/apps|\/web|\/manager|\/developer|\/services/i,r=e.search(i),s=this.getAnchor(e);n+=s.protocol+"//"+this.getHost(e)+"/",r>0&&(n+=e.substring(n.length,r+1))}return g[e]=n,n},isNumber:function(e){if(""===e)return!1;var t=Number(e);return 0===t||!isNaN(t)},isVectorLayer:function(e){return e===o.r.VECTOR||e===o.r.UNIQUE||e===o.r.RANGE||e===o.r.HEAT_MAP||e===o.r.GRAPHIC||e===o.r.MARKER||e===o.r.SYMBOL||e===o.r.CIRCLE},showLoading:function(e,t){e=e||document.body;var a=document.createElement("div");a.className="share-loading";var n=document.createElement("div");if(n.className="loading-img-gif gif-max",a.appendChild(n),t){var i=document.createElement(p);i.innerText=i,a.appendChild(i)}e.appendChild(a)},hideLoading:function(e){var t=(e=e||document.body).querySelector(".share-loading");t&&t.parentNode.removeChild(t)},checkReLogin:function(){return S.doFetch("".concat(S.getRootUrl(),"web/mycontent/account.json"),{method:"GET",withCredentials:!0}).catch((function(e){throw{checkReLogin:!0}}))},showLoinBox:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSucceed,a=s()(e,["onSucceed"]);new m.a(i()({loginOptions:{lang:window.lang,theme:window.DataViz.theme,logoUrl:window.dataVizConfig.logoUrl,appName:DataViz.Language.DataVizHtml.DataViz},onSucceed:function(e){var a="localStorage"in window&&window.localStorage.getItem(o.a)?window.localStorage.getItem(o.a):y.a.getAppTheme(e.data.user.theme);y.a.changeTheme(a),S.showMessage(DataViz.Language.loginSuccess,"SUCCESS"),t&&t(e)}},a)).create()},toggleAllUIs:function(e){var t=this;this.hideAllUIs=!this.hideAllUIs,[".legend-info",".map-info",".toolbar",".edit-btn",".copyright",".mousePosition",".supermap-zoom"].forEach((function(e){var a=document.querySelector(e);a&&(a.style.display=t.hideAllUIs?"none":"")})),document.querySelector(".toggle-ui span").className="supermapol-icons-button-".concat(this.hideAllUIs?"invisible":"visible")},addProjection:function(e){return new Promise((function(t,a){S.doFetch("".concat(S.getIPortalUrl(),"epsgcodes/").concat(e,".json"),{method:"GET"}).then((function(n){proj4?(proj4.defs("EPSG:".concat(e),n.wkt),t()):a()})).catch((function(){a()}))}))},getUrl:function(e,t){return e=e.trim(),this.isInTheSameDomain(e)?e:this.getProxy(t)+encodeURIComponent(e)},getProxy:function(e){var t=e||"json";return"".concat(this.getRootUrl(),"apps/viewer/getUrlResource.").concat(t,"?url=")},isIportalProxyServiceUrl:function(e){if(this.serviceProxy&&this.serviceProxy.enable&&e){var t="";return this.serviceProxy.proxyServerRootUrl?t="".concat(this.serviceProxy.proxyServerRootUrl,"/"):this.serviceProxy.rootUrlPostfix?t="".concat(this.serviceProxy.port,"/").concat(this.serviceProxy.rootUrlPostfix,"/"):this.serviceProxy.rootUrlPostfix||(t="".concat(this.serviceProxy.port,"/")),80!==this.serviceProxy.port?e.indexOf(t)>=0:e.indexOf(t)>=0||e.indexOf(t.replace(":80",""))>=0}return!1},isSupportSearchSettingType:function(e){return[o.o.TILE,o.r.VECTOR,o.r.UNIQUE,o.r.RANGE,o.r.GRAPHIC,o.r.SYMBOL,o.r.RANK_SYMBOL].includes(e)},isInTheSameDomain:function(e){if(!e)return!0;var t=e.indexOf("//"),a=document.location.toString(),n=a.indexOf("//");if(-1===t)return!0;var i,r=i=e.substring(0,t),s=a.substring(n+2);n=s.indexOf("/");var o=s.indexOf(":"),l=s.substring(0,n),c=document.location.protocol;if(-1!==o||(l+=":"+("http:"===c.toLowerCase()?80:443)),c.toLowerCase()!==r.toLowerCase())return!1;var u=(r=e.substring(t+2)).indexOf(":");t=r.indexOf("/");var d,p=r.substring(0,t);return-1!==u?d=r.substring(0,u):(d=r.substring(0,t),p+=":"+("http:"===i.toLowerCase()?80:443)),d===document.domain&&p===l}},b=t.a=S},37:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));a(43),a(32),a(27),a(14),a(44),a(40),a(36);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(11),p=a.n(d),h=a(10),f=a.n(h),m=a(26),y=a.n(m),g=a(0),v=a.n(g),S=a(2),b=a(33),I=a(31),E=(a(1610),function(e){return v.a.createElement("li",y()({},e,{className:"select-item ".concat(e.className)}))}),T=function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).iconClassName=e.iconClassName,a.state={open:!1,selectedValue:e.selectedValue||(e.values?e.values[0]:void 0),customActive:!1,customValue:e.customValue,addClassBold:!1},a.confimCutomInput=a.confimCutomInput.bind(p()(a)),a}return f()(t,e),s()(t,[{key:"compare",value:function(e,t){if(!S.a.shallowEqual(this.state,t))return!0;for(var a in e)if(!S.a.shallowEqual(this.props[a],e[a]))return!0;return!1}},{key:"componentWillReceiveProps",value:function(e){var t=this.state.selectedValue;"selectedValue"in e?t=e.selectedValue:S.a.shallowEqual(e.values,this.props.values)||(t=e.values[0]),!t&&e.values&&(t=e.values[0]),this.setState({selectedValue:t})}},{key:"getOptions",value:function(){var e=this,t=this.props,a=t.values,n=t.children,i=t.customPlaceholder,r=t.labels,s=void 0===r?[]:r;if(n)return v.a.Children.map(n,(function(t,a){return v.a.cloneElement(t,{onMouseDown:e.onSelectedValueChange.bind(e,t.props.value||a)})}));for(var o=[],l=0;l<a.length;l++)o.push(v.a.createElement("li",{className:"select-item",key:l,onMouseDown:this.onSelectedValueChange.bind(this,a[l])},s[l]||a[l]));return i&&o.push(v.a.createElement("div",{key:"custom",className:"custom"},v.a.createElement("label",null,DataViz.Language.customWidth),v.a.createElement("input",{type:"text",placeholder:i,ref:"cutomInput",onChange:this.changeCustomValue.bind(this),value:this.state.customValue}),v.a.createElement("span",{className:this.state.customActive?"supermapol-icons-mark active":"supermapol-icons-mark",onMouseDown:this.confimCutomInput}))),o}},{key:"changeCustomValue",value:function(e){var t=e.target.value;""!==t&&t?this.setState({customActive:!0,customValue:t}):this.setState({customActive:!1,customValue:t})}},{key:"confimCutomInput",value:function(){this.state.customActive&&(this.props.valueLimitFun&&this.props.valueLimitFun(this.refs.cutomInput.value)?this.onSelectedValueChange(this.refs.cutomInput.value):this.setState({customActive:!1,customValue:""}))}},{key:"onSelectedValueChange",value:function(e,t){this.props.isBubble||t&&t.stopPropagation(),this.iconClassName?this.modifyState({open:!1}):this.modifyState({selectedValue:e,open:!1}),e!==this.state.selectedValue&&this.props.onChange&&this.props.onChange(e,this.props.values&&this.props.values.indexOf(e))}},{key:"getSelectedValue",value:function(){return this.state.selectedValue}},{key:"modifyState",value:function(e){if(!this.props.disabled&&(this.setState(Object.assign({},this.state,e)),!this.state.open))for(var t=this.refs.selectList.children[0].childNodes[0].childNodes,a=this.state.selectedValue,n=0;n<t.length;n++)t[n].innerHTML===a?t[n].classList.add("bold"):-1!==t[n].className.indexOf("bold")&&t[n].classList.remove("bold")}},{key:"blur",value:function(){this.props.customPlaceholder||this.modifyState({open:!1})}},{key:"render",value:function(){var e,t=this.getOptions();e=this.props.height?this.props.height:28*t.length>140?140:28*t.length;var a="select";return this.props.className&&(a+=" ".concat(this.props.className)),this.state.open&&(a+=" active"),this.props.disabled&&(a+=" disabled"),v.a.createElement("div",{onClick:this.modifyState.bind(this,{open:!0}),className:a,tabIndex:-1,style:this.props.style,onBlur:this.blur.bind(this)},v.a.createElement("div",{className:"background",onMouseDown:this.modifyState.bind(this,{open:!1}),style:{display:this.state.open&&this.props.customPlaceholder?"block":"none"}}),this.props.tooltip?v.a.createElement(I.a,{placement:"top",labelType:"span",iconClassName:"select-value "+this.iconClassName,tooltip:this.props.tooltip,needPropagation:!0}):v.a.createElement("span",{className:"select-value "+this.iconClassName},this.props.renderValue?this.props.renderValue(this.state.selectedValue):this.iconClassName?"":this.props.labels?this.props.labels[this.props.values.indexOf(this.state.selectedValue)]:this.state.selectedValue),!this.props.hideTriangle&&v.a.createElement("span",{className:"select-open supermapol-icons-solid-triangle"}),v.a.createElement("ul",{ref:"selectList",className:this.props.listClassName+" select-list "+("top"===this.props.placement?"placement-top":"placement-bottom"),style:{height:e,display:this.state.open?"block":"none"}},v.a.createElement(b.Scrollbars,{className:"scroll-bars"},t)))}}]),t}(g.Component);t.b=T},41:function(e,t,a){"use strict";a(72),a(78);var n,i=a(17),r=a.n(i),s=(a(43),a(87),a(25)),o=a.n(s),l=(a(93),a(44),a(40),a(36),a(141),a(20),a(18),a(73),a(2)),c=a(12),u=a(5),d=a(105),p=a(22),h=a(137),f=a(63),m=a(57),y=a(1),g=l.a.getRootUrl()+"apps/viewer/",v=l.a.getRootUrl()+"web/maps/",S={hasServiceProxy:!1,baseMapInfs:null,layerCache:[],changeBaseMapIndex:null,isOpenApp:!1,getInfoEnd:!1,baseMaps:p.a.baseMaps,invalidBaseMap:0,createdBaseMap:!1,hasRelationship:null,dataVizConfig:{buildinMaps:p.a.baseMaps,controls:[{isCheck:!0,id:"OVERVIEW_MAP"},{isCheck:!1,id:"ATTRIBUTION"},{isCheck:!1,id:"DISPLAY_COORDS"},{isCheck:!1,id:"POI_SEARCH"},{isCheck:!1,id:"LAYER_SEARCH"},{isCheck:!1,id:"ROAD_CONDITION"},{isCheck:!0,id:"QRCORD_SHARE"},{isCheck:!0,id:"SHARE_TO_OTHER"}],mapCenter:{level:{id:"MAP_LEVEL",value:1},mapCenterX:{id:"MAP_CENTER_X",value:110},mapCenterY:{id:"MAP_CENTER_X",value:34},tileFormat:"PNG"},directoryName:DataViz.Language.DataVizHtml.DataViz,logoUrl:"".concat(l.a.getIPortalUrl(),"apps/dataviz/static/imgs/logo.png"),layerLists:[{isCheck:!0,children:[],id:"FILE_ADD"},{isCheck:!0,children:[{isCheck:!1,id:"SAMPLE_SERVICE"},{isCheck:!0,id:"MY_PUBLIC_SERVICE"},{isCheck:!1,id:"MAP_GALLERY"}],id:"SEARCH_ADD"},{isCheck:!0,children:[{isCheck:!0,id:"ADD_REST"},{isCheck:!0,id:"ADD_WMS"},{isCheck:!0,id:"ADD_WMTS"},{isCheck:!0,id:"ADD_MAP_SERVICE"},{isCheck:!0,id:"ADD_DATAFLOW_SERVICE"},{isCheck:!0,id:"ADD_GEOJSON_DATA"}],id:"WEB_ADD"},{isCheck:!0,children:[],id:"ADD_MARKER_LAYER"}],tiandituKey:null,googleMapsAPIKey:null},getServiceProxy:function(){return l.a.doFetch("".concat(l.a.getRootUrl(),"web/config/portal.json?").concat(encodeURI("scope=[serviceProxy]")),{method:"GET"}).then((function(e){if(e.serviceProxy){var t=e.serviceProxy;S.hasServiceProxy=t.enable,l.a.serviceProxy=t}})).catch((function(e){}))},getServiceConfig:function(){return l.a.doFetch("".concat(l.a.getIPortalUrl(),"apps/viewer/config.json?_=").concat((new Date).getTime()),{method:"GET",withCredentials:!0}).then((function(e){for(var t in e.addressMatchSetting&&e.addressMatchSetting.matchUrl&&(e.addressMatchSetting.matchUrl=l.a.handleInputUrl(e.addressMatchSetting.matchUrl)),e.searchSetting&&e.searchSetting.restDataUrl&&(e.searchSetting.restDataUrl=l.a.handleInputUrl(e.searchSetting.restDataUrl)),e)"logoUrl"!==t?(S.dataVizConfig[t]=e[t],"layerLists"===t&&(S.dataVizConfig[t][2].children=S.dataVizConfig[t][2].children.concat([{isCheck:!0,id:"ADD_DATAFLOW_SERVICE"},{isCheck:!0,id:"ADD_GEOJSON_DATA"}]))):e[t]&&(S.dataVizConfig[t]=e[t].replace("{portalRoot}",l.a.getIPortalUrl()));0===S.dataVizConfig.buildinMaps.length&&(S.dataVizConfig.buildinMaps=S.baseMaps),S.dataVizConfig.searchSetting||(S.dataVizConfig.searchSetting={searchType:"RestData",restDataUrl:"",restDataFields:[]}),window.isSuperMapOL=e.isSuperMapOL,window.casEnable=e.casEnable,S.updateAppLogo(dataVizConfig.logoUrl),u.a.addMapControl(),S.perfectBaseMapInf()})).catch((function(e){u.a.addMapControl(),S.perfectBaseMapInf()}))},perfectBaseMapInf:function(){var e=this.baseMapInfs=[],t=[];this.dataVizConfig.buildinMaps.forEach((function(a,n){if(a.isInternetMap){var i=d.a.getMapInfo(a.internetMapName);if(!i)return;i&&(i.id=1),i.isInternetMap=!0,i.internetMapName=a.internetMapName,e[n]=[i.name,i.thumbnail],this.layerCache[n]=i,0!==n||S.isOpenApp||S.isIportalView||(S.changeBaseMapIndex(0,i),S.createdBaseMap=!0)}else t.push(this.getIServerBaseMapThumb(a,n))}),this),Promise.all(t).then((function(){var e=[];for(var t in S.layerCache){var a=S.layerCache[t];!a.isInternetMap&&a.thumbnail&&e.push(S.clipImage(a))}if(S.getInfoEnd=!0,!S.createdBaseMap&&!S.isOpenApp&&!S.isIportalView)for(var n in S.layerCache)S.createdBaseMap||(S.changeBaseMapIndex(n,S.layerCache[n]),S.createdBaseMap=!0)})),this.baseMapInfs=e},clipImage:function(e){return new Promise((function(t,a){var n=document.createElement("canvas");if(n.width=170,n.height=170,n.getContext){var i=n.getContext("2d"),r=new Image;r.crossOrigin="anonymous",r.src=e.thumbnail,r.onload=function(){i.drawImage(r,-47.5,0);var a=n.toDataURL("image/png");e.thumbnail=a,t()},r.onerror=function(){t()}}}))},getIServerBaseMapThumb:function(e,t){return new Promise((function(a,n){if("MVT"===e.type){var i={dataSource:{url:e.url,type:"EXTERNAL"},layerType:"MAPBOXSTYLE",name:e.title};f.a.getMapboxStyleLayer(i).then((function(e){S.addBaseMapInfo(e,a,t),a(e)})).catch((function(e){a(e)}))}else l.a.doFetch("".concat(g+e.mapId,".json"),{method:"GET",withCredentials:!0}).then((function(n){if("WMTS"===n.sourceType)u.a.addProjection("EPSG:".concat(n.epsgCode)).then((function(){S.getWmtsInfo(n,e.mapID).then((function(e){S.addBaseMapInfo(e,a,t)})).catch((function(e){a()}))}));else if("SUPERMAP_REST"===n.sourceType)l.a.doFetch("".concat(v+e.mapId,"/map.json"),{method:"GET",withCredentials:!0}).then((function(i){var s={serviceType:e.serviceType||n.sourceType,thumbnail:n.thumbnail},c=i;if(c||c.baseLayer){var u=c.baseLayer,d=u.url||u.dataSource&&u.dataSource.url;(d=l.a.handleInputUrl(d))&&("MAPBOXSTYLE"===u.layerType?f.a.getMapboxStyleLayer(u).then((function(e){S.addBaseMapInfo(e,a,t),a(e)})).catch((function(e){a(e)})):S.getTileInfo(d).then(function(){var n=o()(r.a.mark((function n(i){var o;return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i&&i.visibleScales&&(s.visibleScales=i.visibleScales,s.coordUnit=i.coordUnit),n.next=3,S.getRestServerBaseMapInfo(c,e.mapId);case 3:o=n.sent,s=Object.assign(s,o),S.addBaseMapInfo(s,a,t);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(e){a()})))}})).catch((function(e){a()}));else if("WMS"===n.sourceType)u.a.addProjection("EPSG:".concat(n.epsgCode)).then((function(){S.getWmsInfo(n,e.mapId).then((function(e){S.addBaseMapInfo(e,a,t)})).catch((function(e){a()}))}));else{var i=S.getBaseMapInfoFromMapData(n,e.mapID);S.addBaseMapInfo(i,a,t)}})).catch((function(e){a()}))}))},addBaseMapInfo:function(e,t,a){e?u.a.addProjection(e.projection,e.url).then((function(){S.baseMapInfs[a]=[e.name,e.thumbnail],S.layerCache[a]=e,0!==a||S.isOpenApp||S.isIportalView||(S.changeBaseMapIndex(0,e),S.createdBaseMap=!0),t()})).catch((function(e){t()})):(S.invalidBaseMap++,t())},getBaseMapInfoFromMapData:function(e,t){var a,n=e.layers[0],i=JSON.parse(n.themeSettings);if(i.layerType){var r=i.epsgCode,s=e.extent;"SUPERMAP_REST"===(a={epsgCode:r,projection:r,level:e.level||1,name:e.title,minZoom:0,maxZoom:22,id:1,url:i.url,subLayers:i.subLayers,mapId:t,sourceType:e.sourceType,extent:[s.left,s.bottom,s.right,s.top],thumbnail:e.thumbnail,layerType:i.sourceType||i.layerType}).layerType&&(a.layerType="TILE")}else a=d.a.getMapInfo(i.sourceType);return a},getRestServerBaseMapInfo:(n=o()(r.a.mark((function e(t,a){var n,i,s,o,c,u,d,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.baseLayer,s=0,o=22,c=t.extent,u=n.url||n.dataSource.url,d="png","WebP"!==S.dataVizConfig.mapCenter.tileFormat){e.next=7;break}return e.next=5,l.a.isSupportWebp(u);case 5:p=e.sent,d=p?"webp":"png";case 7:return i={epsgCode:Number(t.projection.replace("EPSG:","")),projection:t.projection,level:t.level||1,name:t.title,minZoom:s,maxZoom:o,id:1,url:u,mapId:a,extent:[c.leftBottom.x,c.leftBottom.y,c.rightTop.x,c.rightTop.y],layerType:n.layerType,format:d},e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)}),getBaseMapInfoFromMapData2:function(e,t,a){var n=e.baseLayer;return"TILE"===n.layerType||"WMS"===n.layerType||"WMTS"===n.layerType?{projection:e.projection,level:e.level||1,name:n.name||e.title,url:n.url,subLayers:n.subLayers,mapId:t,extent:[e.extent.leftBottom.x,e.extent.leftBottom.y,e.extent.rightTop.x,e.extent.rightTop.y],thumbnail:a,layerType:n.layerType}:d.a.getMapInfo(n.layerType)},getWmtsInfo:function(e,t){var a=JSON.parse(e.layers[0].themeSettings),n=l.a.getUrl(e.layers[0].url.trim());return n=l.a.handleInputUrl(n),new Promise((function(i,r){return l.a.doFetch(n,{method:"GET",withCredentials:"include",dataType:"text"}).then((function(n){try{var s=(new ol.format.WMTSCapabilities).read(n);a.layer=a.name,a.tileMatrixSet=a.identifier,(a=h.a.getParamsFromWMTSCapabilities(s,a)).dpi=p.a.dpi.iServerWMTS,a.level=e.level,a.thumbnail=e.thumbnail,a.id=1,a.name=e.title,a.mapID=t,a.layerType=e.sourceType,i(a)}catch(e){c.a.showMessage(DataViz.Language.loadFailed),r(e)}})).catch((function(e){r(e)}))}))},getTileInfo:function(e){return e=l.a.getUrl(e+".json"),new Promise((function(t,a){return l.a.doFetch(e,{method:"GET",withCredentials:"include"}).then((function(e){t(e)})).catch((function(e){a(e)}))}))},getWmsInfo:function(e){var t=l.a.getUrl(e.layers[0].url.trim()),a=JSON.parse(e.layers[0].themeSettings);return t=l.a.handleInputUrl(t),new Promise((function(n,i){m.a.getCapabilities(t,y.s.WMS).then((function(t){a.projection=a.epsgCode,a.layerType=e.sourceType,m.a.getParamsFromWMSCapabilities(t,a),n(a)})).catch((function(e){i(e)}))}))}};window.dataVizConfig=S.dataVizConfig,t.a=S},427:function(e,t,a){"use strict";a(208);var n=a(1),i={defaultStyle:{font:"14px ",labelField:"",fontSize:"14px",fontFamily:window.DataViz.Language.simHei,fill:"#333",backgroundFill:"rgba(255,255,255,0.8)",outlineColor:"#000000",outlineWidth:0,textAlign:"center",textBaseline:"bottom"},featureType:n.p.POINT,getDefaultStyle:function(){return window.cloneDeep(this.defaultStyle)},createLayer:function(e,t,a,n,i,r){this.featureType=a;var s=this.toOpenLayersStyle(t),o=new ol.layer.Vector({declutter:!0,styleOL:s,labelField:t.labelField,source:new ol.source.Vector({features:e,wrapX:!1}),renderMode:"image"});return o.setStyle((function(e){var t=o.get("labelField"),a=e.get("attributes")[t]+"";if("undefined"===a)return null;var n=o.get("styleOL"),i=n.getText();return i&&i.setText&&i.setText(a),n})),o},toOpenLayersStyle:function(e){var t=e.fontSize,a=e.fontFamily,i=e.fill,r=e.backgroundFill,s=e.offsetX,o=void 0===s?0:s,l=e.offsetY,c=e.placement,u=void 0===c?"point":c,d=e.textBaseline,p=void 0===d?"bottom":d,h=e.textAlign,f=void 0===h?"center":h,m=e.outlineColor,y=void 0===m?"#000000":m,g=e.outlineWidth,v=void 0===g?0:g,S={font:"".concat(t," ").concat(a),placement:u,textBaseline:p,fill:new ol.style.Fill({color:i}),backgroundFill:new ol.style.Fill({color:r}),padding:[3,3,3,3],offsetX:this.featureType===n.p.POINT?o:0,offsetY:this.featureType===n.p.POINT?l:0,overflow:!0,maxAngle:0};return this.featureType===n.p.POINT&&(S.textAlign=f),v>0&&(S.stroke=new ol.style.Stroke({color:y,width:v})),new ol.style.Style({text:new ol.style.Text(S)})}};t.a=i},429:function(e,t,a){"use strict";a(14);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(11),p=a.n(d),h=a(10),f=a.n(h),m=a(0),y=a.n(m),g=a(215),v=a(2),S=function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).state={sliderValue:e.value||0,value:e.value||0,min:e.min,max:e.max},a.handlerChange=a.handlerChange.bind(p()(a)),a.sliderValueChange=a.sliderValueChange.bind(p()(a)),a}return f()(t,e),s()(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({sliderValue:e.value||0,value:e.value||0,min:e.min,max:e.max})}},{key:"updateState",value:function(e,t){var a=this.state;void 0!==e&&(a.value=e),void 0!==t&&(a.sliderValue=t),this.setState(a)}},{key:"sliderValueChange",value:function(e){var t=this,a=this.props,n=a.unit,i=a.onChange;this.updateState(e,e),v.a.delayCall((function(){i("%"===n?e/t.state.max:e)}),300,this)}},{key:"handlerChange",value:function(e){var t=this,a=e.target.value;this.updateState(a);var n=this.state,i=n.min,r=n.max,s=n.value;(a=+a)!==s&&v.a.delayCall((function(){var e=t.props,n=e.value,s=e.unit,o=e.onChange;t.props.isDot||(a=parseInt(a)),isNaN(a)?a=n:a<i?a=i:a>r&&(a=r),t.updateState(a,a),o("%"===s?a/r:a)}),300,this)}},{key:"render",value:function(){var e=this.state,t=e.sliderValue,a=e.min,n=e.max,i=e.value,r=this.props,s=r.className,o=r.unit;return y.a.createElement("div",{className:"slider-value".concat(s&&" "+s)},y.a.createElement(g.b,{className:"dv-slider",value:t,min:a,max:n,step:this.props.isDot&&.1,onChange:this.sliderValueChange}),y.a.createElement("input",{type:"text",className:"value-input",value:i,onChange:this.handlerChange}),y.a.createElement("span",{className:"value-unit"},o))}}]),t}(m.Component);t.a=S},431:function(e,t,a){"use strict";a(14),a(43);var n,i,r,s=a(7),o=a.n(s),l=a(6),c=a.n(l),u=a(9),d=a.n(u),p=a(8),h=a.n(p),f=a(10),m=a.n(f),y=a(0),g=a.n(y),v=(a(18),a(112),a(20),a(73),a(32),a(54),a(31)),S=a(33),b=a(2),I=a(12),E=a(45),T=a(150),C=a(85),L=a(55),N=a(1),k=window.DataViz.Language,O=[48,16,50],D={marker:[48,43],destop:[16,16]},w=function(e){function t(e){var a;o()(this,t),a=d()(this,h()(t).call(this,e)),n=C.a.getSymbolPath("base"),i=C.a.getSymbolPath("more");var r=window.cloneDeep(T.a.defaultStyle.MARKER);a.symbolStyle=a.props.style||r;var s=a.resetStyleToUi();return a.state={foldIndex:s.foldIndex||0,iconType:s.iconType||"red",imgIndex:null},a.radius=a.symbolStyle.scale*(a.symbolStyle.imgWidth||D.marker[0]),a.useIndex=0,a}return m()(t,e),c()(t,[{key:"componentWillReceiveProps",value:function(e){if(e.style!==this.symbolStyle){this.symbolStyle=e.style;var t=this.resetStyleToUi();this.setState({foldIndex:t.foldIndex||0,iconType:t.iconType||"red"})}}},{key:"resetStyleToUi",value:function(){var e;return e=this.props.feature?this.props.feature.getProperties().useStyle:this.symbolStyle,this.getIndexFromSrc(e.src),{iconType:this.getIconTypeFromSrc(e.src),foldIndex:this.useIndex}}},{key:"getIconTypeFromSrc",value:function(e){if(0===this.useIndex){var t=e.split("static/imgs/markers/")[1];if((t=(t=t.split(".")[0]).split("_")).length>0)return t[1]}}},{key:"changeFoldIndex",value:function(e){this.setState({foldIndex:e,imgIndex:null})}},{key:"getDefaultStyle",value:function(){var e=this.symbolStyle;this.getIndexFromSrc(e.src),this.radius=this.radius?this.radius:e.scale*e.imgWidth||D.marker[0]}},{key:"getIndexFromSrc",value:function(e){e.indexOf("static/imgs/markers")>-1?this.useIndex=0:e.indexOf("static/imgs/desktop")>-1?this.useIndex=1:this.useIndex=2}},{key:"changeRadius",value:function(e,t){this.radius=t,this.symbolStyle.scale=this.radius/(this.symbolStyle.imgWidth||D.marker[0]),E.a.setStyle(this.symbolStyle,"POINT",this.props.feature)}},{key:"changeOuterImg",value:function(e){var t=n.replace(/light|dark/,"");switch(e){case"red":this.symbolStyle.src=t+"mark_red.png";break;case"blue":this.symbolStyle.src=t+"mark_blue.png";break;default:this.symbolStyle.src=t+"mark_purple.png"}this.symbolStyle.imgWidth=D.marker[0],this.symbolStyle.imgHeight=D.marker[1],this.useIndex=0,this.refreshRadius(),E.a.setStyle(this.symbolStyle,"POINT",this.props.feature),this.setState({iconType:e,imgIndex:null})}},{key:"changeSrc",value:function(e,t){var a=this.state.foldIndex;if(0===a){var r=(n+e).replace(/light|dark/,"");"red"===this.state.iconType?this.symbolStyle.src=r+"_red.png":"blue"===this.state.iconType?this.symbolStyle.src=r+"_blue.png":this.symbolStyle.src=r+"_purple.png",this.symbolStyle.imgWidth=D.marker[0],this.symbolStyle.imgHeight=D.marker[1]}else 1===a&&(this.symbolStyle.src=i+e+".png",this.symbolStyle.imgWidth=D.destop[0],this.symbolStyle.imgHeight=D.destop[1]);this.useIndex=a,this.refreshRadius(),this.setState({imgIndex:t}),E.a.setStyle(this.symbolStyle,"POINT",this.props.feature)}},{key:"refreshRadius",value:function(){this.props.feature&&this.props.feature.getStyle().getImage().setScale(1);this.symbolStyle.scale=1,this.radius=O[this.useIndex]}},{key:"getImgScale",value:function(e){return this.radius/e}},{key:"changeCustomIcon",value:function(e){var t=this;if(e.target.value){var a=e.target.files[0],n=encodeURIComponent(a.name),i=e.target.cloneNode(!0),r=new FileReader;r.readAsDataURL(a),r.onload=function(e){t.judgeType(a.name)&&t.handelImg(e,i,n)}}}},{key:"handelImg",value:function(e,t,a){var n=this,i=new Image;i.src=e.target.result,i.onload=function(){var e;this.width>50&&this.height>50?I.a.showMessage(k.sizeIsWrong):(i.width&&0!==i.width&&(e=n.getImgScale(i.width),n.symbolStyle.imgWidth=this.width,n.symbolStyle.imgHeight=this.height),n.uploadImage(a,t,e),n.useIndex=n.state.foldIndex)}}},{key:"judgeType",value:function(e){var t=e.toLowerCase().match(/(.*?).(jpeg|png|jpg|svg)$/);if(t)return t[2];I.a.showMessage(DataViz.Language.unSupportFileType,N.j.WARNING)}},{key:"uploadImage",value:function(e,t,a){var n=this;b.a.checkReLogin().then((function(){b.a.uploadImageFile("custom-file",e).then((function(e){var t=e.filePath;n.symbolStyle.src=b.a.getIPortalUrl()+t,n.symbolStyle.scale=a,n.symbolStyle.radius=n.radius,E.a.setStyle(n.symbolStyle,"POINT",n.props.feature),n.refs.customFile.value=""})).catch((function(e){}))})).catch((function(e){I.a.showMessage(k.noLogin,N.j.WARNING)}))}},{key:"getImgs",value:function(e){var t,a,r=[];return"base"===e?(t=C.a.baseSymbolNames,a=n,t.forEach((function(e,t){r.push(g.a.createElement("div",{key:e+t,className:this.judgeActive(e,t)?"img active":"img",onClick:this.changeSrc.bind(this,e,t)}))}),this)):(t=C.a.moreSymbolNames,a=i,t.forEach((function(e,t){r.push(g.a.createElement("img",{src:a+e+".png",key:e+t,onClick:this.changeSrc.bind(this,e,t),className:this.judgeActive(e,t)?"img active":"img"}))}),this)),r}},{key:"judgeActive",value:function(e,t){if(this.state.imgIndex){if(this.state.imgIndex===t)return!0}else{var a;if(0===this.state.foldIndex){if(a=this.symbolStyle.src.split("static/imgs/markers/")[1]){var n=(a=a.split(".")[0]).split("_");n.length>0&&(a=n[0])}}else 1===this.state.foldIndex&&(a=this.symbolStyle.src.split("static/imgs/desktop/")[1])&&(a=a.split(".")[0]);if(a&&a.split(".")[0]===e)return!0}return!1}},{key:"render",value:function(){return this.getDefaultStyle(),g.a.createElement("div",{className:"content"},g.a.createElement("div",{className:"base-symbol",onClick:this.changeFoldIndex.bind(this,0)},g.a.createElement("div",null,g.a.createElement("div",null,k.baseSymbol,g.a.createElement(v.a,{placement:"top",labelType:"span",iconClassName:0===this.state.foldIndex?"supermapol-icons-fold":"supermapol-icons-unfold",tooltip:0===this.state.foldIndex?null:k.expand,onClick:this.changeFoldIndex.bind(this,0)}))),g.a.createElement("div",{className:"base-imgs",style:{display:0===this.state.foldIndex?"block":"none"}},g.a.createElement("div",{className:"red"===this.state.iconType?"supermapol-icons-Shape-12 red active":"supermapol-icons-Shape-12 red",onClick:this.changeOuterImg.bind(this,"red")}),g.a.createElement("div",{className:"blue"===this.state.iconType?"supermapol-icons-Shape-12 blue active":"supermapol-icons-Shape-12 blue",onClick:this.changeOuterImg.bind(this,"blue")}),g.a.createElement("div",{className:"purple"===this.state.iconType?"supermapol-icons-Shape-12 purple active":"supermapol-icons-Shape-12 purple",onClick:this.changeOuterImg.bind(this,"purple")}),g.a.createElement("div",{className:"icons-content base-symbol-content"},g.a.createElement(S.Scrollbars,{className:"scroll-bars"},this.getImgs("base"))))),g.a.createElement("div",{className:"more-symbol",onClick:this.changeFoldIndex.bind(this,1)},g.a.createElement("div",null,g.a.createElement("div",null,k.moreSymbol,g.a.createElement(v.a,{placement:"top",labelType:"span",iconClassName:1===this.state.foldIndex?"supermapol-icons-fold":"supermapol-icons-unfold",tooltip:1===this.state.foldIndex?null:k.expand,onClick:this.changeFoldIndex.bind(this,1)}))),g.a.createElement("div",{className:"icons-content more-symbol-content",style:{display:1===this.state.foldIndex?"block":"none"}},g.a.createElement(S.Scrollbars,{className:"scroll-bars"},this.getImgs("more")))),g.a.createElement("div",{className:"custom-symbol",onClick:this.changeFoldIndex.bind(this,2)},g.a.createElement("div",null,g.a.createElement("div",null,k.customSymbol,g.a.createElement(v.a,{placement:"top",labelType:"span",iconClassName:2===this.state.foldIndex?"supermapol-icons-fold":"supermapol-icons-unfold",tooltip:2===this.state.foldIndex?null:k.expand,onClick:this.changeFoldIndex.bind(this,2)}))),g.a.createElement("div",{className:"icons-content cutsom-symbol-content",style:{display:2===this.state.foldIndex?"block":"none"}},g.a.createElement("div",null,g.a.createElement("button",{className:"supermapol-icons-upload"},k.uploadImg),g.a.createElement("input",{className:"file-input",id:"custom-file",name:"file",type:"file",title:k.uploadImg,ref:"customFile",accept:"image/jpeg,image/png,image/jpg,.svg",onChange:this.changeCustomIcon.bind(this)}),g.a.createElement("div",null,k.custormSize)))),g.a.createElement(L.a,{name:k.pointRaduis,type:"pointRadius",editor:this.changeRadius.bind(this),value:this.radius,min:1,max:50,unit:"Px"}))}}]),t}(y.Component),A=a(193),F=window.DataViz.Language,M=function(e){function t(e){var a;return o()(this,t),a=d()(this,h()(t).call(this,e)),r=window.cloneDeep(T.a.defaultStyle.MARKER),a.state={type:e.type||"Symbol"},a}return m()(t,e),c()(t,[{key:"componentWillReceiveProps",value:function(e){e.type&&e.type!=this.state.type&&this.setState({type:e.type})}},{key:"getConfig",value:function(e){return C.a.getUIConfig(e,"Point")}},{key:"chageTab",value:function(e){var t;t="Symbol"===e?r:C.a.pointStyle,E.a.setStyle(t,N.p.POINT,this.props.feature),this.setState({type:e})}},{key:"getStyle",value:function(){var e;return this.props.feature?e=Object.assign({},this.props.feature.getProperties().useStyle):this.props.layerId&&this.props.style&&(e=Object.assign({},this.props.style)),this.getDefaultStyle(e)}},{key:"getDefaultStyle",value:function(e){return"Symbol"!==this.state.type||e&&e.src?"Style"!==this.state.type||e&&e.radius||(e=Object.assign({},C.a.pointStyle)):e=Object.assign({},r),e}},{key:"render",value:function(){var e=this.getStyle();return g.a.createElement("div",{className:"point-style-content"},g.a.createElement("div",{className:"Symbol"===this.state.type?"point-symbol active":"point-symbol",onClick:this.chageTab.bind(this,"Symbol")},F.usePointSymbol),g.a.createElement("div",{className:"Style"===this.state.type?"point-style active":"point-style",onClick:this.chageTab.bind(this,"Style")},F.usePointStyle),"Symbol"===this.state.type?g.a.createElement(w,{feature:this.props.feature,layerId:this.props.layerId,style:e}):g.a.createElement(A.a,{type:"Point",config:this.getConfig(e),feature:this.props.feature,style:e}))}}]),t}(y.Component);t.a=M},444:function(e,t,a){},45:function(e,t,a){"use strict";a(27),a(32),a(18);var n=a(5),i=a(16),r=a(1),s=416,o=244,l=358,c=374;t.a={_layerId:null,_applyToLayer:!1,isClose:!0,styles:{},markerPop:{distanceX:null,distanceY:null},setStyle:function(e,t,a){if(this._applyToLayer){var i=n.a.getVectorLayerById(this._layerId).getFeatures();i&&i.length>0&&i.forEach((function(a){a.getGeometry().getType().toUpperCase().indexOf(t)>-1&&!a.getProperties().useStyle.text&&this.updateStyle(e,t,a)}),this),this.styles[this._layerId]||(this.styles[this._layerId]={}),this.styles[this._layerId][t]=e}else this.updateStyle(e,t,a)},updateStyle:function(e,t,a){a.setProperties({useStyle:e}),a.setStyle(i.a.toOpenLayersStyle(e,r.e[t]))},getOffset:function(e){var t=e.getGeometry().getType(),a=e.getProperties().useStyle;if(a){var n=-l/2,i=-23;return"Point"===t?a.src?a.imgWidth?i+=-(a.scale*a.imgHeight/2+c):i+=-(21.5+c):a.text?(i+=-(document.getElementById(a.canvas).height/2+o),n=-s/2):i+=-(a.radius+a.strokeWidth+c):i+=-(a.strokeWidth+c),{offsetX:n,offsetY:i}}},setLayerId:function(e){this._layerId=e,this.setApplyToLayer(!0)},getLayerId:function(){return this._layerId},setApplyToLayer:function(e,t){this._applyToLayer=e,t&&(e?this.setStyle(t.getProperties().useStyle,t.getGeometry().getType().toUpperCase(),t):this.styles[this._layerId]&&(this.styles[this._layerId][t.getGeometry().getType().toUpperCase()]=null))},refreshMarkerPopup:function(e,t){var a=document.getElementById("dataviz-marker-pop");if(a){var n=t?this.getPositionFromDistance(e,t):this.getPositionFromFeature(e);a.style.left=n.left,a.style.top=n.top}},getPositionFromDistance:function(e,t){var a=e.getGeometry().getClosestPoint(t),i=n.a.map.getPixelFromCoordinate(a),r=i[0]+this.markerPop.distanceX,s=i[1]+this.markerPop.distanceY,o=this.getOffset(e);return{left:r+o.offsetX+"px",top:s+o.offsetY+"px"}},getPositionFromFeature:function(e){var t=e.getGeometry().getFirstCoordinate(),a=n.a.map.getPixelFromCoordinate(t),i=this.getOffset(e);return{left:a[0]+i.offsetX+"px",top:a[1]+i.offsetY+"px"}},getLayerStyle:function(e,t){if(this.styles[e]&&t)return this.styles[e][t]},checkPopPosition:function(e,t,a){var s,o,l=i.a.judgeType(e);l===r.e.TEXT?(s=416,o=244):(s=358,o=364);var c,u,d=e.getGeometry().getType().toUpperCase()!==r.e.POINT&&t?t:e.getGeometry().getFirstCoordinate(),p=n.a.map.getPixelFromCoordinate(d),h=n.a.map.getSize();function f(e){if("left"===e||"right"===e){var t=0;return l===r.e.TEXT&&(t=14),"left"===e?p[0]-s/2+t<0:p[0]+s/2+t>h[0]}return"top"===e?u+o>p[1]:h[1]-(p[1]-u)<0}if(c=l===r.e.POINT?e.getStyle().getImage().getSize()[1]+12:l===r.e.TEXT?e.getStyle().getImage().getSize()[1]/2-10:e.getStyle().getStroke().getWidth()/2+15,u=c+20,f("top")||f("bottom")||f("left")||f("right")){var m=n.a.map.getView(),y=p[0],g=p[1]-u-o/2,v=n.a.map.getCoordinateFromPixel([y,g]);m.animate({center:v}),a&&a()}else a&&a()},calculateDistance:function(e,t){var a=e.getGeometry().getClosestPoint(t),i=n.a.map.getPixelFromCoordinate(a),r=n.a.map.getPixelFromCoordinate(t);this.markerPop.distanceX=r[0]-i[0],this.markerPop.distanceY=r[1]-i[1]}}},47:function(e,t,a){"use strict";a.d(t,"a",(function(){return g})),a.d(t,"b",(function(){return v}));a(27),a(20),a(14);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(11),p=a.n(d),h=a(10),f=a.n(h),m=a(0),y=a.n(m),g=(a(1426),function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).radio=y.a.createRef(),a.onDivClick=a.onDivClick.bind(p()(a)),a}return f()(t,e),s()(t,[{key:"onDivClick",value:function(){this.radio.current.click()}},{key:"render",value:function(){var e=this.props,t=e.onChange,a=e.selectedValue,n=e.name,i=e.disabled,r=e.value,s=e.hide,o=e.className,l=void 0===o?"":o,c=e.isEn,u=e.title,d=void 0===u?"":u;return y.a.createElement("div",{className:"dataViz-radio".concat(s?" hide":""," ").concat(l).concat(c&&" dataViz-radio-en "),onClick:this.onDivClick,title:d},y.a.createElement("div",{className:"dataViz-radio-div"},y.a.createElement("input",{value:r,type:"radio",disabled:i,name:n,onChange:t,checked:a==r,ref:this.radio}),y.a.createElement("div",{className:"dataViz-radio-inner"})),this.props.children)}}]),t}(m.Component)),v=function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).state={selectedValue:a.props.selectedValue},a.onChange=a.onChange.bind(p()(a)),a}return f()(t,e),s()(t,[{key:"componentWillReceiveProps",value:function(e){"selectedValue"in e&&this.setState({selectedValue:e.selectedValue})}},{key:"onChange",value:function(e){this.props.onChange&&this.props.onChange(e.target.value),this.setState({selectedValue:e.target.value})}},{key:"renderChildren",value:function(e){var t=this;return y.a.Children.map(e.children,(function(a){return y.a.cloneElement(a,{selectedValue:t.state.selectedValue,name:e.name,onChange:t.onChange})}))}},{key:"render",value:function(){return y.a.createElement("div",{className:"dataViz-radio-group ".concat(this.props.className)},this.renderChildren(this.props))}}]),t}(m.Component)},49:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"l",(function(){return r})),a.d(t,"i",(function(){return s})),a.d(t,"h",(function(){return o})),a.d(t,"g",(function(){return l})),a.d(t,"e",(function(){return c})),a.d(t,"f",(function(){return u})),a.d(t,"c",(function(){return d})),a.d(t,"a",(function(){return p})),a.d(t,"d",(function(){return h})),a.d(t,"m",(function(){return f})),a.d(t,"j",(function(){return m})),a.d(t,"k",(function(){return y})),a.d(t,"p",(function(){return g})),a.d(t,"n",(function(){return v})),a.d(t,"o",(function(){return S}));var n=a(19);function i(e){return{payload:e,type:n.b}}function r(e){return{payload:e,type:n.y}}function s(e){return{payload:e,type:n.t}}function o(e){return{payload:e,type:n.k}}function l(e,t){return{payload:{idx:e,baseLayerInfo:t},type:n.g}}function c(e,t){return{payload:{restMapInfo:e,twinkleLayerId:t},type:n.e}}function u(e){return{payload:e,type:n.f}}function d(e){return{payload:e,type:n.c}}function p(e,t){return{payload:{dataflowInfo:e,selectedLayerId:t},type:n.a}}function h(e,t){return{features:t,payload:e,type:n.d}}function f(e){return{layerID:e,type:n.z}}function m(e){return{layerID:e,type:n.w}}function y(e){return{payload:e,type:n.x}}function g(e,t){return{layerID:e,updateTime:t,isFold:arguments.length>2&&void 0!==arguments[2]&&arguments[2],type:n.G}}function v(e){return{payload:e,type:n.C}}function S(e,t){return{layerType:t,layerInfo:e,type:n.F}}},5:function(e,t,a){"use strict";a(78),a(92),a(252),a(253),a(71),a(20),a(44),a(40),a(455),a(141),a(459),a(18);var n,i=a(158),r=a.n(i),s=a(51),o=a.n(s),l=a(17),c=a.n(l),u=(a(87),a(25)),d=a.n(u),p=(a(54),a(93),a(36),a(32),a(43),a(27),a(28),a(30),a(62)),h=a.n(p),f=(a(69),a(7)),m=a.n(f),y=a(6),g=a.n(y),v=a(9),S=a.n(v),b=a(8),I=a.n(b),E=a(128),T=a.n(E),C=a(10),L=a.n(C),N=a(1),k=a(211),O=a(2),D=a(12),w=a(16),A=a(45),F=a(76),M=(a(72),a(439)),R=window.DataViz.Language,x={geostatsInstance:null,newInstance:function(){return this.geostatsInstance||(this.geostatsInstance=new geostats),this.geostatsInstance},getInstance:function(e){var t=this.newInstance();return t.setSerie(e),t},getArrayStatistic:function(e,t){return e.length?"Sum"===t||""===t?this.getSum(e):"Maximum"===t||""===t?this.getMax(e):"Minimum"===t||""===t?this.getMin(e):"Average"===t||""===t?this.getMean(e):"Median"===t||""===t?this.getMedian(e):"times"===t||""===t?this.getTimes(e):void 0:0},getArraySegments:function(e,t,a){return"Offset segment"===t||""===t||"offset"===t?this.getEqInterval(e,a):"Natural breaks"===t||""===t||"jenks"===t?this.getJenks(e,a):"Square root segment"===t||""===t||"square"===t?this.getMin(e)>=0?this.getSqrtInterval(e,a):(D.a.showMessage(R.hasNegValue+R.noSupportRange),!1):"Logarithm segment"===t||""===t||"logarithm"===t?this.getMin(e)>0?this.getGeometricProgression(e,a):(D.a.showMessage(R.hasZeroNegValue+R.noSupportRange),!1):void 0},getSum:function(e){return this.getInstance(e).sum()},getMax:function(e){return this.getInstance(e).max()},getMin:function(e){return this.getInstance(e).min()},getMean:function(e){return this.getInstance(e).mean()},getMedian:function(e){return this.getInstance(e).median()},getTimes:function(e){return e.length},getEqInterval:function(e,t){return this.getInstance(e).getClassEqInterval(t)},getJenks:function(e,t){var a=Object(M.ckmeans)(e,t).map((function(e){return e[0]}));return a.push(Object(M.max)(e)),a},getSqrtInterval:function(e,t){return e=e.map((function(e){return Math.sqrt(e)})),this.getInstance(e).getClassEqInterval(t).map((function(e){return e*e}))},getGeometricProgression:function(e,t){return this.getInstance(e).getClassGeometricProgression(t)}},P={defaultParameters:{themeSetting:{colors:["#0000ff","#00ffff","#00ff00","#ffff00","#ff0000"],weight:null,radius:10,customSettings:{}}},fieldMaxValue:{},numberFields:[],getDefaultStyle:function(){return window.cloneDeep(this.defaultParameters)},createLayer:function(e,t,a,n,i,r){var s={layerID:r,source:this.createSource(e)};if(s.gradient=t.themeSetting.colors.slice(),s.radius=parseInt(t.themeSetting.radius),t.themeSetting.customSettings){var o=t.themeSetting.customSettings;for(var l in o)s.gradient[l]=o[l]}return t.themeSetting.weight&&this.changeWeight(e,t.themeSetting.weight),new ol.layer.Heatmap(s)},createSource:function(e){return new ol.source.Vector({features:e,wrapX:!1})},getNumberFields:function(e){if(!this.defaultParameters.weight){for(var t in e)e[t]===N.c.NUMBER&&this.numberFields.push(t);this.defaultParameters.themeSetting.weight=this.numberFields[0]}},regainDefaultStyle:function(e,t,a){this.changeColos(t.themeSetting.colors,e),this.changeRadius(t.themeSetting.radius,e),this.changeWeight(a,t.themeSetting.weight);var n=e.getSource();n.clear(!0),n.addFeatures(a)},changeStyle:function(e,t,a,n,i,r,s){var o=e.getSource();"colors"===r?(t.themeSetting.customSettings={},this.changeColos(s,e)):"themeField"===r?(o=this.createSource(i,t,n),e.setSource(o)):"radius"===r?s>=0&&this.changeRadius(s,e):"weight"===r?this.changeWeight(i,s,e):"defaultStyle"===r?(t.themeSetting.customSettings={},this.regainDefaultStyle(e,t,i)):"defaultCustom"===r?(t.themeSetting.customSettings={},this.changeColos(t.themeSetting.colors,e)):(o.style=t.style?t.style:t,o.changed())},changeUserDefinedAttr:function(e,t,a){var n=a.getGradient().concat();n[e]=t,this.changeColos(n,a),a.getSource().changed()},changeColos:function(e,t){t.setGradient([]),e&&t.setGradient(e)},changeRadius:function(e,t){e&&t.setRadius(+e)},getMaxValue:function(e,t){var a,n=[],i=t||this.defaultParameters.weight;e.forEach((function(e){a=e.get("Properties")||e.get("attributes");try{n.push(parseFloat(a[i.trim()]))}catch(e){}})),this.fieldMaxValue[i]=x.getArrayStatistic(n,"Maximum")},changeWeight:function(e,t){if(t!==DataViz.Language.unSetting){this.getMaxValue(e,t);var a=this.fieldMaxValue[t];e.forEach((function(e){var n=e.get("Properties")||e.get("attributes");try{var i=n[t.trim()];e.set("weight",i/a)}catch(e){}}))}else e.forEach((function(e){e.unset("weight")}))}},V=(a(208),{type:"GraphicLayer",defaultStyle:{style:{radius:8,fillColor:"#EE4D5A",fillOpacity:.9,strokeColor:"#ffffff",strokeWidth:1,strokeOpacity:1,lineDash:"solid",symbolType:"svg",offsetX:0,offsetY:0,rotation:0,symbolOffset:{offsetX:0,offsetY:0},svgOffset:{offsetX:.5,offsetY:.5},imageOffset:{offsetX:.5,offsetY:.5},type:"BASIC_POINT"}},getDefaultStyle:function(){return window.cloneDeep(this.defaultStyle)},createLayer:function(e,t,a,n,i,r){var s=this.createSource(e,t,n,i,a);return new ol.layer.Image({layerID:r,source:s})},createSource:function(e,t,a,n,i){var r=this.getGraphicsFromFeatures(e,t);return new ol.source.Graphic({graphics:r,render:"canvas",map:Ie.map,isHighLight:!1})},changeStyle:function(e,t,a,n,i,r){var s;if("defaultStyle"===r)s=this.createSource(i,t),e.setSource(s);else{var o=this.getOpenlayerStyle(t.style);((s=e.getSource()).graphics_||s.graphics).map((function(e){e.setStyle(o)}),this),s.changed()}},getOpenlayerStyle:function(e){var t,a,n,i=e.type,r=e.radius,s=e.imageInfo,o=e.symbolInfo,l=e.offsetX,c=void 0===l?0:l,u=e.offsetY,d=void 0===u?0:u,p=e.fillOpacity,h=e.rotation,f=void 0===h?0:h;if("IMAGE_POINT"===i&&s){var m=s.img,y=s.size;a=y.w,n=y.h;var g=w.a.getIconAnchor(c,d);t=new ol.style.Icon({img:m,scale:2*r/a,imgSize:[a,n],anchor:g,anchorOrigin:"bottom-right",rotation:f})}else if("SVG_POINT"===i&&o&&o.url){this.div||(this.div=document.createElement("div"),document.body.appendChild(this.div));var v=this;w.a.getCanvasFromSVG(o,this.div,(function(i){a=i.width,n=i.height;var s=w.a.getIconAnchor(c,d);t=new ol.style.Icon({img:v.setColorToCanvas(i,e),scale:2*r/a,imgSize:[a,n],opacity:p,anchor:s,anchorOrigin:"bottom-right",rotation:f})}))}else{var S=w.a.toOpenLayersStyle(e,N.p.POINT);t=S.getImage()}return t},setColorToCanvas:function(e,t){var a=e.getContext("2d"),n=w.a.hexToRgb(t.fillColor);n&&n.push(t.fillOpacity);var i=w.a.hexToRgb(t.strokeColor);return i&&i.push(t.strokeOpacity),a.fillStyle=w.a.formatRGB(n),a.fill(),a.strokeStyle=w.a.formatRGB(i),a.lineWidth=t.strokeWidth,a.stroke(),e},updateGraphics:function(e,t,a){var n=this.getGraphicsFromFeatures(t,a,e);if(n){var i=e.getSource();i.setGraphics(n),i.update()}},getGraphicsFromFeatures:function(e,t){var a=this.getOpenlayerStyle(t.style),n=[];for(var i in e){var r=new ol.Graphic(e[i].getGeometry());r.setStyle(a),r.setProperties({attributes:e[i].get("attributes")}),n.push(r)}return n},regainDefaultStyle:function(e,t,a){this.changeStyle(e,t,a)},removeCanvas:function(e){this.div&&e&&this.div.removeChild(e)}}),B=a(157),U={defaultParameters:{style:{radius:8,lineDash:"solid",strokeWidth:1,strokeColor:"#ffffff",strokeOpacity:1,fillOpacity:.9,fillColor:"#FFFFFF",offsetX:0,offsetY:0},themeSetting:{segmentCount:6,segmentMethod:"offset",colors:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],customSettings:{}}},getDefaultStyle:function(e){var t=window.cloneDeep(this.defaultParameters);return e===N.p.LINE&&(t.style.strokeWidth=2),t},createLayer:function(e,t,a,n,i,r){var s=this.createSource(t,n,i||e,a),o=new ol.layer.Vector({layerID:r,styleSource:s,source:new ol.source.Vector({features:e,wrapX:!1}),renderMode:"image"});return o.setStyle((function(e){var t=o.get("styleSource");if(t)for(var a=t.parameters.themeSetting.themeField,n=Number(e.get("attributes")[a]),i=t.styleGroups,r=0;r<i.length;r++)if(0===r){if(n>=i[r].start&&n<=i[r].end)return i[r].olStyle}else if(n>i[r].start&&n<=i[r].end)return i[r].olStyle})),o},changeStyle:function(e,t,a,n,i,r,s){var o=e.getSource(),l=!1;if(["themeField","colors","segmentCount","segmentMethod","defaultStyle","defaultCustom"].includes(r)){t.themeSetting.customSettings={};var c=this.createSource(t,n,i,a);c?e.set("styleSource",c):l=!0,"defaultStyle"===r&&(o.clear(!0),o.addFeatures(i))}else{var u=e.get("styleSource"),d=u.parameters.style;for(var p in d[r]=s,u.styleGroups){var h=u.styleGroups[p];a===N.p.LINE?d.strokeColor=h.color:d.fillColor=h.color;var f=w.a.toOpenLayersStyle(d,a);u.styleGroups[p].olStyle=f}}return!l&&o.changed(),l},changeUserDefinedAttr:function(e,t,a,n){var i=a.get("styleSource"),r=window.cloneDeep(i.parameters.style);n===N.p.LINE?r.strokeColor=t:r.fillColor=t;var s=w.a.toOpenLayersStyle(r,n);i.styleGroups[e].olStyle=s,i.styleGroups[e].color=t,a.getSource().changed()},changeRange:function(e,t,a,n){var i=n.get("styleSource").styleGroups;i[e][a]=t,e>0&&"start"===a?i[e-1].end=t:e<i.length-1&&"end"===a&&(i[e+1].start=t),n.getSource().changed()},createSource:function(e,t,a,n){var i=e.themeSetting.themeField;i||(i=O.a.initThemeField(t,N.c.NUMBER,!0),e.themeSetting.themeField=i);var r=this.getStyleGroup(i,a||features,n,e);return!!r&&{parameters:e||this.defaultParameters,styleGroups:r}},getStyleGroup:function(e,t,a,n){var i,r,s=[],o=n.themeSetting,l=n.style,c=o.customSettings,u=o.colors,d=o.segmentCount,p=o.segmentMethod,h=d||this.defaultParameters.themeSetting.segmentCount,f=p||this.defaultParameters.themeSetting.segmentMethod;t.forEach((function(t){i=t.get("Properties")||t.get("attributes");try{i?void 0!==i[e]&&null!==i[e]&&O.a.isNumber(i[e])&&s.push(parseFloat(i[e])):void 0!==t.get(e)&&null!==t.get(e)&&O.a.isNumber(t.get(e))&&s.push(parseFloat(t.get(e)))}catch(e){}}));try{r=x.getArraySegments(s,f,h)}catch(e){}if(r){var m=h;for(var y in i&&r[0]===r[i.length-1]&&(m=1,r.length=2),r){var g=r[y];g=0===Number(y)?Math.floor(100*g)/100:Math.ceil(100*g)/100+.1,r[y]=Number(g.toFixed(2))}var v=u||this.defaultParameters.themeSetting.colors;v=B.a.getGradientColors(v,m,"RANGE");for(var S=0;S<m;S++)if(S in c){var b=c[S].segment.start,I=c[S].segment.end;null!=b&&(r[S]=c[S].segment.start),null!=I&&(r[S+1]=c[S].segment.end)}for(var E=[],T=0;T<m;T++){var C=v[T];T in c&&c[T].color&&(C=c[T].color),a===N.p.LINE?l.strokeColor=C:l.fillColor=C;var L=w.a.toOpenLayersStyle(l,a),k=r[T],D=r[T+1];E.push({olStyle:L,color:C,start:k,end:D})}return E}return!1}},G={strokeWidth:2,lineDash:"solid",strokeColor:"ffffff",type:"LINE",strokeOpacity:1},_={lineDash:"solid",strokeWidth:1,strokeColor:"#ffffff",strokeOpacity:1,fillOpacity:.9,fillColor:"#FFFFFF",type:"POLYGON"},z={defaultParameters:{style:{radius:8,lineDash:"solid",strokeWidth:1,strokeColor:"#ffffff",strokeOpacity:1,fillOpacity:.9,offsetX:0,offsetY:0,fillColor:"#FFFFFF",symbolOffset:{offsetX:0,offsetY:0},svgOffset:{offsetX:.5,offsetY:.5},type:"BASIC_POINT"},themeSetting:{themeField:null,colors:["#D53E4F","#FC8D59","#FEE08B","#FFFFBF","#E6F598","#99D594","#3288BD"],customSettings:{}}},getDefaultStyle:function(e){var t=window.cloneDeep(this.defaultParameters);return e===N.p.LINE?t.style=window.cloneDeep(G):e===N.p.POLYGON&&(t.style=window.cloneDeep(_)),t},createLayer:function(e,t,a,n,i,r){var s=this.createSource(t,n,i||e,a),o=new ol.layer.Vector({layerID:r,styleSource:s,source:new ol.source.Vector({features:e,wrapX:!1}),renderMode:"image"});return o.setStyle((function(e){var t=o.get("styleSource"),a=t.parameters.themeSetting.themeField,n=e.get("attributes")[a];return t.styleGroups.find((function(e){return e.value===n})).olStyle})),o},changeStyle:function(e,t,a,n,i,r,s){var o=e.getSource();if(["themeField","colors","defaultStyle","defaultCustom","symbolInfo"].includes(r)){t.themeSetting.customSettings={};var l=this.createSource(t,n,i,a);"defaultStyle"===r&&(o.clear(!0),o.addFeatures(i)),e.set("styleSource",l)}else{var c=e.get("styleSource"),u=c.parameters;for(var d in u.style[r]=s,c.styleGroups){var p=c.styleGroups[d];p.style[r]=s,a===N.p.LINE?u.style.strokeColor=p.style.strokeColor:u.style.fillColor=p.style.fillColor;var h=p.style.type===N.k.SYMBOL_POINT?w.a.toTextOpenlayerStyle(p):w.a.toOpenLayersStyle(p.style,a);c.styleGroups[d].olStyle=h}}o.changed()},changeUserDefinedAttr:function(e,t,a,n){var i=a.get("styleSource"),r=t.type===N.k.SYMBOL_POINT?w.a.toTextOpenlayerStyle({style:t}):w.a.toOpenLayersStyle(t,n),s=i.styleGroups.find((function(t){return t.value===e}));s.olStyle=r,s.style=t,a.getSource().changed()},createSource:function(e,t,a,n){var i=e.themeSetting,r=i.themeField;r||(r=O.a.initThemeField(t,null,!0),i.themeField=r);var s=i.colors;return s||(s=this.defaultParameters.themeSetting.colors),{parameters:e,styleGroups:this.getStyleGroup(r,a,s,n,e)}},getCustomSetting:function(e,t,a){var n={};return"LINE"===a?n.strokeColor=t:n.fillColor=t,Object.assign(e,n)},getStyleGroup:function(e,t,a,n,i){var r=this,s=O.a.getValuesFromField(t,e);if(0===Object.keys(i.themeSetting.customSettings).length){var o=w.a.getUniqueColors(a||this.defaultParameters.themeSetting.colors,s.length);s.forEach((function(e,t){var a=r.getCustomSetting(i.style,o[t],n);i.themeSetting.customSettings[e]=window.cloneDeep(a)}))}var l=[];return s.forEach((function(e){var t=i.themeSetting.customSettings[e],a=t.type===N.k.SYMBOL_POINT?w.a.toTextOpenlayerStyle({style:t}):w.a.toOpenLayersStyle(t,n);l.push({olStyle:a,style:t,value:e})}),this),l}},j={defaultStyle:{style:{radius:8,fillColor:"#EE4D5A",fillOpacity:.9,strokeColor:"#ffffff",strokeWidth:1,strokeOpacity:1,lineDash:"solid",type:"BASIC_POINT"},outlineStyle:{strokeWidth:1,lineDash:"solid",strokeColor:"#d69c08",strokeOpacity:1}},getDefaultStyle:function(e){var t=window.cloneDeep(this.defaultStyle);return e===N.p.LINE?(t.style.strokeColor="#4CC8A3",t.style.strokeWidth=2):e===N.p.POLYGON&&(t.style.fillColor="#826DBA"),t},getOutlineStyle:function(){return window.cloneDeep(this.defaultStyle.outlineStyle)},getPathwayStyle:function(){var e=window.cloneDeep(this.defaultStyle);return e.outlineStyle.strokeColor="#000000",e.style.strokeColor="#ffffff",e.outlineStyle.strokeWidth=e.style.strokeWidth=1,e},createLayer:function(e,t,a,n,i,r){var s=this.getStyle(t,a);return new ol.layer.Vector({layerID:r,style:s,source:new ol.source.Vector({features:e,wrapX:!1}),renderMode:"image"})},changeStyle:function(e,t,a,n,i,r){if("defaultStyle"===r){var s=e.getSource();s.clear(!0),s.addFeatures(i)}var o=this.getStyle(t,a);e&&e.setStyle(o)},getStyle:function(e,t){var a=e.style,n=e.outlineStyle;return"roadPath"===a.lineDash?w.a.getRoadPath(a,n):"pathway"===a.lineDash?w.a.getPathway(a,n):w.a.toOpenLayersStyle(a,t)}},W=a(150),H=a(427),Y={defaultStyle:{style:{radius:8,fillColor:"#EE4D5A",fillOpacity:.9,strokeColor:"#FFFFFF",strokeWidth:1,strokeOpacity:1,offsetX:0,offsetY:0,rotation:0,symbolOffset:{offsetX:0,offsetY:0},svgOffset:{offsetX:.5,offsetY:.5},imageOffset:{offsetX:.5,offsetY:.5},type:"SYMBOL_POINT"}},getDefaultStyle:function(){return window.cloneDeep(this.defaultStyle)},createLayer:function(e,t,a,n,i,r){var s=w.a.toTextOpenlayerStyle(t);return new ol.layer.Vector({layerID:r,style:s,source:new ol.source.Vector({features:e,wrapX:!1}),renderMode:"image"})},changeStyle:function(e,t){var a=w.a.toTextOpenlayerStyle(t);e&&e.setStyle(a)},regainDefaultStyle:function(e,t){this.changeStyle(e,t)}},K=a(192),X=a(165),q=a(49),J=function(){function e(){m()(this,e),this.defaultStyle={style:{radius:8,fillColor:"#ee4d5a",fillOpacity:.9,strokeColor:"#ffffff",strokeWidth:1,strokeOpacity:1,lineDash:"solid",type:"BASIC_POINT"},dataflowSetting:{}},this.pathLineStyle={strokeColor:"#56b781",strokeWidth:1,strokeOpacity:1,maxPointCount:5},this.pathLayer=null,this.featureCache={},this.pathFeature={},this.allFeatures=[],this.labelFeatures={},this.isRefreshLabel=!1,this.addFeatureFinish=!0,this.filterConditionIsRight=!0,this.filterCondition=null}return g()(e,[{key:"getDefaultStyle",value:function(e){var t=window.cloneDeep(this.defaultStyle);return e===N.p.LINE?(t.style.strokeColor="#4CC8A3",t.style.strokeWidth=2):e===N.p.POLYGON&&(t.style.fillColor="#826DBA"),t}},{key:"getPathDefaultStyle",value:function(){return window.cloneDeep(this.pathLineStyle)}},{key:"createLayer",value:function(e,t,a,n){n&&n.length>0&&this.setFeatureCache(n,t.identifyField);var i,r=this,s=this.getStyle(e,t.featureType);t.token&&SuperMap.SecurityManager.registerToken(t.url,t.token);var o=new ol.source.Vector({features:n,wrapX:!1});r.filterCondition=e.filterCondition;var l=!0;return a.events.on({getFeatureSuccess:function(n){l&&(!t.enableFields||t.enableFields.length<1||!t.dataTypes)&&(r.setDataType(t,n.get("attributes")),l=!1),r.isRefreshLabel&&(r.labelLayer.getSource().clear(),r.labelFeatures={},r.isRefreshLabel=!1);var i=e.dataflowSetting&&e.dataflowSetting.pathStyle&&e.dataflowSetting.pathStyle.maxPointCount,s=t.identifyField;if(r.filterCondition&&r.filterConditionIsRight)D.a.closeMessage(),r.filterFeatures(o,n,s,i);else{if(!n.get(s))return a.removeDataflowService(),void D.a.showMessage(DataViz.Language.uniqueFieldIsWrong);r.addFeature(o,n,s),r.pathLayer&&r.addPathFeature(n,n.get(s),i),r.labelLayer&&r.addLabelFeature(n,n.get(s))}Ie.getOnlySelectedFeature()&&Ie.getOnlySelectedFeature().get(t.identifyField)===n.get(t.identifyField)&&K.a.showThemePop(n,null,t.enableFields,t.captions,null,null,t.id)}}),i=this.layer=new ol.layer.Vector({layerID:t.id,styleOL:s,source:o,renderMode:"image"}),this.setStyle(i,e.dataflowSetting&&e.dataflowSetting.directionField,e.style),i}},{key:"createPathLayer",value:function(e){var t=w.a.toOpenLayersStyle(e,N.p.LINE);return this.pathLayer=new ol.layer.Vector({style:t,source:new ol.source.Vector({wrapX:!1}),zIndex:1e4,renderMode:"image"}),this.pathLayer}},{key:"removePathLayer",value:function(){this.pathLayer=null,this.pathFeature={}}},{key:"changeDirection",value:function(e,t){this.setStyle(this.layer,e,t)}},{key:"addFeature",value:function(e,t,a){var n=t.get(a);this.featureCache[n]?(this.addFeatureFinish&&this.layer.getVisible()&&(Ie.zoomToExtent(F.a.getBoundsFromFeatures(e.getFeatures())),this.addFeatureFinish=!1),this.featureCache[n].setGeometry(t.getGeometry()),this.featureCache[n].setProperties(t.getProperties()),e.changed()):(e.addFeature(t),this.featureCache[n]=t)}},{key:"setFeatureCache",value:function(e,t){e.forEach((function(e){var a=e.get(t);this.featureCache[a]||(this.featureCache[a]=e)}),this)}},{key:"addPathFeature",value:function(e,t,a){var n=[];this.pathFeature[t]?((n=this.pathFeature[t].getGeometry().getCoordinates()).push(e.getGeometry().getCoordinates()),a&&n.length>a&&n.splice(0,n.length-a),this.pathFeature[t].getGeometry().setCoordinates(n)):(n.push(e.getGeometry().getCoordinates()),this.pathFeature[t]=new ol.Feature({geometry:new ol.geom.LineString(n)}),this.pathLayer.getSource().addFeature(this.pathFeature[t]))}},{key:"addLabelFeature",value:function(e,t){var a=this.labelLayer.getSource();this.labelFeatures[t]?(this.labelFeatures[t].setGeometry(e.getGeometry()),this.labelFeatures[t].setProperties(e.getProperties())):(a.addFeature(e),this.labelFeatures[t]=e)}},{key:"removeFeature",value:function(e,t,a){var n=t.get(a);void 0!==n&&this.featureCache[n]&&(e.removeFeature(this.featureCache[n]),this.featureCache[n]=null),this.pathLayer&&this.pathFeature[n]&&(this.pathLayer.getSource().removeFeature(this.pathFeature[n]),this.pathFeature[n]=null),this.labelLayer&&this.labelFeatures[n]&&(this.labelLayer.getSource().removeFeature(this.labelFeatures[n]),this.labelFeatures[n]=null)}},{key:"filterFeatures",value:function(e,t,a,n){var i,r=this.filterCondition,s="select * from json where ("+F.a.parseFilterCondition(r)+")";try{i=jsonsql.query(s,{attributes:t.get("attributes")})}catch(e){return D.a.showMessage(DataViz.Language.filterErr),this.filterConditionIsRight=!1,!1}i&&i.length>0?(this.addFeature(e,t,a),this.pathLayer&&this.addPathFeature(t,t.get(a),n),this.labelLayer&&this.addLabelFeature(t,t.get(a))):this.removeFeature(e,t,a)}},{key:"setDataType",value:function(e,t){var a=[],n=[];for(var i in t)a.push(i),n.push(t[i]);(!e.enableFields||e.enableFields.length<1)&&(e.enableFields=a),e.dataTypes=O.a.getFieldType(a,n),X.a.dispatch(Object(q.i)(e.id))}},{key:"changeStyle",value:function(e,t,a){var n=this.getStyle(t,a);e&&(e.set("styleOL",n),this.setStyle(e,t.dataflowSetting&&t.dataflowSetting.directionField,t.style||t))}},{key:"getStyle",value:function(e,t){var a,n=e.style||e;return n.symbolInfo&&n.symbolInfo.unicode?a=w.a.toTextOpenlayerStyle(e):n.symbolInfo&&n.symbolInfo.url?(this.svgDiv||(this.svgDiv=document.createElement("div"),document.body.appendChild(this.svgDiv)),w.a.getCanvasFromSVG(n.symbolInfo,this.svgDiv,(function(e){a=new ol.style.Style({image:new ol.style.Icon({img:w.a.setColorToCanvas(e,n),scale:2*n.radius/e.width,imgSize:[e.width,e.height],anchor:[.5,.5],opacity:n.fillOpacity})})}))):a=w.a.toOpenLayersStyle(e.style,t),a}},{key:"setStyle",value:function(e,t,a){var n=e.get("styleOL");e.setStyle((function(e){var i,r;if((i=t&&t!==DataViz.Language.unSetting?e.get("attributes")[t]:0)>360||i<0)return null;r="SYMBOL_POINT"===a.type?n.getText():n.getImage();var s=Math.PI*i/180;return r&&r.setRotation(s),n}))}},{key:"setLabelLayer",value:function(e,t){e&&(t?(e.getSource().clear(),this.labelFeatures={},this.labelLayer=null):this.labelLayer=e)}},{key:"refreshAttribute",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];"filterCondition"===e?(this.filterConditionIsRight=!0,this.filterCondition=t):"labelLayer"===e&&(this.isRefreshLabel=!0)}},{key:"removeCanvas",value:function(e){this.svgDiv&&e&&this.svgDiv.removeChild(e)}}]),e}(),Z=function(){function e(){m()(this,e),this.defaultParameters={themeSetting:{colors:["#0000ff","#00ffff","#00ff00","#ffff00","#ff0000"],weight:null,radius:10,customSettings:{}}},this.fieldMaxValue={},this.featureCache={},this.filterConditionIsRight=!0,this.filterCondition=null}return g()(e,[{key:"getDefaultStyle",value:function(){return window.cloneDeep(this.defaultParameters)}},{key:"createLayer",value:function(e,t,a,n){n&&n.length>0&&this.setFeatureCache(n,t.identifyField);var i=this.createSource(e,t,a,n),r={layerID:t.id,source:i};if(r.gradient=e.themeSetting.colors.slice(),r.radius=parseInt(e.themeSetting.radius),e.themeSetting.customSettings){var s=e.themeSetting.customSettings;for(var o in s)r.gradient[o]=s[o]}return new ol.layer.Heatmap(r)}},{key:"createSource",value:function(e,t,a,n){var i=this;t.token&&SuperMap.SecurityManager.registerToken(t.url,t.token);var r=new ol.source.Vector({features:n,wrapX:!1});return i.filterCondition=e.filterCondition,a.events.on({getFeatureSuccess:function(a){i.filterCondition&&i.filterConditionIsRight?(D.a.closeMessage(),i.filterFeatures(r,a,t.identifyField)):i.addFeature(r,a,t.identifyField),e.themeSetting.weight&&i.changeWeight(r.getFeatures(),e.themeSetting.weight)}}),r}},{key:"addFeature",value:function(e,t,a){var n=t.get(a);void 0!==n&&this.featureCache[n]?(this.featureCache[n].setGeometry(t.getGeometry()),this.featureCache[n].setProperties(t.getProperties()),e.changed()):(e.addFeature(t),this.featureCache[n]=t)}},{key:"setFeatureCache",value:function(e,t){e.forEach((function(e){var a=e.get(t);this.featureCache[a]||(this.featureCache[a]=e)}),this)}},{key:"removeFeature",value:function(e,t,a){var n=t.get(a);void 0!==n&&this.featureCache[n]&&(e.removeFeature(this.featureCache[n]),this.featureCache[n]=null)}},{key:"filterFeatures",value:function(e,t,a){var n,i=this.filterCondition,r="select * from json where ("+F.a.parseFilterCondition(i)+")";try{n=jsonsql.query(r,{attributes:t.get("attributes")})}catch(e){return D.a.showMessage(DataViz.Language.filterErr),this.filterConditionIsRight=!1,!1}n&&n.length>0?this.addFeature(e,t,a):this.removeFeature(e,t,a)}},{key:"regainDefaultStyle",value:function(e,t,a){this.changeColos(t.themeSetting.colors,e),this.changeRadius(t.themeSetting.radius,e),this.changeWeight(a,t.themeSetting.weight);var n=e.getSource();n.clear(!0),n.addFeatures(a)}},{key:"changeStyle",value:function(e,t,a,n,i,r,s){var o=e.getSource();"colors"===r?(t.themeSetting.customSettings={},this.changeColos(s,e)):"themeField"===r?(o=this.createSource(i,t,n),e.setSource(o)):"radius"===r?s>=0&&this.changeRadius(s,e):"weight"===r?(this.getMaxValue(i,s),this.changeWeight(i,s,e)):"defaultStyle"===r?(t.themeSetting.customSettings={},this.regainDefaultStyle(e,t,i)):"defaultCustom"===r?(t.themeSetting.customSettings={},this.changeColos(t.themeSetting.colors,e)):(o.style=t.style?t.style:t,o.changed())}},{key:"changeUserDefinedAttr",value:function(e,t,a){var n=a.getGradient().concat();n[e]=t,this.changeColos(n,a),a.getSource().changed()}},{key:"changeColos",value:function(e,t){t.setGradient([]),e&&t.setGradient(e)}},{key:"changeRadius",value:function(e,t){e&&t.setRadius(+e)}},{key:"getMaxValue",value:function(e,t){var a,n=[],i=t||this.defaultParameters.weight;e&&0!==e.length&&(e.forEach((function(e){a=e.get("attributes");try{n.push(parseFloat(a[i.trim()]))}catch(e){}})),this.fieldMaxValue[i]=x.getArrayStatistic(n,"Maximum"))}},{key:"changeWeight",value:function(e,t){this.getMaxValue(e,t);var a=this.fieldMaxValue[t];e&&0!==e.length&&e.forEach((function(e){var n=e.get("attributes");try{var i=n[t.trim()];e.set("weight",i/a)}catch(e){}}))}},{key:"refreshAttribute",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];"filterCondition"===e&&(this.filterConditionIsRight=!0,this.filterCondition=t)}}]),e}(),Q=a(125),$={defaultParameters:{style:{radius:6,strokeWidth:1,strokeColor:"#ffffff",strokeOpacity:1,fillOpacity:.9,fillColor:"#24B391",offsetX:0,offsetY:0,symbolOffset:{offsetX:0,offsetY:0},svgOffset:{offsetX:.5,offsetY:.5},imageOffset:{offsetX:.5,offsetY:.5},type:"BASIC_POINT"},themeSetting:{themeField:null,segmentCount:6,segmentMethod:"offset",minRadius:6,maxRadius:12,customSettings:{},colorType:"fillColor",colors:Q.b[0]}},getDefaultStyle:function(){return window.cloneDeep(this.defaultParameters)},createLayer:function(e,t,a,n,i,r){var s=this.createSource(t,n,i||e,a),o=new ol.layer.Vector({layerID:r,styleSource:s,source:new ol.source.Vector({features:e,wrapX:!1}),renderMode:"image"});return o.setStyle((function(e){for(var t=o.get("styleSource"),a=t.parameters.themeSetting.themeField,n=Number(e.get("attributes")[a]),i=t.styleGroups,r=0,s=i.length;r<s;r++)if(n>=i[r].start&&n<i[r].end)return t.styleGroups[r].olStyle})),o},changeStyle:function(e,t,a,n,i,r,s){var o=this,l=e.getSource(),c=!1;if(["themeField","segmentMethod","segmentCount","minRadius","maxRadius","defaultStyle","defaultCustom","colorType","fillColor","colors"].includes(r)){if(["minRadius","maxRadius"].includes(r))for(var u in t.themeSetting.customSettings)delete t.themeSetting.customSettings[u].radius;else if(["colorType","fillColor","colors"].includes(r))for(var d in t.themeSetting.customSettings)delete t.themeSetting.customSettings[d].color;else t.themeSetting.customSettings={};var p=this.createSource(t,n,i,a);p?("defaultStyle"===r&&(l.clear(!0),l.addFeatures(i)),e.set("styleSource",p)):c=!0}else{var h=e.get("styleSource"),f=h.parameters,m=window.cloneDeep(f.style);h.styleGroups.forEach((function(e){m.radius=e.radius,m.fillColor=e.fillColor;var t=o.toOpenLayersStyle(m);e.olStyle=t}))}return!c&&l.changed(),c},createSource:function(e,t,a,n){var i=e.themeSetting,r=i.themeField;r||(r=O.a.initThemeField(t,N.c.NUMBER,!0),i.themeField=r);var s=this.getStyleGroup(r,a,n,e);return!!s&&{parameters:e,styleGroups:s}},getStyleGroup:function(e,t,a,n){var i=[],r=[],s=window.cloneDeep(n.style),o=n.themeSetting,l=o.segmentMethod||this.defaultParameters.themeSetting.segmentMethod,c=o.segmentCount||this.defaultParameters.themeSetting.segmentCount,u=o.customSettings,d=n.themeSetting.minRadius,p=n.themeSetting.maxRadius,h=n.themeSetting.colorType,f=s.fillColor,m=n.themeSetting.colors;t.forEach((function(t){var a=t.get("attributes")[e];null!==a&&O.a.isNumber(a)&&i.push(Number(a))}));try{r=x.getArraySegments(i,l,c)}catch(e){}for(var y=0;y<c;y++)if(y in u){var g=u[y].segment.start,v=u[y].segment.end;null!=g&&(r[y]=g),null!=v&&(r[y+1]=v)}var S=[];if(r&&r.length){for(var b,I,E=r.length,T=(p-d)/(E-1),C=Number(((p+d)/2).toFixed(2)),L="colors"===h?B.a.getGradientColors(m,E,"RANGE"):[],N=0;N<E-1;N++){C=(b=Number(r[N].toFixed(2)))===(I=Number(r[N+1].toFixed(2)))?C:d+Math.round(T*N),I=N===E-2?I+.01:I,C=u[N]&&u[N].radius?u[N].radius:C,s.radius=C,s.fillColor=u[N]&&u[N].color?u[N].color:L[N]||f;var k=this.toOpenLayersStyle(s);S.push({olStyle:k,radius:C,start:b,end:I,fillColor:s.fillColor})}return S}return!1},toOpenLayersStyle:function(e){var t,a,n,i=null,r=e.imageInfo,s=e.radius,o=e.fillOpacity,l=e.offsetX,c=e.offsetY,u=e.rotation,d=void 0===u?0:u;if("IMAGE_POINT"===e.type&&r){var p=r.img,h=r.size,f=w.a.getIconAnchor(l,c);t=h.w,a=h.h,n=2*s/t,i=new ol.style.Style({image:new ol.style.Icon({img:p,scale:n,imgSize:[t,a],anchor:f,anchorOrigin:"bottom-right",rotation:d})})}else if("SYMBOL_POINT"===e.type&&e.symbolInfo&&e.symbolInfo.unicode)i=w.a.toTextOpenlayerStyle({style:e});else if("SVG_POINT"===e.type&&e.symbolInfo&&e.symbolInfo.url)this.svgDiv||(this.svgDiv=document.createElement("div"),document.body.appendChild(this.svgDiv)),delete e.symbolInfo.canvas,w.a.getCanvasFromSVG(e.symbolInfo,this.svgDiv,(function(r){t=r.width,a=r.height,n=2*s/t;var u=w.a.getIconAnchor(l,c);i=new ol.style.Style({image:new ol.style.Icon({img:w.a.setColorToCanvas(r,e),scale:n,imgSize:[t,a],opacity:o,anchor:u,anchorOrigin:"bottom-right",rotation:d})})}));else{if(!e.fillColor){var m=this.getDefaultStyle();Object.assign(e,m.style)}i=w.a.toOpenLayersStyle(e,N.p.POINT)}return i},changeRange:function(e,t,a,n){var i=n.get("styleSource").styleGroups;i[e][a]=t,e>0&&"start"===a?i[e-1].end=t:e<i.length-1&&"end"===a&&(i[e+1].start=t),n.getSource().changed()},changeUserDefinedAttr:function(e,t,a,n,i){var r=a.get("styleSource"),s=r.styleGroups,o=window.cloneDeep(r.parameters.style);i="color"===i?"fillColor":i,o.fillColor=s[e].fillColor,o.radius=s[e].radius,o[i]=t;var l=this.toOpenLayersStyle(o);s[e].olStyle=l,s[e][i]=t,a.getSource().changed()},removeCanvas:function(e){this.svgDiv&&e&&this.svgDiv.removeChild(e)}},ee=a(22),te=a(666),ae=a(667),ne={defaultParameters:{from:{type:"XY_FIELD"},to:{type:"XY_FIELD"},lineSetting:{color:"#62AD16",type:"solid",width:1,opacity:.6,curveness:.2},animationSetting:{show:!1,constantSpeed:40,type:"SVG_POINT",symbolInfo:{className:"supermapol-icons-od-pin",name:"pin",unicode:"&#xe6e2"},imageInfo:{url:"./static/imgs/layer_editor/point_imgs_v1/life-7.png"},symbol:"pin",symbolSize:15},labelSetting:{show:!1,color:"#62AD16",fontFamily:DataViz.Language.simHei}},getDefaultStyle:function(){return window.cloneDeep(this.defaultParameters)},createLayer:function(e,t){EChartsLayer.prototype.getContainer||(EChartsLayer.prototype.getContainer=function(){return this.$container}),EChartsLayer.prototype.setVisible||(EChartsLayer.prototype.setVisible=function(e){if(e){var t=this.get("options");t&&(this.setChartOptions(t),this.unset("options"))}else{var a=this.getChartOptions();this.set("options",a),this.clear(),this.setChartOptions({})}}),EChartsLayer.prototype.setZIndex||(EChartsLayer.prototype.setZIndex=function(e){var t=this.getContainer();t&&(t.style.zIndex=e)}),EChartsLayer.prototype.setCursor||(EChartsLayer.prototype.setCursor=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=this.getContainer();t&&"default"===e&&t.classList.add("cursor-default")});var a=this.createLinesData(null,t,e),n=this.createPointsData(a,t,e),i=this.createOptions(t,a,n),r=new EChartsLayer(i,{hideOnMoving:!1,hideOnZooming:!1,forcedPrecomposeRerender:!0});return r.type="ECHARTS",r},changeStyle:function(e,t,a,n,i,r){var s,o,l;["locationMode","xField","yField","field","defaultStyle"].includes(n)?("locationMode"===n&&e.clear(),"defaultStyle"===n&&e.clear(),o=this.createLinesData(null,t,a)):["from","to"].includes(n)&&"labelSetting"===r?(e.clear(),o=this.createLinesData(e,t,a)):((["symbolInfo","imageInfo","type"].includes(n)&&"animationSetting"===r||"show"===n)&&e.clear(),o=this.createLinesData(e,t,a)),l=this.createPointsData(o,t,a),s=this.createOptions(t,o,l),e.setChartOptions(s)},createOptions:function(e,t,a){var n,i=this.createLineSeries(e,t);if(a&&a.length){var r=this.createPointSeries(e,a);n=i.concat(r)}else n=i.slice();return{series:n}},createLineSeries:function(e,t){var a=e.lineSetting,n=e.animationSetting,i=[{name:"line-series",type:"lines",zlevel:1,effect:{show:n.show,constantSpeed:n.constantSpeed,trailLength:0,symbol:n.symbol,symbolSize:n.symbolSize},lineStyle:{normal:{color:a.color,type:a.type,width:a.width,opacity:a.opacity,curveness:a.curveness}},data:t}];return t.length>ee.a.migrationCount&&(i[0].blendMode="lighter"),i},createPointSeries:function(e,t){var a=e.lineSetting,n=e.animationSetting,i=e.labelSetting,r=[{name:"point-series",coordinateSystem:"geo",zlevel:2,label:{normal:{show:i.show,position:"right",formatter:"{b}",color:i.color,fontFamily:i.fontFamily}},itemStyle:{normal:{color:a.color||i.color}},data:t}];return n.show?(r[0].type="effectScatter",r[0].rippleEffect={brushType:"stroke"}):r[0].type="scatter",r},createPointsData:function(e,t,a){var n=[],i=t.labelSetting;if(!i.show||!e.length)return n;var r=[],s=[];return e.forEach((function(e,t){var n=e.coords,o=n[0],l=n[1],c=a[t][i.from],u=a[t][i.to];!r.find((function(e){return e.value[0]===o[0]&&e.value[1]===o[1]}))&&r.push({name:c,value:o}),!s.find((function(e){return e.value[0]===l[0]&&e.value[1]===l[1]}))&&s.push({name:u,value:l})})),n=r.concat(s)},createLinesData:function(e,t,a){var n=[];if(e){var i=e.getChartOptions().series.find((function(e){return"line-series"===e.name}));n=i&&i.data?i.data.slice():this.createLinesData(null,t)}else if(a&&a.length){var r,s,o=t.from,l=t.to;if("XY_FIELD"===o.type&&o.xField&&o.yField&&l.xField&&l.yField)a.forEach((function(e){var t=e[o.xField],a=e[o.yField],i=e[l.xField],c=e[l.yField];t&&a&&i&&c&&(r=[e[o.xField],e[o.yField]],s=[e[l.xField],e[l.yField]],n.push({coords:[r,s]}))}));else if("PLACE_FIELD"===o.type&&o.field&&l.field){var c=te.concat(ae);a.forEach((function(e){var t=e[o.field],a=e[l.field];r=c.find((function(e){return O.a.isMatchAdministrativeName(e.name,t)})),s=c.find((function(e){return O.a.isMatchAdministrativeName(e.name,a)})),r&&s&&n.push({coords:[r.coord,s.coord]})}))}}return n}},ie={getOffsetFromPosition:function(e,t,a){var n=w.a.getLabelOffset(e),i=0,r=0;return"right"===t&&"bottom"===a?(i=-n,r=-n):"center"===t&&"bottom"===a?(i=0,r=-n):"left"===t&&"bottom"===a?(i=n,r=-n):"right"===t&&"middle"===a?(i=-n,r=0):"center"===t&&"middle"===a?(i=0,r=0):"left"===t&&"middle"===a?(i=n,r=0):"right"===t&&"top"===a?(i=-n,r=n):"center"===t&&"top"===a?(i=0,r=n):"left"===t&&"top"===a&&(i=n,r=n),{offsetX:i,offsetY:r}}},re=window.DataViz.Language,se=function(e){function t(e){var a;if(m()(this,t),(a=S()(this,I()(t).call(this,e))).layer=null,a.features=null,a.styleCache=e.styleCache||{VECTOR:null,HEAT:null,RANGE:null,LABEL:null,GRAPHIC:null,UNIQUE:null,RANK_SYMBOL:null,MIGRATION:null},e.layerType===N.r.MIGRATION?a.styleCache[e.layerType]={from:e.from,to:e.to,lineSetting:e.lineSetting,animationSetting:e.animationSetting,labelSetting:e.labelSetting}:a.styleCache[e.layerType]={style:e.style,labelStyle:e.labelStyle,filterCondition:e.filterCondition,themeSetting:e.themeSetting,outlineStyle:e.outlineStyle},a.currentLayerTool=a.getLayerTool(),!a.layerInfo.enableFields&&"MARKER"!==a.layerInfo.layerType){var n=a.layerInfo.dataSource&&a.layerInfo.dataSource.dataTypes||a.layerInfo.dataTypes;n&&(a.layerInfo.enableFields=O.a.filterDatavizFields(Object.keys(n)))}return a}return L()(t,e),g()(t,[{key:"setId",value:function(e){e&&(this.layerInfo.serverId=e)}},{key:"getProjection",value:function(){return this.layerInfo.fileCode||Ie.getBaseLayerProj()}},{key:"getLayerTool",value:function(e){var t;switch(e||this.layerInfo.layerType){case N.r.HEAT_MAP:t=P;break;case N.r.MARKER:t=W.a;break;case N.r.VECTOR:if(this.layerInfo.featureType===N.p.POINT){var a=this.styleCache[this.layerInfo.layerType];t=a&&a.style&&"SYMBOL_POINT"===a.style.type?Y:V}else t=j;break;case N.r.RANGE:t=U;break;case N.r.UNIQUE:t=z;break;case N.r.LABEL:t=H.a;break;case N.r.SYMBOL:t=Y;break;case N.r.RANK_SYMBOL:t=$;break;case N.r.MIGRATION:t=ne;break;default:return!1}return t}},{key:"setVisible",value:function(e){if(T()(I()(t.prototype),"setVisible",this).call(this,e),this.labelLayer)this.labelLayer.setVisible(e);else{var a=this.styleCache[this.layerInfo.layerType];a&&a.labelStyle&&this.changeLabelStyle()}}},{key:"isVectorLayer",value:function(){return!0}},{key:"createLayer",value:function(e){var t=e,a=this.styleCache[this.layerInfo.layerType];if(a&&this.layerInfo.layerType!==N.r.MARKER){this.features||(this.features=e);var n=a.filterCondition;n&&(t=this.getFiterFeatures(n)),a.labelStyle&&this.layerInfo.visible&&this.changeLabelStyle()}(!a&&this.layerInfo.layerType!==N.r.MARKER||!a.style&&this.layerInfo.layerType!==N.r.MARKER)&&(a&&(this.layerInfo.layerType===N.r.HEAT_MAP&&a.themeSetting||this.layerInfo.layerType===N.r.MIGRATION)||(a=this.styleCache[this.layerInfo.layerType]=this.currentLayerTool.getDefaultStyle(this.layerInfo.featureType)));var i=this.layerInfo.dataTypes||this.layerInfo.dataSource&&this.layerInfo.dataSource.dataTypes;this.layerInfo.layerType===N.r.MIGRATION?(this.properties||(this.properties=O.a.getFeatureProperties(e)),this.layer=this.currentLayerTool.createLayer(this.properties,a)):this.layer=this.currentLayerTool.createLayer(t,a,this.layerInfo.featureType,i,this.features,this.layerInfo.id);var r=this.layerInfo.opacity;return this.layerInfo.layerType!==N.r.MIGRATION&&(O.a.isNumber(r)&&this.layer.setOpacity(r),this.setVisibleScale()),this.features||(this.features=e),this.layer.setZIndex(this.layerInfo.zIndex),this.layerInfo.layerType!==N.r.MIGRATION&&this.layer.setVisible(this.layerInfo.visible),this.layer}},{key:"getBounds",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.bounds||e){if(this.bounds&&!e)return this.bounds;var t=this.features||this.layer.getSource().getFeatures();return this.bounds=F.a.getBoundsFromFeatures(t,this.getProjection()),this.bounds}return null}},{key:"changeStyle",value:function(e,t,a){var n=this.styleCache[this.layerInfo.layerType],i=window.cloneDeep(n);if(!n)return!1;var r=!1;if(this.layerInfo.layerType===N.r.MIGRATION){if(this.changeMigrationStyle(n,e,t,a),this.features.length>ee.a.migrationCount&&["labelSetting","animationSetting"].includes(a))return!1;r=this.currentLayerTool.changeStyle(this.layer,n,this.properties,e,t,a)}else this.changeVectorStyle(n,e,t,a),r=this.currentLayerTool.changeStyle(this.layer,n,this.layerInfo.featureType,this.layerInfo.dataTypes,this.features,e,t);r&&(this.styleCache[this.layerInfo.layerType]=i)}},{key:"changeVectorStyle",value:function(e,t,a,n){if("type"===t&&"IMAGE_POINT"===e.style.type){var i=this.currentLayerTool.getDefaultStyle().style||{};e.style=o()({},i,e.style)}var r;if(["offsetX","offsetY","radius","strokeWidth"].includes(t)&&(r=n?e[n][t]:e[t]),"type"===t)"IMAGE_POINT"===a?e.style.imageInfo&&e.style.imageInfo.url?(e.style.offsetX=e.style.imageOffset.offsetX,e.style.offsetY=e.style.imageOffset.offsetY):(e.style.offsetX=e.style.symbolOffset.offsetX,e.style.offsetY=e.style.symbolOffset.offsetY):"SVG_POINT"===a&&(e.style.symbolInfo&&e.style.symbolInfo.url?(e.style.offsetX=e.style.svgOffset.offsetX,e.style.offsetY=e.style.svgOffset.offsetY):(e.style.offsetX=e.style.symbolOffset.offsetX,e.style.offsetY=e.style.symbolOffset.offsetY));else if(["offsetX","offsetY"].includes(t)){var s=e.style.type;"BASIC_POINT"===s||"SYMBOL_POINT"===s?e.style.symbolOffset[t]=a:"SVG_POINT"===s?e.style.symbolInfo&&e.style.symbolInfo.url?e.style.svgOffset[t]=a:e.style.symbolOffset[t]=a:"IMAGE_POINT"===s&&(e.style.imageInfo&&e.style.imageInfo.url?e.style.imageOffset[t]=a:e.style.symbolOffset[t]=a)}else["symbolInfo","imageInfo"].includes(t)&&("symbolInfo"===t?a.url?(e.style.offsetX=e.style.svgOffset.offsetX,e.style.offsetY=e.style.svgOffset.offsetY):(e.style.offsetX=e.style.symbolOffset.offsetX,e.style.offsetY=e.style.symbolOffset.offsetY):"imageInfo"===t&&(e.style.offsetX=e.style.imageOffset.offsetX,e.style.offsetY=e.style.imageOffset.offsetY));if("roadPath"!==a||e.outlineStyle||(e.style.strokeColor="#FFCE10",e.outlineStyle=this.currentLayerTool.getOutlineStyle()),"pathway"!==a||e.outlineStyle)n?e[n][t]=a:e[t]=a;else{var l=this.currentLayerTool.getPathwayStyle();(e=Object.assign(e,l)).style[t]=a}if(this.layerInfo.layerType!==N.r.RANK_SYMBOL&&this.layerInfo.layerType!==N.r.UNIQUE){if("IMAGE_POINT"===a||"imageInfo"===t){var c=N.r.VECTOR;c!==this.layerInfo.layerType&&(e.style.type="IMAGE_POINT",this.styleCache[c]=e,this.changeLayerType(c))}else if("SVG_POINT"===a||"symbolInfo"===t){var u=N.r.SYMBOL;e.style.type="SYMBOL_POINT",e.style.symbolInfo&&!e.style.symbolInfo.url||(e.style.type="SVG_POINT",u=N.r.VECTOR),u!==this.layerInfo.layerType&&(this.styleCache[u]=e,this.changeLayerType(u))}}else"SVG_POINT"===a||"symbolInfo"===t?e.style.type=!e.style.symbolInfo||e.style.symbolInfo.url?"SVG_POINT":"SYMBOL_POINT":"colorType"!==t||"colors"!==a||e.themeSetting.colors||(e.themeSetting.colors=Q.b[0]);if(this.layerInfo.layerType!==N.r.HEAT_MAP&&this.labelLayer&&this.layerInfo.layerType!==N.r.GRAPHIC){var d=e,p=d.style,h=d.labelStyle;if(!h)return;var f=h.offsetX,m=h.offsetY;if("radius"===t||"strokeWidth"===t){var y=a-r;f>0?f+=y:f<0&&(f-=y),h.offsetX=f,this.changeLabelStyle("offsetX",f),m>0?m+=y:m<0&&(m-=y),h.offsetY=m,this.changeLabelStyle("offsetY",m)}else if("offsetX"===t){var g=w.a.getPointOffsetValue(p,r).x;f+=w.a.getPointOffsetValue(p,a).x-g,h.offsetX=f,this.changeLabelStyle("offsetX",f)}else if("offsetY"===t){var v=w.a.getPointOffsetValue(p,0,r).y;m+=w.a.getPointOffsetValue(p,0,a).y-v,h.offsetY=m,this.changeLabelStyle("offsetY",m)}else if("type"===t){var S=ie.getOffsetFromPosition(p,h.textAlign,h.textBaseline),b={offsetX:S.offsetX,offsetY:S.offsetY,textAlign:h.textAlign,textBaseline:h.textBaseline};this.changeLabelStyle("offset",b)}}}},{key:"changeMigrationStyle",value:function(e,t,a,n){if("locationMode"===t)e.from.type=a,e.to.type=a;else if("type"===t&&"animationSetting"===n){var i;if(e.animationSetting[t]=a,"IMAGE_POINT"===a){var r=e.animationSetting.imageInfo||this.currentLayerTool.getDefaultStyle().animationSetting.imageInfo;i="image://".concat(r.url)}else{var s=e.animationSetting.symbolInfo||this.currentLayerTool.getDefaultStyle().animationSetting.symbolInfo;i=s.url?"image://".concat(s.url):s.name}e.animationSetting.symbol=i}else["symbolInfo","imageInfo"].includes(t)?(e.animationSetting[t]=a,e.animationSetting.symbol=a.url?"image://".concat(a.url,"?t=").concat((new Date).getTime()):a.name):["from","to"].includes(t)&&"labelSetting"===n?(a===re.unSetting?delete e.labelSetting[t]:e.labelSetting[t]=a,e.labelSetting.show=!(!e.labelSetting.from&&!e.labelSetting.to)):n?e[n][t]=a:e[t]=a}},{key:"changeFilterCondition",value:function(e){var t=this.styleCache[this.layerInfo.layerType];if(t&&t.filterCondition!==e){var a=this.getFiterFeatures(e);if(a){if(t.filterCondition=e,"GraphicLayer"===this.currentLayerTool.type?this.currentLayerTool.updateGraphics(this.layer,a,t):("HEAT"===this.layerInfo.layerType&&this.currentLayerTool.changeWeight(a,t.themeSetting.weight),this.updateLayerFeaures(this.layer,a)),this.updateLayerFeaures(this.labelLayer,a),""===e||Ie.getOnlySelectedFeatureLayerId()!==this.layerInfo.id)return;this.getFiterFeatures(e,[Ie.getOnlySelectedFeature()]).length>0||Ie.closeThemePop()}}}},{key:"updateLayerFeaures",value:function(e,t,a){if(!e||!t)return!1;var n=e.getSource();n.clear(a),n.addFeatures(t)}},{key:"getFiterFeatures",value:function(e,t){for(var a="select * from json where ("+F.a.parseFilterCondition(e)+")",n=[],i=t||this.features,r=0;r<i.length;r++){var s=i[r],o=!1;try{o=jsonsql.query(a,{attributes:s.get("attributes")})}catch(e){return D.a.showMessage(re.filterErr),!1}o&&o.length>0&&n.push(s)}return n}},{key:"changeLabelStyle",value:function(e,t){var a=this.styleCache[this.layerInfo.layerType],n=a.style;if(this.labelLayer){if(a.labelStyle||(a.labelStyle=this.labelManager.getDefaultStyle(this.layerInfo.featureType)),this.getInitLabelOffset(a,this.layerInfo.featureType),"offset"===e){var i=w.a.getPointOffsetValue(n,n.offsetX,n.offsetY);n.type===N.k.IMAGE_POINT&&.5===n.offsetX&&.5===n.offsetY?(a.labelStyle.offsetX=t.offsetX,a.labelStyle.offsetY=t.offsetY):(a.labelStyle.offsetX=i.x+t.offsetX,a.labelStyle.offsetY=i.y+t.offsetY),a.labelStyle.textAlign=t.textAlign,a.labelStyle.textBaseline=t.textBaseline}else a.labelStyle[e]=t;"labelField"===e&&this.labelLayer.set("labelField",t);var r=this.labelManager.toOpenLayersStyle(a.labelStyle);this.labelLayer.set("styleOL",r),this.labelLayer.getSource().changed()}else{this.labelManager=this.getLayerTool(N.r.LABEL),a.labelStyle||(a.labelStyle=this.labelManager.getDefaultStyle(this.layerInfo.featureType)),this.getInitLabelOffset(a,this.layerInfo.featureType),e&&t&&(a.labelStyle[e]=t),this.layerInfo.layerType===N.r.RANK_SYMBOL?this.labelLayer=this.labelManager.createLayer(this.getFeatures(),a.labelStyle,this.layerInfo.featureType,a.style):this.labelLayer=this.labelManager.createLayer(this.getFeatures(),a.labelStyle,this.layerInfo.featureType);var s=this.layerInfo.visibleScale;s&&F.a.setVisibleScales(this.labelLayer,s),this.labelLayer.setZIndex(1e4),Ie.map.addLayer(this.labelLayer)}}},{key:"getInitLabelOffset",value:function(e){var t,a=e.labelStyle,n=e.style,i=a.offsetY,r=a.offsetX;t=n.type===N.k.IMAGE_POINT&&.5===n.offsetX&&.5===n.offsetY?{x:0,y:0}:w.a.getPointOffsetValue(n,n.offsetX,n.offsetY),void 0===i&&(e.labelStyle.offsetY=(-w.a.getLabelOffset(n)||0)+t.y),void 0===r&&(e.labelStyle.offsetX=t.x)}},{key:"updateLabelStyle",value:function(e){var t=this.styleCache[this.layerInfo.layerType];if(t&&t.filterCondition){var a=this.getFiterFeatures(t.filterCondition);this.updateLayerFeaures(this.labelLayer,a,!0)}else this.labelLayer&&this.features&&this.labelLayer.getSource().getFeatures().length!==this.features.length&&this.updateLayerFeaures(this.labelLayer,this.features,!0);if(!this.labelLayer)return!1;var n=e;n||(n=this.labelManager.getDefaultStyle(this.layerInfo.featureType));var i=this.labelManager.toOpenLayersStyle(n);this.labelLayer.set("labelField",n.labelField),this.labelLayer.set("styleOL",i),this.labelLayer.getSource().changed()}},{key:"changeUserDefinedAttr",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"color",n=this.styleCache[this.layerInfo.layerType].themeSetting.customSettings;this.layerInfo.layerType===N.r.UNIQUE?n[e]=t:this.layerInfo.layerType===N.r.HEAT_MAP?n[e]=t:[N.r.RANGE,N.r.RANK_SYMBOL].includes(this.layerInfo.layerType)&&(e in n?n[e][a]=t:n[e]=this.setStyleCaches(t,null,null,a)),this.currentLayerTool.changeUserDefinedAttr(e,t,this.layer,this.layerInfo.featureType,a)}},{key:"changeRange",value:function(e,t,a){var n=this.styleCache[this.layerInfo.layerType],i=n.themeSetting.customSettings;"start"===a?(e in i?i[e].segment.start=t:i[e]=this.setStyleCaches(null,t,null),e>0&&(e-1 in i?i[e-1].segment.end=t:i[e-1]=this.setStyleCaches(null,null,t))):(e in i?i[e].segment.end=t:i[e]=this.setStyleCaches(null,null,t),e<n.segmentCount-1&&(e+1 in i?i[e+1].segment.start=t:i[e+1]=this.setStyleCaches(null,t,null))),this.currentLayerTool.changeRange(e,t,a,this.layer)}},{key:"setStyleCaches",value:function(e,t,a){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"color";return n={},h()(n,i,e||null),h()(n,"segment",{start:null!==t?t:null,end:null!==a?a:null}),n}},{key:"getStyleParameters",value:function(){var e=this.styleCache[this.layerInfo.layerType];return e||this.currentLayerTool||(e=this.currentLayerTool.getDefaultStyle(this.layerInfo.featureType)),e}},{key:"regainDefaultStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=null,a="";if(e?(a="defaultCustom",t=this.styleCache[this.layerInfo.layerType]):(a="defaultStyle",t=this.styleCache[this.layerInfo.layerType]=this.currentLayerTool.getDefaultStyle(this.layerInfo.featureType),this.layerInfo.layerType===N.r.SYMBOL?((t=this.styleCache[N.r.VECTOR]=this.currentLayerTool.getDefaultStyle(N.r.VECTOR)).style.type="BASIC_POINT",this.updateLabelStyle(t.labelStyle),this.styleCache[this.layerInfo.layerType]=null,this.changeLayerType(N.r.VECTOR),delete this.styleCache[N.r.VECTOR].style.symbol):this.updateLabelStyle(t.labelStyle)),this.layerInfo.layerType===N.r.MIGRATION)this.currentLayerTool.changeStyle(this.layer,t,this.properties,a);else{var n=this.layerInfo.dataTypes||this.layerInfo.dataSource&&this.layerInfo.dataSource.dataTypes;this.currentLayerTool.changeStyle(this.layer,t,this.layerInfo.featureType,n,this.features,a)}}},{key:"changeLayerType",value:function(e){var t=this.styleCache[N.r.VECTOR],a=this.styleCache[N.r.SYMBOL];e===N.r.VECTOR&&(t&&"SVG_POINT"===t.style.type&&t.style.symbolInfo&&!t.style.symbolInfo.url||!t&&a||t&&t.style.type===N.k.SYMBOL_POINT)?e=N.r.SYMBOL:[N.r.MIGRATION,N.r.HEAT_MAP].includes(e)&&this.layerInfo.id===Ie.getOnlySelectedFeatureLayerId()&&Ie.closeThemePop(),this.layerInfo.layerType===N.r.MIGRATION?this.layer.remove&&this.layer.remove():Ie.map.removeLayer(this.layer),this.layerInfo.layerType=e,this.currentLayerTool=this.getLayerTool(e);var n=e===N.r.SYMBOL?N.r.VECTOR:e,i=this.styleCache[n];this.updateLabelStyle(i&&i.labelStyle);var r=this.getFeatures(),s=this.createLayer(r);this.layerInfo.layerType===N.r.MIGRATION?(s.appendTo(Ie.map),s.setZIndex(this.layerInfo.zIndex),s.setCursor()):Ie.map.addLayer(s)}},{key:"getFeatures",value:function(){var e=this.features,t=this.styleCache[this.layerInfo.layerType];return t&&t.filterCondition&&(e=this.getFiterFeatures(t.filterCondition)),e}},{key:"addFeature",value:function(e,t){var a=this.layer.getSource(),n=N.e[t.toUpperCase()],i=n===N.p.POINT?"MARKER":n,r=this.currentLayerTool.getDefaultStyle(i),s=A.a.getLayerStyle(this.layerInfo.id,e.getGeometry().getType().toUpperCase());s&&"TEXT"!==i&&(r=s);var o=this.currentLayerTool.getDefaultAttribute(),l=this.getMaxFeatureIdx();e.setProperties({useStyle:r,attributes:o,index:l}),e.layerId=this.layerInfo.id,e.setStyle(w.a.toOpenLayersStyle(r,n)),a.addFeature(e),this.features||(this.features=[]),this.features.push(e)}},{key:"getMaxFeatureIdx",value:function(){var e=this.layer.getSource().getFeatures(),t=-1;return e.forEach((function(e){var a=e.getProperties().index;void 0!==a&&O.a.isNumber(a)&&a>t&&(t=a)})),t+1}},{key:"removeFeature",value:function(e,t){this.layer.getSource().removeFeature(e),t?this.features.splice(t,1):this.features.forEach((function(t,a){t===e&&this.features.splice(a,1)}),this)}},{key:"removeLayer",value:function(){this.layerInfo.layerType===N.r.MIGRATION?this.layer.remove():Ie.map.removeLayer(this.layer),this.labelLayer&&Ie.map.removeLayer(this.labelLayer),this.layerInfo.style&&this.layerInfo.style.symbolInfo&&this.layerInfo.style.symbolInfo.canvas&&this.currentLayerTool.removeCanvas&&this.currentLayerTool.removeCanvas(this.layerInfo.style.symbolInfo.canvas)}},{key:"getExtent",value:function(e){var t=this.getBounds();return!e||t.includes(1/0)||t.includes(-1/0)||(t=ol.proj.transformExtent(t,Ie.getBaseLayerProj(),e)),t&&t.includes(NaN)?null:t}},{key:"updateLayerFromEdit",value:function(e,t){var a=this.layerInfo,n=this.layer;if(![N.r.VECTOR,N.r.GRAPHIC,N.r.SYMBOL].includes(a.layerType)){var i=e.fieldName,r=e.fieldValue;if(i&&r){var s=a.layerType,o=this.styleCache[s].themeSetting;if(o.themeField===i||o.weight===i){var l=n.get("styleSource");if(a.layerType===N.r.UNIQUE)l.styleGroups.find((function(e){return e.value===r}))||(this.changeLayerType(N.r.VECTOR),t&&t());else if(a.layerType===N.r.RANGE||a.layerType===N.r.RANK_SYMBOL){for(var c=l.styleGroups,u=!0,d=0;d<c.length;d++)if(0===d){if(r>=c[d].start&&r<=c[d].end){u=!1;break}}else if(r>c[d].start&&r<=c[d].end){u=!1;break}u&&(this.changeLayerType(N.r.VECTOR),t&&t())}else a.layerType===N.r.HEAT_MAP&&this.currentLayerTool.changeWeight(this.features,o.weight)}}}}}]),t}(k.a),oe=["getFeatureSuccess","getFeatureFaild"],le=new ol.format.GeoJSON,ce=function(){function e(t){m()(this,e),this.features={},this.allFeatures={},this.allFeatureArray=[],this._createService(t.layerParams),this.events=new SuperMap.Events(this,null,oe,!0)}return g()(e,[{key:"_createService",value:function(e){var t=this;e.token&&SuperMap.SecurityManager.registerToken(e.wsUrl,e.token);var a=this.dataflowService=new ol.supermap.DataFlowService(e.wsUrl).initSubscribe(),n=!0;a.on("messageSucceeded",(function(a){n&&(D.a.showMessage(DataViz.Language.getDataflowSuccess,N.j.SUCCESS,3e3),n=!1);var i=JSON.parse(a.value.data),r=le.readFeature(i,{dataProjection:e.projection,featureProjection:Ie.getBaseLayerProj()||"EPSG:4326"});r.setProperties({attributes:i.properties}),t._collectionFeatures(r,e.identifyField,i.properties),t.events.triggerEvent("getFeatureSuccess",r)})),a.on("subscribeSocketError",(function(){D.a.showMessage(DataViz.Language.getDataflowFaild)}))}},{key:"_collectionFeatures",value:function(e,t,a){var n=e.get(t);this.allFeatures[n]?(this.allFeatures[n].setGeometry(e.getGeometry()),this.allFeatures[n].setProperties(e.getProperties())):(e.setProperties({attributes:a}),this.allFeatureArray.push(e),this.allFeatures[n]=e)}},{key:"getAllFeatures",value:function(){return this.allFeatureArray}},{key:"removeDataflowService",value:function(){try{this.dataflowService.unSubscribe(),this.dataflowService=null,this.events.remove("getFeatureSuccess")}catch(e){}}}]),e}(),ue=window.DataViz.Language,de=function(e){function t(e){var a;return m()(this,t),(a=S()(this,I()(t).call(this,e))).layer=null,a.styleCache=e.styleCache||{DATAFLOW_POINT_TRACK:null,DATAFLOW_HEAT:null},a.styleCache[e.layerType]={style:e.style,labelStyle:e.labelStyle,filterCondition:e.filterCondition,dataflowSetting:e.dataflowSetting||{},themeSetting:e.themeSetting},a.createLayerTools(),a.currentLayerTool=a.getLayerTool(),a}return L()(t,e),g()(t,[{key:"setVisible",value:function(e){if(T()(I()(t.prototype),"setVisible",this).call(this,e),this.labelLayer&&this.labelLayer.setVisible(e),this.pathLayer)this.pathLayer.setVisible(e);else{var a=this.styleCache[this.layerInfo.layerType];a&&a.labelStyle&&this.changeLabelStyle("changeVisible",e)}}},{key:"createLayerTools",value:function(){this.dataflowVector=new J,this.dataflowHeat=new Z}},{key:"getLayerTool",value:function(e){var t;switch(e||this.layerInfo.layerType){case N.r.DATAFLOW:t=this.dataflowVector;break;case N.r.DATAFLOWHEAT:t=this.dataflowHeat;break;case N.r.LABEL:t=H.a;break;default:return!1}return t}},{key:"createLayer",value:function(e){var t=e,a=this.styleCache[this.layerInfo.layerType];if(a){var n=a.filterCondition;n&&this.dataflowService&&(t=this.getFiterFeatures(this.dataflowService.getAllFeatures(),n)),a.labelStyle&&a.labelStyle.labelField!==DataViz.Language.unSetting&&this.layerInfo.visible&&!this.labelLayer&&this.changeLabelStyle(),a.dataflowSetting&&a.dataflowSetting.pathStyle&&this.changePathStyle("pathVisible",!0)}return a&&(a.style||a.themeSetting)||(a=this.styleCache[this.layerInfo.layerType]=this.currentLayerTool.getDefaultStyle(this.layerInfo.featureType)),this.dataflowService||(this.dataflowService=new ce({layerParams:this.layerInfo})),this.layer=this.currentLayerTool.createLayer(a,this.layerInfo,this.dataflowService,t),this.layer.setOpacity(this.layerInfo.opacity||1),this.layer.setZIndex(this.layerInfo.zIndex),this.layer.setVisible(this.layerInfo.visible),this.setVisibleScale(),this.layer}},{key:"changeStyle",value:function(e,t,a){var n=this.styleCache[this.layerInfo.layerType],i=window.cloneDeep(n);if(!n)return!1;if(a?n[a][e]=t:n[e]=t,this.layerInfo.layerType===N.r.DATAFLOW&&(n.style.symbolInfo?n.style.type=n.style.symbolInfo&&n.style.symbolInfo.url?"SVG_POINT":"SYMBOL_POINT":n.style.type="BASIC_POINT",this.labelLayer&&("radius"===e||"strokeWidth"===e))){var r=-1.8*(n.style&&n.style.radius||0)-(n.style&&n.style.strokeWidth||0);r>-20&&(r=-20),this.layerInfo.layerType!==N.r.GRAPHIC&&this.changeLabelStyle("offsetY",r)}this.currentLayerTool.changeStyle(this.layer,n,this.layerInfo.featureType,this.layerInfo.dataTypes,this.getFeatures(),e,t)&&(this.styleCache[this.layerInfo.layerType]=i)}},{key:"changeFilterCondition",value:function(e){var t=this.styleCache[this.layerInfo.layerType];if(t&&t.filterCondition!==e&&(""!==e&&D.a.showMessage(DataViz.Language.setFilterCondition,N.j.SUCCESS,3e3),t.filterCondition=e,this.currentLayerTool.refreshAttribute("filterCondition",e),this.labelLayer&&this.layerInfo.layerType===N.r.DATAFLOW&&this.currentLayerTool.refreshAttribute("labelLayer"),""!==e&&Ie.getOnlySelectedFeatureLayerId()===this.layerInfo.id)){var a=this.layerInfo.identifyField,n=Ie.getOnlySelectedFeature();this.getFeatures().some((function(e){return e.get(a)===n.get(a)}))||Ie.closeThemePop()}}},{key:"changeLabelStyle",value:function(e,t){var a=this.styleCache[this.layerInfo.layerType];if(this.labelManager||(this.labelManager=this.getLayerTool(N.r.LABEL)),a.labelStyle=a.labelStyle||this.labelManager.getDefaultStyle(this.layerInfo.featureType),e&&(a.labelStyle[e]=t),this.labelLayer){var n=!t||t===ue.unSetting;this.currentLayerTool.setLabelLayer(this.labelLayer,n),"labelField"===e&&this.labelLayer.set("labelField",t);var i=this.labelManager.toOpenLayersStyle(a.labelStyle);this.labelLayer.set("styleOL",i),this.labelLayer.getSource().changed()}else{var r=-1.8*(a.style.radius||0)-(a.style.strokeWidth||0);r>-20&&(r=-20),a.labelStyle.offsetY=r,this.labelLayer=this.labelManager.createLayer(this.getFeatures(),a.labelStyle,this.layerInfo.featureType),this.labelLayer.setZIndex(1e4),this.currentLayerTool.setLabelLayer(this.labelLayer),Ie.map.addLayer(this.labelLayer)}}},{key:"updateLabelStyle",value:function(e){var t=this.styleCache[this.layerInfo.layerType];if(this.layerInfo.layerType===N.r.DATAFLOW&&(this.currentLayerTool.setLabelLayer(this.labelLayer),t&&t.filterCondition&&this.currentLayerTool.refreshAttribute("labelLayer")),!this.labelLayer)return!1;var a=e;a||(a=this.labelManager.getDefaultStyle(this.layerInfo.featureType));var n=this.labelManager.toOpenLayersStyle(a);this.labelLayer.set("labelField",a.labelField),this.labelLayer.set("styleOL",n),this.labelLayer.getSource().changed()}},{key:"changePathStyle",value:function(e,t){if(this.layerInfo.layerType===N.r.DATAFLOW){var a=this.styleCache[this.layerInfo.layerType];a.dataflowSetting||(a.dataflowSetting={}),a.dataflowSetting.pathStyle&&a.dataflowSetting.pathStyle.strokeColor||(a.dataflowSetting.pathStyle=this.currentLayerTool.getPathDefaultStyle()),!this.pathLayer&&"pathVisible"===e&&t?(this.pathLayer=this.currentLayerTool.createPathLayer(a.dataflowSetting.pathStyle),this.pathLayer.setVisible(this.layerInfo.visible),Ie.map.addLayer(this.pathLayer)):"pathVisible"!==e||t?(a.dataflowSetting.pathStyle[e]=t,this.pathLayer&&(this.pathLayer.setStyle(w.a.toOpenLayersStyle(a.dataflowSetting.pathStyle,N.p.LINE)),this.pathLayer.getSource().changed())):(Ie.map.removeLayer(this.pathLayer),this.currentLayerTool.removePathLayer(),this.pathLayer=null,a.dataflowSetting.pathStyle={})}}},{key:"updatePathStyle",value:function(){if(this.layerInfo.layerType===N.r.DATAFLOW){var e=this.styleCache[this.layerInfo.layerType];e.dataflowSetting&&e.dataflowSetting.pathStyle&&(this.pathLayer||(this.pathLayer=this.currentLayerTool.createPathLayer(e.dataflowSetting.pathStyle),this.pathLayer.setZIndex(9999),Ie.map.addLayer(this.pathLayer)),this.pathLayer.setStyle(w.a.toOpenLayersStyle(e.dataflowSetting.pathStyle,N.p.LINE)))}else this.pathLayer.setStyle(null)}},{key:"changeDirection",value:function(e,t){if(this.layerInfo.layerType===N.r.DATAFLOW){var a=this.styleCache[this.layerInfo.layerType];a.dataflowSetting||(a.dataflowSetting={}),a.dataflowSetting.directionField=t,this.currentLayerTool.changeDirection(a.dataflowSetting.directionField,a.style)}}},{key:"regainDefaultStyle",value:function(){var e;e=this.styleCache[this.layerInfo.layerType]=this.currentLayerTool.getDefaultStyle(this.layerInfo.featureType),this.currentLayerTool.refreshAttribute("filterCondition",!1),this.layerInfo.layerType===N.r.DATAFLOW?(this.changePathStyle("pathVisible"),this.changeDirection("directionField"),this.currentLayerTool.setLabelLayer(this.labelLayer,!0),this.currentLayerTool.changeStyle(this.layer,e,this.layerInfo.featureType)):this.currentLayerTool.regainDefaultStyle(this.layer,e,this.getFeatures())}},{key:"changeLayerType",value:function(e){this.layerInfo.layerType=e,this.currentLayerTool=this.getLayerTool(e),Ie.map.removeLayer(this.layer),this.dataflowService&&this.dataflowService.events.remove("getFeatureSuccess"),e===N.r.DATAFLOWHEAT&&this.layerInfo.id===Ie.getOnlySelectedFeatureLayerId()&&Ie.closeThemePop();var t=this.styleCache[e];this.labelLayer&&this.updateLabelStyle(t&&t.labelStyle),this.pathLayer&&this.updatePathStyle();var a=this.getFeatures(),n=this.createLayer(a);Ie.map.addLayer(n)}},{key:"getFeatures",value:function(){if(this.dataflowService){var e=this.dataflowService.getAllFeatures(),t=this.styleCache[this.layerInfo.layerType];return t&&t.filterCondition&&(e=this.getFiterFeatures(e,t.filterCondition)),e}}},{key:"getFiterFeatures",value:function(e,t){for(var a=[],n="select * from json where ("+F.a.parseFilterCondition(t)+")",i=0;i<e.length;i++){var r=e[i],s=!1;try{s=jsonsql.query(n,{attributes:r.get("attributes")})}catch(e){return D.a.showMessage(ue.filterErr),!1}s&&s.length>0&&a.push(r)}return a}},{key:"removeLayer",value:function(){Ie.map.removeLayer(this.layer),this.labelLayer&&Ie.map.removeLayer(this.labelLayer),this.pathLayer&&Ie.map.removeLayer(this.pathLayer),F.a.isDataflowLayer(this.layerInfo.layerType)&&this.dataflowService&&(this.dataflowService.removeDataflowService(),this.dataflowService=null),this.layerInfo.style&&this.layerInfo.style.symbolInfo&&this.layerInfo.style.symbolInfo.canvas&&this.currentLayerTool.removeCanvas(this.layerInfo.style.symbolInfo.canvas)}}]),t}(se),pe=a(247),he=a(63),fe=a(241),me=a(105),ye=a(188),ge=a(41),ve=a(242),Se=a(52),be={epsgcodes:{},map:null,mapTitle:DataViz.Language.lackOfTitle,searchSetting:[],vectorLayers:[],markerLayers:[],tileLayers:[],selectedLayerId:null,selectedFeature:null,highLightLayer:null,selectedTileLayers:[],overviewMapControl:null,mousePositionControl:null,copyrightControl:null,description:"",unOpenDataBox:null,showMarkerPopupAction:null,viewType:"level",graticuleLayer:null,scales:null,resolutions:null,resolutionArray:null,onPopClose:null,minScale:"",maxScale:"",setMinScale:function(e){this.minScale=e,this.scales.includes(this.minScale)||(this.minScale=this.findNearest(this.scales,this.minScale))},setMaxScale:function(e){this.maxScale=e,this.scales.includes(this.maxScale)||(this.maxScale=this.findNearest(this.scales,this.maxScale))},setMaxZoom:function(e){if(-1!==e){var t=this.map.getView(),a=!this.isSetMinMaxResolution();this.map.setView(new ol.View(Object.assign({},t.options_,{maxResolution:void 0,minResolution:void 0,constrainResolution:a,maxZoom:e})))}},setMinZoom:function(e){if(-1!==e){var t=this.map.getView(),a=!this.isSetMinMaxResolution();this.map.setView(new ol.View(Object.assign({},t.options_,{maxResolution:void 0,minResolution:void 0,constrainResolution:a,minZoom:e})))}},getMaxZoom:function(){return this.map.getView().getMaxZoom()},getMinZoom:function(){return this.map.getView().getMinZoom()},isSetMinMaxResolution:function(){if(this.scales&&this.scales.length){var e=this.scales.indexOf(this.maxScale),t=this.scales.indexOf(this.minScale);if(-1!==e&&0!==e)return!0;if(-1!==t&&t!==this.scales.length-1)return!0}return!1},createMapContainer:function(e,t,a){if(this.hideMarkerPopup=a,!e)throw new Error("No Element to init map");this.map=new ol.Map({overlays:[new ol.Overlay({offset:[0,-20],id:"theme-pop",positioning:"bottom-center"}),new ol.Overlay({offset:[0,-45],id:"poi-pop",positioning:"bottom-center"}),new ol.Overlay({offset:[0,-15],id:"tile-pop",positioning:"bottom-center"})],controls:ol.control.defaults({attributionOptions:{collapsed:!1},rotate:!1,zoomOptions:{className:"supermap-zoom",zoomInTipLabel:DataViz.Language.zoomIn,zoomOutTipLabel:DataViz.Language.zoomOut},zoom:!0,attribution:!1,interactions:ol.interaction.defaults({mouseWheelZoom:!1})}),target:e}),this.map.addInteraction(new ol.interaction.MouseWheelZoom({constrainResolution:!0})),this.addTempLayer(),this.registerMapEvent(t)},addProjection:function(e,t){return new Promise((function(a,n){if("EPSG:0"===e)n({type:"Not support CS",info:"Not support CS ".concat(e)});else if("string"==typeof e)if("EPSG:4326"===e||"EPSG:3857"===e||ol.proj.get(e))a(!0);else if(0!==e.indexOf("EPSG:"))a(be.addProjectionFromWKT(e));else{var i=O.a.isCustomProjection(e)&&t?O.a.getUrl("".concat(t,"/prjCoordSys.wkt")):"".concat(O.a.getIPortalUrl(),"epsgcodes/").concat(e.split(":")[1],".json");O.a.doFetch(i,{method:"GET",dataType:O.a.isCustomProjection(e)?"text":"JSON"}).then((function(t){O.a.isString(t)&&-1===t.indexOf("<!doctype html>")||O.a.isObject(t)?a(be.addProjectionFromWKT(t.wkt||t,O.a.isCustomProjection(e)?e:null)):n({type:"Not support CS",info:"Not support CS ".concat(e)})})).catch((function(t){n({type:"Not support CS",info:"Not support CS ".concat(e)})}))}else n({type:"Parameter error",info:"The Parameter must be string"})}))},addProjectionFromWKT:function(e,t){var a=t||O.a.getEpsgCodeFromWKT(e);if(a&&proj4)return proj4.defs(a,e),ol.proj.proj4.register(proj4),be.epsgcodes[a]=e,!0},createOverviewMapControl:(n=d()(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("overviewMapPanel"),e.next=3,this.getOverviewMapControlOption();case 3:a=e.sent,this.overviewMapControl=new ol.control.OverviewMap({view:a.view,target:t,className:"overviewPanel-content",layers:[a.layer],collapsed:!1,collapsible:!1}),this.map.addControl(this.overviewMapControl);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),getOverviewMapControlOption:function(){var e,t,a=this,n=this.getBaseLayer(),i=n.layer,r=n.layerInfo,s=i.getSource();return new Promise(function(){var n=d()(c.a.mark((function n(i,o){var l;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r||"VECTOR_TILE"!==r.layerType){n.next=9;break}return n.next=3,he.a.getOverviewMapControlLayer(r,s);case 3:t=n.sent,l=he.a.creatMapViewOption(r,!0),e=new ol.View(l),i({layer:t,view:e}),n.next=12;break;case 9:e=new ol.View({projection:a.getBaseLayerProj()}),t=new ol.layer.Tile({source:s}),i({layer:t,view:e});case 12:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}())},createCopyrightControl:function(e){var t=document.getElementById("map");this.copyrightControl=document.createElement("div"),this.copyrightControl.className="copyright",this.copyrightControl.innerHTML=ve.a[e]||"",t.appendChild(this.copyrightControl)},createMousePositionControl:function(){var e=document.getElementById("map");this.mousePositionControl=new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(ee.a.mousePositionNumber),projection:"EPSG:4326",className:"mousePosition",target:e,undefinedHTML:""}),this.map.addControl(this.mousePositionControl)},getZoom:function(){return this.map.getView().getZoom()},getInitMapViewOption:function(e){var t=be.map.getView(),a=[0,0],n=t&&t.getZoom(),i=e.extent,r=e.minZoom,s=e.maxZoom||22,o=e.projection||e.epsgCode;if(t&&![void 0,null].includes(n))a=t.getCenter();else if(!ge.a.isOpenApp){var l=ge.a.dataVizConfig.mapCenter,c=l&&l.mapCenterX&&+l.mapCenterX.value||0,u=l&&l.mapCenterY&&+l.mapCenterY.value||0;n=l&&l.level&&l.level.value||n,a=ol.proj.transform([c,u],"EPSG:4326",o)}(ol.extent.containsCoordinate(i,a)||(a=ol.extent.getCenter(i),n=null),![void 0,null].includes(n)&&(n<r||n>s))&&(n=Math.abs(n-r)<Math.abs(n-s)?r:s);return{center:a,zoom:n}},createView:function(e){var t,a=e.extent,n=e.maxZoom||22,i=e.projection||e.epsgCode,r=this.getInitMapViewOption(e),s=r.zoom,l=r.center;if(!s&&(s=1),e.visibleScales&&e.visibleScales.length>0||e.scales&&e.scales.length>0)this.getScales(e);else if(a&&4===a.length){var c=(a[2]-a[0])/512,u=(a[3]-a[1])/512;t=Math.max(c,u)}var d={zoom:s,center:l,projection:i,maxZoom:n,enableRotation:!1,showFullExtent:!0,multiWorld:!0};if(e.scales&&e.scales.length>0&&"WMTS"===e.layerType||e.visibleScales&&e.visibleScales.length>0)this.map.setView(new ol.View(o()({},d,{resolutions:this.resolutionArray})));else if("WMTS"===e.layerType)this.map.setView(new ol.View(d)),this.getScales(e);else{for(var p=[],h=0;h<=n;h++)p.push(t/Math.pow(2,h));this.map.setView(new ol.View(o()({},d,{resolutions:p}))),this.getScales(e)}if(this.validScale(e.minScale)){this.setMinScale(e.minScale);var f=be.scales.indexOf(this.minScale);this.setMinZoom(f)}if(this.validScale(e.maxScale)){this.setMaxScale(e.maxScale);var m=be.scales.indexOf(this.maxScale);this.setMaxZoom(m)}this.isSetMinMaxResolution()?this.setConstrainResolution(!1):this.setConstrainResolution(!0)},updateView:function(e,t,a){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this.map.getView();if(n){var r={duration:ee.a.animateDuration};a?(r.resolution=i.getResolutionForExtent(a,this.map.getSize()),r.center=ol.extent.getCenter(a)):(t&&(r.center=t),(e||0===e)&&(r.zoom=e)),i.animate(r)}else a?(i.setResolution(i.getResolutionForExtent(a,this.map.getSize())),i.setCenter(ol.extent.getCenter(a))):(t&&i.setCenter(t),(e||0===e)&&i.setZoom(e))},zoomToExtent:function(e){if(!e)return!1;for(var t in e)if(!O.a.isNumber(e[t]))return!1;if(ol.extent.isEmpty(e))return!1;this.map.getView().fit(e,{duration:ee.a.animateDuration})},getNeedSaveMapInfo:function(){var e=this.map.getView(),t=e.getCenter(),a=r()(t,2),n=a[0],i=a[1];return{zoom:e.getZoom(),center:{x:n,y:i},extent:e.calculateExtent()}},getBaseLayerBounds:function(){for(var e in this.tileLayers)if(this.tileLayers[e].isBaseLayer())return this.tileLayers[e].getBounds();return!1},getProjection:function(){return this.map.getView().getProjection().getCode()},resizeMap:function(e,t){this.map.setSize([e,t])},addBaseMap:function(e){if(this.changeMapDomBackgroundColor(),e.projection&&0!==e.projection.indexOf("EPSG:")&&(e.projection=O.a.getEpsgCodeFromWKT(e.projection)),this.minScale="",this.maxScale="",e.url||e.iserverUrl)return e.id=1,"VECTOR_TILE"===e.layerType?this.addVectorTileLayer(e,!0):this.addTileLayerToMap(e,!0);var t=me.a.getMapInfo(e.internetMapName||e.layerType);return void 0!==e.labelLayerVisible&&(t.labelLayerVisible=e.labelLayerVisible),t.id=1,t.visible=e.visible,t.minScale=e.minScale,t.maxScale=e.maxScale,this.addTileLayerToMap(t,!0)},changeMapDomBackgroundColor:function(){var e=this.getBaseLayer();e&&e.layerInfo&&("VECTOR_TILE"===e.layerInfo.layerType&&(be.map.getTargetElement().style.backgroundColor=""))},getScales:function(e){var t,a,n=[],i={},r=[],s=this.getBaseLayerProjUnit(e);if(s||(s="EPSG:3857"===e.projection?"m":"degree"),"VECTOR_TILE"===e.layerType){var o=e.bounds;s=e.coordUnit;var l=e.styles&&e.styles.metadata&&e.styles.metadata.indexbounds,c=he.a.createVisibleResolution(e.visibleScales,l,o,s);c.forEach((function(e){var t=O.a.getScaleFromRes(e,s);i[O.a.formatScale(t)]=e,n.push(t)})),r=c}else if("WMTS"===e.layerType)e.scales.forEach((function(e){t=O.a.getResFromScale(e,s,ee.a.dpi.iServerWMTS),e="1:".concat(e),i[O.a.formatScale(e)]=t,r.push(t),n.push(e)}));else{var u=e.visibleScales,d=e.minZoom,p=void 0===d?0:d,h=e.maxZoom,f=void 0===h?22:h,m=this.getScalesResolutions(u,s,p,f);i=m.resolutions,r=m.resolutionArray,n=m.scales}n=Array.from(new Set(n)),be.scales&&!O.a.judgeArrayEqual(be.scales,n)&&(D.a.showMessage(DataViz.Language.visibleScaleChanged,"warning"),a=!0),be.scales=n,be.minScale&&!be.scales.includes(be.minScale)&&(be.minScale=be.findNearest(be.scales,be.minScale)),be.maxScale&&!be.scales.includes(be.maxScale)&&(be.maxScale=be.findNearest(be.scales,be.maxScale)),be.resolutions=i,be.resolutionArray=Array.from(new Set(r)),a&&this.updateLayersScales(n)},getScalesResolutions:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:22,i=arguments.length>4?arguments[4]:void 0,r=[],s={},o=[];if(e&&e.length>0)e.forEach((function(e){var a=1/e,n=O.a.getResFromScale(a,t);e="1:".concat(a),s[O.a.formatScale(e)]=n,o.push(n),r.push(e)}));else if(i)o=O.a.getStyleResolutions(i);else for(var l=this.map.getView(),c=a;c<=n;c++){var u=l.getResolutionForZoom(c),d=O.a.getScaleFromRes(u,t);s[O.a.formatScale(d)]=u,o.push(u),r.push(d)}return{scales:r=Array.from(new Set(r)),resolutions:s,resolutionArray:o}},updateLayersScales:function(e){var t=e[e.length-1],a=e[0],n={maxScale:O.a.formatScale(t),minScale:O.a.formatScale(a)};this.vectorLayers&&this.vectorLayers.length>0&&this.vectorLayers.forEach((function(e){var t=e.layerInfo;t.visibleScale&&(t.visibleScale=n,e.setVisibleScale())})),this.tileLayers&&this.tileLayers.length>0&&this.tileLayers.forEach((function(e){var t=e.layerInfo;t.visibleScale&&(t.visibleScale=n,e.setVisibleScale())}))},addTileLayerToMap:function(e,t,a){var n,i=null;if(e.id||(e.id=(new Date).getTime()),t){e.zIndex=0;var r=this.tileLayers.shift();for(var s in r&&r.layerInfo.layerType.indexOf("TIANDITU")>-1&&this.map.removeLayer(r.labelLayer),r&&this.map.removeLayer(r.layer),this.tileLayers){var o=this.tileLayers[s];o.layerInfo.projection2!==e.projection?(o.layer.setVisible(!1),o.layerInfo.unAbleProj=!0):(o.layerInfo.projection2===e.projection||o.layerInfo.unAbleProj)&&(o.layer.setVisible(!0),delete o.layerInfo.unAbleProj)}if(i=new pe.a(e),this.tileLayers.unshift(i),Se.a.setProjectionExtent(),n=i.createLayer(),this.map.addLayer(n),e.layerType.indexOf("TIANDITU")>-1&&this.map.addLayer(i.createTiandituLabelLayer()),this.createView(e),this.overviewMapControl&&(this.map.removeControl(this.overviewMapControl),this.createOverviewMapControl()),this.copyrightControl){var l=e.layerType.toUpperCase();this.copyrightControl.innerHTML=ve.a[l]||""}}else{e.zIndex=e.zIndex||this.tileLayers.length;for(var c=0,u=this.vectorLayers.length;c<u;c++)this.vectorLayers[c].up(),a[c].zIndex=this.vectorLayers[c].getZIndex();e.getDataFaild?this.tileLayers.push({layerInfo:e}):(i=new pe.a(e),this.tileLayers.push(i),Se.a.setProjectionExtent(),n=i.createLayer(),this.map.addLayer(n))}var d=e.visible;return void 0!==e.visible&&null!==e.visible||(d=!0),!t&&d&&i&&e.extent&&this.zoomToExtent(i.getBounds()),{overLayer:e.overLayer||!1,thumbnail:e.thumbnail,layerType:e.layerType,zIndex:e.zIndex,name:e.name,id:e.id||(new Date).getTime(),labelLayerVisible:e.labelLayerVisible,visible:d,getDataFaild:e.getDataFaild}},addVectorTileLayer:function(e,t,a){var n=null,i=this;if(t){e.zIndex=0;var r=this.tileLayers.shift();for(var s in r&&r.layerInfo.layerType.indexOf("TIANDITU")>-1&&this.map.removeLayer(r.labelLayer),r&&this.map.removeLayer(r.layer),this.tileLayers){var l=this.tileLayers[s];l.layerInfo.projection2!==e.projection?(l.layer.setVisible(!1),l.layerInfo.unAbleProj=!0):(l.layerInfo.projection2===e.projection||l.layerInfo.unAbleProj)&&(l.layer.setVisible(!0),delete l.layerInfo.unAbleProj)}var c=he.a.creatMapViewOption(e);if(this.map.setView(new ol.View(o()({},c))),i.getScales(e),n=new fe.a(e),i.tileLayers.unshift(n),Se.a.setProjectionExtent(),n.createLayer(t).then((function(){i.map.addLayer(n.layer),i.overviewMapControl&&(i.map.removeControl(i.overviewMapControl),i.createOverviewMapControl())})),this.copyrightControl){var u=e.layerType.toUpperCase();this.copyrightControl.innerHTML=ve.a[u]||""}}else{he.a.renameMapboxStyleLayerId(e),e.id||(e.id=(new Date).getTime()),e.zIndex=e.zIndex||this.tileLayers.length;for(var d=0,p=this.vectorLayers.length;d<p;d++)this.vectorLayers[d].up(),a[d].zIndex=this.vectorLayers[d].getZIndex();if(n=new fe.a(e),this.tileLayers.push(n),Se.a.setProjectionExtent(),e.styles)n.createLayer().then((function(){i.map.addLayer(n.layer)}));else this.map.addLayer(n.createLayer())}var h=e.visible;return void 0!==e.visible&&null!==e.visible||(h=!0),t||!h||e.notZoomToExtent||e.extent&&this.zoomToExtent(n.getBounds()),{overLayer:e.overLayer||!1,thumbnail:e.thumbnail,layerType:e.layerType,zIndex:e.zIndex,name:e.name,id:e.id||(new Date).getTime(),labelLayerVisible:e.labelLayerVisible,visible:h,getDataFaild:e.getDataFaild}},changeMapSetting:function(e){var t=e.center,a=e.extent,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"level";if(this.map)if("extent"===n)this.updateView(null,null,a);else{var i=ol.proj.fromLonLat([t[0],t[1]],this.getBaseLayerProj());this.updateView(t[2],i)}},registerMapEvent:function(e){var t,a=e.mapPostrenderCallback,n=e.changeResCallback,i=e.mapMoveEndCallback,r=this.map,s=this;r.on("postrender",(function(){s.selectedFeature&&a(s.selectedLayerId,s.getOnlySelectedFeature())})),r.on("pointermove",(function(e){var t=r.getEventPixel(e.originalEvent),a=!1;s.map.forEachFeatureAtPixel(t,(function(e,t){t&&t.get("layerType")===N.r.MARKER&&(a=!0)})),s.map.getTargetElement().style.cursor=a?"pointer":""})),r.on("moveend",(function(){var e=s.getBaseLayer().layerInfo,t=e.coordUnit||e.units||e.unit,a="WMTS"===e.layerType?ee.a.dpi.iServerWMTS:ee.a.dpi.default;t||(t="EPSG:3857"===be.getBaseLayerProj()?"m":"degree"),n(O.a.getScaleFromRes(be.map.getView().getResolution(),t,a)),"function"==typeof i&&i.call(this,s.getMapSettingInfo()),Se.a.graticuleLineChanged()})),r.on("click",(function(a){if(s.closeAllPop(s.hideMarkerPopup),!window.DataViz.isMeasure&&e.mapClickCallback){var n=[],i=-1,o=r.getCoordinateFromPixel(a.pixel);if(t=!1,r.forEachFeatureAtPixel(a.pixel,(function(e,a){if(a&&!(t="poi-layer"===a.getProperties().dataVizId)&&a.getProperties().zIndex>i){i=a.getProperties().zIndex;var r=a.getProperties().layerID;if(!r&&a.getProperties().labelField)return;n.unshift({feature:e,layerID:r})}}),{layerFilter:function(e){return!["measure-layer","high-light-layer"].includes(e.getProperties().dataVizId)&&s.isLayerInResRange(e)}}),!t){var l=n.length>0?n[0]:{};if(s.setOnlySelectedFeature(l),!l.layerID||!l.feature){var c=s.tileLayers.filter((function(e){var t=e.layerInfo,a=e.layer;return["TILE","WMS"].includes(t.layerType)&&!1!==t.visible&&0!==t.zIndex&&s.isLayerInResRange(a)})),u=[];return c.forEach((function(e){var t=e.layerInfo,a=t.extent,n=t.projection,i=s.getBaseLayerProj();n&&i!==n&&(a=ol.proj.transformExtent(a,n,i)),a&&ol.extent.containsCoordinate(a,o)&&u.push(e)})),s.selectedTileLayers=u,void e.mapClickCallback(0,null,o,u)}e.mapClickCallback(l.layerID,l.feature,o)}}}))},isLayerInResRange:function(e){var t=this.map.getView().getResolution();return e&&t<e.getMaxResolution()&&t>=e.getMinResolution()},getOnlySelectedFeature:function(){return this.selectedFeature?this.selectedFeature.feature:null},setOnlySelectedFeature:function(e){this.selectedFeature=e},highlightFeature:function(e){if(be.closeAllPop(),e){var t=e.getGeometry(),a=t.getType(),n=e.getProperties(),i=window.cloneDeep(n.useStyle),r=N.e[a.toUpperCase()],s=e.getGeometry().getCoordinates(),o=this.highLightLayer.getSource(),l=new ol.Feature({geometry:t.clone()});o.addFeature(l);var c=this.getLayerById(this.selectedLayerId);if(c){var u=c.layerInfo.visibleScale;if(u&&F.a.setVisibleScales(this.highLightLayer,u),"Point"===a||"MultiPoint"===a)if(n.useStyle&&n.useStyle.text)i.borderColor="#00FFCC",r=N.e.TEXT;else{var d=new ol.Feature({geometry:new ol.geom.Point([])});"MultiPoint"===a&&(d=new ol.Feature({geometry:new ol.geom.MultiPoint([])})),o.addFeature(d),d.getGeometry().setCoordinates(s);var p=null,h=null;if(i.strokeColor)h=i.radius+8;else h=((p=e.getStyle().getImage().getSize())[0]>p[1]?p[0]:p[1])*i.scale/2*1.4;var f=new ol.style.Style({image:new ol.style.Circle({radius:h,fill:new ol.style.Fill({color:"rgba(255,255,255,0)"}),stroke:new ol.style.Stroke({color:"#00FFCC",width:2})})});d.setStyle(f)}else i.strokeColor="#00FFCC";l.setStyle(w.a.toOpenLayersStyle(i,r)),be.setOnlySelectedFeature({feature:e,layerID:this.selectedLayerId})}}},getOnlySelectedFeatureLayerId:function(){return this.selectedFeature?this.selectedFeature.layerID:null},isSelectedTileLayer:function(e){for(var t=!1,a=0;a<this.selectedTileLayers.length;a++)this.selectedTileLayers[a].layerInfo.id===e&&(t=!0);return t},closeAllPop:function(e){this.map&&(this.map.getOverlayById("poi-pop").setPosition(void 0),this.closeThemePop(),e&&!A.a.isClose&&(e(),A.a.isClose=!0),this.map.getOverlayById("tile-pop").setPosition(void 0),this.highLightLayer.getSource().clear())},closeThemePop:function(){this.map.getOverlayById("theme-pop").setPosition(void 0),this.setOnlySelectedFeature(),this.onPopClose&&this.onPopClose()},getMapSettingInfo:function(){var e=this.map.getView(),t=this.getBaseLayerProj(),a=e.getCenter(),n=e.getZoom();if(!a||void 0===n)return{};var i=e.calculateExtent();return"EPSG:4326"!==t&&(a=ol.proj.toLonLat(a,t)),{center:a.concat(n),extent:i}},getVectorLayerById:function(e){for(var t=null,a=0;a<this.vectorLayers.length;a++)this.vectorLayers[a].layerInfo.id&&this.vectorLayers[a].layerInfo.id===e&&(t=this.vectorLayers[a]);return t},getTileLayerById:function(e){for(var t=null,a=0;a<this.tileLayers.length;a++)this.tileLayers[a].layerInfo.id===e&&(t=this.tileLayers[a]);return t},getLayerById:function(e){return this.getTileLayerById(e)||this.getVectorLayerById(e)},isMarkerLayerRename:function(e,t,a){if(0!==this.markerLayers.length){var n=0,i=[],r=[],s=this.markerLayers.some((function(s){if(i.push(s.layerInfo.name),r.push(s.layerInfo.id),s.layerInfo.name===t){if(!a)return e!==s.layerInfo.id;n++}if(n>1)return!0}));if(!a)return s;if(s){var o=i.lastIndexOf(t);return e===r[o]}return!1}},addVectorLayerToMap:function(e,t){this.curentID=t.id=t.id||(new Date).getTime(),t.zIndex=t.zIndex||this.tileLayers.length+this.vectorLayers.length;var a=[N.r.DATAFLOW,N.r.DATAFLOWHEAT].includes(t.layerType)?new de(t):new se(t);return a.createLayer(e),this.vectorLayers.push(a),t.layerType===N.r.MARKER&&this.markerLayers.push(a),Se.a.setProjectionExtent(),a.layerInfo.layerType===N.r.MIGRATION?(a.layer.appendTo(this.map),a.layer.setVisible(t.visible),a.layer.setCursor()):this.map.addLayer(a.layer),e&&e.length>0&&!t.notZoomToExtent&&this.zoomToExtent(a.getBounds()),{layerType:t.layerType,popupConfig:t.popupConfig,featureType:t.featureType,zIndex:t.zIndex,name:t.name,id:t.id,visible:t.visible,getDataFaild:t.getDataFaild,layerNotEditable:t.layerNotEditable}},removeVectorLayerFromMap:function(e){var t=this.vectorLayers.indexOf(e);if(t<0)throw"this layer not exsit in map";for(var a=t+1,n=this.vectorLayers.length;a<n;a++)this.vectorLayers[a].down();this.vectorLayers.splice(t,1),e.removeLayer()},removeTileLayerFromMap:function(e){var t=this.tileLayers.indexOf(e);if(t<0)throw"this layer not exsit in map";for(var a=t+1;a<this.tileLayers.length;a++)this.tileLayers[a].down();for(var n=0,i=this.vectorLayers.length;n<i;n++)this.vectorLayers[n].down();this.tileLayers.splice(t,1),this.map.removeLayer(e.layer)},addTempLayer:function(){var e=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(83,196,26,0.35)"}),stroke:new ol.style.Stroke({color:"#0081E2",width:2}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"#0081E2",width:2}),fill:new ol.style.Fill({color:"rgba(255,255,255,1)"})})});this.measureLayer=new ol.layer.Vector({source:new ol.source.Vector({wrapX:!1}),style:e,zIndex:9997}),this.measureLayer.setProperties({dataVizId:"measure-layer"}),this.poiLayer=new ol.layer.Vector({source:new ol.source.Vector({wrapX:!1}),zIndex:9998}),this.poiLayer.setProperties({dataVizId:"poi-layer"}),this.highLightLayer=new ol.layer.Vector({source:new ol.source.Vector({wrapX:!1}),style:e,zIndex:9999}),this.highLightLayer.setProperties({dataVizId:"high-light-layer"}),this.map.addLayer(this.measureLayer),this.map.addLayer(this.poiLayer),this.map.addLayer(this.highLightLayer)},addMapControl:function(){ye.a.addControlToMap(this.map,this.hideMarkerPopup);var e=O.a.getChildToolsConfig();e.ATTRIBUTION&&this.createCopyrightControl(),e.DISPLAY_COORDS&&this.createMousePositionControl()},updateZindex:function(e,t,a){var n=O.a.isVectorLayer(e.layerType)?this.getVectorLayerById(e.id):this.getTileLayerById(e.id);if(!n)return!1;t?n.updateZIndex(e.zIndex):a?n.up():n.down()},changeLayerVisible:function(e){var t=this.getLayerById(e.id),a=e.visible,n=t.isBaseLayer();if(t.setVisible(a),t.labelLayer&&n?this.changeTiandituLabelVisible(a):e.layerType,n&&t&&t.layerInfo&&"VECTOR_TILE"===t.layerInfo.layerType){var i=t.layerInfo.styles,r="";if(i){var s=i.layers&&i.layers.find((function(e){return"background"===e.type}));s&&s.paint&&a&&(r=s.paint["background-color"])}be.map.getTargetElement().style.backgroundColor=r}},changeTiandituLabelVisible:function(e){this.tileLayers[0].layerInfo.labelLayerVisible=e,this.tileLayers[0].labelLayer&&this.tileLayers[0].labelLayer.setVisible(e)},getPOIFilterByName:function(e){var t=null,a=-1;if(this.poiFilters.length>0)for(var n=0,i=this.poiFilters.length;n<i;n++)if(this.poiFilters[n].filterName===e){t=this.poiFilters[n],a=n;break}return{filter:t,idx:a}},changeLayerName:function(e){(O.a.isVectorLayer(e.layerType)?this.getVectorLayerById(e.id):this.getTileLayerById(e.id)).setLayerName(e.name)},getBaseLayer:function(){return this.tileLayers&&this.tileLayers[0]},getBaseLayerProj:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.map){var t=this.map.getView().getProjection().getCode();return e?t.split(":")[1]:t}return null},getUploadDataIdsFromLayers:function(){var e=[];return this.tileLayers.concat(this.vectorLayers).forEach((function(t){var a=t.layerInfo.dataSource?t.layerInfo.dataSource.serverId:t.layerInfo.serverId;a&&e.push(Number(a))})),e},getGeojsonFromFeature:function(e,t){var a=[];e&&e.forEach((function(e){var t,n={type:"Feature"},i=be.getBaseLayerProj();if("EPSG:4326"!==i){var r=e.getGeometry().clone();t=(r=r.transform(i,"EPSG:4326")).getCoordinates()}else t=e.getGeometry().getCoordinates();if(n.properties=e.get("attributes")||{},e.get("attributes")||e.get("useStyle")){n.properties=Object.assign(n.properties,e.get("attributes"));var s=cloneDeep(e.getProperties().useStyle);s&&s.canvas&&delete s.canvas,n.dv_v5_markerStyle=s,n.dv_v5_markerInfo=e.get("attributes")}n.geometry={type:e.getGeometry().getType(),coordinates:t},a.push(n)}));var n={type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}},features:a};return t?JSON.stringify(n):n},getMapExtent:function(){var e=this,t=this.vectorLayers.concat(this.tileLayers),a=ol.extent.createEmpty(),n=ol.extent.createEmpty();return t.forEach((function(t){var i=t.layerInfo,r=i.layerType;if(!i.getDataFaild){var s=t.getExtent(),o=t.getExtent("EPSG:4326");(r!==N.r.MARKER||t.features)&&(s&&ol.extent.extend(a,s),o&&e.isCorrectExtent(o)&&ol.extent.extend(n,o))}}),this),{extent:a,worldExtent:n}},isCorrectExtent:function(e){var t=r()(e,4),a=t[0],n=t[1],i=t[2],s=t[3];return!(a<-181||a>181||n<-91||n>91||i<-181||i>181||s<-91||s>91||a===i&&n===s)},getBaseLayerProjUnit:function(e){return e.coordUnit||ol.proj.get(e.projection).getUnits()},setConstrainResolution:function(e){this.map.getView().setConstrainResolution(e)},roundZoom:function(e){return this.isSetMinMaxResolution()?Math.round(e):e},validScale:function(e){if(!e)return!1;var t=e.split(":")[1];if(!t)return!1;var a=1/+t;return!(a===1/0||a>=1)},parseNumber:function(e){return Number(e.split(":")[1])},findNearest:function(e,t){for(var a=0,n=this.parseNumber(t),i=1,r=e.length;i<r;i++)Math.abs(this.parseNumber(e[i])-n)<Math.abs(this.parseNumber(e[a])-n)&&(a=i);return e[a]}};window.MapManager=be;var Ie=t.a=be},52:function(e,t,a){"use strict";a(208),a(27),a(28),a(30);var n=a(1),i=a(35),r=a(12),s=a(5),o=a(2),l=[.5,4],c={font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:"rgba(0,0,0,1)",outlineColor:"rgba(255,255,255,0.85)",outlineWidth:3},u={graticuleLayer:null,addGraticuleLayer:function(e,t){var a=this.judgeGraticuleLineDensity(t),n=a.lonLineNumber,i=a.latLineNumber,r=a.visible,s=2;(n>50||i>50)&&(s=1),this.removeGraticuleLayer(),this.createGraticuleLayer(e,t,s,r)},updateGraticuleLayer:function(e){if(this.graticuleLayer){var t=this.getColor(),a=this.getIntervals();this.removeGraticuleLayer();var n=this.setProjectionExtent();e&&(n=n&&this.projIsSupport()),n&&this.addGraticuleLayer(t,a)}},getBaseLayerProj:function(){return s.a.tileLayers[0]&&s.a.tileLayers[0].layerInfo.projection},projIsSupport:function(){return!o.a.isCustomProjection(u.getBaseLayerProj())},setProjectionExtent:function(){var e=s.a.getMapExtent(),t=e.extent,a=e.worldExtent,n=u.getBaseLayerProj();if(!n)return!1;var i=new ol.proj.get(n),r=!t.includes(1/0);r&&i.setExtent(t);var o=!a.includes(1/0);return i.setWorldExtent([-180,-90,180,90]),!(!r||!o)},graticuleLineChanged:function(){var e=this.graticuleLayer;if(e){var t=e.intervals_[0],a=this.judgeGraticuleLineDensity(t);this.changeGraticuleLayer(a)}},judgeGraticuleLineDensity:function(e){var t=s.a.map.getView().calculateExtent(),a=i.a.getBaseLayerProj(s.a.map),o=this.graticuleLayer,l=t;"EPSG:4326"!==a&&(l=ol.proj.transformExtent(l,a,"EPSG:4326"));var c=(l[2]-l[0])/e,u=(l[3]-l[1])/e,d=!o||o.getVisible();return(c>120||u>120)&&d&&(d=!1,r.a.showMessage(DataViz.Language.hiddenGraticule,n.j.WARNING)),c<=120&&u<=120&&!d&&(d=!0),{lonLineNumber:c,latLineNumber:u,visible:d}},changeGraticuleLayer:function(e){var t=this.graticuleLayer,a=e.lonLineNumber,n=e.latLineNumber,i=e.visible,r=this.getColor(),s=this.getLineWidth(),o=this.getIntervals(),l=t.getVisible();(a>50||n>50)&&1!==s?(this.removeGraticuleLayer(),this.createGraticuleLayer(r,o,1,i)):a<=50&&n<=50&&2!==s?(this.removeGraticuleLayer(),this.createGraticuleLayer(r,o,2,i)):l!==i&&t.setVisible(i)},removeGraticuleLayer:function(){this.graticuleLayer&&(s.a.map.removeLayer(this.graticuleLayer),this.graticuleLayer=null)},createGraticuleLayer:function(e,t,a,n){var i=l,r=c,o=r.font,u=r.textBaseline,d=r.fill,p=r.outlineColor,h=r.outlineWidth,f=s.a.getMapExtent().extent,m=new ol.style.Text({font:o,textBaseline:u,fill:new ol.style.Fill({color:d}),stroke:new ol.style.Stroke({color:p,width:h})});this.graticuleLayer=new ol.layer.Graticule({strokeStyle:new ol.style.Stroke({color:e,width:a,lineDash:i}),extent:f,lonLabelStyle:m,latLabelStyle:m,showLabels:!0,zIndex:9999,visible:n,wrapX:!1,intervals:[t],targetSize:0}),s.a.map.addLayer(this.graticuleLayer)},getColor:function(){return this.graticuleLayer.strokeStyle_.color_},getLineWidth:function(){return this.graticuleLayer.strokeStyle_.width_},getIntervals:function(){return this.graticuleLayer.intervals_[0]},getGraticule:function(){var e={fontFamily:"Calibri,sans-serif",textBaseline:"bottom",fill:"#000000",outlineColor:"rgba(255,255,255,0.85)",outlineWidth:3,fontSize:"12px"};return{extent:this.graticuleLayer.get("extent"),strokeColor:this.getColor(),strokeWidth:this.getLineWidth(),lineDash:[.5,4],interval:[this.getIntervals()],lonLabelStyle:e,latLabelStyle:e}}};t.a=u},53:function(e,t,a){"use strict";a(71),a(99),a(100),a(18),a(93),a(44),a(40),a(36),a(141),a(32),a(72),a(78),a(207),a(112),a(20);var n=a(2),i=a(12),r=a(1),s=a(5),o=/^(\-|\+)?\d+(\.\d+)?$/,l=DataViz.Language,c="https://www.supermapol.com/iserver/services/location-china/rest/locationanalyst/China/geocoding.json?";t.a={userCount:0,getFileType:function(e){var t,a,n=e.name||e.fileName,i=n.match(/(.*?).(csv|CSV|json|JSON|geojson|GEOJSON|xls|XLSX|xlsx|zip|ZIP)$/);return i?(t=i[1],a=i[2]):(t=n,a="unsupported"),{name:t,type:a}},getFirstCoordinate:function(e){return n.a.isArray(e[0])?this.getFirstCoordinate(e[0]):e},getGeoJsonEpsgCode:function(e){var t=this.getFirstCoordinate(e.geometry.coordinates);return-180<t[0]&&t[0]<180&&-180<t[1]&&t[1]<180?"EPSG:4326":"EPSG:3857"},getCsvExcelEpsgCode:function(e,t,a){var n=e.xField,i=e.yField;if(!(!t.length>0)){var r=t.findIndex((function(e){return e===n})),s=t.findIndex((function(e){return e===i})),o=Number(a[0][r]),l=Number(a[0][s]);return-180<o&&o<180&&-90<l&&l<90?"EPSG:4326":"EPSG:3857"}},getGeoJsonFeatureType:function(e){var t=e.features,a=t[0]&&t[0].geometry.type,n=!0;if(a){a=this.getFeatureType(a.toUpperCase());for(var i=1,s=t.length;i<s;i++){if((t[i].geometry&&this.getFeatureType(t[i].geometry.type.toUpperCase()))!==a){n=!1;break}}}return n?a:r.p.UNKNOWN},getFeatureType:function(e){switch(e){case r.p.POINT:case r.p.MUTLIPOINT:return r.p.POINT;case r.p.LINE:case r.p.MULTILINESTRING:case r.p.LINESTRING:case r.p.LINEARRING:return r.p.LINE;case r.p.POLYGON:case r.p.REGION:case r.p.MULTIPOLYGON:return r.p.POLYGON}},getExcelLonLatField:function(e,t){for(var a,i,r,s,l,c,u,d=0;d<e.length;d++)if(t[d]&&!n.a.isNumber(t[d])&&(t[d]=t[d].trim()),!n.a.isAddressField(e[d])||r)if(!n.a.isCityField(e[d])||s){if(n.a.isXField(e[d])&&o.test(t[d])&&!a)a=e[d],c=d;else if(n.a.isYField(e[d])&&o.test(t[d])&&!i)i=e[d],u=d;else if(a&&i&&r&&s)break}else s=e[d];else r=e[d];return l=t[c]&&t[u]&&Math.abs(t[c])<=180&&Math.abs(t[u])<=90?"EPSG:4326":"EPSG:3857",{x:a||e[0],y:i||e[0],xIndex:c||0,yIndex:u||0,city:s||e[0],address:r||e[0],code:l,selectedValue1:e[0],selectedValue2:DataViz.Language.notSet}},searchUserInfo:function(){var e=this;return n.a.checkReLogin().then((function(){return e.getRequestCount()})).catch((function(){i.a.showMessage(DataViz.Language.noLogin,r.j.WARNING)}))},getRequestCount:function(){var e=this,t="".concat(n.a.getIPortalUrl(),"web/mycontent/statistics/accessUsage.json");return n.a.doFetch(t,{method:"GET",withCredentials:!0}).then((function(t){if(t.length>0)for(var a in t){var n=t[a];if(""===n.name||"baseService"===n.name)return e.userCount=n.maxCount-n.count,e.userCount}}))},addressMatch:function(e,t,a,s){var o,l=this;if(window.isSuperMapOL)n.a.checkReLogin().then((function(){o=c,-1!==n.a.getRootUrl().indexOf("www.supermapol.com")?n.a.getPrivateKey().then((function(n){l.getLonlatFromAddress(o,n,e,t,a,s)})):l.getLonlatFromAddress(o,"fvv2osxwuZWlY0wJb8FEb2i5",e,t,a,s)}));else{var u,d=dataVizConfig.addressMatchSetting;if(d&&"RestData"===d.matchType&&d.matchUrl)o="".concat(d.matchUrl,"/geocoding.json?");else{if(!d||"Online"!==d.matchType||!d.mathOnlineKey)return i.a.showMessage(DataViz.Language.iportalAddressNone,r.j.ERROR,3e3),void s();o=c,u=d.mathOnlineKey}l.getLonlatFromAddress(o,u,e,t,a,s)}},getLonlatFromAddress:function(e,t,a,r,o,l){var c=this,u=a.titles||a.colTitles,d=a.rows,p=d.length,h=0,f=0,m=p-1;window.isSuperMapOL&&this.userCount<p&&(p=this.userCount,h=d.length-this.userCount);var y=[],g=u.indexOf(r),v=u.indexOf(o);u.unshift("dataviz_lon","dataviz_lat");var S=s.a.getBaseLayerProj(!0),b={type:"FeatureCollection",features:[]},I=[];if(g>-1&&v>-1){for(var E=function(a){var r=d[a];if(r[v]){var s=t?"address="+r[v]+"&city="+r[g]+"&maxResult=1&to="+S+"&key="+t:"address="+r[v]+"&fromIndex=0&toIndex=1&maxReturn=-1&prjCoordSys={epsgcode:"+S+"}",o=e+encodeURI(s);y.push(n.a.doFetch(o,{method:"GET"}).then((function(e){if(e.length>0){var t=e[0].location;r.unshift(t.x,t.y),I.push(r);var n={type:"Feature"};n.properties=c.getProperties(u,d[a]),n.geometry={type:"Point",coordinates:[t.x,t.y]},b.features.push(n)}else h++;f++,i.a.changeMessage(f,m,h)})).catch((function(e){h++,f++,i.a.changeMessage(f,m,h)})))}},T=1;T<p;T++)E(T);Promise.all(y).then((function(){l(I,b,S,u)}))}},getProperties:function(e,t){var a={};return e.forEach((function(e,n){a[e]=t[n]})),a},showErrrModal:function(e,t){var a=this.getErrorContent(t),n={modalTitle:e,content:a&&a.content,children:a&&a.reasons.length>0&&a.reasons,okButton:l.okButton,hideCancelBtn:!0,hideIcon:!0};i.a.showConfirmModal(n)},getErrorContent:function(e){var t,a=[];if(e.errorType)if(e.error&&e.error.response&&(401===e.error.response.status||"401"===e.error.response.status))t=l.noPermission3;else switch(e.errorType){case"getUploadIdFailed":case"upLoadFileFailed":case"moveFileToDirFailed":t=l.upLoadFileFailed;break;case"uploadRelationshipFaild":t=l.reasons,a=[l.dataNumberOver,l.noPermissionUpload,l.relationshipWrong];break;case"relationshipClose":t=l.relationshipClose;break;case"publicServiceFaild":t=l.publicServiceFaild;break;case"getDataServiceFaild":t=l.getDataServiceFaild;break;case"noServerAndRelationship":t=l.noServerAndRelationship;break;case"noHostServer":t=l.noHostServer;break;case"noRelationship":t=l.noRelationship;break;case"XYFieldIsWrong":t=l.addToMapFailed;break;case"uploadJsonFile":t=l.uploadJsonFile;break;case"XYFieldIsNaN":t=l.XYFieldIsNaN;break;case"fieldIsNotString":t=l.fieldIsNotString;break;case"disabledTableField":t=l.disabledTableField;break;case"isDifferentDataStructure":t=l.isDifferentDataStructure;break;case"getNewDataFailed":case"updateDataFaild":t=l.getRestDataFaild}else t="string"==typeof e?e:l.upLoadFileFailed;return{content:t,reasons:a}},isNumberFild:function(e,t,a){if(a[e]&&"NUMBER"!==a[e]||a[t]&&"NUMBER"!==a[t])throw{XYFieldIsNaN:!0}},isStringField:function(e,t){return!t[e]||"STRING"===t[e]},isMvt:function(e,t,a){return this.getDatasetsInfo(e,t).then((function(e){return e.epsgCode.toString()===(a||s.a.getBaseLayerProj(!0)).toString()?n.a.doFetch("".concat(n.a.getUrl(e.url),"/tilefeature.mvt"),{method:"GET",withCredentials:!0}).then((function(t){return e.isMvt=t.error&&400===t.error.code,e})).catch((function(){return e})):e}))},getDatasetsInfo:function(e,t){return n.a.getDatasources(e).then((function(a){var i="".concat(e,"/data/datasources/").concat(a,"/datasets/").concat(t);return n.a.getDataServiceInfo("".concat(n.a.getUrl(i))).then((function(e){return{epsgCode:e.datasetInfo.prjCoordSys.epsgCode,bounds:e.datasetInfo.bounds,url:i}}))}))},getService:function(e,t){return e.filter((function(e){return e.serviceType===t&&e}))[0]}}},55:function(e,t,a){"use strict";a(20),a(14);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(11),p=a.n(d),h=a(10),f=a.n(h),m=a(0),y=a.n(m),g=a(429),v=a(31),S=function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).editor=a.editor.bind(p()(a)),a}return f()(t,e),s()(t,[{key:"editor",value:function(e){this.props.editor(this.props.type,e,this.props.parentKey)}},{key:"render",value:function(){return"IMAGE_POINT"===this.props.symbolType?null:y.a.createElement("div",{className:"editor-tool point-color"},y.a.createElement("div",{className:"text"},this.props.name,this.props.tooltip&&y.a.createElement(v.a,{iconClassName:"supermapol-icons-question-circle",trigger:"click",placement:"bottomLeft",tooltip:this.props.tooltip,overlayClassName:this.props.tooltipClassName})),y.a.createElement(g.a,{className:"value-container",value:this.props.value,min:this.props.min,max:this.props.max,unit:this.props.unit,onChange:this.editor,isDot:this.props.isDot}))}}]),t}(m.Component);t.a=S},56:function(e,t,a){"use strict";a.d(t,"a",(function(){return g})),a.d(t,"b",(function(){return v}));a(27),a(99),a(100),a(36),a(253),a(32),a(20),a(14);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(11),p=a.n(d),h=a(10),f=a.n(h),m=a(0),y=a.n(m),g=(a(1427),function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).checkbox=y.a.createRef(),a.state={isChecked:e.checked||a.isChecked(),disabled:e.disabled},a.onDivClick=a.onDivClick.bind(p()(a)),a}return f()(t,e),s()(t,[{key:"componentWillReceiveProps",value:function(e){void 0!==e.checked&&e.checked!==this.state.isChecked?this.setState({isChecked:e.checked}):e.checkLists&&e.name&&this.setState({isChecked:e.checkLists.indexOf(e.name)>-1||e.checkLists.indexOf(+e.name)>-1}),e.disabled!==this.state.disabled&&this.setState({disabled:e.disabled})}},{key:"isChecked",value:function(){var e=this;return this.props.checkLists&&this.props.checkLists.length>0&&this.props.checkLists.some((function(t){return t.toString()===e.props.name.toString()}))}},{key:"onClick",value:function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},{key:"onDivClick",value:function(){this.checkbox.current.click()}},{key:"render",value:function(){var e=this.props,t=e.onChange,a=e.name,n=e.className;return y.a.createElement("div",{className:"dataViz-checkbox "+n,onClick:this.onDivClick},y.a.createElement("div",{className:"dataViz-checkbox-div"},y.a.createElement("input",{name:a,onClick:this.onClick.bind(this),type:"checkbox",disabled:!!this.state.disabled,checked:!!this.state.isChecked,onChange:t,ref:this.checkbox}),y.a.createElement("div",{className:"dataViz-checkbox-inner"})),this.props.children)}}]),t}(m.Component)),v=function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).state={checkLists:a.props.checkLists},a.onChange=a.onChange.bind(p()(a)),a}return f()(t,e),s()(t,[{key:"componentWillReceiveProps",value:function(e){"checkLists"in e&&this.setState({checkLists:e.checkLists})}},{key:"onChange",value:function(e){var t=+e.target.name||e.target.name,a=this.state.checkLists;if(a.indexOf(t)>-1){var n=a.indexOf(t);a.splice(n,1)}else a.push(t);this.setState({checkLists:a}),this.props.onChange&&this.props.onChange(e.target.checked,t)}},{key:"renderChildren",value:function(e){var t=this;return y.a.Children.map(e.children,(function(e){return y.a.cloneElement(e,{checkLists:t.state.checkLists,onChange:t.onChange})}))}},{key:"render",value:function(){return y.a.createElement("div",{className:"dataViz-checkbox-group"},this.renderChildren(this.props))}}]),t}(m.Component)},57:function(e,t,a){"use strict";a(28),a(30),a(44),a(40),a(69),a(20),a(71),a(18),a(32),a(207),a(72),a(54),a(73),a(93),a(36),a(112);var n=a(1),i=a(240),r=a(2),s=a(5),o=new ol.format.WMTSCapabilities,l={WMS:["version","capability","service"],WMTS:["Contents","OperationsMetadata"],RESTMAP:["prjCoordSys","name","bounds","center","dynamicPrjCoordSyses"],RESTDATA:["prjCoordSys","name","bounds"],MAPBOXSTYLE:["prjCoordSys","name","bounds"]},c={getUrl:function(e,t,a){var i=e;switch(t){case n.s.RESTMAP:case n.s.RESTDATA:i=c._getRestUrl(i,a);break;case n.s.MAPBOXSTYLE:i=c._getMapboxstyleUrl(i,a);break;case n.s.WMS:i=c._getWMSUrl(i,a);break;case n.s.WMTS:i=c._getWMTSUrl(i,a)}return i},checkUrl:function(e){return!(""===e||!r.a.isMatchUrl(e))&&(!/^http[s]?:\/\/localhost/.test(e)&&!/^http[s]?:\/\/127.0.0.1/.test(e))},isRestjsrServiceUrl:function(e,t){if(!e.match(/iserver\/services\/(.+)/))return Promise.reject({});var a=e.replace(e.match(/iserver\/services\/(.+)/)[1],""),n=e.trim().split("/"),i=n.findIndex((function(e){return"services"===e})),s="".concat(a).concat(n[i+1],"/").concat(n[i+2],".json");if(s=r.a.getUrl(s),t){var o=this.getKeyName(e);s="".concat(s,"?").concat(o,"=").concat(t)}return r.a.doFetch(s,{method:"GET"}).then((function(e){return e}))},isValidResponse:function(e,t){var a=l[t],n=!0;if(a){for(var i=0;i<a.length;i++)if(!e[a[i]]||e.error){n=!1;break}}else n=!1;return n},getRestLayerInfo:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.s.RESTMAP,i=c.getUrl(e.trim(),a,t);return r.a.doFetch(i,{method:"GET"}).then((function(t){if(c.isValidResponse(t,a))return r.a.isCustomProjection(t.prjCoordSys.epsgCode)&&t.prjCoordSys.epsgCode===+s.a.getBaseLayerProj().split(":")[1]?r.a.getRestMapWKT(e).then((function(e){return t.wkt=e,t})).catch((function(e){c.throwIserverError(e.errorMsg||DataViz.Language.restMapRequestFailed)})):t;t.error&&"{0}"===t.error.errorMsg?c.throwIserverError(DataViz.Language.dynamicProjectionUnable):c.throwIserverError(t.error&&t.error.errorMsg||DataViz.Language.restMapRequestFailed)}))},getRestDataInfo:function(e){var t=this.getUrl(e.trim(),n.s.RESTDATA);return r.a.doFetch(t,{method:"GET"}).then((function(e){if(c.isDataSourceRespond(e)||e.datasetNames||e.datasetInfo)return e;c.throwIserverError(e.error.errorMsg||DataViz.Language.restMapRequestFailed)}))},isDataSourceRespond:function(e){return!(!e.datasourceInfo||!e.datasourceInfo.prjCoordSys)},getCapabilities:function(e,t,a){return e=c.getUrl(e.trim(),t,a),r.a.doFetch(e,{method:"GET",withCredentials:!0,dataType:"text"}).then((function(e){try{var a=(t===n.s.WMS?i.a:o).read(e);if(c.isValidResponse(a,t))return a;c.throwIserverError(DataViz.Language.loadFailed)}catch(e){c.throwIserverError(DataViz.Language.loadFailed)}}))},throwIserverError:function(e){throw{succeed:!1,error:{errorMsg:e}}},getKeyName:function(e){var t=e.split("/iserver")[0].split("://")[1];return"www.supermapol.com"===t||"itest.supermapol.com"===t?"key":"token"},_getWMTSUrl:function(e,t){var a="?";return e.indexOf("?")>-1&&(a="&"),e+=t?a+"SERVICE=WMTS&VERSION=1.0.0&REQUEST=GetCapabilities":a+"/1.0.0/WMTSCapabilities.xml",r.a.getUrl(e,"json")},_getWMSUrl:function(e,t){return e+=e.indexOf("?")>-1?"&SERVICE=WMS&REQUEST=GetCapabilities":"?SERVICE=WMS&REQUEST=GetCapabilities",r.a.getUrl(e,"json")},_getMapboxstyleUrl:function(e,t){if(e+=".json",t&&""!==t){var a=c.getKeyName(e);e+="?".concat(a,"=").concat(t)}return r.a.getUrl(e,"json")},_getRestUrl:function(e,t){var a=!0;if(e.indexOf("?")>-1){var n=e.split("?");e=n[0]+".json?"+n[1],a=!1}else e=e.replace("+"," ")+".json";if(t&&""!==t){var i=c.getKeyName(e);e+="".concat(a?"?":"&").concat(i,"=").concat(t),a=!1}var o={epsgCode:+s.a.getBaseLayerProj(!0)};return s.a.getBaseLayerProj(!0)>0&&(e+=encodeURI("".concat(a?"?":"&","prjCoordSys=").concat(JSON.stringify(o)))),r.a.getUrl(e,"json")},getDataTypes:function(e){var t=[],a=[];for(var n in e)t.push(n),a.push(e[n]);return r.a.getFieldType(t,a)},getTileUrl:function(e,t,a,n){var i;if(n)e.forEach((function(e){"KVP"===e.Constraint[0].AllowedValues.Value[0].toUpperCase()&&(i=e.href)}));else{var r=t.ResourceURL.filter((function(e){return e.format===a}));i=r[0].template}return i},getParamsFromWMSCapabilities:function(e,t){t.version=e.version;var a=e.capability.layers,n=t.projection;t.subLayers||(t.subLayers=t.layers[0]);for(var i=0;i<a.length;i++)if(t.subLayers===a[i].name){var s=a[i],o=r.a.getMatchedEpsg(Object.keys(s.bbox),n),l=s.bbox[o];if(l){var c=l.bbox;"1.3.0"===t.version&&["EPSG:4326","EPSG:4490"].includes(t.projection)?t.extent=[c[1],c[0],c[3],c[2]]:t.extent=c;break}}return t}};t.a=c},61:function(e,t,a){"use strict";a(14);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(11),p=a.n(d),h=a(10),f=a.n(h),m=a(0),y=a.n(m),g=a(217),v=a.n(g),S=a(326),b=a.n(S);a(1425);v.a.setAppElement(document.querySelector(".root")||document.querySelector(".share-app"));var I=function(e){function t(e){var a;return i()(this,t),(a=l()(this,u()(t).call(this,e))).customStyles={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",padding:"0",border:"0"}},a.customStyles.content.width=e.modalWidth||"358px",a.cancelCallBack=a.cancelCallBack.bind(p()(a)),a.okCallBack=a.okCallBack.bind(p()(a)),a.closeBtnCallBack=a.closeBtnCallBack.bind(p()(a)),a.state={modalIsOpen:e.modalIsOpen||!1,disableConfirm:e.disableConfirm||!1,disableCancel:e.disableCancel||!1,disableCloseBtn:e.disableCloseBtn||!1},a.modalIsOpen=e.modalIsOpen||!1,a.defaultParentSelector=function(){return document.querySelector(".app-root")||document.querySelector(".share-app")},a}return f()(t,e),s()(t,[{key:"componentWillReceiveProps",value:function(e){("disableConfirm"in e||"modalIsOpen"in e||"disableCancel"in e||"disableCloseBtn"in e)&&this.setState({disableConfirm:e.disableConfirm,modalIsOpen:e.modalIsOpen||this.modalIsOpen,disableCancel:e.disableCancel,disableCloseBtn:e.disableCloseBtn})}},{key:"showModal",value:function(){this.setState({modalIsOpen:!0}),this.modalIsOpen=!0}},{key:"hideModal",value:function(){this.setState({modalIsOpen:!1}),this.modalIsOpen=!1}},{key:"isOpen",value:function(){return this.modalIsOpen}},{key:"closeBtnCallBack",value:function(e){e.nativeEvent.stopImmediatePropagation(),e.stopPropagation(),this.state.disableCloseBtn||(this.hideModal(),this.props.closeBtnCallBack&&this.props.closeBtnCallBack())}},{key:"cancelCallBack",value:function(e){e.nativeEvent.stopImmediatePropagation(),e.stopPropagation(),this.state.disableCancel||(this.props.cancelCallBack?this.props.cancelCallBack():this.hideModal())}},{key:"okCallBack",value:function(e){e.nativeEvent.stopImmediatePropagation(),e.stopPropagation(),this.state.disableConfirm||this.props.okCallBack&&this.props.okCallBack()}},{key:"enableConfirm",value:function(){this.setState({disableConfirm:!1})}},{key:"disableConfirm",value:function(){this.setState({disableConfirm:!0})}},{key:"disableCancel",value:function(){this.setState({disableCancel:!0})}},{key:"afterOpenModal",value:function(){this.props.afterOpenModal&&this.props.afterOpenModal()}},{key:"onModalClick",value:function(e){e.stopPropagation(),this.props.onModalClick&&this.props.onModalClick()}},{key:"onMouseOver",value:function(e){e.stopPropagation(),this.props.onMouseOver&&this.props.onMouseOver()}},{key:"onMouseOut",value:function(e){e.stopPropagation(),this.props.onMouseOut&&this.props.onMouseOut()}},{key:"render",value:function(){var e=this.props.parentSelector;return y.a.createElement("div",{onClick:this.onModalClick.bind(this),onMouseOver:this.onMouseOver.bind(this),onMouseOut:this.onMouseOut.bind(this)},y.a.createElement(v.a,{shouldFocusAfterRender:!0,shouldReturnFocusAfterClose:!1,isOpen:this.state.modalIsOpen,onAfterOpen:this.afterOpenModal.bind(this),parentSelector:e||this.defaultParentSelector,style:this.customStyles},y.a.createElement("div",{className:"modal-header",style:{display:this.props.hideHeader?"none":"block"}},y.a.createElement("span",null,this.props.modalTitle),this.props.headerChild&&y.a.createElement("span",null,this.props.headerChild),y.a.createElement("span",{className:this.state.disableCloseBtn?"supermapol-icons-close disabled":"supermapol-icons-close",onClick:this.closeBtnCallBack})),y.a.createElement("div",{className:"en"===window.lang?"modal-content en":"modal-content",style:{height:this.props.modalHeight}},this.props.children),y.a.createElement("div",{className:"modal-footer",style:{display:this.props.hideFooter?"none":"block"}},this.props.paginationConfig&&this.props.paginationConfig.total>(this.props.paginationConfig.pageSize||8)&&y.a.createElement(b.a,{prevPageText:"",firstPageText:"",nextPageText:"",lastPageText:"",linkClassFirst:"supermapol-icons-first",linkClassNext:"supermapol-icons-next",linkClassLast:"supermapol-icons-last",linkClassPrev:"supermapol-icons-prev",innerClass:"modal-pagination ".concat(this.props.paginationConfig.className||""),itemClass:"pagination-link",disabledClass:"pagination-link-disabled",onChange:this.props.paginationConfig.onPageChange,activePage:this.props.paginationConfig.currentPage||1,itemsCountPerPage:this.props.paginationConfig.pageSize||8,totalItemsCount:this.props.paginationConfig.total||1,pageRangeDisplayed:5}),y.a.createElement("button",{className:"confirm",onClick:this.okCallBack,style:{display:this.props.hideOkBtn?"none":"block"},disabled:this.state.disableConfirm},this.props.okButton||DataViz.Language.okButton),y.a.createElement("button",{className:"cancel",onClick:this.cancelCallBack,style:{display:this.props.hideCancelBtn?"none":"block"},disabled:this.state.disableCancel},this.props.cancelButton||DataViz.Language.cancelButton))))}}]),t}(m.Component);t.a=I},620:function(e,t,a){},623:function(e,t,a){},63:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));a(112),a(92),a(71),a(18),a(44),a(40),a(69),a(73),a(43),a(32),a(28),a(30),a(20),a(27),a(93),a(36);var n=a(5),i=a(22),r=a(2),s="/tileFeature/vectorstyles.json?type=MapBox_GL&styleonly=true&tileURLTemplate=ZXY",o={createLayer:function(e){var t=e.styles.metadata&&e.styles.metadata.indexbounds,a=o.createVisibleResolution(e.visibleScales,t,e.bounds,e.coordUnit),n=o.getEnvelope(t,e.bounds),i=r.a.getStyleResolutions(n),s=[n.left,n.top],l=o._createMapBoxStyle(e.styles,i);return new Promise((function(t){l.on("styleloaded",(function(){var n=new ol.format.MVT({featureClass:ol.RenderFeature}),i=a[a.length-1],o=a[0],c=r.a.isIportalProxyServiceUrl(e.url),u=new ol.layer.VectorTile({declutter:!0,source:new ol.source.VectorTileSuperMapRest({style:e.styles,projection:e.projection,format:n,tileGrid:new ol.tilegrid.TileGrid({resolutions:a,origin:s,tileSize:512}),wrapX:!1,withCredentials:c}),style:l.featureStyleFuntion,visible:e.visible,zIndex:e.zIndex,opacity:e.opacity,minResolution:i,maxResolution:o>1?Math.ceil(o):1.1*o});t(u)}))}))},getOverviewMapControlLayer:function(e,t){var a=e.styles,i=a.metadata&&a.metadata.indexbounds,s=o.getEnvelope(i,e.bounds),l=r.a.getStyleResolutions(s),c=o._createMapBoxStyle(a,l);return new Promise((function(e,a){var i=function(e,t){var a=n.a.map.getView().getResolution();return c.featureStyleFuntion(e,a)};c.on("styleloaded",(function(){var a=new ol.layer.VectorTile({declutter:!0,source:t,style:i});e(a)}))}))},_createMapBoxStyle:function(e,t){var a=r.a.isIportalProxyServiceUrl(e.sprite);return new ol.supermap.MapboxStyles({style:e,source:e.name,resolutions:t,map:n.a.map,withCredentials:a})},createVisibleResolution:function(e,t,a,n){var i=[];if(e&&e.length>0)i=e.map((function(e){var t=1/e;return r.a.getResFromScale(t,n)}));else{var s=o.getEnvelope(t,a);i=r.a.getStyleResolutions(s)}return i},getEnvelope:function(e,t){var a={};return e&&4===e.length?(a.left=e[0],a.bottom=e[1],a.right=e[2],a.top=e[3]):a=t,a},getViewZoom:function(e,t,a,n,s){var l=0;if(e&&e.length>0){var c=r.a.scaleToResolution(t,i.a.dpi.default,a);if(c)for(var u=Math.abs(c-e[0]),d=0;d<e.length;d++)u>Math.abs(c-e[d])&&(u=Math.abs(c-e[d]),l=d)}else for(var p=o.getEnvelope(n,s),h=o.getScales(p,a),f=Math.abs(t-h[0]),m=0;m<h.length;m++)f>Math.abs(t-h[m])&&(f=Math.abs(t-h[m]),l=m);return l},getViewCenter:function(e){return[(e.left+e.right)/2,(e.bottom+e.top)/2]},getScales:function(e,t){for(var a=Math.abs(e.left-e.right)/512,n=r.a.resolutionToScale(a,i.a.dpi.default,t),s=[],o=0;o<22;o++)0!==o?(n*=2,s[o]=n):s[o]=n;return s},creatMapViewOption:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.scale,r=e.visibleScales,s=e.bounds,l=e.styles,c=e.projection,u=e.coordUnit,d=l&&l.metadata&&l.metadata.indexbounds,p={zoom:t,center:o.getViewCenter(s)},h=p.center,f=o.createVisibleResolution(r,d,s,u);a||(p=n.a.getInitMapViewOption(e)),t=r&&r.length>0?o.getViewZoom(f,i,u,d,s):p.zoom,[void 0,null].includes(t)&&(t=o.getViewZoom(f,i,u,d,s));var m={center:h,zoom:t,projection:c,resolutions:f,enableRotation:!1,showFullExtent:!0,constrainResolution:!0,multiWorld:!0};return m},isMapboxStyleLayer:function(e){return o._isRestjsrMapboxStyle(e)||o.isRestMapMapboxStyle(e)},_isRestjsrMapboxStyle:function(e){var t=e.dataSource,a=e.layerType;return!(!(t&&t.url&&t.url.indexOf("/restjsr/")>-1)||"MAPBOXSTYLE"!==a&&"VECTOR_TILE"!==a)},isRestMapMapboxStyle:function(e){var t=e.dataSource,a=e.layerType;return!(!(t&&"EXTERNAL"===t.type&&t.url.indexOf(s)>-1)||"MAPBOXSTYLE"!==a&&"VECTOR_TILE"!==a)},getMapboxStyleLayer:function(e){return new Promise((function(t,a){return o.getLayerExtent(e).then((function(e){return o.getMapboxStyle(e).then((function(a){Object.assign(e,a),t(e)})).catch((function(e){a(e)}))})).catch((function(e){a(e)}))}))},getLayerExtent:function(e){var t=e.dataSource,a=t.url;o.isRestMapMapboxStyle(e)?a=a.replace(s,""):(a=a.replace("/style.json",""),e.dataSource.url=a);var n,i,l=r.a.getUrl(a+".json"),c=e.credential;return c&&(n=c[i=Object.keys(c)[0]],l="".concat(l,"?").concat(i,"=").concat(n)),r.a.doFetch(l,{method:"GET",withCredentials:!0}).then((function(t){return e.visibleScales=t.visibleScales,e.coordUnit=t.coordUnit,e.scale=t.scale,e.epsgCode=t.prjCoordSys.epsgCode,e.bounds=t.bounds,e})).catch((function(a){throw e.url=t.url,a}))},getMapboxStyle:function(e){var t=e.url||e.dataSource.url,a=t;a.indexOf("/restjsr/")>-1&&(a="".concat(a,"/style.json")),a=r.a.getUrl(a);var n,i,s=e.credential;return s&&(i=Object.keys(s)[0],n=s[i],a="".concat(a,"?").concat(i,"=").concat(n)),r.a.doFetch(a,{method:"GET",withCredentials:!0}).then((function(a){if(n){a.sprite="".concat(a.sprite,"?").concat(i,"=").concat(n);var r=a.sources;Object.keys(r).forEach((function(e){a.sources[e].tiles.forEach((function(t,r){a.sources[e].tiles[r]="".concat(t,"?").concat(i,"=").concat(n)}))}))}var s=e.bounds,o={url:t,sourceType:"VECTOR_TILE",layerType:"VECTOR_TILE",styles:a,extent:s&&[s.left,s.bottom,s.right,s.top],bounds:e.bounds,dataSource:{type:"EXTERNAL",url:t},projection:"EPSG:"+e.epsgCode,epsgCode:e.epsgCode,name:e.name,credential:e.credential};return Object.assign(e,o),e})).catch((function(e){return e}))},renameMapboxStyleLayerId:function(e){if("VECTOR_TILE"===e.layerType){var t=e.styles.layers;if(t){var a=n.a.tileLayers.filter((function(e){return e.layerInfo&&"VECTOR_TILE"===e.layerInfo.layerType})).map((function(e){return e.layerInfo&&e.layerInfo.styles&&e.layerInfo.styles.layers}));a&&0!==a.length&&a.forEach((function(e){t.forEach((function(t){o.renameLayerId(e,t)}))}))}}},renameLayerId:function(e,t){if(e.find((function(e){return e.id===t.id}))){var a=t.id.match(/(.+)\((\w)\)$/);a?t.id="".concat(a[1],"(").concat(+a[2]+1,")"):t.id+="(1)",e.find((function(e){return e.id===t.id}))&&n.a.renameLayerId(e,t)}}},l={getMapboxStyle:o.getMapboxStyle,getMapboxStyleLayer:o.getMapboxStyleLayer,isRestjsrMapboxStyle:o._isRestjsrMapboxStyle,isRestMapMapboxStyle:o.isRestMapMapboxStyle,isMapboxStyleLayer:o.isMapboxStyleLayer,creatMapViewOption:o.creatMapViewOption,getOverviewMapControlLayer:o.getOverviewMapControlLayer,getEnvelope:o.getEnvelope,getScales:o.getScales,createVisibleResolution:o.createVisibleResolution,getReslutionsFromScales:r.a.scaleToResolution,renameMapboxStyleLayerId:o.renameMapboxStyleLayerId};t.b=o},666:function(e){e.exports=JSON.parse('[{"name":"","coord":[127.64559817675396,48.48668098449708]},{"name":"","coord":[118.34519572208615,45.370218276977525]},{"name":"","coord":[87.13479065593184,41.75497055053711]},{"name":"","coord":[126.12985278813787,43.57983207702637]},{"name":"","coord":[124.02494773936439,41.105743408203125]},{"name":"","coord":[102.87785725633012,37.69582366943361]},{"name":"","coord":[115.66327227481898,39.33383178710938]},{"name":"","coord":[116.62199343603638,40.25053787231445]},{"name":"","coord":[112.45180235808988,37.666561126708984]},{"name":"","coord":[117.35711842642581,39.406789779663086]},{"name":"","coord":[109.56294003056632,35.64754199981689]},{"name":"","coord":[105.96110877640074,37.3081169128418]},{"name":"","coord":[96.07301048277901,35.44417190551758]},{"name":"","coord":[118.03833752951093,36.29800605773925]},{"name":"","coord":[87.47361520439412,31.6703872680664]},{"name":"","coord":[113.07832397097275,33.87751102447509]},{"name":"","coord":[119.93926538201052,32.945452690124505]},{"name":"","coord":[117.15146765881019,32.024482727050774]},{"name":"","coord":[102.28998890142759,30.182161331176758]},{"name":"","coord":[112.87798261431585,31.157071113586426]},{"name":"","coord":[107.870126637831,30.188085556030266]},{"name":"","coord":[121.42561166015514,31.276043891906745]},{"name":"","coord":[119.75337092707514,29.175934791564945]},{"name":"","coord":[111.52770282777405,27.38110256195069]},{"name":"","coord":[115.51091280655628,27.283511161804206]},{"name":"","coord":[101.27053825991308,25.19783210754396]},{"name":"","coord":[106.49672346773299,26.92267990112305]},{"name":"","coord":[117.9976766946587,25.939599990844727]},{"name":"","coord":[108.98706831086302,23.891559600830078]},{"name":"","coord":[120.82468432537434,23.602651596069336]},{"name":"","coord":[114.21036850371561,22.374858856201172]},{"name":"","coord":[109.62792940960824,19.163116455078125]},{"name":"","coord":[113.32127888266032,22.873867034912106]},{"name":"","coord":[113.56819996291901,22.160347992976]}]')},667:function(e){e.exports=JSON.parse('[{"name":"","coord":[85.01486759299489,45.406422237230046]},{"name":"","coord":[88.7154624754753,44.26991024636568]},{"name":"","coord":[86.0208600035924,44.239045558096805]},{"name":"","coord":[114.73479243733115,44.16058374713977]},{"name":"","coord":[124.64357865201586,41.177197783134275]},{"name":"","coord":[98.16891560537093,39.76279786284264]},{"name":"","coord":[117.65723565456207,36.27916499211527]},{"name":"","coord":[110.48296222218153,31.581260143666697]},{"name":"","coord":[113.00615321481195,30.64105781887143]},{"name":"","coord":[114.94764081970385,30.325634953844585]},{"name":"","coord":[112.70703817700621,30.349210666019893]},{"name":"","coord":[113.34688900729822,30.315951161935402]},{"name":"","coord":[113.88072263074415,27.47193090553213]},{"name":"","coord":[120.14338943402045,23.596002465926095]},{"name":"","coord":[113.89443658529342,22.897826158636448]},{"name":"","coord":[113.37118387764659,22.501478858616522]},{"name":"","coord":[113.21799258934986,22.23782602992192]},{"name":"","coord":[109.18248083043899,21.695773689750148]},{"name":"","coord":[114.20689279508653,22.36016760139811]},{"name":"","coord":[122.22514712841459,30.338633120695956]},{"name":"","coord":[74.62910472637343,39.59886016069875]},{"name":"","coord":[77.19899922143753,37.85462871211595]},{"name":"","coord":[81.43930290016381,41.067304799230456]},{"name":"","coord":[80.69780509160952,36.95287032287055]},{"name":"","coord":[82.536487505389,32.69566569631762]},{"name":"","coord":[86.5996831353606,29.54861754814263]},{"name":"","coord":[88.32523292667608,33.20600450932715]},{"name":"","coord":[95.2107128446203,33.90320387919257]},{"name":"","coord":[99.42465312188943,28.052797714348895]},{"name":"","coord":[98.85737910439825,26.98345757528851]},{"name":"","coord":[99.93934374816013,25.684737357453045]},{"name":"","coord":[98.13830877778075,24.593421919561205]},{"name":"","coord":[99.19031013453166,24.979380341662]},{"name":"","coord":[99.62483778975081,24.058807858948214]},{"name":"","coord":[100.94440267992684,23.44121660743221]},{"name":"","coord":[100.86105801845994,21.882475641324206]},{"name":"","coord":[91.3684790613129,30.14176592960237]},{"name":"","coord":[92.11665242621062,28.33000201578789]},{"name":"","coord":[94.9307847458166,29.125110156601963]},{"name":"","coord":[97.33912235873476,30.48520825551814]},{"name":"","coord":[100.65713436205135,26.96190318191959]},{"name":"","coord":[101.73355913301131,26.714486678752795]},{"name":"","coord":[102.08678551422615,27.683020519860396]},{"name":"","coord":[101.68264761198458,25.369603845264024]},{"name":"","coord":[102.95101719613119,23.624860095239875]},{"name":"","coord":[104.8708359910614,23.579587266862504]},{"name":"","coord":[106.69546907589859,23.98220841166522]},{"name":"","coord":[107.3277087317123,22.49769755349952]},{"name":"","coord":[107.88939931155171,21.94550204069006]},{"name":"","coord":[108.67078983716917,23.12207641861882]},{"name":"","coord":[108.8532307305186,22.157690108421384]},{"name":"","coord":[110.26918466489103,22.391823643610415]},{"name":"","coord":[109.93033457863683,21.086751055633457]},{"name":"","coord":[110.80336192333934,22.069184739040775]},{"name":"","coord":[111.70471342186183,22.108751366417575]},{"name":"","coord":[112.53715618649149,22.297368082806777]},{"name":"","coord":[113.4949302208309,23.28359314707863]},{"name":"","coord":[113.10957368131268,24.334444053233856]},{"name":"","coord":[112.11117530204233,23.60241158796112]},{"name":"","coord":[111.01709510772797,23.518132876753846]},{"name":"","coord":[111.50423061842756,24.4095096817199]},{"name":"","coord":[110.44046163393094,25.353966673735407]},{"name":"","coord":[109.34854449214147,24.972408051485047]},{"name":"","coord":[107.81191841865586,24.649291651298164]},{"name":"","coord":[108.39952601614591,26.429286420465576]},{"name":"","coord":[106.59784062851153,26.797907456479816]},{"name":"","coord":[105.76161265300635,25.988644902171018]},{"name":"","coord":[105.5954078788574,25.404850939549405]},{"name":"","coord":[103.9164335632742,25.697243690315265]},{"name":"","coord":[104.77723228072432,26.15402255629164]},{"name":"","coord":[105.03867422931839,27.077913968069666]},{"name":"","coord":[104.29730513046874,27.62418247971078]},{"name":"","coord":[104.76748901448207,28.553501804266475]},{"name":"","coord":[103.56027669102787,29.160754519210577]},{"name":"","coord":[104.63272827056402,29.273152614922402]},{"name":"","coord":[104.82644562304716,29.61272653799929]},{"name":"","coord":[106.82413636302059,28.191847588570702]},{"name":"","coord":[107.59704170009518,31.32138258839703]},{"name":"","coord":[105.48979445433736,30.677687821242678]},{"name":"","coord":[106.56708164098042,30.43500706741521]},{"name":"","coord":[105.42591761727707,28.50277238478137]},{"name":"","coord":[104.97995126874034,30.154251886139654]},{"name":"","coord":[102.69931299964517,29.892630706195035]},{"name":"","coord":[104.07052881858888,29.894202166560405]},{"name":"","coord":[100.50721042614238,30.975216556269658]},{"name":"","coord":[99.30775565051923,34.03539865224808]},{"name":"","coord":[100.39969108016373,35.90048272566899]},{"name":"","coord":[101.5360706381689,35.10286360841902]},{"name":"","coord":[102.97083885806067,34.326752803339026]},{"name":"","coord":[105.24780098912132,33.57031117443431]},{"name":"","coord":[105.53503634660417,34.62320421368087]},{"name":"","coord":[104.58787768541339,35.08900966621695]},{"name":"","coord":[103.2612870434902,35.591577124455235]},{"name":"","coord":[101.57680657999033,36.84800271717157]},{"name":"","coord":[102.30909850729282,36.287400615025646]},{"name":"","coord":[100.27122484450717,37.892557516083826]},{"name":"","coord":[102.02244049169511,38.497330414886164]},{"name":"","coord":[95.94486678270127,40.56891536586272]},{"name":"","coord":[94.67143298050689,36.022725148503724]},{"name":"","coord":[88.18116214759745,39.556478810319916]},{"name":"","coord":[93.84302392518026,42.95015211178875]},{"name":"","coord":[89.82035217277885,42.399368632283505]},{"name":"","coord":[88.00048109561487,43.549986370786]},{"name":"","coord":[88.11213933257655,47.05593413019629]},{"name":"","coord":[82.26402238163408,44.671135542630864]},{"name":"","coord":[82.80778717477179,43.53783381365267]},{"name":"","coord":[103.29923966842289,40.10955801781495]},{"name":"","coord":[102.73362058791429,37.94211141321436]},{"name":"","coord":[103.73793563506032,36.27379827886003]},{"name":"","coord":[105.6943786030716,37.20654236148948]},{"name":"","coord":[106.20022174140034,38.52103167597483]},{"name":"","coord":[106.41544011793628,38.84054137571417]},{"name":"","coord":[106.8984175998405,39.54616572239788]},{"name":"","coord":[108.43285571424619,39.24036799350715]},{"name":"","coord":[107.45840392808307,41.30159860424196]},{"name":"","coord":[110.46472193224272,41.48017783644221]},{"name":"","coord":[111.48365173603975,40.498363056149884]},{"name":"","coord":[112.61568977597707,41.75789561273154]},{"name":"","coord":[113.7107192749083,39.898956799744184]},{"name":"","coord":[112.65428748167508,39.681772914701924]},{"name":"","coord":[112.36127575589583,38.88990233614568]},{"name":"","coord":[109.68473112169593,38.19921027134876]},{"name":"","coord":[109.52425222161318,36.406522726136814]},{"name":"","coord":[107.73052193155061,36.183821532624464]},{"name":"","coord":[106.20191575442442,36.11634909496382]},{"name":"","coord":[104.68634478137065,36.51582865625868]},{"name":"","coord":[107.33534779230747,34.3387216485855]},{"name":"","coord":[107.03534754266246,33.00142998064871]},{"name":"","coord":[105.92928137563939,32.21872447205537]},{"name":"","coord":[107.03422410306194,31.99874720836291]},{"name":"","coord":[106.32964805032347,31.156657700184095]},{"name":"","coord":[104.58949560201106,31.88628780630976]},{"name":"","coord":[104.41542984932845,31.110558133718676]},{"name":"","coord":[103.8852290010473,30.777258040348634]},{"name":"","coord":[102.26209319552814,32.45725845387284]},{"name":"","coord":[109.14236501848015,32.77467694678074]},{"name":"","coord":[110.39934083416314,32.376209039347906]},{"name":"","coord":[111.97539147094662,31.93399822417465]},{"name":"","coord":[111.22204852395754,30.772457669035354]},{"name":"","coord":[109.42158366502872,30.260366574390105]},{"name":"","coord":[110.59760006538717,29.330107409240718]},{"name":"","coord":[109.72176899848378,28.681903937242495]},{"name":"","coord":[108.54247523485463,28.11736237519646]},{"name":"","coord":[107.86007108564992,30.186253395053196]},{"name":"","coord":[109.94325166787243,27.43919084801186]},{"name":"","coord":[112.43060358108062,28.75127294553697]},{"name":"","coord":[111.41891416951897,27.696312460064604]},{"name":"","coord":[111.72571610131646,29.27189463838195]},{"name":"","coord":[112.65896596965268,30.05161542755362]},{"name":"","coord":[112.6586855902184,31.01267124474617]},{"name":"","coord":[113.2595036144316,29.106247116930163]},{"name":"","coord":[113.15415586456598,28.222934680488425]},{"name":"","coord":[112.51092596317824,27.69881544105668]},{"name":"","coord":[113.49665538546823,27.03993794610501]},{"name":"","coord":[112.48849636578527,26.783613569970782]},{"name":"","coord":[110.6723832117475,26.81652287086792]},{"name":"","coord":[111.8565364154186,25.768488267811968]},{"name":"","coord":[113.53420325850979,24.69848878771937]},{"name":"","coord":[114.32029589634925,23.25504544231892]},{"name":"","coord":[112.95925897403649,23.10116677189257]},{"name":"","coord":[111.78042514904234,22.840400494105687]},{"name":"","coord":[114.13138648919008,22.649563063468342]},{"name":"","coord":[115.57412892884373,23.06989642104901]},{"name":"","coord":[114.89746229844398,23.97971937124767]},{"name":"","coord":[116.04290004239446,23.304802704715357]},{"name":"","coord":[116.7008461897183,23.35898625947344]},{"name":"","coord":[116.75405548481658,23.854381508863064]},{"name":"","coord":[116.13719397345734,24.15633544812716]},{"name":"","coord":[117.38279760543345,24.41111215459575]},{"name":"","coord":[118.04275971554665,24.675908246507944]},{"name":"","coord":[116.69341144552507,25.20284542644492]},{"name":"","coord":[118.12035864630246,25.22984144365049]},{"name":"","coord":[118.82439690138142,25.439653480972687]},{"name":"","coord":[119.1608285845262,25.99117532466728]},{"name":"","coord":[117.51188176216434,26.318292906961602]},{"name":"","coord":[118.16153136678187,27.306303151805437]},{"name":"","coord":[116.3455359885574,27.487043655935366]},{"name":"","coord":[117.01082360702333,28.241253742969946]},{"name":"","coord":[114.91377151807418,26.957486660664525]},{"name":"","coord":[115.046455717572,25.81565075681663]},{"name":"","coord":[113.1544526703492,25.871927095452524]},{"name":"","coord":[114.94161795877827,27.79044654578371]},{"name":"","coord":[115.04574494880995,28.306428044943356]},{"name":"","coord":[115.9963824234495,28.664803351584705]},{"name":"","coord":[115.53225905704193,29.362905920276297]},{"name":"","coord":[117.8595355766598,28.765755150094634]},{"name":"","coord":[117.25387030721845,29.33426823662448]},{"name":"","coord":[117.85476357809696,29.969632034273722]},{"name":"","coord":[117.34517113140791,30.208089337922335]},{"name":"","coord":[117.93160431300694,30.926442655001676]},{"name":"","coord":[116.54307680610799,30.524265461641296]},{"name":"","coord":[115.02354597728443,29.924060229331015]},{"name":"","coord":[114.26967602231792,29.652174021136048]},{"name":"","coord":[115.2859016705373,30.65856897065683]},{"name":"","coord":[114.34552076948799,30.68836237966767]},{"name":"","coord":[113.3850627838818,31.87891659924412]},{"name":"","coord":[114.81374730587638,32.0309685135914]},{"name":"","coord":[114.07756451509235,32.896720987266114]},{"name":"","coord":[109.82044421310393,33.77403373563189]},{"name":"","coord":[109.11839808451401,34.225257215515896]},{"name":"","coord":[109.75732444226935,35.025913644359306]},{"name":"","coord":[108.98695328111377,35.19235092947735]},{"name":"","coord":[108.36398776446165,34.84311348287181]},{"name":"","coord":[110.80049688104964,34.31818709571671]},{"name":"","coord":[111.1736679525165,35.19010372283576]},{"name":"","coord":[111.87577573098216,34.33379926109848]},{"name":"","coord":[112.80931281928427,33.759895800153096]},{"name":"","coord":[113.83505724178012,33.70034266174508]},{"name":"","coord":[113.78762484088509,34.051835688452435]},{"name":"","coord":[113.49619951867594,34.61181797865449]},{"name":"","coord":[113.13404280173008,35.134167097471625]},{"name":"","coord":[112.7495732073233,35.63186423091449]},{"name":"","coord":[112.85900842873183,36.45872910742828]},{"name":"","coord":[111.49379787924448,36.22810800777857]},{"name":"","coord":[112.15628804033796,37.91704444063036]},{"name":"","coord":[111.31901105774872,37.712740463356496]},{"name":"","coord":[113.08199599739676,37.36532613794343]},{"name":"","coord":[114.41824047234618,36.530119932543315]},{"name":"","coord":[113.88883283163116,35.7797611183252]},{"name":"","coord":[114.3654094911545,35.75770487428472]},{"name":"","coord":[113.9184107718167,35.348471214026716]},{"name":"","coord":[114.52801677500626,34.61371216679872]},{"name":"","coord":[114.88509782391864,33.69999759722657]},{"name":"","coord":[115.44595951398213,32.98060371610532]},{"name":"","coord":[116.68941991880993,32.79972275772595]},{"name":"","coord":[117.38594715783302,33.106729536033896]},{"name":"","coord":[116.69651711889378,33.69527529383458]},{"name":"","coord":[117.30175405886838,33.943330421260015]},{"name":"","coord":[116.12410804185097,33.46769392946132]},{"name":"","coord":[115.59575176872548,34.28339840831147]},{"name":"","coord":[115.53631974831816,35.197319393220624]},{"name":"","coord":[115.3070485514902,35.775883510964334]},{"name":"","coord":[115.8870069012884,36.40529594548765]},{"name":"","coord":[114.74259008644859,37.251396750084155]},{"name":"","coord":[114.56923838363613,38.13141710980106]},{"name":"","coord":[113.39216149668508,38.09075470547468]},{"name":"","coord":[115.261524468934,39.09118520781398]},{"name":"","coord":[115.8182936677897,37.715661598187154]},{"name":"","coord":[116.4582273790399,37.19372347888644]},{"name":"","coord":[116.76192710911863,38.20240042039232]},{"name":"","coord":[116.50410772133856,39.27896741763884]},{"name":"","coord":[117.31988934444873,39.37154482470619]},{"name":"","coord":[116.59734730757869,40.237112944270976]},{"name":"","coord":[115.1823606483226,40.83732566607167]},{"name":"","coord":[117.8693184261954,39.71862889477249]},{"name":"","coord":[119.30467355367742,39.990574652162564]},{"name":"","coord":[117.16275671911026,41.36623845548547]},{"name":"","coord":[119.9342336210531,40.5628822626519]},{"name":"","coord":[120.11853493535794,41.471852354885755]},{"name":"","coord":[118.50943546234379,43.25452976059767]},{"name":"","coord":[121.5167549323861,41.45933087433065]},{"name":"","coord":[122.58571915054674,40.42093503997384]},{"name":"","coord":[124.33549382902183,40.46369290272115]},{"name":"","coord":[123.34064798039414,41.152331397771356]},{"name":"","coord":[122.06718005354679,41.05573599862555]},{"name":"","coord":[121.93889757908204,42.27641773244204]},{"name":"","coord":[122.78904432242356,40.77781183142038]},{"name":"","coord":[122.99508899709724,42.1162195010079]},{"name":"","coord":[124.23100515588399,42.72666083611828]},{"name":"","coord":[124.46027188217573,41.82955407638859]},{"name":"","coord":[122.0729370657937,43.90889130864869]},{"name":"","coord":[120.79456431092532,45.92003249442161]},{"name":"","coord":[123.10619907715235,45.25475749267784]},{"name":"","coord":[124.5462214659102,47.55395009317394]},{"name":"","coord":[124.50992855161529,52.18438447846694]},{"name":"","coord":[127.14721400335922,49.25080134026901]},{"name":"","coord":[124.40329830095243,46.401048760966745]},{"name":"","coord":[126.5214484055605,46.76992452194825]},{"name":"","coord":[124.21244334807682,44.75779381338502]},{"name":"","coord":[124.27839350328821,43.52139065090318]},{"name":"","coord":[125.67392830706305,41.91771808663852]},{"name":"","coord":[125.33529527643432,42.758340204944986]},{"name":"","coord":[126.83350281902375,43.60730120049175]},{"name":"","coord":[125.53597875970374,44.24624314701737]},{"name":"","coord":[127.16780160322108,42.093893880305075]},{"name":"","coord":[127.39125008786029,45.36200668820575]},{"name":"","coord":[130.4703811258197,47.66520688940109]},{"name":"","coord":[128.91240831703635,47.93833794565277]},{"name":"","coord":[131.2677920224311,45.945099776108584]},{"name":"","coord":[132.38059153660274,45.722934218318535]},{"name":"","coord":[132.3184817002743,46.65813679030265]},{"name":"","coord":[132.26174446608726,47.17569713691394]},{"name":"","coord":[122.3210739998419,50.18176996070858]},{"name":"","coord":[113.83749892135485,31.11757234692128]},{"name":"","coord":[110.07354588052804,23.380735604767374]},{"name":"","coord":[107.30931767543106,26.2976919432269]},{"name":"","coord":[119.52482556634342,27.013151692716413]},{"name":"","coord":[120.30037042732202,27.8699145504001]},{"name":"","coord":[120.88886782713843,28.670799172772313]},{"name":"","coord":[119.56796851966463,28.170268394477755]},{"name":"","coord":[118.79479802644406,28.865874397158763]},{"name":"","coord":[119.99381920686633,29.093455548185744]},{"name":"","coord":[120.46546691682343,29.69382513836818]},{"name":"","coord":[121.42142987830871,29.70001162878972]},{"name":"","coord":[119.4405685790891,29.87218307296989]},{"name":"","coord":[118.68748382914703,30.628143499626418]},{"name":"","coord":[119.98261306633574,30.7945175862809]},{"name":"","coord":[120.83889215988998,30.67538495499343]},{"name":"","coord":[121.37534147322967,31.25628247908459]},{"name":"","coord":[120.6906182622391,31.381280695137775]},{"name":"","coord":[120.32182300914366,31.54113306724517]},{"name":"","coord":[119.61953292830165,31.611878565375576]},{"name":"","coord":[118.71890548838064,31.910863187910323]},{"name":"","coord":[119.42349332902813,31.97942313430778]},{"name":"","coord":[117.30651975617157,31.79407863049138]},{"name":"","coord":[116.24668220575353,31.820846193819513]},{"name":"","coord":[117.88422385307969,32.51792621904418]},{"name":"","coord":[120.03124303305091,32.56503102346783]},{"name":"","coord":[120.85599446760912,32.18496706099728]},{"name":"","coord":[120.01812490612667,33.54219948734023]},{"name":"","coord":[119.0749424205415,33.39203631772854]},{"name":"","coord":[118.45404943216346,33.666258719120265]},{"name":"","coord":[117.77482249295966,34.30847766157078]},{"name":"","coord":[116.74147276546373,35.27488504351119]},{"name":"","coord":[117.43359942491492,34.884162021736]},{"name":"","coord":[119.01553213785074,34.54316517587849]},{"name":"","coord":[118.31478835349617,35.28173079028279]},{"name":"","coord":[119.14265350444272,35.54479073199592]},{"name":"","coord":[120.27779044405756,36.3464117375903]},{"name":"","coord":[122.12963327195605,37.13879077904251]},{"name":"","coord":[120.7689567423966,37.19772002195597]},{"name":"","coord":[119.02178548592039,36.49292234053931]},{"name":"","coord":[117.92936024367185,36.60871347163638]},{"name":"","coord":[116.93810893944303,36.0423330118612]},{"name":"","coord":[117.34560282551296,36.769574973846304]},{"name":"","coord":[118.4915054457184,37.52194690335787]},{"name":"","coord":[117.67610299757533,37.4439597758601]},{"name":"","coord":[102.93100245594789,25.481300763922075]},{"name":"","coord":[102.23080854291823,24.156168324611663]},{"name":"","coord":[83.60908162840168,45.3721852373893]},{"name":"","coord":[100.47710030600572,38.704239320458385]},{"name":"","coord":[112.1400670951149,33.03033276715801]},{"name":"","coord":[119.48949608990988,32.80956776339646]},{"name":"","coord":[129.3577692895626,43.24968794080283]},{"name":"","coord":[129.87240796405672,44.7073040108322]},{"name":"","coord":[113.56289691515346,22.14602596262204]},{"name":"","coord":[106.76894508116403,37.72566765880316]},{"name":"","coord":[109.25592217010114,23.86346274681084]},{"name":"","coord":[107.0708132782897,35.30329631658711]},{"name":"","coord":[118.27245878467022,31.657727937739004]},{"name":"","coord":[118.32992684415504,31.081688223101658]},{"name":"","coord":[110.04198076060266,19.694955078668105]},{"name":"","coord":[109.6055304964257,18.6101488675304]},{"name":"","coord":[109.04051999525574,18.643137437909203]},{"name":"","coord":[109.3431358337404,19.550974957403195]},{"name":"","coord":[110.38744429685676,19.47557074114284]},{"name":"","coord":[110.00574767630334,19.367175093044388]},{"name":"","coord":[109.36860737761768,19.214416393082217]},{"name":"","coord":[109.86691465937548,19.073671135862682]},{"name":"","coord":[108.86903802405428,19.017352815445214]},{"name":"","coord":[108.9686431884767,19.182594167127824]},{"name":"","coord":[110.420654296875,19.806565564640795]},{"name":"","coord":[112.38051465474433,35.07958362422394]},{"name":"","coord":[109.53595187364496,18.832908264613966]},{"name":"","coord":[121.96662235866603,39.444150542439914]},{"name":"","coord":[110.81828537536748,19.756501444162936]},{"name":"","coord":[109.38424600793707,18.39186315877128]},{"name":"","coord":[110.28485046979574,18.860240588635115]},{"name":"","coord":[109.95577603229562,18.594712684620465]},{"name":"","coord":[109.71915395436967,19.79420403032508]},{"name":"","coord":[110.41650700703043,19.22315873149372]}]')},670:function(e,t,a){"use strict";a(93),a(112),a(72);var n=a(17),i=a.n(n),r=a(51),s=a.n(r),o=a(62),l=a.n(o),c=(a(87),a(25)),u=a.n(c),d=(a(73),a(408),a(99),a(100),a(334),a(18),a(20),a(28),a(30),a(71),a(27),a(14),a(7)),p=a.n(d),h=a(6),f=a.n(h),m=a(9),y=a.n(m),g=a(8),v=a.n(g),S=a(11),b=a.n(S),I=a(10),E=a.n(I),T=(a(44),a(40),a(36),a(69),a(0)),C=a.n(T),L=(a(32),a(13)),N=a.n(L),k=a(326),O=a.n(k),D=a(1),w=a(12),A=a(81),F=a.n(A),M=(a(92),a(54),a(158)),R=a.n(M),x=(a(466),a(43),String.fromCharCode(parseInt("&#xe62c".replace(/^&#x/,""),16))),P=new ol.style.Style({text:new ol.style.Text({font:"30px supermapol-icons",text:x,offsetX:0,offsetY:-15,fill:new ol.style.Fill({color:"#4A90E2"})})}),V=new ol.style.Style({text:new ol.style.Text({font:"30px supermapol-icons",text:x,offsetX:0,offsetY:-15,fill:new ol.style.Fill({color:"#E63831"})}),zIndex:999}),B=new ol.style.Style({stroke:new ol.style.Stroke({color:"#4A90E2",width:2,lineCap:"round"})}),U=new ol.style.Style({stroke:new ol.style.Stroke({color:"#E63813",width:3,lineCap:"round"}),zIndex:999}),G={DEFAULT_POINT:P,DEFAULT_LINE:B,DEFAULT_POLYGON:new ol.style.Style({fill:new ol.style.Fill({color:[74,144,226,.5]}),stroke:new ol.style.Stroke({color:[74,144,226,1],width:2,lineCap:"round"})}),HIGHLIGHT_POINT:V,HIGHLIGHT_LINE:U,HIGHLIGHT_POLYGON:new ol.style.Style({fill:new ol.style.Fill({color:[230,56,19,.5]}),stroke:new ol.style.Stroke({color:[230,56,19,1],width:3,lineCap:"round"}),zIndex:999})},_=a(2),z=a(22),j=new SuperMap.Format.GeoJSON,W={getFeatureType:function(e,t){var a;return a=e instanceof ol.geom.Polygon||e instanceof ol.geom.MultiPolygon?"_POLYGON":e instanceof ol.geom.LineString||e instanceof ol.geom.MultiLineString||e instanceof ol.geom.LinearRing?"_LINE":e instanceof ol.geom.Point||e instanceof ol.geom.MultiPoint?"_POINT":"_UNKONWN",a=t?"HIGHLIGHT"+a:"DEFAULT"+a},clonePOIsForMarker:function(e){_.a.isArray(e)||(e=[e]);var t=[];return e.forEach((function(e){var a=e.getProperties().attributes,n=e.get("filterField"),i=e.getGeometry().clone(),r=new ol.Feature({geometry:i});a.dataViz_title=n?a[n]:a.name,r.setProperties({attributes:Object.assign({},a)}),t.push(r)})),t},cloneFeature:function(e,t){var a=e.getGeometry(),n=this.getFeatureType(a),i=G[n],r=a.clone(),s=Object.assign({},e.getProperties().attributes),o=new ol.Feature({geometry:r});return o.set("filterField",t),o.setProperties({attributes:s}),o.setStyle(i),o},resolveGetFeaturesEventArgs:function(e,t,a,n,i){var r=e.result,s=r&&e.result.recordsets,o=(s&&s[0]).features.features,l=[],c=r&&r.totalCount,u=new RegExp(t,"i");return o.forEach((function(e){var t=e.properties;delete e.properties;for(var r=_.a.translateTools.readFeature(e,{dataProjection:n||"EPSG:3857",featureProjection:i||"EPSG:3857"}),s=0,o=a.length;s<o;s++)if(u.test(t[a[s]])){r.set("filterField",a[s]);break}r.setStyle(G[this.getFeatureType(r.getGeometry())]),r.setProperties({attributes:t}),l.push(r)}),this),{olFeatures:l,totalHits:c}},getOlFeaturesFromPOI:function(e,t){var a=[];return e.forEach((function(e){var n=new ol.geom.Point([e.location.x,e.location.y]);n=n.transform("EPSG:4326","EPSG:".concat(t));var i=new ol.Feature({geometry:n}),r={name:e.name||e.filters.join(" , "),tel:e.telephone,address:e.address,score:e.score};i.setProperties({attributes:r}),i.setStyle(G.DEFAULT_POINT),a.push(i)})),a},getFeaturesExtent:function(e){e instanceof ol.Feature&&(e=[e]);var t=ol.extent.createEmpty();return e.reduce((function(e,t){return ol.extent.extend(e,t.getGeometry().getExtent()),e}),t)},formatRestDataFeatures:function(e,t,a){var n=this,i=j.toGeoJSON(e),r=_.a.translateTools.readFeatures(i),s=new RegExp(t,"i"),o=a.length,l=[];return r.forEach((function(e){var t=e.getProperties()||{};delete t.geometry,e.setProperties({attributes:t});for(var i=Object.fromEntries(Object.entries(t).map((function(e){var t=R()(e,2),a=t[0],n=t[1];return[a.toUpperCase(),n]}))),r=0;r<o;r++){var c=a[r].toUpperCase(),u=i[c];if(s.test(u)){e.set("filterField",c);break}}void 0!==e.get("filterField")&&(e.setStyle(G[n.getFeatureType(e.getGeometry())]),l.push(e))})),l},formatESFeatures:function(e,t,a,n,i){var r,s,o=this,l=[];return e.forEach((function(e){var c=e._source,u=parseFloat(c[n[0]]),d=parseFloat(c[n[1]]);if(u&&d){var p=new ol.geom.Point([u,d]);!s&&(s=o.getESepsgcode(u,d)),parseInt(i)!==s&&(p=p.transform("EPSG:".concat(s),"EPSG:".concat(i)));var h=new ol.Feature({geometry:p,properties:c});if(h.setProperties({attributes:c}),e.highlight)h.set("filterField",Object.keys(e.highlight)[0]);else{!r&&(r=new RegExp(t));for(var f=0;f<a.length;f++){var m=a[f],y=c[m];if(r.test(y)){h.set("filterField",m);break}}}h.setStyle(G[o.getFeatureType(h.getGeometry())]),l.push(h)}})),l},getESepsgcode:function(e,t){return Math.abs(e)<181&&Math.abs(t)<91?4326:3857},formatESSuggestion:function(e,t,a){var n,i=[];return e.forEach((function(e){var r=e._source;if(e.highlight){var s=Object.keys(e.highlight)[0];i.push(r[s])}else{!n&&(n=new RegExp(t));for(var o=0;o<a.length;o++){var l=a[o],c=r[l];if(n.test(c)){i.push(r[l]);break}}}})),i},zoomToExtent:function(e,t){if(!t)return!1;for(var a in t)if(!_.a.isNumber(t[a]))return!1;if(ol.extent.isEmpty(t))return!1;e.getView().fit(t,{duration:z.a.animateDuration})},getBaseLayerProj:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var a=e.getView().getProjection().getCode();return t?a.split(":")[1]:a}return null},getSelectInfo:function(e,t,a,n,i){var r=null;if(e.length>0){t?t=e.find((function(e){return e.layerId===t.layerId}))||e[0]:(t=e[0],a=0);var s=a,o=this.getAttributes(n,i,t,s);r={selectedLayerInfo:t,layerIdx:s,filterName:null,attributes:o}}return r},getSearchLayerState:function(e,t){if(e){var a={},n=e.selectedLayerInfo,i="".concat(n.layerId,"-").concat(e.layerIdx);return e.attributes&&e.attributes.length>0&&(a[i]=e.attributes),{layersSearchSetting:Object.assign(t,a),selectedLayerInfo:n,selectedChildrenIdx:e.layerIdx,selectedSearchSetting:{key:i,filterName:e.filterName,attributes:e.attributes}}}return{selectedLayerInfo:null,selectedChildrenIdx:0,layersSearchSetting:{},selectedSearchSetting:{key:null,attributes:null}}},getAttributes:function(e,t,a,n){var i=a.searchSetting,r="".concat(a.layerId,"-").concat(n),s=null;if(e&&e.key&&r===e.key&&(s=e.attributes),!s&&t&&t[r]&&(s=t[r]),!s&&i){var o=i.find((function(e){return e.layerIdx===n}));s=o&&o.attributes}return s&&F()(s)},updateView:function(e,t,a,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=e.getView();if(i){var s={duration:z.a.animateDuration};n?(s.resolution=r.getResolutionForExtent(n,this.map.getSize()),s.center=ol.extent.getCenter(n)):(a&&(s.center=a),t&&(s.zoom=t)),r.animate(s)}else n?(r.setResolution(r.getResolutionForExtent(n,this.map.getSize())),r.setCenter(ol.extent.getCenter(n))):(a&&r.setCenter(a),t&&r.setZoom(t))}},H=a(56),Y=function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).state={checked:!1},a.onCheckedChange=a.onCheckedChange.bind(b()(a)),a}return E()(t,e),f()(t,[{key:"onCheckedChange",value:function(e){this.setState({checked:e.target.checked}),this.props.onAdd&&this.props.onAdd(this.props.feature)}},{key:"getInfoUI",value:function(){var e=this.props.feature,t=e.get("attributes");if("Online"===this.props.searchType)return C.a.createElement("div",{className:"poi-result-info"},C.a.createElement("div",{className:"title"},t.name),C.a.createElement("div",{className:"decription"},t.address));var a=e.get("filterField");return C.a.createElement("div",{className:"poi-result-info"},C.a.createElement("span",{className:"title"},"".concat(a,"")),C.a.createElement("span",{className:"decription"},t[a]))}},{key:"render",value:function(){var e=this;return C.a.createElement("div",{className:"poi-result-items".concat(this.props.selected?" selected":""),onClick:function(){e.props.onClick(e.props.feature)}},C.a.createElement("div",{className:"supermapol-icons-point-layer1 poi-result-icon"}),this.getInfoUI(),this.props.isSave&&C.a.createElement(H.a,{onChange:this.onCheckedChange,checked:this.state.checked}))}}]),t}(T.Component);var K=function(e){return C.a.createElement("div",{className:"save-result-btn"},C.a.createElement("div",{onClick:e.addPagedFeatures},DataViz.Language.saveAll),C.a.createElement("div",{onClick:e.addSelectedFeatures},DataViz.Language.saveSelected))},X=a(239),q=a(107),J=a(31),Z=(a(1612),0),Q=function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).state={feature:null},a.onItemsClick=a.onItemsClick.bind(b()(a)),a.onPageChange=a.onPageChange.bind(b()(a)),a.onAdd=a.onAdd.bind(b()(a)),a.addPagedFeatures=a.addPagedFeatures.bind(b()(a)),a.addSelectedFeatures=a.addSelectedFeatures.bind(b()(a)),a}return E()(t,e),f()(t,[{key:"getContent",value:function(){var e=[],t=this.props.searchCache,a=t.cacheFeatures[t.pageIndex];return a&&a.forEach((function(a,n){e.push(C.a.createElement(Y,{onClick:this.onItemsClick,selected:this.state.feature===a,isSave:this.props.isSave,onAdd:this.onAdd,key:"".concat(t.pageIndex,"-").concat(n),feature:a,searchType:t.params.type}))}),this),e}},{key:"showPopup",value:function(e){var t=this;this.props.closeAllPop(this.props.hideMarkerPopup);var a=this.props.map.getOverlayById("poi-pop");if(e){this.pop||(this.pop=document.createElement("div")),a.setElement(this.pop);var n=e.get("attributes"),i=_.a.getFieldsByObj(n),r=C.a.createElement(J.a,{needPropagation:!0,iconClassName:"supermapol-icons-close",onClick:function(){t.props.closeAllPop(t.props.hideMarkerPopup)}}),s=q.a.getDefaultPopupInfo(i,r);a.setPosition(e.getGeometry().getFirstCoordinate()),N.a.render(C.a.createElement(X.a,{className:"dv-poiSearch-popup",olPopupInstance:a,fields:i,attributes:n,popupInfo:s}),this.pop)}}},{key:"onItemsClick",value:function(e,t){if(this.state.feature){var a=this.state.feature.getGeometry(),n=G[W.getFeatureType(a)];this.state.feature.setStyle(n)}if(e){var i=e.getGeometry(),r=G[W.getFeatureType(i,!0)];e.setStyle(r),this.setState({feature:e}),this.showPopup(e),!t&&this.props.goCenter(e)}}},{key:"onAdd",value:function(e){var t=this.props.searchCache,a=t.selectedFeatures.indexOf(e);a>-1?t.selectedFeatures.splice(a,1):t.selectedFeatures.push(e)}},{key:"onPageChange",value:function(e){this.props.searchCache.pageIndex=e,0===this.props.tabIndex?"Elasticsearch"===this.props.searchCache.params.type?this.props.searchElasticsearch():"Online"===this.props.searchCache.params.type?this.props.searchOnline():this.props.searchRestData():this.props.searchLayersFun()}},{key:"addSelectedFeatures",value:function(){this.props.searchCache.selectedFeatures.length>0?(this.addFeaturesToMarkerLayer(this.props.searchCache.selectedFeatures),w.a.showMessage(DataViz.Language.poiSaveSucceed,D.j.SUCCESS)):w.a.showMessage(DataViz.Language.selectedPOI,D.j.WARNING)}},{key:"addPagedFeatures",value:function(){this.addFeaturesToMarkerLayer(this.props.searchCache.cacheFeatures[this.props.searchCache.pageIndex]),w.a.showMessage(DataViz.Language.poiSaveSucceed,D.j.SUCCESS)}},{key:"addFeaturesToMarkerLayer",value:function(e){e&&0!==e.length?this.props.addMarkerLayer({visible:!0,layerType:D.r.MARKER,id:(new Date).getTime(),name:DataViz.Language.poiMarkerlayer+"_"+Z++},W.clonePOIsForMarker(e)):w.a.showMessage(DataViz.Language.selectedSaveFeature,D.j.WARNING)}},{key:"render",value:function(){return C.a.createElement("div",{className:"poi-result"},C.a.createElement("div",{className:"poi-result-content"},this.getContent()),C.a.createElement("div",{className:"poi-result-helper"},C.a.createElement(O.a,{prevPageText:"",firstPageText:"",nextPageText:"",lastPageText:"",linkClassFirst:"supermapol-icons-first fonts",linkClassNext:"supermapol-icons-next fonts",linkClassLast:"supermapol-icons-last fonts",linkClassPrev:"supermapol-icons-prev fonts",innerClass:"dataviz-pagination",itemClass:"dataviz-link",disabledClass:"dataviz-link-disabled",linkClass:"dataviz-link-a",activeLinkClass:"dataviz-link-a-active",onChange:this.onPageChange,activePage:this.props.searchCache.pageIndex,itemsCountPerPage:8,totalItemsCount:this.props.searchCache.totalHits,pageRangeDisplayed:5}),this.props.isSave&&C.a.createElement(K,{addPagedFeatures:this.addPagedFeatures,addSelectedFeatures:this.addSelectedFeatures})))}},{key:"componentWillUnmount",value:function(){var e=this.props.map.getOverlayById("poi-pop");e.getPosition()&&e.setPosition(void 0)}}]),t}(T.Component),$={TABS:["HOT","AB","CD","EFG","H","J","KL","MNP","QR","S","T","W","X","Y","Z"],CITYS:{HOT:{HOT:["","","","","","","","","","","","","","","","","","","",""]},AB:{A:["","","","","","","","","","",""],B:["","","","","","","","","","","","","","","","","","","","","",""]},CD:{C:["","","","","","","","","","","","","","","","","","","","","",""],D:["","","","","","","","","","","","","","","","","","","",""]},EFG:{E:["","",""],F:["","","","","","",""],G:["","","","","","","","","","","",""]},H:{H:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},J:{J:["","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},KL:{K:["","","","",""],L:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},MNP:{M:["","","","","","",""],N:["","","","","","","","","","","","","",""],P:["","","","","","","","",""]},QR:{Q:["","","","","","","","","","","","","","","","",""],R:["",""]},S:{S:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},T:{T:["","","","","","","","","","","","","","","","","","","","","","","","","","",""]},W:{W:["","","","","","","","","","","","","","","","","","","",""]},X:{X:["","","","","","","","","","","","","","","","","","","","","","","","",""]},Y:{Y:["","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Z:{Z:["","","","","","","","","","","","","","","","","","","","","","",""]}}},ee=function(e){function t(){return p()(this,t),y()(this,v()(t).apply(this,arguments))}return E()(t,e),f()(t,[{key:"shouldComponentUpdate",value:function(e,t){return!_.a.shallowEqual(e,this.props)||!_.a.shallowEqual(t,this.state)}},{key:"onCityChange",value:function(e){this.props.onCityChange&&this.props.onCityChange(e.target.innerText.trim())}},{key:"getContent",value:function(){var e=[];return this.props.pyValues.forEach((function(t,a){var n=this;e.push(C.a.createElement("span",{onClick:function(e){n.onCityChange(e)},key:a,className:"city-name"},t))}),this),e}},{key:"render",value:function(){return C.a.createElement("div",{className:this.props.className},C.a.createElement("div",{className:"py-key"},this.props.pyFirst),C.a.createElement("div",{className:"city-content"},this.getContent()))}}]),t}(T.Component),te=(a(1613),function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).state={tabIndex:0},a.onTabsChange=a.onTabsChange.bind(b()(a)),a}return E()(t,e),f()(t,[{key:"shouldComponentUpdate",value:function(e,t){return!_.a.shallowEqual(e,this.props)||!_.a.shallowEqual(this.state,t)}},{key:"getCitysTabs",value:function(){var e=[];return $.TABS.forEach((function(t,a){e.push(C.a.createElement("li",{key:a+t,"data-index":a,className:this.state.tabIndex===a?"on":""},t))}),this),e}},{key:"onTabsChange",value:function(e){var t=e.target.dataset.index;!(t=t&&parseInt(t))&&0!==t||this.state.tabIndex===t||(this.setState({tabIndex:t}),this.props.onTabsChange&&this.props.onTabsChange(t,$.TABS[this.state.tabIndex]))}},{key:"getCitysList",value:function(){var e=$.CITYS[$.TABS[this.state.tabIndex]],t=[];for(var a in e)t.push(C.a.createElement(ee,{onCityChange:this.props.onCityChange,className:a,key:a,pyFirst:a,pyValues:e[a]}));return t}},{key:"render",value:function(){return C.a.createElement("div",{className:"dataviz-cityselector"},C.a.createElement("ul",{onClick:this.onTabsChange},this.getCitysTabs()),C.a.createElement("div",{className:"city"},this.getCitysList()))}}]),t}(T.Component)),ae=a(26),ne=a.n(ae),ie=a(33),re=(a(1614),function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).state={mouseIn:!1},a}return E()(t,e),f()(t,[{key:"render",value:function(){var e=this;return C.a.createElement("div",{onMouseLeave:function(){e.setState({mouseIn:!1})},onMouseEnter:function(){!e.state.mouseIn&&e.setState({mouseIn:!0})},onMouseDown:function(){e.props.onMouseDown(e.props.attributesName)},className:"attributes-items"},C.a.createElement("span",{className:"supermapol-icons-mark"+(this.state.mouseIn?" hover":"")+(this.props.checked?" checked":"")}),C.a.createElement("span",null,this.props.attributesName))}}]),t}(T.Component)),se=function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).requested=!1,a.attributes=[],a.state={show:!1,checkedAttribute:[]},a.hideList=a.hideList.bind(b()(a)),a.onAttributesClick=a.onAttributesClick.bind(b()(a)),a}return E()(t,e),f()(t,[{key:"shouldComponentUpdate",value:function(e,t){return!_.a.shallowEqual(e,this.props)||!_.a.shallowEqual(t,this.state)}},{key:"getCheckedAttribute",value:function(){return this.state.checkedAttribute}},{key:"onAttributesClick",value:function(e){var t=this.state.checkedAttribute.indexOf(e);t>-1?this.state.checkedAttribute.splice(t,1):this.state.checkedAttribute.push(e);var a=[].concat(this.state.checkedAttribute);this.setState({checkedAttribute:a}),this.props.onChange&&this.props.onChange(a)}},{key:"hideList",value:function(){this.setState({show:!1})}},{key:"toggleList",value:function(){var e=this;this.setState({show:!this.state.show},(function(){e.state.show&&e.content.focus()}))}},{key:"getLayerAttibutes",value:function(){var e=this,t=this.props,a=t.searchLayerInfo,n=t.subLayerInfo;if(a.enableFields)this.attributes=a.enableFields,this.toggleList();else if("TILE"===a.layerType&&n)if(this.requested)e.toggleList();else{_.a.queryFeatureBySQL(a.url,n.name,"smid=1",null,"",(function(t){var a=t.result&&t.result.recordsets,n=a&&a[0];e.attributes=n.fields||[],e.requested=!0,e.toggleList()}),(function(){e.attributes=[],e.requested=!0,e.toggleList()}),null,null,!0,e.props.serviceProxy)}}},{key:"getLayerAttibutesUIs",value:function(){var e=[];return this.attributes.forEach((function(t,a){e.push(C.a.createElement(re,{key:a,checked:this.state.checkedAttribute.indexOf(t)>-1,attributesName:t,onMouseDown:this.onAttributesClick}))}),this),e}},{key:"render",value:function(){var e=this,t=24*this.attributes.length>175?175:24*this.attributes.length,a=this.state.checkedAttribute.join(" , ");return C.a.createElement("div",{ref:function(t){e.content=t},className:"attributes-select",tabIndex:"-1",onBlur:this.hideList},C.a.createElement("input",{placeholder:DataViz.Language.selectedAttr,onBlur:function(e){e.stopPropagation()},readOnly:!0,value:a,title:a,onClick:function(){e.getLayerAttibutes()},className:"selected-attributes"}),C.a.createElement("span",{className:"supermapol-icons-solid-triangle"}),C.a.createElement("div",{className:"attributes-content",style:{display:this.state.show?"block":"none",height:t}},C.a.createElement(ie.Scrollbars,{className:"scroll-bars"},this.getLayerAttibutesUIs())))}}],[{key:"getDerivedStateFromProps",value:function(e){return{checkedAttribute:e.attributes||[]}}}]),t}(T.Component),oe=a(47),le=function(e){function t(e){return p()(this,t),y()(this,v()(t).call(this,e))}return E()(t,e),f()(t,[{key:"shouldComponentUpdate",value:function(e,t){return!_.a.shallowEqual(e,this.props)||!_.a.shallowEqual(t,this.state)}},{key:"onSelectedLayerChange",value:function(e,t){var a,n=e.searchSetting,i="".concat(e.layerId,"-").concat(t),r=n&&n.find((function(e){return"".concat(e.layerId,"-").concat(e.layerIdx)===i}));a=this.attrSelect.getCheckedAttribute(),r?(r.attributes=a,r.selectedLayerInfo=e):r={selectedLayerInfo:e,layerIdx:t,attributes:a},this.props.onSelectedChange(r)}},{key:"onAttributeChange",value:function(e,t,a){var n={selectedLayerInfo:e,layerIdx:t,attributes:a};this.props.onSelectedChange(n)}},{key:"render",value:function(){var e=this,t=this.props,a=t.selectedLayerInfo,n=t.layerIdx,i=t.searchLayerInfo,r="".concat(this.props.searchLayerInfo.layerId,"-").concat(n),s="".concat(a.layerId,"-").concat(this.props.selectedChildrenIdx);return C.a.createElement("div",{className:"poi-search-layer"},C.a.createElement(oe.a,{name:"search-layer",onChange:this.onSelectedLayerChange.bind(this,i,n),value:r,selectedValue:s,title:this.props.children},this.props.children),C.a.createElement(se,{ref:function(t){e.attrSelect=t},attributes:this.props.attributes,serviceProxy:this.props.serviceProxy,onChange:this.onAttributeChange.bind(this,i,n),subLayerInfo:this.props.subLayerInfo,searchLayerInfo:this.props.searchLayerInfo}))}}]),t}(T.Component),ce=function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).state={expend:!1},a}return E()(t,e),f()(t,[{key:"getSubLayerUIs",value:function(){var e=this,t=this.props,a=t.searchLayerInfo,n=t.selectedLayerInfo,i=t.selectedChildrenIdx,r=t.onSelectedChange,s=t.getAttributes,o=a.subLayers;return o&&o.length>0?o.map((function(t,o){var l=s(a,o);return C.a.createElement(le,{key:o,attributes:l,serviceProxy:e.props.serviceProxy,searchLayerInfo:a,selectedLayerInfo:n,layerIdx:o,selectedChildrenIdx:i,onSelectedChange:r,subLayerInfo:t},t.name)})):""}},{key:"render",value:function(){var e=this;return C.a.createElement("div",{className:"poi-search-layers"},C.a.createElement("div",{className:"expand-btn",onClick:function(){e.props.refreshScroller(),e.setState({expend:!e.state.expend})}},C.a.createElement("div",{className:this.state.expend?"expand-icons supermapol-icons-zoomout":"expand-icons supermapol-icons-zoomin"}),C.a.createElement("div",null,this.props.children)),C.a.createElement("div",{style:{display:this.state.expend?"block":"none"},className:"poi-search-layergroup"},this.getSubLayerUIs()))}}]),t}(T.Component),ue=(a(207),a(61)),de=a(37);var pe=function(e){return C.a.createElement("div",{className:"poi-no-layer"},C.a.createElement("div",{className:"image"}),C.a.createElement("div",{className:"text"},e.text||DataViz.Language.noLayerNow))};function he(e){return C.a.createElement("div",{className:"poi-filter-items"},C.a.createElement("div",{className:"filter-name"},C.a.createElement("span",null,e.filterName),e.isSave&&C.a.createElement("span",{onClick:e.delete,className:"filter-delete supermapol-icons-delete"}),C.a.createElement("span",{className:"filter-time"},DataViz.Language.createTime+" : "+e.createTime)),C.a.createElement("div",{className:"filter-des"},C.a.createElement("span",null,e.layerName),C.a.createElement("span",null,e.filters)))}var fe=function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).state={currentFilterIdx:0},a.openLoadFilterModal=a.openLoadFilterModal.bind(b()(a)),a.useFilter=a.useFilter.bind(b()(a)),a.onSelectChange=a.onSelectChange.bind(b()(a)),a}return E()(t,e),f()(t,[{key:"deleteBtnClick",value:function(e){this.props.removeFilter(e),this.setState({currentFilterIdx:0})}},{key:"onSelectChange",value:function(e,t){this.setState({currentFilterIdx:t})}},{key:"useFilter",value:function(){this.props.useFilter(this.state.currentFilterIdx,!0),this.loadModal.hideModal()}},{key:"openLoadFilterModal",value:function(){this.loadModal.showModal(),this.props.afterOpenModal()}},{key:"getSelectValues",value:function(){var e,t=[];return this.props.filters.forEach((function(e){t.push(e.filterName)})),t.length>0&&(e=t[this.state.currentFilterIdx]),{values:t,selectedValue:e}}},{key:"getFilterItem",value:function(){var e=this.props.filters[this.state.currentFilterIdx];return e?C.a.createElement(he,{delete:this.deleteBtnClick.bind(this,e.filterName),filterName:e.filterName,createTime:e.createTime,layerName:e.layerName,isSave:this.props.isSave,filters:e.attributes.join(" , ")}):C.a.createElement(pe,{text:DataViz.Language.noFilter})}},{key:"render",value:function(){var e=this,t=this.getSelectValues();return C.a.createElement("div",{className:"save-btn",onClick:this.openLoadFilterModal},C.a.createElement("span",{className:"supermapol-icons-poi-load"}),C.a.createElement("span",null,DataViz.Language.loadSearchFilter),C.a.createElement(ue.a,{okCallBack:this.useFilter,modalTitle:DataViz.Language.loadFilter,ref:function(t){e.loadModal=t},modalWidth:520},C.a.createElement("div",{className:"poi-filter-select"},C.a.createElement("span",null,DataViz.Language.useFilter),C.a.createElement(de.b,{onChange:this.onSelectChange,values:t.values,selectedValue:t.selectedValue})),C.a.createElement("div",{className:"poi-filter-des"},this.getFilterItem())))}}]),t}(T.Component),me=function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).addFilter=a.addFilter.bind(b()(a)),a}return E()(t,e),f()(t,[{key:"addFilter",value:function(){var e=this.filterInput.value;e.trim()?this.props.hasFilter(e).has?w.a.showMessage(DataViz.Language.exsitFilterName):(this.props.addFilter(e),this.saveModal.hideModal()):w.a.showMessage(DataViz.Language.inputFilterName)}},{key:"render",value:function(){var e=this;return C.a.createElement("div",{className:"load-btn",onClick:function(){e.saveModal.showModal()}},C.a.createElement("span",{className:"supermapol-icons-poi-save"}),C.a.createElement("span",null,DataViz.Language.saveSearchFilter),C.a.createElement(ue.a,{okCallBack:this.addFilter,modalWidth:416,modalTitle:DataViz.Language.saveFilter,ref:function(t){e.saveModal=t}},C.a.createElement("div",{className:"poi-save-filter"},C.a.createElement("label",null,DataViz.Language.filterName),C.a.createElement("input",{ref:function(t){e.filterInput=t},type:"text",maxLength:20,placeholder:DataViz.Language.maxNameLength}))))}}]),t}(T.Component),ye=function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).state={filter:[]},a.getFilters=a.getFilters.bind(b()(a)),a.hasFilter=a.hasFilter.bind(b()(a)),a.addFilter=a.addFilter.bind(b()(a)),a.useFilter=a.useFilter.bind(b()(a)),a.removeFilter=a.removeFilter.bind(b()(a)),a}return E()(t,e),f()(t,[{key:"shouldComponentUpdate",value:function(e,t){return!_.a.shallowEqual(e,this.props)||!_.a.shallowEqual(t,this.state)}},{key:"hasFilter",value:function(e){for(var t=this.state.filter,a=!1,n=0,i=t.length;n<i;n++)if(t[n].filterName===e){a=!0;break}return{has:a,index:a?n:-1}}},{key:"removeFilter",value:function(e){var t=this.hasFilter(e),a=t.has,n=t.index,i=this.state.filter[n].layerId,r=this.props.searchLayers.find((function(e){return e.layerId===i})),s=r.searchSetting;if(a&&n>-1){var o=this.state.filter[n];this.state.filter.splice(n,1);var l=s.findIndex((function(t){return t.filterName===e||t.name===e}));s.splice(l,1),s&&!s.length&&delete r.searchSetting,this.setState({filter:[].concat(this.state.filter)}),this.props.deletedLayerSearchSetting&&this.props.deletedLayerSearchSetting(o)}else w.a.showMessage("no filter")}},{key:"useFilter",value:function(e){var t=this.state.filter[e];t?(w.a.showMessage(DataViz.Language.matchSuccess,D.j.SUCCESS,1500),this.props.onSelectedChange&&this.props.onSelectedChange(t)):w.a.showMessage(DataViz.Language.noFilter)}},{key:"addFilter",value:function(e){var t=this.props.selectedLayerInfo,a=this.props.attributes;if(!(a=a&&a.filter((function(e){return null!=e})))||a&&0===a.length)w.a.showMessage(DataViz.Language.noSearchFilter,"warning");else if(t){var n,i=new Date,r="".concat(i.getFullYear(),".").concat(i.getMonth()+1,".").concat(i.getDate()),s=t.layerId;n="TILE"===t.layerType?t.subLayers[this.props.selectedChildrenIdx].name:t.name;var o={layerIdx:this.props.selectedChildrenIdx,filterName:e,attributes:[].concat(this.props.attributes),createTime:r,layerId:s,layerName:n};t.searchSetting||(t.searchSetting=[]),this.state.filter.push(o),this.setState({filter:[].concat(this.state.filter)}),o.name=e,t.searchSetting.push(o),this.props.addLayerSearchSetting&&this.props.addLayerSearchSetting(o),w.a.showMessage(DataViz.Language.saveFilterSuccess,D.j.SUCCESS,1500)}else w.a.showMessage(DataViz.Language.noLayerNow)}},{key:"getFilters",value:function(){var e=[],t=this.props.searchLayers;t&&t.forEach((function(t){var a=t.layerType,n=t.searchSetting;n&&n.forEach((function(n){if(n){var i={attributes:[].concat(n.attributes),createTime:n.createTime,filterName:n.name,layerName:n.layerName||t.name,layerIdx:0,layerId:t.layerId};if("TILE"===a){var r=t.subLayers,s=r&&r.findIndex((function(e){return e.name===i.layerName}));i.layerIdx=s>0?s:0}e.push(i)}}))})),this.setState({filter:e})}},{key:"render",value:function(){return C.a.createElement("div",{className:"poi-layers-header"},C.a.createElement(fe,{useFilter:this.useFilter,removeFilter:this.removeFilter,filters:this.state.filter,afterOpenModal:this.getFilters,isSave:this.props.isSave}),this.props.isSave&&C.a.createElement(me,{hasFilter:this.hasFilter,addFilter:this.addFilter}))}}]),t}(T.Component),ge=function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).refreshScroller=a.refreshScroller.bind(b()(a)),a.getAttributes=a.getAttributes.bind(b()(a)),a}return E()(t,e),f()(t,[{key:"refreshScroller",value:function(){this.refs.scroller.forceUpdate()}},{key:"getAttributes",value:function(e,t){var a=this.props.selectedSearchSetting,n=this.props.layersSearchSetting;return W.getAttributes(a,n,e,t)}},{key:"getLayersUIs",value:function(){var e=this,t=[],a=this.props.searchLayers;return a.forEach((function(n,i){var r=e.props.selectedLayerInfo||a[0];if("TILE"!==n.layerType){var s=e.getAttributes(n,0);t.push(C.a.createElement(le,{key:i,attributes:s,onSelectedChange:e.props.onSelectedChange,layerIdx:0,serviceProxy:e.props.serviceProxy,selectedChildrenIdx:e.props.selectedChildrenIdx,selectedLayerInfo:r,searchLayerInfo:n},n.name))}else t.push(C.a.createElement(ce,{refreshScroller:e.refreshScroller,getAttributes:e.getAttributes,key:i,serviceProxy:e.props.serviceProxy,onSelectedChange:e.props.onSelectedChange,selectedChildrenIdx:e.props.selectedChildrenIdx,selectedLayerInfo:r,searchLayerInfo:n},n.name))}),this),0===t.length&&t.push(C.a.createElement(pe,{key:"no-layer"})),t}},{key:"render",value:function(){var e=this.props.selectedLayerInfo,t=e&&this.props.layersSearchSetting["".concat(e.layerId,"-").concat(this.props.selectedChildrenIdx)];return C.a.createElement("div",{className:"poi-layers-content"},C.a.createElement(ye,{addLayerSearchSetting:this.props.addLayerSearchSetting,deletedLayerSearchSetting:this.props.deletedLayerSearchSetting,selectedLayerInfo:e,onSelectedChange:this.props.onSelectedChange,searchLayers:this.props.searchLayers,attributes:t,selectedChildrenIdx:this.props.selectedChildrenIdx,isSave:this.props.isSave}),C.a.createElement(ie.Scrollbars,{ref:"scroller",className:"scroll-bars",renderTrackHorizontal:function(e){return C.a.createElement("div",ne()({},e,{style:{display:"none"},className:"track-horizontal"}))},style:{height:"310px",width:"490px"}},this.getLayersUIs()))}}]),t}(T.Component),ve=a(669),Se=a.n(ve),be=a(671),Ie="",Ee=function(e,t,a){for(var n=0,i=e.length;n<i;++n)if(t.call(a,e[n],n))return e[n];return null};var Te=function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).state={tabIndex:e.needPoi?0:1,selectedCity:"",showSetting:!1,selectedLayerInfo:null,selectedChildrenIdx:0,layersSearchSetting:{},selectedSearchSetting:{key:null,attributes:null}},a.onCityChange=a.onCityChange.bind(b()(a)),a.onSelectedLayerChange=a.onSelectedLayerChange.bind(b()(a)),a.hideSetting=a.hideSetting.bind(b()(a)),a.onTabsChange=a.onTabsChange.bind(b()(a)),a}return E()(t,e),f()(t,[{key:"hideSetting",value:function(){this.state.showSetting&&this.setState({showSetting:!1})}},{key:"componentWillReceiveProps",value:function(e){if(e.needLayer&&!e.needPoi&&this.onTabsChange(1),e.searchLayers.length!==this.props.searchLayers.length&&1===this.state.tabIndex){var t=e.searchLayers,a=this.state,n=a.selectedLayerInfo,i=a.selectedChildrenIdx,r=a.selectedSearchSetting,s=a.layersSearchSetting,o=W.getSelectInfo(t,n,i,r,s);this.onSelectedLayerChange(o)}}},{key:"shouldComponentUpdate",value:function(e,t){return!_.a.shallowEqual(this.props,e)||!_.a.shallowEqual(this.state,t)}},{key:"onCityChange",value:function(e,t){var n=this.state,i=n.selectedCity,r=n.tabIndex;this.cityNameCache=e||i;var s=this.props.map;if(0===r){this.setState({selectedCity:this.cityNameCache,showSetting:!1}),this.props.changeSelectCity&&this.props.changeSelectCity(e);var o=W.getBaseLayerProj(s);a.e(1).then(a.t.bind(null,1662,7)).then((function(){var a=function(e,t){var a=window.MunicipalData.features,n=null,i=Ee(a,(function(t,a){return t.properties.Name===e}));return i&&(n=ol.proj.transformExtent(Se()(i),"EPSG:4326",t)),n}(e,o);a&&!t&&W.zoomToExtent(s,a)}))}}},{key:"onTabsChange",value:function(e){if(e!==this.state.tabIndex){var t;if(this.setState({tabIndex:e}),0===e)t=this.cityNameCache,this.cityNameCache!==this.state.selectedCity&&this.setState({selectedCity:this.cityNameCache}),this.props.changeSelectCity(t);else{var a=this.props.searchLayers,n=this.state,i=n.selectedLayerInfo,r=n.selectedChildrenIdx,s=n.selectedSearchSetting,o=n.layersSearchSetting;t=W.getSelectInfo(a,i,r,s,o),this.onSelectedLayerChange(t)}this.props.changeSelectTab&&this.props.changeSelectTab(e)}}},{key:"onSelectedLayerChange",value:function(e){var t=this.state.layersSearchSetting,a=this.props.searchLayers;e&&!e.selectedLayerInfo&&(e.selectedLayerInfo=a.find((function(t){return t.layerId===e.layerId}))||a[0]);var n=W.getSearchLayerState(e,t);n&&this.setState(s()({},n)),this.props.changeSelectSearchLayer(e)}},{key:"render",value:function(){var e=this,t=this.state.selectedLayerInfo,a=this.props.needPoi,n=this.props.needLayer,i=this.state.selectedCity,r=t?t.name:DataViz.Language.searchLayers,s=0===this.state.tabIndex?i:r;return C.a.createElement("div",{className:"dataviz-poi-settings"},C.a.createElement("div",{className:"dataviz-poi-settings-name",onClick:function(){e.setState({showSetting:!e.state.showSetting})}},s,C.a.createElement("span",{className:"supermapol-icons-solid-triangle",style:{marginLeft:4}})),C.a.createElement("div",{className:"dataviz-poi-settings-content",style:{display:this.state.showSetting?"block":"none"}},C.a.createElement("span",{onClick:function(){e.setState({showSetting:!1})},className:"supermapol-icons-close"}),C.a.createElement("div",{className:"settings-tab-title"},a&&C.a.createElement("span",{onClick:function(){e.onTabsChange(0)},className:0===this.state.tabIndex?"tabs-select":""},DataViz.Language.searchCity),n&&C.a.createElement("span",{onClick:function(){e.onTabsChange(1)},className:1===this.state.tabIndex?"tabs-select":""},DataViz.Language.searchLayers)),C.a.createElement("div",{className:"settings-tab-content"},a&&C.a.createElement("div",{style:{display:0===this.state.tabIndex?"block":"none"},className:"city-select"},C.a.createElement(te,{onCityChange:this.onCityChange})),n&&C.a.createElement("div",{style:{display:1===this.state.tabIndex?"block":"none"},className:"layers-select"},C.a.createElement(ge,{map:this.props.map,selectedLayerInfo:this.state.selectedLayerInfo,selectedChildrenIdx:this.state.selectedChildrenIdx,layersSearchSetting:this.state.layersSearchSetting,selectedSearchSetting:this.state.selectedSearchSetting,addLayerSearchSetting:this.props.addLayerSearchSetting,deletedLayerSearchSetting:this.props.deletedLayerSearchSetting,isSave:this.props.isSave,serviceProxy:this.props.serviceProxy,onSelectedChange:this.onSelectedLayerChange,searchLayers:this.props.searchLayers})))))}}]),t}(T.Component);var Ce=function(e){return C.a.createElement("div",{className:"dataviz-poi-loading"})},Le=(a(1616),a(259),a(1617),function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).state={show:!1,suggestions:[],selectedIndex:-1},a}return E()(t,e),f()(t,[{key:"show",value:function(e){var t=this.state;e!==this.state.suggestions&&(t.suggestions=e),t.selectedIndex=-1,t.show=!!t.suggestions.length,this.setState(t)}},{key:"hide",value:function(){this.setState({show:!1,suggestions:[],selectedIndex:-1})}},{key:"search",value:function(e){this.props.updateKeyWords(this.state.suggestions[e],!0)}},{key:"getContentUI",value:function(){var e=this,t=[],a=null;return this.state.suggestions.forEach((function(n,i){a=C.a.createElement("p",{key:i,onClick:e.search.bind(e,i),className:e.state.selectedIndex===i?"active":""},n),t.push(a)})),t}},{key:"changeSelectedIndex",value:function(e){if(this.state.show){var t=this.state.selectedIndex;"ARROWUP"===e&&t>0?t-=1:"ARROWDOWN"===e&&t<this.state.suggestions.length-1&&(t+=1),this.props.updateKeyWords(this.state.suggestions[t],!1),this.setState({selectedIndex:t})}}},{key:"render",value:function(){var e=this;return C.a.createElement("div",{ref:function(t){e.suggestion=t},className:"poi-suggestion",style:{display:this.state.show?"block":"none"}},this.getContentUI())}}]),t}(T.Component)),Ne=["long","integer","short","byte","double","float","half_float","scaled_float"],ke=[],Oe={pageIndex:1,cacheFeatures:{},selectedFeatures:[],totalHits:0,params:{},initSelectedFeatures:function(){Oe.selectedFeatures=[]},toDefault:function(){Oe.pageIndex=1,Oe.cacheFeatures={},Oe.totalHits=0,Oe.selectedFeatures=[],Object.keys(Oe.params).length&&("Elasticsearch"===Oe.params.type?(delete Oe.params.queryCondition,delete Oe.params.highlightCondition):"RestData"===Oe.params.type&&delete Oe.params.attributeFilter)}},De=["INT16","INT32","INT64","SINGLE","DOUBLE"],we=function(e){function t(e){var a;return p()(this,t),(a=y()(this,v()(t).call(this,e))).state={keyWords:"",showLoading:!1,currentPageFeatures:null,showDelete:!1},a.onDeletePress=a.onDeletePress.bind(b()(a)),a.searchOnline=a.searchOnline.bind(b()(a)),a.searchLayersFun=a.searchLayersFun.bind(b()(a)),a.searchRestData=a.searchRestData.bind(b()(a)),a.searchElasticsearch=a.searchElasticsearch.bind(b()(a)),a.updateKeyWords=a.updateKeyWords.bind(b()(a)),a.onChange=a.onChange.bind(b()(a)),a.goCenter=a.goCenter.bind(b()(a)),a.searchLayerInfo=null,a.searchCityName="",a.changeSelectCity=a.changeSelectCity.bind(b()(a)),a.changeSelectSearchLayer=a.changeSelectSearchLayer.bind(b()(a)),a.changeSelectTab=a.changeSelectTab.bind(b()(a)),a.tabIndex=e.needPoi?0:1,a.epsgCode=3857,a.restDataFieldsType={},a.searchFailed=a.searchFailed.bind(b()(a)),a}var n,r,o;return E()(t,e),f()(t,[{key:"componentDidMount",value:function(){this.props.needPoi&&this.bindMapEvents();var e=dataVizConfig.searchSetting,t=e.searchType,a=e.restDataUrl,n=e.restDataFields;if("RestData"===t&&a){var i=this;_.a.doFetch("".concat(a,"/fields.json?returnAll=true")).then((function(e){var t=n.map((function(e){return e.toUpperCase()}));e.filter((function(e){return t.includes(e.name.toUpperCase())})).forEach((function(e){var t=e.name,a=e.type;i.restDataFieldsType[t.toUpperCase()]=De.includes(a)?"number":"string"}))}))}}},{key:"componentWillUnmount",value:function(){ke&&ol.Observable.unByKey(ke)}},{key:"bindMapEvents",value:function(){var e=this,t=this.props.map;ke.push(t.on("moveend",(function(n){_.a.delayCall((function(){var e=this;a.e(1).then(a.t.bind(null,1662,7)).then((function(){var a=W.getBaseLayerProj(t),n=function(e,t){var a=window.MunicipalData.features;e={type:"Point",coordinates:e=ol.proj.transform(e,t,"EPSG:4326")};var n=Ee(a,(function(t,a){return Object(be.a)(e,t)}));return n?Ie=n.properties.Name:Ie}(t.getView().getCenter(),a)||"";e.settings.onCityChange(n,!0)}))}),500,e)}))),ke.push(t.on("click",(function(a){if(!window.DataViz.isMeasure){var n=t.getFeaturesAtPixel(a.pixel,{layerFilter:function(e){return"poi-layer"===e.getProperties().dataVizId}});n&&n.length>0&&(n=n[n.length-1],e.result&&e.result.onItemsClick(n,!0))}})))}},{key:"changeSelectCity",value:function(e){this.searchCityName=e}},{key:"changeSelectSearchLayer",value:function(e){this.searchLayerInfo=e,e||this.onDeletePress()}},{key:"changeSelectTab",value:function(e){this.tabIndex=e,Oe.toDefault(),Oe.initSelectedFeatures(),this.props.poiLayer.getSource().clear(),this.setState({keyWords:"",currentPageFeatures:null,showDelete:!1})}},{key:"searchLayersFun",value:function(){if(!this.searchLayerInfo||!this.searchLayerInfo.attributes||this.searchLayerInfo.attributes&&0===this.searchLayerInfo.attributes.length)this.searchFailed();else{var e=this.searchLayerInfo.selectedLayerInfo,t=this.searchLayerInfo.attributes,a=this.searchLayerInfo.layerIdx,n=e.features,i=this.searchLayerInfo.selectedLayerInfo.url;"TILE"===e.layerType?(this.loading(!0),this.searchIServerLayers(i,a,t)):this.searchVectorLayers(n,t)}}},{key:"searchIServerLayers",value:function(e,t,a){var n=this,i=Oe.cacheFeatures[Oe.pageIndex];if(Oe.initSelectedFeatures(),Oe.params.type="Tile",i)n.addFeatures(i);else{var r=_.a.isNumber(this.state.keyWords)?" = ".concat(this.state.keyWords):" LIKE '%".concat(this.state.keyWords,"%'"),s=a.join("".concat(r," OR ")),o=this.searchLayerInfo.selectedLayerInfo,l=o.subLayers[t].name,c=o.orginEpsgCode?o.orginEpsgCode:"EPSG:3857";s+=r;_.a.queryFeatureBySQL(e,l,s,null,this.epsgCode,(function(e){var t=W.resolveGetFeaturesEventArgs(e,n.state.keyWords,a,c,"EPSG:".concat(n.epsgCode));t.olFeatures.length>0?(Oe.cacheFeatures[Oe.pageIndex]=t.olFeatures,Oe.totalHits=t.totalHits,n.addFeatures(t.olFeatures),n.loading(!1)):n.searchFailed()}),n.searchFailed,8*(Oe.pageIndex-1),8,null,n.props.serviceProxy)}}},{key:"searchVectorLayers",value:function(e,t){var a=Oe.cacheFeatures[Oe.pageIndex];if(Oe.initSelectedFeatures(),Oe.params.type="Vector",a)this.addFeatures(a);else{var n=new RegExp(this.state.keyWords.toLowerCase()),i=[];if(e.forEach((function(e){for(var a=e.get("attributes"),r=0,s=t.length;r<s;r++)if(a[t[r]]&&n.test(a[t[r]].toString().toLowerCase())){i.push(W.cloneFeature(e,t[r]));break}})),0===i.length)this.searchFailed();else{var r=Math.ceil(i.length/8);Oe.totalHits=i.length;for(var s=0;s<r;s++)Oe.cacheFeatures[s+1]=i.splice(0,8);this.addFeatures(Oe.cacheFeatures[Oe.pageIndex])}}}},{key:"searchRestData",value:function(){var e=this,t=Oe.cacheFeatures[Oe.pageIndex];if(Oe.initSelectedFeatures(),t)e.addFeatures(t);else{var a=Oe.params,n=e.state.keyWords;a.attributeFilter||(a.attributeFilter=a.fields.reduce((function(t,a){return a=a.toUpperCase(),"number"===e.restDataFieldsType[a.toUpperCase()]?isNaN(+n)?t:t+"".concat(a," = '").concat(n,"' OR "):t+"".concat(a," LIKE '%25").concat(n,"%25' OR ")}),""),a.attributeFilter=a.attributeFilter.slice(0,-4)),_.a.doFetch("".concat(a.url,"/featureResults.json?returnContent=true"),{method:"POST",data:{getFeatureMode:"SQL",datasetNames:["".concat(a.datasources,":").concat(a.datasets)],targetEpsgCode:this.epsgCode,queryParameter:{name:"".concat(a.datasets,"@").concat(a.datasources),attributeFilter:a.attributeFilter,fields:a.displayFields.length?a.displayFields:null}}}).then((function(t){if(t.totalCount>0){for(var i=W.formatRestDataFeatures(t.features,n,a.fields),r=Oe.totalHits=i.length,s=Math.ceil(r/8),o=0;o<s;o++)Oe.cacheFeatures[o+1]=i.splice(0,8);e.addFeatures(Oe.cacheFeatures[Oe.pageIndex]),e.loading(!1)}else e.searchFailed()})).catch((function(t){e.searchFailed()}))}}},{key:"searchOnline",value:function(){var e=this,t=Oe.cacheFeatures[Oe.pageIndex];if(Oe.initSelectedFeatures(),t)e.addFeatures(t);else{var a="https://www.supermapol.com/iserver/services/localsearch/rest/searchdatas/China/poiinfos.json?keywords={keywords}&city={city}&pageNum={pageNum}&pageSize={pageSize}&key={key}".replace("{keywords}",this.state.keyWords).replace("{city}",this.searchCityName).replace("{pageSize}",8).replace("{pageNum}",Oe.pageIndex).replace("{key}",Oe.params.key);_.a.doFetch(encodeURI(a),{method:"GET"}).then((function(t){if(t.totalHits&&t.totalHits>0){var a=W.getOlFeaturesFromPOI(t.poiInfos,e.epsgCode);Oe.totalHits=t.totalHits,Oe.cacheFeatures[Oe.pageIndex]=a,e.addFeatures(a)}else e.searchFailed();e.loading(!1)})).catch((function(t){var a;"401"===t&&(a=DataViz.Language.noSearchPermission),e.searchFailed(a)}))}}},{key:"searchElasticsearch",value:(o=u()(i.a.mark((function e(){var t,a,n,r,o=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this,a=Oe.cacheFeatures[Oe.pageIndex],n=this.state.keyWords,this.props.closeAllPop(),Oe.initSelectedFeatures(),a?t.addFeatures(a):((r=Oe.params).queryCondition||(r.queryCondition=[],r.highlightCondition={},r.fields.forEach((function(e){r.highlightCondition[e]={};var t=r.esDataTypes[e];if("keyword"===t)r.queryCondition.push({wildcard:l()({},e,"*".concat(n,"*"))});else{if(Ne.includes(t)&&!_.a.isNumber(n))return;r.queryCondition.push({match:l()({},e,n)})}}))),_.a.doFetch(_.a.getUrl("".concat(r.url,"/_search")),{method:"POST",headers:{"Content-Type":"application/json"},data:{query:{bool:{should:r.queryCondition}},size:8,from:8*(Oe.pageIndex-1),highlight:{pre_tags:"<b>",post_tags:"</b>",fields:s()({},Oe.params.highlightCondition)}}}).then((function(e){if(e.hits&&e.hits.total.value>0){Oe.totalHits=e.hits.total.value;var a=W.formatESFeatures(e.hits.hits,o.state.keyWords,r.fields,r.coords,o.epsgCode);if(!a.length)return void t.searchFailed(DataViz.Language.elasticsearchCoordsError);Oe.cacheFeatures[Oe.pageIndex]=a,t.addFeatures(a),t.loading(!1),t.suggestion.hide()}else t.searchFailed()})).catch((function(e){t.searchFailed()})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"addFeatures",value:function(e){var t=this.props.poiLayer.getSource();t.clear(),t.addFeatures(e),this.setState({currentPageFeatures:this.state.keyWords+"-"+Oe.pageIndex}),W.zoomToExtent(this.props.map,W.getFeaturesExtent(e))}},{key:"goCenter",value:function(e){var t=e.getGeometry().getFirstCoordinate();W.updateView(this.props.map,null,t)}},{key:"loading",value:function(e){this.setState({showLoading:e})}},{key:"searchFailed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DataViz.Language.noResult;w.a.showMessage(e),Oe.initSelectedFeatures(),Oe.toDefault(),this.props.poiLayer.getSource().clear(),this.suggestion&&this.suggestion.hide(),this.setState({currentPageFeatures:null,showLoading:!1})}},{key:"getESDataTypes",value:function(){return _.a.doFetch(_.a.getUrl("".concat(Oe.params.url,"/_mapping")),{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){if(e.error)throw e.status;var t={},a=e[Object.keys(e)[0]].mappings.properties;for(var n in a)t[n]=a[n].type;return t}))}},{key:"onSearch",value:(r=u()(i.a.mark((function e(){var t,a,n,r,s,o,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Oe.params,this.epsgCode=W.getBaseLayerProj(this.props.map,!0)||3857,Oe.toDefault(),!_.a.isString(this.state.keyWords)||""!==this.state.keyWords.trim()){e.next=5;break}return e.abrupt("return");case 5:if(this.settings.hideSetting(),0!==this.tabIndex){e.next=62;break}if(this.loading(!0),"RestData"!==(a=dataVizConfig.searchSetting).searchType){e.next=29;break}if((n=a.restDataUrl.match(/(^.+\/rest\/data)\/datasources\/(.+?)\/datasets\/(.+?$)/))&&(!n||4===n.length)){e.next=16;break}return this.searchFailed(DataViz.Language.restDataUrlError),e.abrupt("return");case 16:if(a.restDataFields.length){e.next=19;break}return this.searchFailed(DataViz.Language.noRestDataFields),e.abrupt("return");case 19:r=n[1],s=n[2],o=n[3],t.type="RestData",t.url=r,t.datasources=s,t.datasets=o,t.fields=a.restDataFields,t.displayFields=a.restDataDisplayFields,this.searchRestData(),e.next=60;break;case 29:if("Online"!==a.searchType){e.next=47;break}if(l="fvV2osxwuZWlY0wJb8FEb2i5",!window.isSuperMapOL){e.next=44;break}return e.next=34,_.a.checkReLogin().catch((function(e){return e}));case 34:if(e.sent.checkReLogin){e.next=39;break}return e.next=38,_.a.getPrivateKey();case 38:l=e.sent;case 39:t.type="Online",t.key=l,this.searchOnline(),e.next=45;break;case 44:""!==a.onlineKey?(l=a.onlineKey,t.type="Online",t.key=l,this.searchOnline()):this.searchFailed(DataViz.Language.noOnlineSearchKey);case 45:e.next=60;break;case 47:if("Elasticsearch"!==a.searchType){e.next=60;break}if(!t.failed){e.next=52;break}this.searchFailed(DataViz.Language.elasticsearchUrlError),e.next=60;break;case 52:return e.next=54,this.getESParams();case 54:if(e.t0=e.sent,e.t0){e.next=57;break}e.t0={};case 57:t.esDataTypes=e.t0,t.fields.length||(t.fields=Object.keys(t.esDataTypes)),this.searchElasticsearch();case 60:e.next=63;break;case 62:this.searchLayersFun();case 63:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getESParams",value:function(){var e=dataVizConfig.searchSetting,t=Oe.params;return!Object.keys(t).length&&e&&(t.type="Elasticsearch",t.url=e.elasticsearchUrl,t.fields=e.elasticsearchFields,t.coords=e.elasticsearchCoords),t.esDataTypes?new Promise((function(e,a){e(t.esDataTypes)})):this.getESDataTypes().then((function(e){return e})).catch((function(e){t.failed=!0}))}},{key:"getESSuggestion",value:(n=u()(i.a.mark((function e(t){var a,n,r,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this,n=Oe.params,r=[],o={},e.next=3,this.getESParams();case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0={};case 6:n.esDataTypes=e.t0,n.fields.length||(n.fields=Object.keys(n.esDataTypes)),n.fields.forEach((function(e){o[e]={};var a=n.esDataTypes[e];if("keyword"===a)r.push({wildcard:l()({},e,"*".concat(t,"*"))});else{if(Ne.includes(a)&&!_.a.isNumber(t))return;r.push({match:l()({},e,t)})}})),_.a.doFetch(_.a.getUrl("".concat(n.url,"/_search")),{method:"POST",headers:{"Content-Type":"application/json"},data:{query:{bool:{should:r}},size:5,highlight:{pre_tags:"<b>",post_tags:"</b>",fields:s()({},o)}}}).then((function(e){if(!Oe.totalHits&&""!==a.state.keyWords)if(e.hits&&e.hits.total.value>0){var i=W.formatESSuggestion(e.hits.hits,t,n.fields);a.suggestion.show(i)}else a.suggestion.hide()}));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onKeyPressEvent",value:function(e){var t=e.key.toUpperCase();"ENTER"===t&&""!==this.state.value?this.onSearch():["ARROWDOWN","ARROWUP"].includes(t)&&this.suggestion&&this.suggestion.changeSelectedIndex(t)}},{key:"updateKeyWords",value:function(e,t){var a=this;e&&this.setState({keyWords:e,showDelete:!0},(function(){t&&a.onSearch()}))}},{key:"onChange",value:function(e){var t=this,a=e.target.value,n=this.state;a!==n.keyWords&&(n.keyWords=a,n.showDelete=""!==a,this.suggestion&&!Oe.params.failed&&(n.currentPageFeatures=null,this.props.poiLayer.getSource().clear(),Oe.toDefault(),""===a?this.suggestion.hide():_.a.delayCall((function(){t.getESSuggestion(a.trim())}),500,this)),this.setState(n))}},{key:"onDeletePress",value:function(){var e=this;this.props.poiLayer.getSource().clear(),this.suggestion&&this.suggestion.hide(),Oe.initSelectedFeatures(),Oe.toDefault(),this.setState({showDelete:!1,keyWords:"",currentPageFeatures:null},(function(){e.searchInput.focus()}))}},{key:"filterLayers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter((function(e){return 0!==e.zIndex&&_.a.isSupportSearchSettingType(e.layerType)}))}},{key:"render",value:function(){var e=this,t=this.filterLayers(this.props.layers);return C.a.createElement("div",{className:"dataviz-poi"},C.a.createElement(Te,{map:this.props.map,serviceProxy:this.props.serviceProxy,addLayerSearchSetting:this.props.addLayerSearchSetting,deletedLayerSearchSetting:this.props.deletedLayerSearchSetting,needLayer:this.props.needLayer,needPoi:this.props.needPoi,ref:function(t){e.settings=t},searchLayers:t,isSave:this.props.isSave,changeSelectCity:this.changeSelectCity,changeSelectSearchLayer:this.changeSelectSearchLayer,changeSelectTab:this.changeSelectTab}),C.a.createElement("div",{className:"dataviz-poi-input"},C.a.createElement("input",{placeholder:DataViz.Language.searchOnline,onKeyUp:function(t){e.onKeyPressEvent(t)},onChange:this.onChange.bind(this),value:this.state.keyWords,ref:function(t){e.searchInput=t},type:"text",className:"dataviz-poi-input"}),this.state.showLoading&&C.a.createElement(Ce,null),this.state.showDelete&&C.a.createElement("span",{onClick:this.onDeletePress,className:"supermapol-icons-close"}),C.a.createElement("span",{className:"dataviz-poi-icon supermapol-icons-search",onClick:function(){e.onSearch()}})),0===this.tabIndex&&"Elasticsearch"===dataVizConfig.searchSetting.searchType&&C.a.createElement(Le,{ref:function(t){e.suggestion=t},updateKeyWords:this.updateKeyWords}),Oe.totalHits>0&&C.a.createElement(Q,{ref:function(t){e.result=t},map:this.props.map,isSave:this.props.isSave,goCenter:this.goCenter,addMarkerLayer:this.props.addMarkerLayer,searchLayersFun:this.searchLayersFun,tabIndex:this.tabIndex,searchOnline:this.searchOnline,searchCache:Oe,closeAllPop:this.props.closeAllPop,hideMarkerPopup:this.props.hideMarkerPopup,searchRestData:this.searchRestData,searchElasticsearch:this.searchElasticsearch}))}}]),t}(T.Component);t.a=we},674:function(e,t,a){},675:function(e,t,a){},676:function(e,t,a){},74:function(e,t,a){"use strict";a(71),a(27),a(20),a(28),a(30),a(1589),a(54),a(32);var n,i=a(81),r=a.n(i),s=(a(18),a(17)),o=a.n(s),l=(a(87),a(25)),c=a.n(l),u=(a(93),a(36),a(2)),d=a(5),p=a(84),h=a(1),f=a(327),m=a.n(f),y=window.DataViz.Language,g=u.a.getRootUrl(),v="".concat(g,"web/config/userprofile.json"),S="".concat(g,"web/webprinting/layouts.json"),b="".concat(g,"web/webprinting"),I={A2_landscape:828,A2_portrait:728,A3_landscape:699,A3_mapcornermarks:250,A3_portrait:450,A4_landscape_v2:150,A4_portrait:340,A4_landscape:400},E={preLegendOptions:{type:"default",options:null},isPrintLegend:!1,printOptions:{content:{type:"WEBMAP",url:null},layoutOptions:{templateName:null,title:null,subTitle:y.subTitle,copyright:y.copyRight,author:null,legendOptions:{title:""},scaleBarOptions:{orientation:"HORIZONTALLABELSBELOW",type:"LINE",intervals:3,unit:"METER",scaleText:null},littleMapOptions:{layers:null}},exportOptions:{format:"PDF",dpi:96}},templates:[],layers:[],changeOptions:function(e,t,a){E.printOptions[e][t]=a},changeLayoutOptions:function(e,t,a){E.printOptions.layoutOptions[e][t]=a},getWebMap:function(){return p.a.appID?"".concat(g,"web/maps/").concat(p.a.appID,"/map.json"):null},printMap:function(e,t){return new Promise(function(){var a=c()(o.a.mark((function a(n,i){var r,s;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,E.createLegendPicture();case 2:E.printOptions.content.url=e,r=E.formatOptions(t),(s=new ol.supermap.WebPrintingJobService(b,{withCredentials:!0})).createWebPrintingJob(r,(function(e){var t=e.result;t&&t[0]&&t[0].path?s.getPrintingJob(t[0].resourceConfigID,(function(e){var t=e.result;if(t&&"FINISHED"===t.status){var a=t.result.downloadUrl;n(a)}else i()})):i()}));case 6:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}())},createLegendPicture:(n=c()(o.a.mark((function e(){var t,a,n,i,r,s,l,c,u,d,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=E.isPrintLegend,a=E.preLegendOptions,t){e.next=4;break}return E.setNoneLegend(),e.abrupt("return");case 4:if(n=a.type,i=a.options,s="","default"!==n){e.next=24;break}if(l=document.querySelector(".legend")){e.next=13;break}return E.setNoneLegend(),e.abrupt("return");case 13:return c=l.cloneNode(!0),u=E.printOptions.layoutOptions.templateName,d=I[u]||1684,E.reRenderLegend(c,d),e.next=17,m()(c,{onclone:function(e){var t=e.querySelector(".webprint-legend");t&&t.classList.add("webprint-legend-clone")}});case 17:return p=e.sent,c.remove(),e.next=21,E.uploadLegendPic(p.toDataURL("image/png"));case 21:r=e.sent;case 22:e.next=31;break;case 24:if(i&&i.file){e.next=27;break}return E.setNoneLegend(),e.abrupt("return");case 27:return s=DataViz.Language.legend,e.next=30,E.uploadLegendPic(null,i.file);case 30:r=e.sent;case 31:E.printOptions.layoutOptions.legendOptions={title:s,picAsUrl:r};case 32:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)}),setNoneLegend:function(){E.printOptions.layoutOptions.legendOptions={title:"",picAsBase64:"iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAFM0aXcAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAD6ADAAQAAAABAAAADwAAAAAHNtsJAAAAE0lEQVQoFWNgGAWjITAaAoM2BAADoQABUmn/6gAAAABJRU5ErkJggg=="}},reRenderLegend:function(e,t){e.classList.add("webprint-legend"),e.style.width="".concat(t,"px"),e.querySelector(".legend-title i").remove();var a=e.querySelector(".legend-content");a.querySelectorAll(".legend-item").forEach((function(e){var t=e.querySelector(".content-info");t&&t.remove(),e.querySelectorAll(".item-title a").forEach((function(e){return e.remove()}));var n=e.querySelector(".content-container");n&&n.append.apply(n,r()(e.querySelectorAll(".content-container .detail-container"))),a.appendChild(e)})),e.querySelectorAll(".scroll-bars").forEach((function(e){return e.remove()})),document.body.appendChild(e)},dataURItoBlob:function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var a=new Uint8Array(t.length),n=0,i=t.length;n<i;n++)a[n]=t.charCodeAt(n);return new Blob([a],{type:"image/png"})},uploadLegendPic:function(e,t){var a="".concat(u.a.getIPortalUrl(),"web/uploadfile.json?toFile=./resources/portal/dataviz/webprint-legend/legend-").concat(p.a.appID,".png");return u.a.checkReLogin().then((function(){var n=t||E.dataURItoBlob(e);return u.a.doFetch(a,{method:"POST",withCredentials:!0,file:!0,uploadFile:n}).then((function(e){if(!e.filePath)throw new Error("upload legend failed");return u.a.getIPortalUrl()+e.filePath}))}))},checkLayers:function(){var e=d.a.tileLayers.concat(d.a.vectorLayers),t=[];return e.forEach((function(e){var a=e.layerInfo.layerType;h.m.includes(a)&&t.push(a)})),t},getLayersName:function(){var e=[];return E.layers.forEach((function(t){e.push(t.name)})),e},formatOptions:function(e){var t=E.printOptions,a=window.cloneDeep(t),n=E.getTemplateFromName(e).layoutOptions,i=n.hasCopyright,r=n.hasSubtitle,s=n.hasAuthor,o=n.hasScaleBar,l=n.hasTitle,c=n.hasLittleMap;return!l&&delete a.layoutOptions.title,!r&&delete a.layoutOptions.subTitle,!s&&delete a.layoutOptions.author,!i&&delete a.layoutOptions.copyright,c?(a.layoutOptions.littleMapOptions.center=E.formatCenter(t.layoutOptions.littleMapOptions.center),a.layoutOptions.littleMapOptions.scale=E.formatScale(t.layoutOptions.littleMapOptions.scale),a.layoutOptions.littleMapOptions.layerNames=E.getLayersName()):delete a.layoutOptions.littleMapOptions,!o&&delete a.layoutOptions.scaleBarOptions,a},formatCenter:function(e){return e&&2===e.length?{x:e[0],y:e[1]}:{x:0,y:0}},formatScale:function(e){e||(e=E.getCurrentScale());var t=e.split(":");return+t[0]/+u.a.formatScale(t[1])},getCurrentScale:function(){if(d.a.getBaseLayer()){var e=d.a.getBaseLayer().layerInfo,t=e.coordUnit||e.units||e.unit;return u.a.getScaleFromRes(d.a.map.getView().getResolution(),t)}},getCurrentCenter:function(){return d.a.map.getView().getCenter()},isLogin:function(){return u.a.doFetch(v,{method:"GET",withCredentials:!0}).then((function(e){return e}))},getPrintSettings:function(){return u.a.doFetch(S,{method:"GET",withCredentials:!0}).then((function(e){return e}))},getPrintTemplates:function(){var e=[];return u.a.doFetch(S,{method:"GET",withCredentials:!0}).then((function(t){return t&&t.length>0&&(E.templates=t,t.forEach((function(t){e.push(t.templateName)}))),e}))},getTemplateFromName:function(e){return E.templates.filter((function(t){return t.templateName===e}))[0]},isSupportLegend:function(){var e=!1,t=0;return d.a.vectorLayers.forEach((function(e){"MARKER"===e.layerInfo.layerType&&t++})),d.a.vectorLayers.length!==t&&(e=!0),e}};t.a=E},76:function(e,t,a){"use strict";a(18),a(28),a(30),a(72),a(54),a(27),a(112),a(73);var n=a(1),i=a(5),r={parseFilterCondition:function(e){return e.replace(/=/g,"==").replace(/AND|and/g,"&&").replace(/or|OR/g,"||").replace(/<==/g,"<=").replace(/>==/g,">=").replace(/\(?[^\(]+?\s*in\s*\([^\)]+?\)\)?/gi,(function(e){var t=e.match(/([^(]+?)\s*in\s*\(([^)]+?)\)/i);return 3===t.length?"(".concat(t[2].split(",").map((function(e){return"".concat(t[1]," == ").concat(e.trim())})).join(" || "),")"):e}))},isDataflowLayer:function(e){return[n.r.DATAFLOW,n.r.DATAFLOWHEAT].includes(e)},getBoundsFromFeatures:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.a.getBaseLayerProj(),a=ol.extent.createEmpty();return e&&e.forEach((function(e){var t=e.getGeometry();t&&ol.extent.extend(a,t.getExtent())})),t!==i.a.getBaseLayerProj()&&(a=ol.proj.transformExtent(a,this.getProjection(),i.a.getBaseLayerProj())),a},setVisibleScales:function(e,t){var a=i.a.resolutions[t.maxScale],n=i.a.resolutions[t.minScale];n>1?e.setMaxResolution(Math.ceil(n)):e.setMaxResolution(1.1*n),e.setMinResolution(a)}};t.a=r},82:function(e,t,a){"use strict";a(99),a(100),a(18),a(1588),a(69),a(207),a(92),a(333),a(72),a(20);var n,i,r=a(17),s=a.n(r),o=(a(87),a(25)),l=a.n(o),c=(a(27),a(73),a(78),a(44),a(40),a(141),a(28),a(30),a(43),a(93),a(36),a(54),a(32),a(2)),u=a(12),d=a(84),p=a(41),h=a(5),f=a(24),m=a(240),y=a(137),g=a(1),v={initMapInfo:function(e){u.a.showMessage(DataViz.Language.onlyBeViewedMap,g.j.WARNING);var t,a=this,n=e.baseLayer,i=n.url,r=n.layerType,s=a.initMap(e),o=c.a.formateWithToken(i);o&&(n.url=o.url,i=o.requestUrl,e.baseLayer.credential=o.credential),"TILE"===r||"SUPERMAP_REST"===r?c.a.doFetch(c.a.getUrl(i,"json"),{method:"GET",withCredentials:!0}).then((function(e){n.originResult=e,t=a.createLayer(n),s&&t&&s.addLayer(t)})).catch((function(e){u.a.showMessage(DataViz.Language.loadMapFaild)})):"WMS"===r?(t=this.createLayer(n),s&&t&&s.addLayer(t)):"WMTS"===r?c.a.doFetch(c.a.getUrl(i),{method:"GET",withCredentials:"include",dataType:"text"}).then((function(i){var r=y.a.getWMTSScales(n.tileMatrixSet,i,n.name),o=[e.extent.leftBottom.x,e.extent.leftBottom.y,e.extent.rightTop.x,e.extent.rightTop.y];n.tileGrid=y.a.getWMTSTileGrid(o,r),t=a.createLayer(n),s&&t&&s.addLayer(t)})).catch((function(e){u.a.showMessage(DataViz.Language.loadMapFaild)})):u.a.showMessage(DataViz.Language.unsupportedPreview);var l=[e.extent.leftBottom.x,e.extent.leftBottom.y,e.extent.rightTop.x,e.extent.rightTop.y];s.getView().fit(l)},initMap:function(e){var t=document.createElement("div");return t.setAttribute("id","map"),t.style.height="100%",t.style.width="100%",document.getElementsByClassName("root").length>0?document.body.replaceChild(t,document.getElementsByClassName("root")[0]):document.getElementsByClassName("share-app").length>0&&document.body.replaceChild(t,document.getElementsByClassName("share-app")[0]),this.createMap(e,"map")},createMap:function(e,t){var a=new ol.proj.Projection({extent:[e.extent.leftBottom.x,e.extent.leftBottom.y,e.extent.rightTop.x,e.extent.rightTop.y],units:"m",code:"EPSG:0"});ol.proj.addProjection(a);var n=new ol.View({center:e.center?[e.center.x,e.center.y]:[0,0],zoom:0,projection:a});return new ol.Map({target:t,view:n})},createLayer:function(e){var t,a;if("TILE"===e.layerType||"SUPERMAP_REST"===e.layerType){var n=ol.source.TileSuperMapRest.optionsFromMapJSON(e.url,e.originResult).tileGrid,i={url:e.url,tileGrid:n};e.credential&&SuperMap.SecurityManager["register".concat("Token")](e.url,e.credential),c.a.isInTheSameDomain(i.url)||(i.tileProxy=c.a.getProxy("png")),a=new ol.source.TileSuperMapRest(i)}else"WMS"===e.layerType?a=new ol.source.TileWMS({url:e.url,wrapX:!1,params:{LAYERS:e.layers[0]||"0",FORMAT:"image/png",VERSION:e.version||"1.3.0"},tileLoadFunction:function(e,t){e.getImage().src=c.a.getUrl(t,"png")}}):"WMTS"===e.layerType&&(a=new ol.source.WMTS({url:e.url,layer:e.name,format:"image/png",matrixSet:e.tileMatrixSet,requestEncoding:e.requestEncoding||"KVP",tileGrid:e.tileGrid,tileLoadFunction:function(e,t){e.getImage().src=c.a.getUrl(t,"png")}}));return a&&(t=new ol.layer.Tile({source:a,zIndex:0})),t}},S=a(53),b=a(246),I=a(21),E=a(16),T={webmapVersion:null,upgradeUniqSettings:function(e,t,a){if("1.0"===this.webMapVersion&&0!==Object.keys(e).length){var n=e;return t.forEach((function(t,i){n[t]=e[i]||a[i]})),n}return e}},C=a(22),L=a(57),N=a(63),k=a(74),O=a(105),D=a(161),w=a(52),A=new ol.format.GeoJSON,F={changeBaseMapIndex:null,changeMinMaxScale:null,addFromRestData:null,addRestMapOverLayer:null,baseLayerEpsgCode:null,changeMapTags:null,changeMapTitle:null,changeAuthorizeSetting:null,updateLegendView:null,changeTabFold:null,isIportalMap:!1,isIportalService:!1,hasAddBaseLayer:!1,reviewPortalMap:!1,changeGraticuleVisible:null,open:function(e,t,a){if(e){d.a.appID=a;var n="".concat(c.a.getIPortalUrl(),"web/maps/").concat(a);this.getAppData(n)}else this.isIportalService=!0,this.getMapData(t),this.getAppInfoEnd=!0},getServerData:function(e){var t=this;c.a.doFetch("".concat(e,".json"),{method:"GET",withCredentials:!0}).then((function(e){if(!1!==e.succeed){var a,n,i="EPSG:".concat(e.epsgCode),r=e.layers[0],s=[],o={baseLayer:{name:e.title,layerType:r.type,tileMatrixSet:r.identifier,url:r.url,layers:["0"]},center:e.center,extent:r.bounds,projection:i,thumbnail:e.thumbnail};if(0===i.indexOf("EPSG")&&i.split(":")[1]<=0)"undefined"!==e.epsgCode?v.initMapInfo(o):(n=e.error.errorMsg,u.a.showMessage(n));else h.a.addProjection(i).then((function(){"MAPBOXSTYLE"===r.type?(o.title=e.title,o.baseLayer={dataSource:{url:r.url},layerType:r.type,name:r.title},s.push(new Promise((function(e,a){return N.a.getMapboxStyleLayer(o.baseLayer).then((function(a){Object.assign(o.baseLayer,a),t.baseMapInfoCache=a,e(o.baseLayer)})).catch((function(e){u.a.closeLoadingBox(),u.a.showMessage(DataViz.Language.getMapDataFaild),a(e)}))})))):(a={projection:i,level:e.level||1,name:e.title,layers:["0"],minZoom:e.minZoom||0,maxZoom:e.maxZoom||22,id:1,tileMatrixSet:r.identifier,identifier:r.identifier,scales:r.scales,dpi:C.a.dpi.iServerWMTS,url:r.url,subLayers:r.subLayers,mapId:d.a.appID,sourceType:e.sourceType,extent:[r.bounds.left,r.bounds.bottom,r.bounds.right,r.bounds.top],thumbnail:e.thumbnail,layerType:r.type},"SUPERMAP_REST"===e.sourceType&&(a.layerType="TILE",o.baseLayer.layerType="TILE"),t.baseMapInfoCache=a,["SUPERMAP_REST","TILE","WMS"].includes(o.baseLayer.layerType)?s.push(F.getLayerExtent(o.baseLayer,o.baseLayer.layerType,o.projection,!0)):"WMTS"===o.baseLayer.layerType&&s.push(F.getWmtsInfo(o.baseLayer,!0))),F.getAppInfoEnd=!0,s.length>0?Promise.all(s).then((function(){t.renewApp(o),u.a.closeLoadingBox()})).catch((function(e){u.a.closeLoadingBox(),u.a.showMessage(DataViz.Language.getMapDataFaild),"401"===e&&t.renewApp(o)})):F.renewApp(o)}))}else{var l=DataViz.Language.loadMapFaild;u.a.showMessage(l)}})).catch((function(e){var t=DataViz.Language.loadMapFaild;u.a.showMessage(t)}))},getAppData:function(e){var t=this;c.a.doFetch("".concat(e,".json"),{method:"GET",withCredentials:!0}).then((function(a){t.changeAuthorizeSetting(a.authorizeSetting),t.authorizeSetting=a.authorizeSetting,t.sourceType=a.sourceType,h.a.unOpenDataBox=a.unOpenDataBox,t.tags=a.tags,t.getAppInfoEnd=!0,t.projectInfo=a.projectInfo&&JSON.parse(a.projectInfo);var n="".concat(e,"/map");t.getMapData(n,a.thumbnail)})).catch((function(e){u.a.showMessage(Language.loadMapFaild)}))},openDatavizWebMap:function(e){this.getAppInfoEnd=!0,this.isFromLocalStorageWebmap=!0,this.afterGetMapData(e)},afterGetMapData:function(e,t){var a=this;T.webMapVersion=e.version,document.title=e.title;var n=e.baseLayer,i=n.url||n.dataSource&&n.dataSource.url;a.handleCRS(e.projection,i).then((function(n){"OpenMap"===n.action?(e.projection=n.newCrs,a.getAllLayerInfo(e,t),F.baseLayerEpsgCode=e.projection):(v.initMapInfo(e),u.a.closeLoadingBox())}))},handleCRS:function(e,t){return new Promise((function(a,n){!e&&n("error: crs value is undefined");var i=e,r="OpenMap";"EPSG:0"===e?a({action:r="BrowseMap",newCrs:i}):"EPSG:910111"===e||"EPSG:910112"===e?i="EPSG:3857":"EPSG:910101"===e||"EPSG:910102"===e?i="EPSG:4326":0!==e.indexOf("EPSG")&&(i=c.a.getEpsgCodeFromWKT(e)),h.a.addProjection(e,t).then((function(){a({action:r,newCrs:i})})).catch((function(e){u.a.showMessage(DataViz.Language.unsupportedPreview),u.a.closeLoadingBox()}))}))},getMapData:function(e,t){var a=this;u.a.showLoadingBox(),c.a.doFetch("".concat(e,".json"),{method:"GET",withCredentials:!0}).then((function(e){var n=[e.baseLayer].concat(e.layers);k.a.layers=window.cloneDeep(n),a.afterGetMapData(e,t)})).catch((function(e){u.a.closeLoadingBox(),u.a.showMessage(DataViz.Language.loadMapFaild)}))},getAllLayerInfo:function(e,t){var a=[],n=this;["SUPERMAP_REST","TILE","WMS"].includes(e.baseLayer.layerType)?a.push(F.getLayerExtent(e.baseLayer,e.baseLayer.layerType,e.projection)):"WMTS"===e.baseLayer.layerType&&a.push(F.getWmtsInfo(e.baseLayer,!0)),"MAPBOXSTYLE"===e.baseLayer.layerType?(e.baseLayer.epsgCode=Number(e.projection.replace("EPSG:","")),a.push(new Promise((function(t,a){return N.a.getMapboxStyleLayer(e.baseLayer).then((function(a){Object.assign(e.baseLayer,a),n.baseMapInfoCache=a,t(a)})).catch((function(e){u.a.closeLoadingBox(),u.a.showMessage(DataViz.Language.getMapDataFaild),a(e)}))})))):n.baseMapInfoCache=p.a.getBaseMapInfoFromMapData2(e,d.a.appID,t),e.layers&&e.layers.map((function(t){if("MAPBOXSTYLE"===t.layerType)a.push(new Promise((function(e,a){return N.a.getMapboxStyleLayer(t).then((function(a){Object.assign(t,a),e(a)})).catch((function(a){u.a.closeLoadingBox(),u.a.showMessage(DataViz.Language.getMapDataFaild),t.getDataFaild=a&&"401"===a?g.n.NOPERMISSION:g.n.ERROR,e()}))})));else if(t.dataSource||t.serverId){var n=F.getLayerData(t,e.projection);for(var i in n)a.push(n[i])}else[g.r.DATAFLOW,g.r.DATAFLOWHEAT].includes(t.layerType)?a.push(F.getDataflowInfo(t)):"WMTS"===t.layerType?a.push(F.getWmtsInfo(t)):"TILE"!==t.layerType&&"WMS"!==t.layerType||(a.push(F.getLayerExtent(t,t.layerType,e.projection)),"TILE"===t.layerType&&a.push(c.a.getSublayers(t.url,null,{token:t.credential}).then((function(e){t.subLayers=e}))))})),a.length>0?Promise.all(a).then(l()(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=e.layers,!t.t0){t.next=4;break}return t.next=4,f.a.getIptDataPermission(e.layers);case 4:F.renewApp(e),u.a.closeLoadingBox();case 6:case"end":return t.stop()}}),t)})))).catch((function(t){u.a.closeLoadingBox(),u.a.showMessage(DataViz.Language.getMapDataFaild),"401"===t&&F.renewApp(e)})):(F.renewApp(e),u.a.closeLoadingBox())},renewApp:function(e){var t=this;if(e.minScale&&e.maxScale&&+e.minScale.split(":")[1]<+e.maxScale.split(":")[1]){var a;a=e.minScale,e.minScale=e.maxScale,e.maxScale=a}var n=setInterval(l()(s.a.mark((function a(){var i,r,o,l,u,m,y,v,S,b,I,C,L,k,A,M,R,x,P,V,B,U,G,_,z,j,W,H,Y,K,X,q,J,Z,Q,$,ee,te,ae,ne,ie,re,se,oe,le,ce,ue,de;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!p.a.getInfoEnd||!t.getAppInfoEnd){a.next=100;break}clearInterval(n),F.changeMapDescription(e.description),F.changeMapTags(t.tags),F.changeMapTitle(e.title),F.judgeSharePermission(t.authorizeSetting),i=e.baseLayer,a.t0=s.a.keys(p.a.layerCache);case 8:if((a.t1=a.t0()).done){a.next=33;break}if(r=a.t1.value,!(o=p.a.layerCache[r]).isInternetMap){a.next=21;break}if(o.internetMapName!==i.layerType&&o.url!==i.url){a.next=19;break}return o.url===O.a.CHINA_DARK_URL&&(i=Object.assign(O.a.getMapInfo("CHINA_DARK"),i)),e.minScale&&(i.minScale=e.minScale),e.maxScale&&(i.maxScale=e.maxScale),F.changeBaseMapIndex(r,i),F.hasAddBaseLayer=!0,a.abrupt("break",33);case 19:a.next=31;break;case 21:if(!o.url){a.next=31;break}if(l=!1,i.url?(u=i.url,i.url.indexOf("services/../")>-1&&(u=i.url.replace("services/../","")),("WMTS"!==o.layerType&&o.url===u||"WMTS"===o.layerType&&o.url===u&&o.identifier===i.identifier&&o.layer===i.layer)&&(l=!0)):i.dataSource&&i.dataSource.url===o.url&&"MAPBOXSTYLE"===i.layerType&&(o.visible=void 0===i.visible||i.visible,l=!0),!l){a.next=31;break}return o.visible=void 0===i.visible||null===i.visible||i.visible,e.minScale&&(o.minScale=e.minScale),e.maxScale&&(o.maxScale=e.maxScale),F.changeBaseMapIndex(r,o),F.hasAddBaseLayer=!0,a.abrupt("break",33);case 31:a.next=8;break;case 33:F.hasAddBaseLayer||(m=p.a.layerCache.length,p.a.baseMapInfs[m]=[t.baseMapInfoCache.name,t.baseMapInfoCache.thumbnail],p.a.layerCache[m]=t.baseMapInfoCache,p.a.dataVizConfig.buildinMaps.push({isInternetMap:!1,mapId:d.a.appID}),e.minScale&&(t.baseMapInfoCache.minScale=e.minScale),e.maxScale&&(t.baseMapInfoCache.maxScale=e.maxScale),F.changeBaseMapIndex(m,t.baseMapInfoCache)),y={maxScale:h.a.maxScale,minScale:h.a.minScale},F.changeMinMaxScale(y),v=e.layers||[],S=0;case 38:if(!(S<v.length)){a.next=97;break}if(b=v[S],I=void 0,C=b.originData,t.projectInfo&&t.projectInfo.popupConfig&&(b.popupConfig=t.projectInfo.popupConfig[S]),!N.a.isRestjsrMapboxStyle(b)){a.next=48;break}b.notZoomToExtent=!0,F.addVectorTileLayer(b),a.next=94;break;case 48:if(![g.r.DATAFLOW,g.r.DATAFLOWHEAT].includes(b.layerType)){a.next=53;break}F.addFromRestData({features:[],layerInfo:b}),b.legendSetting&&b.legendSetting.isShow&&F.updateLegendView(h.a.curentID,null,b.legendSetting.isFold),a.next=94;break;case 53:if(!b.dataSource&&"MARKER"!==b.layerType){a.next=93;break}for(L in b.enableFields)b.enableFields[L]=c.a.trim(b.enableFields[L]);if((!b.dataSource||b.dataSource.accessType&&"REST_DATA"!==b.dataSource.accessType&&"DIRECT"!==b.dataSource.accessType)&&"MARKER"!==b.layerType){a.next=91;break}if(C){a.next=60;break}I=[],a.next=81;break;case 60:if("JSON"!==C.type&&"GEOJSON"!==C.type){a.next=65;break}C.content=C.content.type?C.content:JSON.parse(C.content),I=F.geojsonToFeature(C.content,b),a.next=81;break;case 65:if("EXCEL"!==C.type&&"CSV"!==C.type){a.next=80;break}if(!b.dataSource||!b.dataSource.administrativeInfo){a.next=75;break}return C.content.colTitles=f.a.trimBinaryTitles(C.content.colTitles),k=b.dataSource.administrativeInfo,A=k.divisionType,M=k.divisionField,a.next=71,f.a.excelData2FeatureByDivision(C.content,A,M);case 71:R=a.sent,I=f.a.parseData2Feature({allDatas:{features:R.features},fileCode:b.projection},"GEOJSON"),a.next=78;break;case 75:return a.next=77,F.excelData2Feature(C.content,b);case 77:I=a.sent;case 78:a.next=81;break;case 80:"SHP"===C.type?(C.content=JSON.parse(C.content).layers[0],I=F.geojsonToFeature(C.content,b)):b.dataSource.url&&(I=C);case 81:if(P=(x=b).layerType,V=x.featureType,B=b.style||{},[g.r.VECTOR,g.r.RANK_SYMBOL,g.r.UNIQUE].includes(P)&&V===g.p.POINT?(E.a.initOffset(B),["SYMBOL_POINT"].includes(B.type)?(P!==g.r.UNIQUE&&"RANK_SYMBOL"!==b.layerType&&(b.layerType="SYMBOL"),t.formatSymbolInfo(B)):"SVG_POINT"===B.type&&(B.symbolInfo={url:B.url},delete B.url)):P===g.r.VECTOR&&V===g.p.LINE&&c.a.isArray(B)&&(b.outlineStyle=B[0],b.style=B[1],b.style.lineDash="solid"===b.style.lineDash?"roadPath":"pathway"),b.labelStyle&&(U=b.labelStyle,G=U.fontFamily,_=U.backgroundFill,b.labelStyle.font="14px ".concat(G),b.labelStyle.backgroundFill=E.a.RGB2String(_)),b.layerType===g.r.MIGRATION?(z=b.animationSetting.symbol,/^image:\/\//g.test(z)&&/.(png|jpg|jpeg|svg)$/g.test(z)?(j=z.substring(8),/.svg$/g.test(z)?(b.animationSetting.type="SVG_POINT",b.animationSetting.symbolInfo={url:j}):(b.animationSetting.type="IMAGE_POINT",b.animationSetting.imageInfo={url:j})):(b.animationSetting.type="SVG_POINT",b.animationSetting.symbolInfo={className:"supermapol-icons-od-".concat(z),name:z,unicode:"&#xe6e2"})):b.layerType===g.r.RANK_SYMBOL&&(b.themeSetting.colorType=b.themeSetting.colors?"colors":"fillColor"),"MARKER"===b.layerType?b.projection="EPSG:4326":I&&I[0]&&(b.dataSource.dataTypes=c.a.getDataTypesFromFeature(I[0]),delete b.dataTypes),b.layerType===g.r.UNIQUE)for(J in W=b.themeSetting,H=W.themeField,Y=W.colors,K=W.customSettings,X=c.a.getValuesFromField(I,H),q=E.a.getUniqueColors(Y,X.length),b.themeSetting.customSettings=T.upgradeUniqSettings(K,X,q),K)Z=K[J],c.a.isString(Z)?(Q=b.style,$=Q.type,ee=Q.radius,te=Q.fillOpacity,ae=Q.strokeColor,ne=Q.strokeOpacity,ie=Q.strokeWidth,re=Q.lineDash,se=Q.fillColor,K[J]={type:$,radius:ee,fillColor:se,fillOpacity:te,strokeColor:ae,strokeOpacity:ne,strokeWidth:ie,lineDash:re},V===g.p.LINE?K[J].strokeColor=Z:K[J].fillColor=Z):K[J]=D.a.getDVPointThemeStyle(Z);b.notZoomToExtent=!0,F.addFromRestData({features:I,layerInfo:b}),b.legendSetting&&b.legendSetting.isShow&&F.updateLegendView(h.a.curentID,null,b.legendSetting.isFold);case 91:a.next=94;break;case 93:b.dataSource||(b.layerType===g.i.VECTOR_TILE?F.addVectorTileLayer(b):("WMS"===b.layerType&&(b.subLayers=b.layers[0],delete b.layers),"HOSTED_TILE"===b.layerType&&(b={id:(new Date).getTime(),layerType:"TILE",overLayer:!0,epsgCode:h.a.getBaseLayerProj(),projection:h.a.getBaseLayerProj(),name:b.name,url:"",sourceType:"TILE",visible:b.visible,serverId:b.serverId,popupInfo:b.popupInfo,getDataFaild:b.getDataFaild}),F.addRestMapOverLayer(b)));case 94:S++,a.next=38;break;case 97:["WMTS","WMS"].includes(t.sourceType)&&(oe=e.extent,e.visibleExtent=[oe.leftBottom.x,oe.leftBottom.y,oe.rightTop.x,oe.rightTop.y]),e.visibleExtent?(F.changeMapSetting({type:"extent"}),h.a.updateView(null,null,e.visibleExtent,!1)):e.center&&h.a.updateView(e.level,Object.values(e.center),null,!1),e.grid&&e.grid.graticule&&(le=e.grid.graticule,ce=le.strokeColor,ue=le.interval,de=le.strokeWidth,w.a.createGraticuleLayer(ce,ue[0],de,!0),F.changeGraticuleVisible(!0));case 100:case"end":return a.stop()}}),a)}))),200)},judgeSharePermission:function(e){c.a.checkReLogin().then((function(t){if(e&&e.length>0)for(var a=0;a<e.length;a++)"DELETE"===e[a].permissionType&&e[a].entityName!==t.name&&c.a.actions.changeMapShare(!0)}))},excelData2Feature:(i=l()(s.a.mark((function e(t,a){var n,i,r,o,l,u,d,p,f,m,y,v,S,I,E,T,C,L,N,k,O,D,w,A,F;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in n=t.rows,i=t.colTitles)c.a.isString(i[r])&&(i[r]=c.a.trim(i[r]));if(o=a.projection,l=a.dataSource,u=h.a.getBaseLayerProj(),d=[],p=c.a.trim(a.xyField&&a.xyField.xField||a.from&&a.from.xField),f=c.a.trim(a.xyField&&a.xyField.yField||a.from&&a.from.yField),m=i.indexOf(p),y=i.indexOf(f),a.layerType!==g.r.MIGRATION){e.next=20;break}if(e.prev=4,l.type!==g.b.PORTAL_DATA){e.next=14;break}return e.next=8,c.a.doFetch("".concat(c.a.getIPortalUrl(),"web/datas/").concat(l.serverId,".json"),{method:"GET",withCredentials:!0});case 8:v=e.sent,S=v.dataMetaInfo,a.xyField={xField:S.xField,yField:S.yField},S.xIndex?(m=S.xIndex,y=S.yIndex):(m=i.indexOf(S.xField),y=i.indexOf(S.yField)),e.next=15;break;case 14:l.type===g.b.SAMPLE_DATA&&(I=b.b.find((function(e){return e.id===l.name}))||{},p=I.xField,f=I.yField,a.xyField={xField:p,yField:f},m=i.findIndex((function(e){return e===p})),y=i.findIndex((function(e){return e===f})));case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4);case 20:E=0,T=n.length;case 21:if(!(E<T)){e.next=42;break}if(C=n[E],L={},N=n[E][m],k=n[E][y],""===N||""===k){e.next=39;break}O=new ol.geom.Point([+N,+k]),o&&o!==u&&O.transform(o,u),D=0,w=C.length;case 27:if(!(D<w)){e.next=36;break}if(null!=(A=i[D])){e.next=31;break}return e.abrupt("continue",33);case 31:A=A.trim(),Object.keys(L).includes(A)?L[A+"_1"]=C[D]:L[A]=C[D];case 33:D++,e.next=27;break;case 36:L.dataviz_featureID=E,F=new ol.Feature({geometry:O,attributes:L}),d.push(F);case 39:E++,e.next=21;break;case 42:return e.abrupt("return",d);case 43:case"end":return e.stop()}}),e,null,[[4,17]])}))),function(e,t){return i.apply(this,arguments)}),geojsonToFeature:function(e,t){var a=e.features,n=[],i="EPSG:4326";t.projection?i=t.projection:e.crs&&e.crs.properties&&e.crs.properties.name.indexOf("3857")>-1&&(i="EPSG:3857");for(var r=0,s=a.length;r<s;r++){var o=a[r].properties||{};delete a[r].properties,o.dataviz_featureID=r;var l=A.readFeature(a[r],{dataProjection:i,featureProjection:h.a.getBaseLayerProj()||"ESPG:4326"}),u=l.getGeometry().getCoordinates();"Point"===a[r].geometry.type&&a[r].properties&&(a[r].properties.lon=u[0],a[r].properties.lat=u[1]);var d=!1,p=void 0,f=void 0;a[r].dv_v5_markerInfo&&!t.dataSource&&((p=Object.assign({},a[r].dv_v5_markerInfo,o)).lon&&(delete p.lon,delete p.lat),d=!0),a[r].dv_v5_markerStyle&&!t.dataSource&&(f=a[r].dv_v5_markerStyle,d=!0);var m=void 0;if(d)m=Object.assign({},{attributes:p},{useStyle:f}),l.layerId=t.id;else if(t.featureStyles){var y=JSON.parse(t.featureStyles[r].style),g=o,v=void 0;g._smiportal_imgLinkUrl.indexOf("http://")>-1||g._smiportal_imgLinkUrl.indexOf("https://")>-1?v=g._smiportal_imgLinkUrl:void 0!==g._smiportal_imgLinkUrl&&null!==g._smiportal_imgLinkUrl&&""!==g._smiportal_imgLinkUrl&&(v="".concat(c.a.getIPortalUrl(),"resources/markerIcon/").concat(g._smiportal_imgLinkUrl)),p={dataViz_description:g._smiportal_description,dataViz_imgUrl:v,dataViz_title:g._smiportal_title,dataViz_url:g._smiportal_otherLinkUrl},y.anchor=[.5,1],y.src=y.externalGraphic,f=y,m=Object.assign({},{attributes:p},{useStyle:f}),delete g._smiportal_description,delete g._smiportal_imgLinkUrl,delete g._smiportal_title,delete g._smiportal_otherLinkUrl}else m={attributes:o};l.setProperties(m),n.push(l)}return n},getLayerExtent:(n=l()(s.a.mark((function e(t,a,n){var i,r,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this,"TILE"!==a){e.next=19;break}return e.next=4,i.getTileLayerExtentInfo(t,n);case 4:if(!(r=e.sent)){e.next=16;break}if(!1!==r.succeed){e.next=15;break}return u.a.showMessage(DataViz.Language.showLayerErrDynamicProjectionNotSupported,g.j.WARNING),e.next=10,i.getTileLayerExtentInfo(t,n,!1);case 10:!1===(o=e.sent).succeed&&(t.getDataFaild=g.n.ERROR),Object.assign(t,o),e.next=16;break;case 15:Object.assign(t,r);case 16:return e.abrupt("return",t);case 19:return e.abrupt("return",i.getWMSLayerExtent(t,n));case 20:case"end":return e.stop()}}),e,this)}))),function(e,t,a){return n.apply(this,arguments)}),getTileLayerExtentInfo:function(e,t){var a,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this,r=e.url.trim(),o="json";if(e.credential){var u=e.credential,d=Object.keys(u);a=u[d]}var h=c.a.formateWithToken(r,a);if(h&&(e.url=h.url,r=h.requestUrl,e.credential=a=h.credential),n){var f={epsgCode:t.split(":")[1]};c.a.isCustomProjection(t)||(r+=a?"&":"?",r+=encodeURI("prjCoordSys=".concat(JSON.stringify(f))))}r=c.a.getUrl(r,"json");var m=new Promise((function(a){return c.a.doFetch(r,{method:"GET",dataType:o,withCredentials:"include"}).then(function(){var n=l()(s.a.mark((function n(r){var o;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!1!==r.succeed){n.next=4;break}a(r),n.next=18;break;case 4:if(e.projection=t,e.format="png","WebP"!==p.a.dataVizConfig.mapCenter.tileFormat||e.url===O.a.CHINA_DARK_URL){n.next=11;break}return n.next=9,c.a.isSupportWebp(e.url,e.credential);case 9:o=n.sent,e.format=o?"webp":"png";case 11:e.extent=[r.bounds.left,r.bounds.bottom,r.bounds.right,r.bounds.top],r.visibleScales&&(e.visibleScales=r.visibleScales,e.coordUnit=r.coordUnit,i.baseMapInfoCache||(i.baseMapInfoCache={})),i.baseMapInfoCache.visibleScales=r.visibleScales,i.baseMapInfoCache.coordUnit=r.coordUnit,i.baseMapInfoCache.credential=e.credential,i.baseMapInfoCache.format=e.format,a(e);case 18:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(t){e.getDataFaild=t&&"401"===t?g.n.NOPERMISSION:g.n.ERROR,a()}))}));return m},getWMSLayerExtent:function(e,t){var a=this,n=e.url.trim();return n+=n.indexOf("?")>-1?"&SERVICE=WMS&REQUEST=GetCapabilities":"?SERVICE=WMS&REQUEST=GetCapabilities",n=c.a.getUrl(n),"text",new Promise((function(i,r){return c.a.doFetch(n,{method:"GET",dataType:"text",withCredentials:"include"}).then(function(){var n=l()(s.a.mark((function n(o){var l;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o){n.next=4;break}return e.getDataFaild=g.n.ERROR,i(o),n.abrupt("return");case 4:e.projection=t,l=m.a.read(o),L.a.getParamsFromWMSCapabilities(l,e),a.baseMapInfoCache&&(a.baseMapInfoCache.projection=e.projection,a.baseMapInfoCache.extent=e.extent,a.baseMapInfoCache.version=e.version,a.baseMapInfoCache.subLayers=e.subLayers),h.a.addProjection(e.projection).then((function(){return i()})).catch((function(e){r(e)}));case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(t){e.getDataFaild=g.n.ERROR,i()}))}))},getWmtsInfo:function(e,t){delete e.scales;var a=this;return new Promise((function(n){var i=y.a.isKvp(e.requestEncoding);return L.a.getCapabilities(e.url,g.s.WMTS,i).then((function(i){try{e=y.a.getParamsFromWMTSCapabilities(i,e,a.baseLayerEpsgCode),t&&a.baseMapInfoCache&&(a.baseMapInfoCache.identifier=e.identifier,a.baseMapInfoCache.scales=e.scales,a.baseMapInfoCache.matrixIds=e.matrixIds,a.baseMapInfoCache.layer=e.layer,a.baseMapInfoCache.origin=e.origin,a.baseMapInfoCache.extent=e.extent,a.baseMapInfoCache.format=e.format,a.baseMapInfoCache.style=e.style),n()}catch(e){throw"error"}})).catch((function(t){e.getDataFaild=g.n.ERROR,n()}))}))},formatSymbolInfo:function(e){e.symbolInfo={className:e.className,name:e.name,unicode:e.unicode},e.radius=e.fontSize.substr(0,e.fontSize.length-2)/2,delete e.className,delete e.name,delete e.unicode,delete e.fontSize},getDataflowInfo:function(e){var t,a=e.url,n="".concat(c.a.getUrl(a),".json");return e.credential&&e.credential.token&&(t=e.credential.token,n+="?token=".concat(t)),new Promise((function(a,i){return c.a.doFetch(n,{method:"GET",withCredentials:!0}).then((function(n){if(n){if(e.featureType="POINT",e.dataSource={},n.featureMetaData&&(e.featureType=n.featureMetaData.featureType.toUpperCase(),e.dataSource.dataTypes=c.a.formatDataTypes(n.featureMetaData.fieldInfos)),e.wsUrl=n.urls[0].url,e.name=n.urls[0].url.split("iserver/services/")[1].split("/dataflow")[0],e.token=t,e.layerType===g.r.DATAFLOW){var i=e.style=e.pointStyle;if("SYMBOL_POINT"===i.type?(i.symbolInfo={className:i.className,name:i.name,unicode:i.unicode},i.radius=i.fontSize.substr(0,i.fontSize.length-2)/2,delete i.className,delete i.name,delete i.unicode):"SVG_POINT"===i.type&&(i.symbolInfo={url:i.url},delete i.url),e.dataflowSetting={pathStyle:e.lineStyle,directionField:e.directionField},e.maxPointCount&&(e.dataflowSetting.pathStyle.maxPointCount=e.maxPointCount,delete e.maxPointCount),e.labelStyle){var r=e.labelStyle,s=r.fontFamily,o=r.backgroundFill;e.labelStyle.font="14px ".concat(s),e.labelStyle.backgroundFill=E.a.RGB2String(o)}}delete e.credential,delete e.pointStyle,delete e.lineStyle,a()}else e.getDataFaild=!0,u.a.showMessage(DataViz.Language.loadFailed),a()})).catch((function(t){e.getDataFaild=!0,u.a.showMessage(DataViz.Language.loadFailed),a()}))}))},requestDataUrlPromise:function(e,t,a){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];c.a.doFetch(e,{method:"GET",withCredentials:n}).then((function(e){if(!1===e.succeed)throw"error";t.originData=e,a(e)})).catch((function(e){t.getDataFaild="401"===e?g.n.NOPERMISSION:g.n.ERROR,a()}))},getLayerData:function(e,t){var a,n=this,i=[],r=e.dataSource,s=r&&r.type===g.b.SAMPLE_DATA&&!!r.name;if(r&&r.type===g.b.PORTAL_DATA&&r.serverId||s||"MARKER"===e.layerType&&e.serverId||"HOSTED_TILE"===e.layerType)if(s){var o="".concat(b.a).concat(r.name,".json");a=new Promise((function(t,a){n.requestDataUrlPromise(o,e,(function(){t()}))})),i.push(a)}else if(r&&(!r.accessType||"DIRECT"===r.accessType)||e.layerType===g.r.MARKER){var l=r&&r.serverId||e.serverId;a=new Promise((function(t,a){I.o.getDataInfo(l).then((function(a){e.dataMetaInfo=f.a.getDataMetaInfoParams(a.type,a.dataMetaInfo);e.dataName=a.fileName.replace(/\.\w+$/,"");var i="".concat(c.a.getIPortalUrl(),"web/datas/").concat(l,"/content.json?pageSize=9999999&currentPage=1");n.requestDataUrlPromise(i,e,(function(){t()}))})).catch((function(a){var n=a&&a.error&&a.error.response.data;n&&n.error&&401===n.error.code?e.getDataFaild=g.n.NOPERMISSION:e.getDataFaild=g.n.ERROR,t()}))})),i.push(a)}else{var d=r?r.serverId:e.serverId;a=new Promise((function(a,i){I.o.getDatasetsByID(d).then((function(r){if(!r||!1===r.succeed)throw"error";if(!(r.length>0))throw"error";var s=r[0].name,o=r[0].type.toUpperCase();I.o.getDataInfo(d).then((function(r){var l=r.dataItemServices;if(e.dataName=r.fileName.replace(/\.\w+$/,""),0===l.length)return e.getDataFaild=!0,a(),void u.a.showMessage(DataViz.Language.getMapDataFaild);if("HOSTED_TILE"===e.layerType){var c=S.a.getService(l,"RESTDATA"),d=t.split(":")[1];S.a.isMvt(c.address,s,d).then((function(t){n.getServiceInfoFromLayer(e,l,s,o,a,i,t)})).catch((function(t){n.getServiceInfoFromLayer(e,l,s,o,a,i)}))}else n.getServiceInfoFromLayer(e,l,s,o,a,i)}))})).catch((function(){e.getDataFaild=!0,a()}))})),i.push(a)}else if(r&&["REST_MAP","REST_DATA"].includes(r.type)&&r.url){var p=new Promise((function(t,a){h.a.addProjection(e.projection).then((function(){n.getServerDatas(e,t,a)}))}));i.push(p)}else if(r&&"USER_DATA"===r.type){var m=new Promise((function(t,a){n.requestDataUrlPromise(r.url,e,(function(a){e.originData={content:a,type:"GEOJSON"},t()}),!1)}));i.push(m)}if("MARKER"!==e.layerType){var y=e.style;if(y&&y.imageInfo&&y.imageInfo.url){var v=new Promise((function(e,t){var a=new Image,n=y.imageInfo.url;n.indexOf("resources")>-1&&n.indexOf("http")<0&&(n=c.a.getIPortalUrl()+n),a.src=n,a.onload=function(){y.imageInfo.img=a,e()},a.onerror=function(){delete y.img,t("load img failed")}}));i.push(v)}}return i},getServiceInfoFromLayer:function(e,t,a,n,i,r,s){var o=this,l=s?!s.isMvt:"HOSTED_TILE"===e.layerType,d=!1;t.forEach((function(t){if(!d)if(t&&l&&"RESTMAP"===t.serviceType)d=!0,c.a.getTileLayerInfo(t.address,h.a.getBaseLayerProj(!0)).then((function(t){t.forEach((function(t){var a=t.bounds;e=Object.assign(e,{id:(new Date).getTime(),layerType:"TILE",overLayer:!0,epsgCode:h.a.getBaseLayerProj(),projection:"EPSG:".concat(t.prjCoordSys.epsgCode),units:t.coordUnit&&t.coordUnit.toLowerCase(),extent:[a.left,a.bottom,a.right,a.top],visibleScales:t.visibleScales,url:t.url,sourceType:"TILE"}),i()}))}));else if(t&&!l&&"RESTDATA"===t.serviceType)if(d=!0,s&&s.isMvt){var u=s.bounds;e=Object.assign(e,{id:(new Date).getTime(),layerType:g.i.VECTOR_TILE,overLayer:!0,epsgCode:s.epsgCode,projection:"EPSG:".concat(s.epsgCode),bounds:u,extent:[u.left,u.bottom,u.right,u.top],name:e.name,url:s.url,visible:e.visible,featureType:n,serverId:e.serverId.toString()}),i()}else c.a.getDatasources(t.address).then((function(n){e.dataSource.dataSourceName=n+":"+a,e.dataSource.url="".concat(t.address,"/data"),o.getServerDatas(e,i,r)}))})),d||(i(),u.a.showMessage(DataViz.Language.getMapDataFaild))},getServerDatas:function(e,t,a){var n=e.dataSource,i=n.url,r=i.substr(i.indexOf("/rest/")+6,4),s=F;if("maps"===r){c.a.queryFeatureBySQL(n.url,n.layerName,"smid=1",null,null,(function(n){var i=n&&n.result.recordsets,r=i&&i[0],o=r.fields;if(r&&o){var l=[];for(var c in o){var u=o[c];0===u.indexOf("Sm")&&"SmID"!==u||l.push(u)}s.getFeatures(l,e,t,a)}}),(function(a){e.getDataFaild=!0,t()}))}else if("data"===r){var o;c.a.isDynamicRestData(e.projection)&&(o=F.baseLayerEpsgCode.split("EPSG:")[1]),c.a.getFeatureBySQL(n.url,[n.dataSourceName],(function(a){if(!(a&&a.result&&a.result.features))return e.getDataFaild=!0,void t();e.originData=f.a.parseData2Feature({allDatas:{features:a.result.features.features},fileCode:o||e.projection,featureProjection:F.baseLayerEpsgCode},"JSON"),e.dataTypes||(e.dataTypes=c.a.getDataTypesFromFeature(a.result.features[0])),t()}),(function(a){"401"===a||a&&a.error&&401===a.error.code?e.getDataFaild=g.n.NOPERMISSION:e.getDataFaild=g.n.ERROR,t()}),null,null,o)}},getFeatures:function(e,t,a,n){var i=t.dataSource,r=t.projection;c.a.queryFeatureBySQL(i.url,i.layerName,null,e,null,(function(e){var n=e.result.recordsets[0],i=n.features.features;if(t.originData=f.a.parseData2Feature({allDatas:{features:i},fileCode:r,featureProjection:F.baseLayerEpsgCode},"JSON"),!t.dataTypes){var s=f.a.assembleTableJSONData(n.features);t.dataTypes=c.a.getFieldType(s.titles,s.rows[0])}a()}),(function(e){t.getDataFaild=!0,a()}))}};t.a=F},84:function(e,t,a){"use strict";a(27),a(208),a(43);var n,i=a(51),r=a.n(i),s=(a(32),a(28),a(30),a(673),a(17)),o=a.n(s),l=(a(141),a(44),a(40),a(69),a(93),a(36),a(54),a(20),a(18),a(87),a(25)),c=a.n(l),u=a(2),d=a(21),p=a(16),h=a(12),f=a(5),m=a(24),y=a(63),g=a(1),v=a(327),S=a.n(v),b=a(22),I=a(82),E=a(74),T=a(41),C=a(105),L=a(161),N=a(52),k=window.DataViz.Language,O={appID:null,appUrl:null,save:(n=c()(o.a.mark((function e(t,a){var n,i,r,s,l,c,p,y,v,S,E,T,C,L,D,w,A,F,M,R;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.a.showLoadingBox(DataViz.Language.saving),n=t.mapDescription||"",i=t.mapTags,r=t.mapTitle||"",s=t.isNew||!1,l=f.a.getNeedSaveMapInfo(),c=l.center,p=l.zoom,y=l.extent,I.a.isIportalService&&(s=!0),I.a.isIportalService=!1,i&&0!==i.length||(i=[k.userMap]),(v=f.a.getBaseLayerBounds())&&(S={leftBottom:{x:v[0],y:v[1]},rightTop:{x:v[2],y:v[3]}}),E={version:b.a.version,title:r,description:n,projection:f.a.getProjection(),center:c,level:p,extent:S,baseLayer:{},layers:[],minScale:u.a.formatScale(f.a.minScale)||u.a.formatScale(f.a.scales[0]),maxScale:u.a.formatScale(f.a.maxScale)||u.a.formatScale(f.a.scales[f.a.scales.length-1])},"extent"===f.a.viewType&&(E.visibleExtent=y),N.a.graticuleLayer&&(E.grid={graticule:N.a.getGraticule()}),T={tags:i,title:r,description:n,thumbnail:"".concat(u.a.getIPortalUrl(),"apps/dataviz/static/imgs/thumbnail_default.png"),sourceType:"MAPVIEWER",projectInfo:{}},L=[],D={},f.a.vectorLayers.forEach((function(e,t){var a=e.layerInfo;a.popupConfig&&u.a.isSupportPopupConfig(a.layerType)&&(D[t]=a.popupConfig);var n=!1;if("MARKER"!==a.layerType||a.serverId){if(!a.serverId&&e.layerInfo.dataSource){var i=e.layerInfo.dataSource;i.serverId||i.url||i.name||(n=!0)}}else n=!0;var r=e.layerInfo.name;r.split(".").length<2&&(r=e.layerInfo.type?"".concat(r,".").concat(e.layerInfo.type.toLowerCase()):"".concat(r,".geojson")),n?L.push(this.saveData(e.features,r,e)):a.layerType!==g.r.MARKER||a.layerNotEditable||a.getDataFaild||(C=m.a.updateMarkeData(e.features,r,a.serverId),L.push(C)),e.layerInfo.serverId&&a.layerType!==g.r.MARKER&&(e.layerInfo.dataSource=e.layerInfo.dataSource||{},e.layerInfo.dataSource.type=g.b.PORTAL_DATA,e.layerInfo.dataSource.serverId=e.layerInfo.serverId)}),this),e.next=16,m.a.confirmDataChange();case 16:w=e.sent,(A=w.Binary.length+w.Relationship.length)>0&&(F=0,M=function(){F++;var e="".concat(k.updateDataSuccess," ").concat(F,"/").concat(A);h.a.showMessage(e,g.j.SUCCESS),F+1===A&&m.a.updataAtrributeTableFn&&m.a.updataAtrributeTableFn()},w.Binary.forEach((function(e){C=new Promise((function(t,a){var n={file:e.file,fileName:e.dataName,dataID:e.dataId,dataMetaInfo:JSON.stringify(e.dataMetaInfo)};d.o.updateData(n).then((function(e){M(),t()})).catch((function(e){h.a.showMessage(k.attributeModificationFailed,g.j.ERROR),h.a.closeLoadingBox(),a(e)}))}))})),w.Relationship.forEach((function(e){C=new Promise((function(t,a){u.a.doFetch(e.urlId,{method:"POST",withCredentials:!1,data:e.params}).then((function(e){M(),t()})).catch((function(e){h.a.showMessage(k.attributeModificationFailed,g.j.ERROR),h.a.closeLoadingBox(),a(e)}))}))})),L.push(C),m.a.updateFeatures={},m.a.dataLayerInfo={}),R={authorizeSetting:t.authorizeSetting,changeAuthorizeSetting:t.changeAuthorizeSetting},Object.keys(D).length>0&&(T.projectInfo.popupConfig=D),O.successCallback=a,L.length>0?Promise.all(L).then((function(){O.handleLayerInfo(E),O.saveApp(E,s,T,R)})):(O.handleLayerInfo(E),O.saveApp(E,s,T,R));case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)}),handleLayerInfo:function(e){var t=this;f.a.tileLayers.sort((function(e,t){return e.layerInfo.zIndex-t.layerInfo.zIndex})),f.a.tileLayers.forEach((function(t,a){var n=t.layerInfo,i={layerType:n.layerType,name:n.name,visible:n.visible};if(0===a){var s,o=n.layerType;["TILE","WMS","WMTS","VECTOR_TILE"].includes(o)?(s=n.url,n.credential&&(s+="?token=".concat(n.credential)),i.url=s,"WMTS"===n.layerType?(i.tileMatrixSet=n.tileMatrixSet||n.identifier,i.layer=n.layer):"WMS"===n.layerType?i.layers=["0"]:"VECTOR_TILE"===n.layerType&&(i.layerType="MAPBOXSTYLE",i.dataSource={type:"EXTERNAL",url:n.url},delete i.url)):n.layerType.indexOf("TIANDITU")>-1?(i.tk=T.a.dataVizConfig.tiandituKey,void 0!==n.labelLayerVisible?i.labelLayerVisible=n.labelLayerVisible:i.labelLayerVisible=!0,void 0===n.visible&&(n.visible=!0)):"CHINA_DARK"===o&&(i.url=C.a.CHINA_DARK_URL,i.layerType=g.i.TILE,void 0===n.visible&&(n.visible=!0)),e.baseLayer=window.cloneDeep(i)}else{n.visibleScale&&(i.visibleScale={maxScale:u.a.formatScale(n.visibleScale.maxScale),minScale:u.a.formatScale(n.visibleScale.minScale)}),i.layerType!==g.r.DATAFLOW&&i.layerType!==g.r.DATAFLOWHEAT&&n.autoUpdateTime&&(i.autoUpdateTime=n.autoUpdateTime);var l=y.a.isMapboxStyleLayer(n);n.serverId&&!l?(i.layerType="HOSTED_TILE",i.serverId=n.serverId):(i.url=n.url,n.credential&&(i.credential={token:n.credential},n.credential.token&&(i.credential=r()({},n.credential))),"WMTS"===n.layerType?(i.tileMatrixSet=n.tileMatrixSet||n.identifier,i.layer=n.layer,i.requestEncoding=n.requestEncoding,i.dpi=n.dpi):"WMS"===n.layerType?i.layers=[n.subLayers]:l&&(i.layerType="MAPBOXSTYLE",i.dataSource={type:"EXTERNAL",url:n.url},delete i.url),n.searchSetting&&n.searchSetting.length&&(i.searchSetting=u.a.handleSearchSetting(n.searchSetting,n.layerType)),void 0!==n.opacity&&(i.opacity=n.opacity)),e.layers.push(window.cloneDeep(i))}}),this),f.a.vectorLayers.sort((function(e,t){return e.layerInfo.zIndex-t.layerInfo.zIndex})),f.a.vectorLayers.forEach((function(a){var n=a.layerInfo,i={layerType:n.layerType,name:n.name,visible:n.visible,featureType:n.featureType,xyField:n.xyField,legendSetting:n.legendSetting,projection:n.projection||f.a.getBaseLayerProj(),opacity:n.opacity,enableFields:n.enableFields,captions:n.captions};n.popupInfo&&u.a.isSupportPopupConfig(n.layerType)&&(i.popupInfo=n.popupInfo);var r,s=a.getStyleParameters();if(i.layerType===g.r.DATAFLOW?i.pointStyle=window.cloneDeep(s.style):i.layerType===g.r.MIGRATION?i=Object.assign({},i,s):(i.style=window.cloneDeep(s.style),r=window.cloneDeep(s.outlineStyle)),n.searchSetting&&n.searchSetting.length&&(i.searchSetting=u.a.handleSearchSetting(n.searchSetting,n.layerType)),n.visibleScale&&(i.visibleScale={maxScale:u.a.formatScale(n.visibleScale.maxScale),minScale:u.a.formatScale(n.visibleScale.minScale)}),i.layerType!==g.r.DATAFLOW&&i.layerType!==g.r.DATAFLOWHEAT&&n.autoUpdateTime&&(i.autoUpdateTime=n.autoUpdateTime),i.xyField&&!i.xyField.xField&&delete i.xyField,i.style&&i.style.symbolType&&delete i.style.symbolType,i.layerType===g.r.MARKER)i.featureType&&delete i.featureType,i.style&&delete i.style,i.projection&&delete i.projection;else if(i.layerType===g.r.DATAFLOW){i.pointStyle&&i.pointStyle.lineDash&&delete i.pointStyle.lineDash,"BASIC_POINT"===i.pointStyle.type?delete i.pointStyle.imageInfo:"SVG_POINT"===i.pointStyle.type?(i.pointStyle.url=i.pointStyle.symbolInfo.url,delete i.pointStyle.symbolInfo,delete i.pointStyle.imageInfo,delete i.pointStyle.fontSize):"SYMBOL_POINT"===i.pointStyle.type&&i.pointStyle.symbolInfo&&(i.pointStyle.className=i.pointStyle.symbolInfo.className,i.pointStyle.name=i.pointStyle.symbolInfo.name,i.pointStyle.unicode=i.pointStyle.symbolInfo.unicode,i.pointStyle.fontSize=2*i.pointStyle.radius+"px",delete i.pointStyle.radius,delete i.pointStyle.lineDash,delete i.pointStyle.symbolInfo);var o=window.cloneDeep(s.dataflowSetting);o&&(o.pathStyle&&o.pathStyle.strokeColor&&(i.lineStyle=o.pathStyle,i.lineStyle.type="LINE",i.lineStyle.lineDash="solid",i.maxPointCount=i.lineStyle.maxPointCount,delete i.lineStyle.maxPointCount,delete i.lineStyle.pathVisible),o.directionField&&(i.directionField=o.directionField)),i.credential={token:n.token},i.url=n.url,i.identifyField=n.identifyField,delete i.xyField,delete i.featureType}else if(i.layerType===g.r.DATAFLOWHEAT)i.url=n.url,i.credential={token:n.token},i.themeSetting=s.themeSetting,i.identifyField=n.identifyField,delete i.xyField,delete i.featureType,delete i.style,delete i.enableFields,i.themeSetting.weight||delete i.themeSetting.weight,i.themeSetting.radius=parseInt(i.themeSetting.radius);else{var l=n.featureType&&n.featureType.toUpperCase();if(l===g.p.POINT){if([g.r.VECTOR,g.r.UNIQUE,g.r.RANGE,g.r.RANK_SYMBOL].includes(i.layerType)&&!i.style.offsetX&&(i.style.offsetX=0),i.style&&i.style.lineDash&&delete i.style.lineDash,"VECTOR"===i.layerType){if("IMAGE_POINT"===i.style.type&&i.style.imageInfo)for(var c in i.style)if(["type","imageInfo","radius","anchor","rotation","offsetX","offsetY"].includes(c)){if("imageInfo"===c){var d=i.style.imageInfo.url;d&&/point_imgs/.test(d)&&!/apps\/dataviz/.test(d)&&!/^(http:|https:)/.test(d)&&(i.style.imageInfo.url="".concat(u.a.getIPortalUrl(),"apps/dataviz/").concat(d)),delete i.style.imageInfo.img}}else delete i.style[c];else"BASIC_POINT"===i.style.type&&i.style.imageInfo?(delete i.style.imageInfo,delete i.style.rotation):"IMAGE_POINT"===i.style.type&&!i.style.imageInfo||"SVG_POINT"===i.style.type&&!i.style.symbolInfo?(i.style.type="BASIC_POINT",delete i.style.imageInfo,delete i.style.symbolInfo,delete i.style.rotation):"SVG_POINT"===i.style.type&&i.style.symbolInfo?t.formatSvgPointStyle(i):i.style.type===g.k.BASIC_POINT&&delete i.style.rotation;delete i.style.symbolOffset,delete i.style.svgOffset,delete i.style.imageOffset}else i.layerType===g.r.UNIQUE&&(i.style.symbolInfo&&(i.style.type===g.k.SYMBOL_POINT?t.formatSymbolStyle(i,s):t.formatSvgPointStyle(i)),delete i.style.symbolOffset,delete i.style.svgOffset,delete i.style.imageOffset);"SYMBOL"===i.layerType?(i.layerType="VECTOR",s.style.symbolInfo&&t.formatSymbolStyle(i,s)):"HEAT"===i.layerType&&delete i.enableFields}else if(l===g.p.LINE||l===g.p.MULTILINESTRING||l===g.p.MULTILINESTRING){for(var h in delete i.style.offsetX,delete i.style.offsetY,i.style)["strokeWidth","lineDash","strokeColor","strokeOpacity"].includes(h)||delete i.style[h];i.style.type=g.p.LINE;var m=i.style.lineDash;r&&["roadPath","pathway"].includes(m)&&(i.style.lineDash="roadPath"===m?"solid":"dash",r.type=g.p.LINE,i.style=[r,i.style])}else l!==g.p.POLYGON&&l!==g.p.REGION&&l!==g.p.MULTIPOLYGON||(i.style&&(delete i.style.offsetX,delete i.style.offsetY),"MARKER"===n.layerType?(delete i.featureType,delete i.style):(n.layerType!==g.r.MIGRATION&&(i.style.type="POLYGON",delete i.style.radius),i.featureType="POLYGON"));if(i.layerType===g.r.RANK_SYMBOL){if("IMAGE_POINT"===i.style.type&&i.style.imageInfo){var y=i.style.imageInfo.url;y&&/point_imgs/.test(y)&&!/apps\/dataviz/.test(y)&&!/^(http:|https:)/.test(y)&&(i.style.imageInfo.url="".concat(u.a.getIPortalUrl(),"apps/dataviz/").concat(y)),delete i.style.imageInfo.img,delete i.style.fillColor,delete i.style.fillOpacity,delete i.style.strokeColor,delete i.style.strokeOpacity,delete i.style.strokeWidth,delete i.style.symbolInfo}else"SVG_POINT"===i.style.type&&i.style.symbolInfo?(i.style.url=i.style.symbolInfo.url,delete i.style.symbolInfo,delete i.style.imageInfo):"SYMBOL_POINT"===i.style.type&&i.style.symbolInfo?(i.style.name=i.style.symbolInfo.name,i.style.unicode=i.style.symbolInfo.unicode,i.style.className=i.style.symbolInfo.className,i.style.fontSize=2*i.style.radius+"px",delete i.style.symbolInfo,delete i.style.imageInfo,delete i.style.radius):(i.style.type="BASIC_POINT",delete i.style.symbolInfo,delete i.style.imageInfo,delete i.style.rotation);delete i.style.symbolOffset,delete i.style.svgOffset,delete i.style.imageOffset}if(i.layerType===g.r.MIGRATION){delete i.xyField,delete i.animationSetting.type,delete i.animationSetting.symbolInfo,delete i.animationSetting.imageInfo;var v=i.animationSetting.symbol;/^image:\/\//.test(v)&&(v=v.substring(8).split("?t=")[0],v=/^(http:|https:)/.test(v)||!/point_imgs/.test(v)||/apps\/dataviz/.test(v)?"image://".concat(v):"image://".concat(u.a.getIPortalUrl(),"apps/dataviz/").concat(v)),i.animationSetting.symbol=v,"XY_FIELD"===i.from.type?(delete i.from.field,delete i.to.field):(delete i.from.xField,delete i.from.yField,delete i.to.xField,delete i.to.yField)}if(s.themeSetting){if(s.style&&!s.style.type){var S=n.featureType;"POINT"===S&&(S="BASIC_POINT"),i.style.type=S}i.themeSetting=window.cloneDeep(s.themeSetting),n.layerType===g.r.RANK_SYMBOL&&("colors"!==i.themeSetting.colorType&&delete i.themeSetting.colors,delete i.themeSetting.colorType);var b=i.themeSetting.customSettings;for(var I in b){var E=b[I];n.layerType===g.r.UNIQUE?b[I]=n.featureType===g.p.POINT?t.formatPointThemeStyle(E):E:(E.color||delete E.color,E.radius||delete E.radius,E.segment?(null!==E.segment.start&&void 0!==E.segment.start||delete E.segment.start,null!==E.segment.end&&void 0!==E.segment.end||delete E.segment.end):delete E.segment)}"HEAT"===n.layerType&&(i.themeSetting.radius=parseInt(i.themeSetting.radius),i.themeSetting.weight||delete i.themeSetting.weight)}}if(s.labelStyle){var T=s.labelStyle,C=p.a.rgbaString2Array(T.backgroundFill),L=T.offsetX,N=T.offsetY,k=T.textBaseline,O=T.textAlign,D=T.outlineColor,w=T.outlineWidth,A=T.placement;i.labelStyle={fill:T.fill,fontFamily:T.fontFamily,labelField:T.labelField,backgroundFill:C,fontSize:T.fontSize,offsetX:L,offsetY:N,textBaseline:k,textAlign:O,outlineColor:D,outlineWidth:w,placement:A}}s.filterCondition&&(i.filterCondition=s.filterCondition);var F=n.dataSource;F&&F.type&&(i.dataSource={type:F.type},F.url?(i.dataSource.url=F.url,F.layerName?i.dataSource.layerName=F.layerName:i.dataSource.dataSourceName=F.dataSourceName,F.serverId&&(i.dataSource.serverId=F.serverId+"",i.dataSource.accessType=F.accessType,delete i.dataSource.url,delete i.dataSource.dataSourceName)):F.serverId?(i.dataSource.serverId=F.serverId+"",i.dataSource.accessType=F.accessType):F.type===g.b.SAMPLE_DATA&&(i.dataSource.name=F.name)),"MARKER"===n.layerType&&(i.serverId=n.serverId,delete i.dataSource,delete i.projection),F&&F.administrativeInfo&&(i.dataSource.administrativeInfo=F.administrativeInfo),e.layers.push(window.cloneDeep(i))}),this)},formatPointThemeStyle:function(e){var t=e.type,a=e.imageInfo,n=e.symbolInfo;return t===g.k.IMAGE_POINT&&a?L.a.getWebMapPointThemeStyle(e,g.k.IMAGE_POINT):t===g.k.BASIC_POINT&&a||t===g.k.IMAGE_POINT&&!a||t===g.k.SVG_POINT&&!n?L.a.getWebMapPointThemeStyle(e,g.k.BASIC_POINT):t===g.k.SVG_POINT&&n?L.a.getWebMapPointThemeStyle(e,g.k.SVG_POINT):t===g.k.SYMBOL_POINT&&n?L.a.getWebMapPointThemeStyle(e,g.k.SYMBOL_POINT):L.a.getWebMapPointThemeStyle(e,g.k.BASIC_POINT)},formatSymbolStyle:function(e,t){var a=t.style.symbolInfo;for(var n in a)e.style[n]=a[n];delete e.style.symbolInfo,e.style.fontSize=2*e.style.radius+"px",delete e.style.radius,e.style.imageInfo&&delete e.style.imageInfo,delete e.style.symbolOffset,delete e.style.svgOffset,delete e.style.imageOffset},formatSvgPointStyle:function(e){e.style.url=e.style.symbolInfo.url,delete e.style.symbolInfo,delete e.style.imageInfo,delete e.style.fontSize},saveData:function(e,t,a){if(e&&0!==e.length){var n=f.a.getGeojsonFromFeature(e,!1);return new Promise((function(e,i){u.a.uploadJsonUnCheckLogin(t,n).then((function(t){a.layerInfo.layerType===g.r.MARKER?a.layerInfo.serverId=t.childID:Object.assign(a.layerInfo.dataSource,{type:g.b.PORTAL_DATA,serverId:t.childID}),a.layerInfo.projection="EPSG:4326",a.layerInfo.type="GEOJSON",u.a.moveFileToDir(t.childID),e()})).catch((function(e){h.a.closeLoadingBox(),"401"===e.info&&h.a.showMessage(window.DataViz.Language.unPermission),i()}))}))}},saveApp:function(e,t,a,n){var i;if(O.appID&&!t){this.saveMapInfo(O.appID,e,t),a.authorizeSetting=n.authorizeSetting,i="".concat(u.a.getIPortalUrl(),"web/maps/").concat(O.appID,".json");var r=u.a.getPostOrPutParams(i);u.a.doFetch(r.requestUrl,{method:r.method,withCredentials:!0,data:a}).then((function(e){})).catch((function(e){}))}else i="".concat(u.a.getIPortalUrl(),"web/maps.json"),u.a.doFetch(i,{method:"POST",withCredentials:!0,data:a}).then((function(a){a.succeed?(n.changeAuthorizeSetting&&n.changeAuthorizeSetting([]),O.saveMapInfo(a.newResourceID,e,t)):(h.a.showMessage(window.DataViz.Language.saveFailed,g.j.ERROR),h.a.closeLoadingBox())})).catch((function(e){h.a.closeLoadingBox(),h.a.showMessage(window.DataViz.Language.noPermission2,g.j.ERROR,5e3)}))},saveMapInfo:function(e,t,a){var n="".concat(u.a.getIPortalUrl(),"web/maps/").concat(e,"/map.json"),i=u.a.getPostOrPutParams(n);u.a.doFetch(i.requestUrl,{method:i.method,withCredentials:!0,data:t}).then((function(n){if(!n.succeed||n.error)throw new Error("");var i=[t.baseLayer].concat(t.layers);E.a.layers=window.cloneDeep(i),O.printMap(e),!O.appID||a?setTimeout((function(){var t="".concat(u.a.getRootUrl(),"apps/dataviz/edit.html?id=").concat(e);h.a.closeLoadingBox(),window.history&&window.history.replaceState?(h.a.showMessage(k.saveSucceed,g.j.SUCCESS),window.history.replaceState(null,"",t),O.appID=e,O.successCallback&&O.successCallback(t)):(h.a.showMessage(k.saveSucceed+k.toBeRefresh,g.j.SUCCESS),window.onbeforeunload=null,window.location.href=t,O.successCallback&&O.successCallback(t))}),1e3):(h.a.closeLoadingBox(),h.a.showMessage(k.saveSucceed,g.j.SUCCESS),O.successCallback&&O.successCallback()),document.title=t.title})).catch((function(e){h.a.closeLoadingBox(),"401"===e?h.a.showMessage(window.DataViz.Language.unPermission):h.a.showMessage(k.saveFailed,g.j.ERROR)}))},printMap:function(e){var t={useCORS:!0,backgroundColor:getComputedStyle(document.body).backgroundColor||"rgba(0, 0, 0,0)"};try{var a=f.a.map.getViewport().childNodes[0];if(!a)return;S()(a,t).then((function(t){if(t){var n=t.toDataURL("image/png"),i=document.createElement("canvas");if(i.width=265,i.height=170,i.getContext){var r=i.getContext("2d"),s=new Image;s.src=n,s.crossOrigin="Anonymous",s.onload=function(t){try{var n=a.clientHeight/170,o=a.clientWidth/265,l=Math.max(n,o),c=(265-a.clientWidth/l)/2,d=(170-a.clientHeight/l)/2;r.drawImage(s,0,0,a.clientWidth,a.clientHeight,c,d,a.clientWidth/l,a.clientHeight/l);var p=r.getImageData(0,0,265,170);r.putImageData(p,0,0);var h=i.toDataURL("image/png");h=h.split(",")[1];var f="".concat(u.a.getIPortalUrl(),"web/maps/").concat(e,"/thumbnail.json"),m=u.a.getPostOrPutParams(f);u.a.doFetch(m.requestUrl,{method:m.method,withCredentials:!0,data:h},!0).then((function(e){})).catch((function(e){}))}catch(t){throw{cutFailed:!0,mapId:e}}}}}})).catch((function(t){throw{cutFailed:!0,mapId:e}}))}catch(e){}}};t.a=O},85:function(e,t,a){"use strict";var n=a(2),i=window.DataViz.Language,r={baseSymbolNames:["catering","cinema","hotel","ktv","shopping","subway","supermarket","taix","ATM","bar","barber","bus","clinic","coffee","depot","drug","email","embassy","golf","hospital","hotpot","kgarten","noodle","park","police","plane","primary","signal","sports","swim","tea","university","WC","bank","authe","community","filling"],moreSymbolNames:["aircraft","ATM","ATM2","Bar","barber-shop","boundary","Box-pin","Bus","Camping-area","Castle","Cemetery","China-Mobile","circle","circle1","circle2","circle3","circle4","circle5","circle6","City","Coffee","Court","cross1","cross2","cross3","Diamond1","Diamond2","Diamond3","Embassy","Entrance","Esri-pin1","Esri-pin2","Exit","Fire-station","Gas-station","Golf-Course","help","Hospital","Hospital2","hotel","House","industrial-park","KFC","Library","MacDonald","mainland","metro","Military","Museum","National-flag","Newspaper-office","Park","Parking-lot","Pentagon1","Pentagon2","Pentagon3","pin","Playground","Post-Office","Procuratorial-Bureau","Push-pin1","Push-pin2","Radio-tower","Restroom","Rounder-Square","Sandy-beach","School","Ship","Shopping-Mall","Sports-competitions","Square","Square1","Square2","Square3","Square4","Square5","Square6","Star","Star1","Star2","Star3","Tear-pin","Tear-pin2","Theatre","Traffic-lights","Train-station","Travel","Triangle1","Triangle2","Triangle3","Triangle4","Triangle5","Triangle6","University","Western-Restaurant","wheelchair","Zoo"],pointStyle:{radius:6,fillColor:"#53C41A",fillOpacity:1,strokeColor:"#0081E2",strokeOpacity:1,strokeWidth:1},lineStyle:{strokeColor:"#0081E2",strokeOpacity:1,strokeWidth:5,lineCap:"round",lineDash:"solid"},polygonStyle:{fillColor:"#53C41A",fillOpacity:.35,strokeColor:"#0081E2",strokeOpacity:1,strokeWidth:3,lineCap:"round",lineDash:"solid"},getSymbolPath:function(e){var t;"base"===e?t="apps/dataviz/static/imgs/markers/"+((window.DataViz.theme||"light")+"/"):t="apps/dataviz/static/imgs/desktop/";return n.a.getRootUrl()+t},getUIConfig:function(e,t){return"Point"===t?[{componentName:"selectColor",type:"fillColor",value:{defaultValue:e.fillColor||this.pointStyle.fillColor},title:i.pointColor},{componentName:"slider",type:"radius",value:{min:1,max:22,defaultValue:e.radius||this.pointStyle.radius,unit:"Px"},title:i.pointRaduis},{componentName:"slider",type:"fillOpacity",value:{min:0,max:100,defaultValue:100*e.fillOpacity||100*this.pointStyle.fillOpacity,unit:"%"},title:i.pointOpacity},{componentName:"selectColor",type:"strokeColor",value:{defaultValue:e.strokeColor||this.pointStyle.strokeColor},title:i.polygonStrokeColor},{componentName:"slider",type:"strokeWidth",value:{min:0,max:20,defaultValue:e.strokeWidth||this.pointStyle.strokeWidth,unit:"Px"},title:i.polygonStrokeWidth},{componentName:"slider",type:"strokeOpacity",value:{min:0,max:100,defaultValue:100*e.strokeOpacity||100*this.pointStyle.strokeWidth,unit:"%"},title:i.polygonStrokeOpacity}]:"LineString"===t?[{componentName:"selectColor",type:"strokeColor",value:{defaultValue:e.strokeColor||this.lineStyle.strokeColor},title:i.lineColor},{componentName:"selectLineDash",type:"lineDash",value:{defaultValue:e.lineDash||this.lineStyle.lineDash},title:i.lineStyle},{componentName:"selectLineCapStyle",type:"lineCap",value:{defaultValue:e.lineCap||this.lineStyle.lineCap},title:i.lineCap},{componentName:"slider",type:"strokeWidth",value:{min:0,max:20,defaultValue:e.strokeWidth||this.lineStyle.strokeWidth,unit:"Px"},title:i.lineWidth},{componentName:"slider",type:"strokeOpacity",value:{min:0,max:100,defaultValue:100*e.strokeOpacity||100*this.lineStyle.strokeOpacity,unit:"%"},title:i.lineOpacity}]:[{componentName:"selectColor",type:"fillColor",value:{defaultValue:e.fillColor||this.polygonStyle.fillColor},title:i.polygonfillColor},{componentName:"slider",type:"fillOpacity",value:{min:0,max:100,defaultValue:100*e.fillOpacity||100*this.polygonStyle.fillOpacity,unit:"%"},title:i.polygonOpacity},{componentName:"selectColor",type:"strokeColor",value:{defaultValue:e.strokeColor||100*this.polygonStyle.fillOpacity},title:i.polygonStrokeColor},{componentName:"selectLineDash",type:"lineDash",value:{defaultValue:e.lineDash||this.polygonStyle.lineDash},title:i.lineDash},{componentName:"lineCap",type:"lineCap",value:{defaultValue:e.lineCap||this.polygonStyle.lineCap},title:i.polygonLineCap},{componentName:"slider",type:"strokeWidth",value:{min:0,max:20,defaultValue:e.strokeWidth||this.polygonStyle.strokeWidth,unit:"Px"},title:i.polygonStrokeWidth},{componentName:"slider",type:"strokeOpacity",value:{min:0,max:100,defaultValue:100*e.strokeOpacity||100*this.polygonStyle.strokeOpacity,unit:"%"},title:i.polygonStrokeOpacity}]}};t.a=r},96:function(e,t,a){"use strict";a(14),a(20);var n=a(7),i=a.n(n),r=a(6),s=a.n(r),o=a(9),l=a.n(o),c=a(8),u=a.n(c),d=a(10),p=a.n(d),h=a(0),f=a.n(h),m=a(153),y=(window.DataViz.Language,function(e){function t(){return i()(this,t),l()(this,u()(t).apply(this,arguments))}return p()(t,e),s()(t,[{key:"componentWillReceiveProps",value:function(e){e.color!==this.props.color&&this.setState({color:e.color})}},{key:"onColorPickerChange",value:function(e){this.props.editor(this.props.type,e.hex,this.props.parentKey)}},{key:"render",value:function(){return"IMAGE_POINT"===this.props.symbolType?null:f.a.createElement("div",{className:"editor-tool point-color"},f.a.createElement("div",{className:"text"},this.props.name),f.a.createElement("div",{className:"icon"},f.a.createElement(m.a,{onColorPickerChange:this.onColorPickerChange.bind(this),color:this.props.color})))}}]),t}(h.Component));t.a=y}});
//# sourceMappingURL=app.js.map